import{r as k,m as te,j as e,S as se}from"./app-Cn0xEGqc.js";import{S as re,H as ie}from"./sidebar-TraE6lS9.js";import{C as le,b as de,c as ne,a as ce}from"./card-DK9aUxTq.js";import{B as h}from"./button-Dpy4lAAW.js";import{I as c}from"./input-D35ZiEHZ.js";import{L as l}from"./label-wZXVEhbR.js";import{S as j,a as g,b as _,c as v,d as m}from"./select-C2F-H1_8.js";import{A as x,a as u}from"./alert-CEkQY_lI.js";import{B as p}from"./badge-CC_msjP7.js";import{D as V,b as z,c as H,d as $}from"./dialog-Dg0PCJFg.js";import{A as oe}from"./arrow-left-UCiXZx5M.js";import{B as M}from"./book-open-DJjHuqrf.js";import{P as me}from"./plus-CYmWZSdn.js";import{C as U}from"./calendar-Cn054-S_.js";import{S as L}from"./square-pen-CsDmbecs.js";import{T as W}from"./trash-2-BOk13Z9G.js";/* empty css            */import"./dropdown-menu-ZeH_xjKC.js";import"./Combination-B0sP4jMS.js";import"./index-CmwvKrYR.js";import"./separator-BLbn8sLt.js";import"./users-D7rl6z4X.js";import"./chevron-right-DC-4WjRP.js";import"./crown-CMeBrk5Y.js";import"./building-2-BBSfZ0tp.js";import"./user-cog-RU_-Z9QG.js";import"./user-check-CvQO1CGp.js";import"./graduation-cap-GMCBALPe.js";import"./notebook-GcjueQ9x.js";import"./chart-no-axes-column-increasing-BHb-2lK6.js";import"./index-Bt1WD5LL.js";import"./index-Df3ABpsR.js";import"./check-B_oxwK-T.js";function Le({user:F,gradingPeriods:y,academicLevels:N}){var P,G;const[R,f]=k.useState(!1),[D,A]=k.useState(null),[J,b]=k.useState(!1),{data:t,setData:s,post:K,put:X,processing:C,reset:q,errors:r}=te({name:"",code:"",type:"quarter",academic_level_id:"",parent_id:null,period_type:"quarter",semester_number:null,weight:1,is_calculated:!1,include_midterm:!1,include_prefinal:!1,start_date:"",end_date:"",sort_order:0,is_active:!0}),Y=()=>{K(route("registrar.academic.grading-periods.store"),{onSuccess:()=>{f(!1),q()}})},I=a=>{A(a),s("name",a.name),s("code",a.code),s("type",a.type),s("academic_level_id",a.academic_level_id.toString()),s("parent_id",a.parent_id||null),s("period_type",a.period_type),s("semester_number",a.semester_number||null),s("weight",a.weight),s("is_calculated",a.is_calculated),s("include_midterm",a.include_midterm),s("include_prefinal",a.include_prefinal),s("start_date",a.start_date),s("end_date",a.end_date),s("sort_order",a.sort_order),s("is_active",a.is_active),b(!0)},Z=()=>{D&&X(route("registrar.academic.grading-periods.update",D.id),{onSuccess:()=>{b(!1),A(null),q()}})},T=a=>{confirm(`Are you sure you want to delete "${a.name}"? This action cannot be undone.`)&&se.delete(route("registrar.academic.grading-periods.destroy",a.id))},S=a=>new Date(a).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),O=a=>a?e.jsx(p,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"}):e.jsx(p,{variant:"secondary",children:"Inactive"}),E=a=>{switch(a){case"elementary":case"junior_highschool":return"quarter";case"senior_highschool":case"college":return"semester";default:return"quarter"}},Q=a=>y.filter(i=>i.academic_level_id===a&&i.type==="semester"&&!i.parent_id).map(i=>({value:i.id.toString(),label:i.name})),B=a=>{const i=N.find(o=>o.id===a);return i&&(i.key==="senior_highschool"||i.key==="college")};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(re,{user:F}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(ie,{user:F}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"mb-4",children:e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>window.history.back(),className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Back"]})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Grading Periods Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Manage grading periods, quarters, and semesters for each academic level."})]}),e.jsx(V,{open:R,onOpenChange:f,children:e.jsxs(z,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(H,{children:e.jsx($,{children:"Create New Grading Period"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"type",children:"Type"}),e.jsxs(j,{value:t.type,onValueChange:a=>s("type",a),children:[e.jsx(g,{children:e.jsx(_,{placeholder:"Select type"})}),e.jsxs(v,{children:[e.jsx(m,{value:"quarter",children:"Quarter"}),e.jsx(m,{value:"semester",children:"Semester"})]})]}),(r==null?void 0:r.type)&&e.jsx(x,{variant:"destructive",children:e.jsx(u,{children:r.type})})]}),e.jsxs("div",{className:"hidden",children:[e.jsx(l,{htmlFor:"academic_level_id",children:"Academic Level"}),e.jsxs(j,{value:t.academic_level_id,onValueChange:a=>s("academic_level_id",a),children:[e.jsx(g,{children:e.jsx(_,{placeholder:"Select academic level"})}),e.jsx(v,{children:N.map(a=>e.jsx(m,{value:a.id.toString(),children:a.name},a.id))})]}),(r==null?void 0:r.academic_level_id)&&e.jsx(x,{variant:"destructive",children:e.jsx(u,{children:r.academic_level_id})})]}),e.jsx("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-4 w-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-medium text-blue-800",children:["Academic Level: ",((P=N.find(a=>a.id.toString()===t.academic_level_id))==null?void 0:P.name)||"Not selected"]})]})}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"name",children:"Name"}),e.jsx(c,{id:"name",value:t.name,onChange:a=>s("name",a.target.value),placeholder:"e.g., First Quarter, First Semester"}),(r==null?void 0:r.name)&&e.jsx(x,{variant:"destructive",children:e.jsx(u,{children:r.name})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"code",children:"Code"}),e.jsx(c,{id:"code",value:t.code,onChange:a=>s("code",a.target.value),placeholder:"e.g., Q1, S1"}),(r==null?void 0:r.code)&&e.jsx(x,{variant:"destructive",children:e.jsx(u,{children:r.code})})]}),t.type==="quarter"&&B(parseInt(t.academic_level_id))&&e.jsxs("div",{children:[e.jsx(l,{htmlFor:"parent_id",children:"Which Semester? (Optional)"}),(()=>{var i;const a=Q(parseInt(t.academic_level_id));return a.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(j,{value:((i=t.parent_id)==null?void 0:i.toString())||"",onValueChange:o=>s("parent_id",o?parseInt(o):null),children:[e.jsx(g,{children:e.jsx(_,{placeholder:"Select parent semester"})}),e.jsx(v,{children:a.map(o=>e.jsx(m,{value:o.value,children:o.label},o.value))})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Select a semester if this quarter belongs to one"})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"p-3 bg-amber-50 border border-amber-200 rounded-md text-sm text-amber-800 dark:bg-amber-900/20 dark:border-amber-800 dark:text-amber-200",children:[e.jsx("p",{className:"font-medium",children:"No semesters available"}),e.jsx("p",{className:"mt-1",children:'To create quarters under a semester, you need to create a semester first. Change the "Type" to "Semester" to create one.'})]})})})(),(r==null?void 0:r.parent_id)&&e.jsx(x,{variant:"destructive",className:"mt-2",children:e.jsx(u,{children:r.parent_id})})]}),t.type==="quarter"&&B(parseInt(t.academic_level_id))&&e.jsxs("div",{children:[e.jsx(l,{children:"Period Type"}),e.jsx("div",{className:"space-y-2 mt-2",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:"period_final",checked:t.period_type==="final",onChange:a=>s("period_type",a.target.checked?"final":"quarter"),className:"rounded border-gray-300 text-blue-600"}),e.jsx(l,{htmlFor:"period_final",className:"text-sm font-normal",children:"Final Average"})]})}),(r==null?void 0:r.period_type)&&e.jsx(x,{variant:"destructive",children:e.jsx(u,{children:r.period_type})})]}),t.period_type==="final"&&t.parent_id&&e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),e.jsx("h5",{className:"font-medium text-yellow-900",children:"Final Average Calculation"})]}),e.jsx("p",{className:"text-sm text-yellow-700 mb-3",children:"Select which quarters from the selected semester should be included in the final average calculation:"}),e.jsx("div",{className:"space-y-2",children:(()=>{console.log("Debug - data.parent_id:",t.parent_id),console.log("Debug - gradingPeriods:",y);const a=y.filter(i=>i.parent_id===t.parent_id&&i.period_type!=="final");return console.log("Debug - semesterQuarters found:",a),a.length===0?e.jsxs("div",{className:"text-sm text-yellow-600 italic",children:["No quarters found in the selected semester. Please create Midterm and Pre-Final periods first.",e.jsx("br",{}),e.jsxs("small",{children:["Debug: parent_id = ",t.parent_id,", total periods = ",y.length]})]}):a.map(i=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`include_${i.id}`,checked:!!t[`include_${i.period_type}`],onChange:o=>s(`include_${i.period_type}`,o.target.checked),className:"rounded border-gray-300"}),e.jsxs(l,{htmlFor:`include_${i.id}`,className:"text-sm",children:["Include ",i.name," Grade"]})]},i.id))})()}),e.jsxs("div",{className:"mt-3 p-2 bg-yellow-100 rounded text-xs text-yellow-800",children:[e.jsx("strong",{children:"Calculation:"})," Final Average = (Selected Quarters) รท Number of Selected Quarters"]})]}),t.type==="quarter"&&t.period_type!=="final"&&e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"weight",children:"Grade Contribution (%)"}),e.jsx(c,{id:"weight",type:"number",step:"0.01",value:t.weight,onChange:a=>s("weight",parseFloat(a.target.value)||0),min:"0",max:"1",placeholder:"0.50 = 50%"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"How much this period contributes to final grade (0.50 = 50%, 1.00 = 100%)"}),(r==null?void 0:r.weight)&&e.jsx(x,{variant:"destructive",children:e.jsx(u,{children:r.weight})})]}),e.jsxs("div",{className:"flex items-start space-x-2 pt-6",children:[e.jsx("input",{id:"is_calculated",type:"checkbox",checked:t.is_calculated,onChange:a=>s("is_calculated",a.target.checked),className:"rounded border-gray-300 mt-1"}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"is_calculated",className:"text-sm font-medium",children:"Auto-Calculated Grade"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"System will automatically calculate this grade from other periods"})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"start_date",children:"Start Date"}),e.jsx(c,{id:"start_date",type:"date",value:t.start_date,onChange:a=>s("start_date",a.target.value)}),(r==null?void 0:r.start_date)&&e.jsx(x,{variant:"destructive",children:e.jsx(u,{children:r.start_date})})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"end_date",children:"End Date"}),e.jsx(c,{id:"end_date",type:"date",value:t.end_date,onChange:a=>s("end_date",a.target.value)}),(r==null?void 0:r.end_date)&&e.jsx(x,{variant:"destructive",children:e.jsx(u,{children:r.end_date})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"sort_order",children:"Sort Order"}),e.jsx(c,{id:"sort_order",type:"number",value:t.sort_order,onChange:a=>s("sort_order",parseInt(a.target.value)||0),min:"0"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx("input",{id:"is_active",type:"checkbox",checked:t.is_active,onChange:a=>s("is_active",a.target.checked),className:"rounded border-gray-300"}),e.jsx(l,{htmlFor:"is_active",children:"Active"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>f(!1),children:"Cancel"}),e.jsx(h,{onClick:Y,disabled:C,children:C?"Creating...":"Create"})]})]})]})}),e.jsx("div",{className:"space-y-4",children:N.map(a=>{const i=y.filter(d=>d.academic_level_id===a.id),o=i.filter(d=>!d.parent_id),ee=i.filter(d=>d.parent_id);return e.jsxs(le,{children:[e.jsx(de,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(ne,{className:"flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5"}),a.name,e.jsx(p,{variant:"outline",className:"ml-2",children:E(a.key)==="quarter"?"Quarter-based":"Semester-based"})]}),e.jsxs(h,{className:"flex items-center gap-2",onClick:()=>{a.key==="elementary"||a.key==="junior_highschool"?s({...t,academic_level_id:a.id.toString(),type:"quarter",period_type:"quarter",parent_id:null,semester_number:null}):s({...t,academic_level_id:a.id.toString(),type:"semester",period_type:"quarter",parent_id:null,semester_number:1}),f(!0)},children:[e.jsx(me,{className:"h-4 w-4"}),a.key==="elementary"||a.key==="junior_highschool"?"Add Quarter":"Add Semester/Quarter"]})]})}),e.jsx(ce,{children:i.length===0?e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No grading periods defined for this level."}):e.jsx("div",{className:"space-y-4",children:o.sort((d,w)=>d.sort_order-w.sort_order).map(d=>{const w=ee.filter(n=>n.parent_id===d.id);return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-lg bg-gray-50 dark:bg-gray-800",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"font-medium",children:d.name}),e.jsx(p,{variant:"outline",children:d.code}),d.is_calculated&&e.jsx(p,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:"Calculated"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[S(d.start_date)," - ",S(d.end_date)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[O(d.is_active),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>I(d),children:e.jsx(L,{className:"h-4 w-4"})}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>T(d),className:"text-red-600 hover:text-red-700",children:e.jsx(W,{className:"h-4 w-4"})})]})]}),w.length>0&&e.jsx("div",{className:"ml-6 space-y-2",children:w.sort((n,ae)=>n.sort_order-ae.sort_order).map(n=>e.jsxs("div",{className:"flex items-center justify-between p-2 border rounded-lg bg-gray-100 dark:bg-gray-700 border-l-4 border-l-blue-300",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-3 w-3 text-blue-400"}),e.jsx("span",{className:"text-sm font-medium",children:n.name}),e.jsx(p,{variant:"outline",className:"text-xs",children:n.code}),n.is_calculated&&e.jsx(p,{variant:"secondary",className:"bg-yellow-100 text-yellow-800 text-xs",children:"Calculated"}),e.jsx(p,{variant:"outline",className:"text-xs",children:n.period_type})]}),e.jsxs("div",{className:"text-xs text-gray-500",children:[S(n.start_date)," - ",S(n.end_date)]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[O(n.is_active),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>I(n),className:"h-7 px-2",children:e.jsx(L,{className:"h-3 w-3"})}),e.jsx(h,{variant:"outline",size:"sm",onClick:()=>T(n),className:"text-red-600 hover:text-red-700 h-7 px-2",children:e.jsx(W,{className:"h-3 w-3"})})]})]},n.id))})]},d.id)})})})]},a.id)})})]})})]}),e.jsx(V,{open:J,onOpenChange:b,children:e.jsxs(z,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(H,{children:e.jsx($,{children:"Edit Grading Period"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_name",children:"Name"}),e.jsx(c,{id:"edit_name",value:t.name,onChange:a=>s("name",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_code",children:"Code"}),e.jsx(c,{id:"edit_code",value:t.code,onChange:a=>s("code",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_academic_level_id",children:"Academic Level"}),e.jsxs(j,{value:t.academic_level_id,onValueChange:a=>s("academic_level_id",a),children:[e.jsx(g,{children:e.jsx(_,{})}),e.jsx(v,{children:N.map(a=>e.jsx(m,{value:a.id.toString(),children:a.name},a.id))})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_type",children:"Type"}),e.jsxs(j,{value:t.type,onValueChange:a=>s("type",a),children:[e.jsx(g,{children:e.jsx(_,{placeholder:"Select type"})}),e.jsxs(v,{children:[e.jsx(m,{value:"quarter",children:"Quarter"}),e.jsx(m,{value:"semester",children:"Semester"})]})]})]}),t.type==="semester"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_period_type",children:"Period Type"}),e.jsxs(j,{value:t.period_type,onValueChange:a=>s("period_type",a),children:[e.jsx(g,{children:e.jsx(_,{placeholder:"Select period type"})}),e.jsxs(v,{children:[e.jsx(m,{value:"quarter",children:"Semester"}),e.jsx(m,{value:"midterm",children:"Midterm"}),e.jsx(m,{value:"prefinal",children:"Pre-Final"}),e.jsx(m,{value:"final",children:"Final Average"})]})]})]}),t.period_type!=="quarter"&&e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_parent_id",children:"Parent Semester"}),e.jsxs(j,{value:((G=t.parent_id)==null?void 0:G.toString())||"",onValueChange:a=>s("parent_id",a?parseInt(a):null),children:[e.jsx(g,{children:e.jsx(_,{placeholder:"Select parent semester"})}),e.jsx(v,{children:Q(parseInt(t.academic_level_id)).map(a=>e.jsx(m,{value:a.value,children:a.label},a.value))})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_semester_number",children:"Semester Number"}),e.jsx(c,{id:"edit_semester_number",type:"number",value:t.semester_number||"",onChange:a=>s("semester_number",a.target.value?parseInt(a.target.value):null),min:"1",max:"2"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_weight",children:"Weight"}),e.jsx(c,{id:"edit_weight",type:"number",step:"0.01",value:t.weight,onChange:a=>s("weight",parseFloat(a.target.value)||0),min:"0",max:"1"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx("input",{id:"edit_is_calculated",type:"checkbox",checked:t.is_calculated,onChange:a=>s("is_calculated",a.target.checked),className:"rounded border-gray-300"}),e.jsx(l,{htmlFor:"edit_is_calculated",children:"Calculated Period"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_start_date",children:"Start Date"}),e.jsx(c,{id:"edit_start_date",type:"date",value:t.start_date,onChange:a=>s("start_date",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_end_date",children:"End Date"}),e.jsx(c,{id:"edit_end_date",type:"date",value:t.end_date,onChange:a=>s("end_date",a.target.value)})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"edit_sort_order",children:"Sort Order"}),e.jsx(c,{id:"edit_sort_order",type:"number",value:t.sort_order,onChange:a=>s("sort_order",parseInt(a.target.value)||0),min:"0"})]}),e.jsxs("div",{className:"flex items-center space-x-2 pt-6",children:[e.jsx("input",{id:"edit_is_active",type:"checkbox",checked:t.is_active,onChange:a=>s("is_active",a.target.checked),className:"rounded border-gray-300"}),e.jsx(l,{htmlFor:"edit_is_active",children:"Active"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(h,{variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsx(h,{onClick:Z,disabled:C,children:C?"Updating...":"Update"})]})]})]})})]})}export{Le as default};
