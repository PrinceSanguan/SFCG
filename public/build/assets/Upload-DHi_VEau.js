import{r as u,m as O,j as e,$ as q,d as z,C as J}from"./app-CRXmIzOw.js";import{C as S,b as C,c as w,a as k}from"./card-_Ap0jbej.js";import{B as y}from"./button-CEeFs4wn.js";import{I as f}from"./input-Dpz5SRWa.js";import{L as m}from"./label-hnV3NXgg.js";import{S as F,a as D,b as A,c as U,d as V}from"./select-BClAMGs7.js";import{A as I,a as L}from"./alert-qlisOIvT.js";import{S as M,H as Q}from"./sidebar-BbXQDPYj.js";import{U as T}from"./upload-B2yPQQAh.js";import{F as W}from"./file-text-FozttAkA.js";import{D as X}from"./download-3MKhiCng.js";/* empty css            */import"./index-Df_ITiGZ.js";import"./Combination-CrMD9hR8.js";import"./index-Zt2TxXUI.js";import"./index-cf71jPO-.js";import"./check-7T-d3Z8W.js";import"./dropdown-menu-CqDM_Kh6.js";import"./user-CEQUT7FY.js";import"./log-out-Dy8xh3V7.js";import"./book-open-DdJFhINy.js";import"./graduation-cap-D2HbUvmj.js";import"./crown-CGEntCbm.js";function be({user:_,assignedSubjects:o,academicLevels:x,gradingPeriods:j}){const p=u.useRef(null),[i,v]=u.useState(null),[b,n]=u.useState(0),[h,g]=u.useState(!1),{data:r,setData:t,post:G,processing:B,errors:l,reset:E}=O({csv_file:null,subject_id:"",academic_level_id:"",school_year:"",year_of_study:""});if(!o||!Array.isArray(o)||!x||!Array.isArray(x)||!j||!Array.isArray(j))return e.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects and academic data."}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(o)]})]})})});const H=s=>{var c;const a=(c=s.target.files)==null?void 0:c[0];a&&(v(a),t("csv_file",a))},$=s=>{var c;t("subject_id",s);const a=o.find(d=>d.subject.id.toString()===s);if(a){console.log("Subject selected:",{subjectId:s,subject:a.subject.name,academicLevel:a.academicLevel.name,gradingPeriod:((c=a.gradingPeriod)==null?void 0:c.name)||"None",schoolYear:a.school_year}),t("academic_level_id",a.academicLevel.id.toString()),t("school_year",a.school_year);const d=j.filter(Y=>Y.academic_level_id.toString()===a.academicLevel.id.toString());console.log("Available grading periods for academic level:",d)}},P=s=>{if(s.preventDefault(),!i)return;g(!0),n(0);const a=new FormData;a.append("csv_file",i),a.append("subject_id",r.subject_id),a.append("academic_level_id",r.academic_level_id),a.append("school_year",r.school_year),a.append("year_of_study",r.year_of_study||"");const c=setInterval(()=>{n(d=>d>=90?(clearInterval(c),90):d+10)},200);G(route("teacher.grades.upload.store"),a,{forceFormData:!0,onSuccess:()=>{n(100),setTimeout(()=>{g(!1),n(0),v(null),E(),p.current&&(p.current.value="")},1e3)},onError:()=>{g(!1),n(0)}})},R=()=>{const s=N(),a=route("teacher.grades.template")+"?academic_level="+s;console.log("Downloading CSV template for academic level:",s),window.open(a,"_blank")},N=()=>{const s=x.find(a=>a.id.toString()===r.academic_level_id);return(s==null?void 0:s.key)||"college"},K=N()==="college";return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(M,{user:_}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(Q,{user:_}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Grades CSV"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Bulk upload student grades using a CSV file"})]}),e.jsx(q,{href:route("teacher.grades.index"),children:e.jsx(y,{variant:"outline",children:"Back to Grades"})})]}),e.jsxs(S,{className:"max-w-2xl",children:[e.jsx(C,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Upload Grades CSV"]})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"csv_file",children:"CSV File"}),e.jsx("div",{className:"mt-2",children:e.jsx(f,{id:"csv_file",ref:p,type:"file",accept:".csv,.txt",onChange:H,className:"cursor-pointer",disabled:h})}),i&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(W,{className:"h-4 w-4"}),i.name," (",(i.size/1024).toFixed(1)," KB)"]}),l.csv_file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.csv_file})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"subject_id",children:"Subject *"}),e.jsxs(F,{value:r.subject_id,onValueChange:$,children:[e.jsx(D,{className:l.subject_id?"border-red-500":"",children:e.jsx(A,{placeholder:"Select a subject"})}),e.jsx(U,{children:o.map(s=>e.jsxs(V,{value:s.subject.id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.id))})]}),l.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.subject_id})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"academic_level_id",children:"Academic Level *"}),e.jsxs(F,{value:r.academic_level_id,onValueChange:s=>t("academic_level_id",s),children:[e.jsx(D,{className:l.academic_level_id?"border-red-500":"",children:e.jsx(A,{placeholder:"Select academic level"})}),e.jsx(U,{children:x.map(s=>e.jsx(V,{value:s.id.toString(),children:s.name},s.id))})]}),l.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"school_year",children:"School Year *"}),e.jsx(f,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:r.school_year,onChange:s=>t("school_year",s.target.value),className:l.school_year?"border-red-500":""}),l.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.school_year})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(f,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1",value:r.year_of_study,onChange:s=>t("year_of_study",s.target.value),className:l.year_of_study?"border-red-500":""}),l.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.year_of_study})]}),e.jsxs(I,{children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("strong",{children:"Grade System:"})," ",K?"College uses 1.0-5.0 scale (1.0 highest, 3.0 passing)":"Elementary to Senior High uses 75-100 scale (75 passing)"]})]}),h&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Uploading... ",b,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${b}%`}})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(y,{type:"submit",disabled:B||h||!i||!r.subject_id||!r.academic_level_id||!r.school_year,className:"flex-1",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),h?"Uploading...":"Upload Grades"]}),e.jsxs(y,{type:"button",variant:"outline",onClick:R,className:"flex-1",children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})]})})]}),e.jsxs(S,{children:[e.jsx(C,{children:e.jsx(w,{children:"CSV Format Instructions"})}),e.jsxs(k,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Required Columns:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Grade Values:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"College:"})," 1.0 to 5.0 (3.0 = passing)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Elementary/Senior High:"})," 75 to 100 (75 = passing)"]})]})]})]}),e.jsxs(I,{children:[e.jsx(J,{className:"h-4 w-4 text-green-600"}),e.jsxs(L,{children:[e.jsx("strong",{children:"Tip:"})," Download the template to see the exact format. The system will automatically detect existing grades and update them, or create new ones if they don't exist."]})]})]})]})]})})]})]})}export{be as default};
