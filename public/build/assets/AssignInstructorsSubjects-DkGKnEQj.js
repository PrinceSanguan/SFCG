import{r as o,j as s,$ as P,S as z}from"./app-BcMbUOyL.js";import{S as ce,H as oe}from"./sidebar-Dn4u4m5X.js";import{C as W,a as K,b as ne,c as de}from"./card-Bk2OfYCK.js";import{B as T}from"./badge-K8H9M4lL.js";import{B as j}from"./button-DLdAtO11.js";import{I as Q}from"./input-DufYmIPg.js";import{L as _}from"./label-D14go-_e.js";import{S as b,a as A,b as I,c as N,d as v}from"./select-DfuM06rf.js";import{T as ue}from"./textarea-BgoMUww7.js";import{D as me,b as he,c as _e,d as ge}from"./dialog-COio5f6h.js";import{A as fe}from"./arrow-left-BqpYomqK.js";import{B as X}from"./book-open-DyiePNY1.js";import{P as xe}from"./plus-DI9jxdgN.js";import{U as pe}from"./user-qhjkqW_K.js";import{C as je}from"./calendar-DyKqYuBF.js";import{U as ve}from"./users-BLtwl422.js";import{S as Re}from"./square-pen-BI0-W-kz.js";import{T as Se}from"./trash-2-D5Mmi5nC.js";/* empty css            */import"./dropdown-menu-Dtu71WjG.js";import"./Combination-DHRJhgOO.js";import"./index-CpyyUAg9.js";import"./separator-DMqbdZPP.js";import"./chevron-right-DlWNQpY3.js";import"./crown-D-hxzwMc.js";import"./building-2-CzaHmrsm.js";import"./user-cog-77De7lAI.js";import"./user-check-DPOfzT5h.js";import"./graduation-cap-ZWh-LsIt.js";import"./notebook-5NekX0qq.js";import"./chart-no-axes-column-increasing-BUUtZVYC.js";import"./index-Vfnx9PJj.js";import"./index-Nroa_FiD.js";import"./check-C3W7Vz7J.js";function cs({user:O,assignments:Z,instructors:ee,subjects:C,sections:g,academicLevels:f,gradingPeriods:se}){const[G,te]=o.useState(""),[d,k]=o.useState(""),[p,J]=o.useState(""),[m,w]=o.useState(""),[R,L]=o.useState(""),[F,x]=o.useState([]),[$,E]=o.useState([]),[ye,V]=o.useState([]),[be,D]=o.useState([]),[Ae,Y]=o.useState([]),[Ie,M]=o.useState([]),[le,S]=o.useState(!1),[y,B]=o.useState(null),[n,h]=o.useState({instructor_id:"",subject_id:"",section_id:"",academic_level_id:"",grading_period_id:"",school_year:"2024-2025",notes:"",auto_enroll_students:!0});o.useEffect(()=>{if(!d){V([]),D([]),Y([]),M([]);return}const e=parseInt(d),l=f.find(t=>t.id===e);if(!l)return;let i=g.filter(t=>t.academic_level_id===e);if(p&&(i=i.filter(t=>t.specific_year_level===p)),l.key==="college"){const t=new Map;if(i.forEach(r=>{r.department&&r.department_id&&t.set(r.department_id,r.department)}),V(Array.from(t.values())),m){const r=new Map;i.filter(a=>{var c;return((c=a.department_id)==null?void 0:c.toString())===m}).forEach(a=>{a.course&&a.course_id&&r.set(a.course_id,a.course)}),D(Array.from(r.values()))}else D([])}else if(l.key==="senior_highschool"){const t=new Map;if(i.forEach(r=>{r.track&&r.track_id&&t.set(r.track_id,r.track)}),Y(Array.from(t.values())),m){const r=new Map;i.filter(a=>{var c;return((c=a.track_id)==null?void 0:c.toString())===m}).forEach(a=>{a.strand&&a.strand_id&&r.set(a.strand_id,a.strand)}),M(Array.from(r.values()))}else M([])}},[d,p,m,g,f]),o.useEffect(()=>{if(!d){E([]);return}const e=parseInt(d),l=f.find(t=>t.id===e);if(!l){E([]);return}let i=g.filter(t=>t.academic_level_id===e);if(p&&(i=i.filter(t=>t.specific_year_level===p)),l.key==="college"){if(m){const t=parseInt(m);i=i.filter(r=>r.department_id===t)}if(R){const t=parseInt(R);i=i.filter(r=>r.course_id===t)}}if(l.key==="senior_highschool"){if(m){const t=parseInt(m);i=i.filter(r=>r.track_id===t)}if(R){const t=parseInt(R);i=i.filter(r=>r.strand_id===t)}}console.log("Filtered sections:",i),E(i)},[d,p,m,R,g,f]),o.useEffect(()=>{if(console.log("====== SUBJECT FILTERING START ======"),console.log("[REGISTRAR] formData.section_id:",n.section_id),console.log("[REGISTRAR] selectedAcademicLevel:",d),console.log("[REGISTRAR] Total subjects available:",C.length),!n.section_id||!d){console.log("[REGISTRAR] CLEARING subjects - no section or academic level selected"),console.log("[REGISTRAR] formData.section_id empty?",!n.section_id),console.log("[REGISTRAR] selectedAcademicLevel empty?",!d),x([]),console.log("====== SUBJECT FILTERING END (CLEARED) ======");return}const e=g.find(r=>r.id.toString()===n.section_id);if(console.log("[REGISTRAR] Selected Section:",{id:e==null?void 0:e.id,name:e==null?void 0:e.name,course_id:e==null?void 0:e.course_id,department_id:e==null?void 0:e.department_id,track_id:e==null?void 0:e.track_id,strand_id:e==null?void 0:e.strand_id,specific_year_level:e==null?void 0:e.specific_year_level,academic_level_id:e==null?void 0:e.academic_level_id}),!e){console.log("[REGISTRAR] CLEARING subjects - section not found in sections array"),x([]),console.log("====== SUBJECT FILTERING END (NO SECTION) ======");return}const l=parseInt(d),i=f.find(r=>r.id===l);if(console.log("[REGISTRAR] Selected Academic Level:",{id:i==null?void 0:i.id,name:i==null?void 0:i.name,key:i==null?void 0:i.key}),!i){console.log("[REGISTRAR] CLEARING subjects - academic level not found"),x([]),console.log("====== SUBJECT FILTERING END (NO LEVEL) ======");return}console.log("[REGISTRAR] Starting subject filtering with academic_level_id:",l);let t=C.filter(r=>r.academic_level_id===l);if(console.log("[REGISTRAR] After academic level filter:",t.length,"subjects"),i.key==="college"&&e.course_id){console.log("[REGISTRAR] Applying College-specific filtering"),console.log("[REGISTRAR] Section course_id:",e.course_id),console.log("[REGISTRAR] Section year level:",e.specific_year_level);const r=t.length;t=t.filter(a=>{const c=a.course_id===e.course_id,u=a.college_year_level;if(console.log(`[REGISTRAR] Subject "${a.name}":`,{subject_course_id:a.course_id,matchesCourse:c,college_year_level:u,section_year_level:e.specific_year_level}),u&&e.specific_year_level){const q=c&&u===e.specific_year_level;return console.log(`[REGISTRAR] Result (with year level): ${q}`),q}return console.log(`[REGISTRAR] Result (course only): ${c}`),c}),console.log(`[REGISTRAR] After College filter: ${t.length} subjects (was ${r})`)}if(i.key==="senior_highschool"){console.log("[REGISTRAR] Applying SHS-specific filtering"),console.log("[REGISTRAR] Section year level:",e.specific_year_level);const r=t.length;t=t.filter(a=>{const c=a.shs_year_level;if(console.log(`[REGISTRAR] Subject "${a.name}":`,{shs_year_level:c,section_year_level:e.specific_year_level}),c&&e.specific_year_level){const u=c===e.specific_year_level;return console.log(`[REGISTRAR] Result: ${u}`),u}return console.log("[REGISTRAR] Result (no year level check): true"),!0}),console.log(`[REGISTRAR] After SHS filter: ${t.length} subjects (was ${r})`)}if(i.key==="junior_highschool"){console.log("[REGISTRAR] Applying JHS-specific filtering"),console.log("[REGISTRAR] Section year level:",e.specific_year_level);const r=t.length;t=t.filter(a=>{const c=a.jhs_year_level;if(console.log(`[REGISTRAR] Subject "${a.name}":`,{jhs_year_level:c,section_year_level:e.specific_year_level}),c&&e.specific_year_level){const u=c===e.specific_year_level;return console.log(`[REGISTRAR] Result: ${u}`),u}return console.log("[REGISTRAR] Result (no year level check): true"),!0}),console.log(`[REGISTRAR] After JHS filter: ${t.length} subjects (was ${r})`)}if(i.key==="elementary"){console.log("[REGISTRAR] Applying Elementary-specific filtering"),console.log("[REGISTRAR] Section year level:",e.specific_year_level);const r=t.length;t=t.filter(a=>{const c=a.selected_grade_level;if(console.log(`[REGISTRAR] Subject "${a.name}":`,{selected_grade_level:c,section_year_level:e.specific_year_level}),c&&e.specific_year_level){const u=c===e.specific_year_level;return console.log(`[REGISTRAR] Result: ${u}`),u}return console.log("[REGISTRAR] Result (no year level check): true"),!0}),console.log(`[REGISTRAR] After Elementary filter: ${t.length} subjects (was ${r})`)}console.log("[REGISTRAR] FINAL filtered subjects COUNT:",t.length),console.log("[REGISTRAR] FINAL filtered subjects:",t.map(r=>({id:r.id,name:r.name,code:r.code,course_id:r.course_id,academic_level_id:r.academic_level_id}))),console.log("====== SUBJECT FILTERING END ======"),x(t)},[n.section_id,d,C,g,f]);const re=e=>{e.preventDefault();const l=y?`/registrar/academic/assign-instructors-subjects/${y.id}`:"/registrar/academic/assign-instructors-subjects",i=y?"put":"post";z.visit(l,{method:i,data:n,onSuccess:()=>{S(!1),B(null),U()}})},ie=e=>{var i;B(e);const l=g.find(t=>t.id===e.section_id);h({instructor_id:e.instructor_id.toString(),subject_id:e.subject_id.toString(),section_id:e.section_id.toString(),academic_level_id:e.academic_level_id.toString(),grading_period_id:((i=e.grading_period_id)==null?void 0:i.toString())||"",school_year:e.school_year,notes:e.notes||"",auto_enroll_students:e.auto_enroll_students||!0}),k(e.academic_level_id.toString()),l&&(J(l.specific_year_level||""),l.department_id?w(l.department_id.toString()):l.track_id&&w(l.track_id.toString()),l.course_id?L(l.course_id.toString()):l.strand_id&&L(l.strand_id.toString())),S(!0)},ae=e=>{confirm("Are you sure you want to delete this assignment?")&&z.delete(`/registrar/academic/assign-instructors-subjects/${e.id}`)},U=()=>{h({instructor_id:"",subject_id:"",section_id:"",academic_level_id:"",grading_period_id:"",school_year:"2024-2025",notes:"",auto_enroll_students:!0}),k(""),J(""),w(""),L(""),E([]),x([]),B(null)},H=Z.filter(e=>{var i;const l=G.toLowerCase();return e.instructor.name.toLowerCase().includes(l)||e.subject.name.toLowerCase().includes(l)||((i=e.subject.course)==null?void 0:i.name.toLowerCase().includes(l))||!1||e.academicLevel.name.toLowerCase().includes(l)});return s.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[s.jsx(ce,{user:O}),s.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[s.jsx(oe,{user:O}),s.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:s.jsxs("div",{className:"flex flex-col gap-6",children:[s.jsxs("div",{className:"flex items-center gap-4",children:[s.jsxs(P,{href:"/registrar/academic",className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 dark:text-gray-400 dark:hover:text-gray-100",children:[s.jsx(fe,{className:"h-4 w-4"}),"Back to Academic Management"]}),s.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Assign Instructors (Subjects)"})]}),s.jsx(W,{className:"bg-blue-50 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800",children:s.jsx(K,{className:"p-4",children:s.jsxs("div",{className:"flex items-start gap-3",children:[s.jsx(X,{className:"h-5 w-5 text-blue-600 mt-0.5"}),s.jsxs("div",{children:[s.jsx("h3",{className:"font-medium text-blue-900 dark:text-blue-100",children:"Instructor Subject Assignments"}),s.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300 mt-1",children:"Manage instructor assignments by subject and section. Select the academic level, choose the subject, then select the section. When an instructor is assigned to a section's subject, all students enrolled in that section will automatically be assigned to that instructor."})]})]})})}),s.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[s.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:s.jsx("div",{className:"relative",children:s.jsx(Q,{placeholder:"Search assignments...",value:G,onChange:e=>te(e.target.value),className:"w-full sm:w-64"})})}),s.jsxs(j,{onClick:()=>{U(),S(!0)},className:"flex items-center gap-2",children:[s.jsx(xe,{className:"h-4 w-4"}),"Assign Instructor"]})]}),s.jsxs(W,{children:[s.jsx(ne,{children:s.jsxs(de,{className:"flex items-center justify-between",children:[s.jsx("span",{children:"Instructor Subject Assignments"}),s.jsxs("span",{className:"text-sm text-muted-foreground",children:[H.length," assignments"]})]})}),s.jsx(K,{children:H.length>0?s.jsx("div",{className:"space-y-4",children:H.map(e=>s.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx(pe,{className:"h-5 w-5 text-gray-400"}),s.jsxs("div",{children:[s.jsx("p",{className:"font-medium",children:e.instructor.name}),s.jsxs("p",{className:"text-sm text-muted-foreground",children:[e.subject.name,e.subject.course&&s.jsxs(s.Fragment,{children:[" • ",e.subject.course.name]}),e.section&&s.jsxs(s.Fragment,{children:[" • Section ",e.section.name]})]}),s.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[s.jsx(T,{variant:"outline",className:"text-xs",children:e.academicLevel.name}),e.subject.course&&s.jsx(T,{variant:"outline",className:"text-xs",children:e.subject.course.code}),e.section&&s.jsx(T,{variant:"outline",className:"text-xs",children:e.section.code||e.section.name})]})]})]})}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(je,{className:"h-4 w-4 text-gray-400"}),s.jsx("span",{className:"text-sm text-muted-foreground",children:e.school_year})]}),s.jsx(T,{variant:e.is_active?"default":"secondary",className:e.is_active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800",children:e.is_active?"Active":"Inactive"}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx(j,{variant:"outline",size:"sm",asChild:!0,children:s.jsxs(P,{href:route("registrar.assign-instructors-subjects.students",e.id),children:[s.jsx(ve,{className:"h-4 w-4 mr-2"}),"Manage Students"]})}),s.jsx(j,{variant:"outline",size:"sm",onClick:()=>ie(e),children:s.jsx(Re,{className:"h-4 w-4"})}),s.jsx(j,{variant:"outline",size:"sm",className:"text-red-600 hover:text-red-700",onClick:()=>ae(e),children:s.jsx(Se,{className:"h-4 w-4"})})]})]})]},e.id))}):s.jsxs("div",{className:"text-center py-8",children:[s.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:G?"No assignments found matching your search.":"No instructor subject assignments have been created yet."})]})})]})]})})]}),s.jsx(me,{open:le,onOpenChange:S,children:s.jsxs(he,{className:"max-w-2xl",children:[s.jsx(_e,{children:s.jsx(ge,{children:y?"Edit Instructor Assignment":"Assign Instructor to Subject"})}),s.jsxs("form",{onSubmit:re,className:"space-y-4",children:[s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(_,{htmlFor:"instructor_id",children:"Instructor"}),s.jsxs(b,{value:n.instructor_id,onValueChange:e=>h(l=>({...l,instructor_id:e})),required:!0,children:[s.jsx(A,{children:s.jsx(I,{placeholder:"Select instructor"})}),s.jsx(N,{children:ee.map(e=>s.jsx(v,{value:e.id.toString(),children:e.name},e.id))})]})]}),s.jsxs("div",{children:[s.jsx(_,{htmlFor:"academic_level_id",children:"Academic Level"}),s.jsxs(b,{value:n.academic_level_id,onValueChange:e=>{console.log("[REGISTRAR] Academic level changed to:",e),x([]),h(l=>({...l,academic_level_id:e,section_id:"",subject_id:""})),k(e)},required:!0,children:[s.jsx(A,{children:s.jsx(I,{placeholder:"Select academic level"})}),s.jsx(N,{children:f.map(e=>s.jsx(v,{value:e.id.toString(),children:e.name},e.id))})]})]})]}),s.jsxs("div",{children:[s.jsx(_,{htmlFor:"section_id",children:"Section *"}),s.jsxs(b,{value:n.section_id,onValueChange:e=>{console.log("[REGISTRAR] Section changed to:",e),console.log("[REGISTRAR] Immediately clearing filteredSubjects"),x([]),h(l=>({...l,section_id:e,subject_id:""}))},disabled:!d||$.length===0,required:!0,children:[s.jsx(A,{children:s.jsx(I,{placeholder:"Select section"})}),s.jsx(N,{children:$.map(e=>s.jsxs(v,{value:e.id.toString(),children:[e.name,e.code?` (${e.code})`:""]},e.id))})]}),d&&$.length===0&&s.jsx("p",{className:"text-sm text-amber-600 mt-1",children:"No sections available for this academic level. Please add sections first."})]}),n.section_id&&s.jsxs("div",{children:[s.jsx(_,{htmlFor:"subject_id",children:"Subject *"}),s.jsxs(b,{value:n.subject_id,onValueChange:e=>h(l=>({...l,subject_id:e})),disabled:F.length===0,required:!0,children:[s.jsx(A,{children:s.jsx(I,{placeholder:"Select subject"})}),s.jsx(N,{children:F.map(e=>s.jsx(v,{value:e.id.toString(),children:s.jsxs("div",{className:"flex flex-col",children:[s.jsxs("span",{children:[e.name," (",e.code,")"]}),e.course&&s.jsxs("span",{className:"text-xs text-muted-foreground",children:["Course: ",e.course.name]})]})},e.id))})]}),F.length===0&&s.jsx("p",{className:"text-sm text-amber-600 mt-1",children:"No subjects available for the selected section. Please add subjects first."})]}),s.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[s.jsxs("div",{children:[s.jsx(_,{htmlFor:"grading_period_id",children:"Grading Period"}),s.jsxs(b,{value:n.grading_period_id,onValueChange:e=>h(l=>({...l,grading_period_id:e})),children:[s.jsx(A,{children:s.jsx(I,{placeholder:"Select grading period (optional)"})}),s.jsxs(N,{children:[s.jsx(v,{value:"",children:"No grading period"}),se.map(e=>s.jsx(v,{value:e.id.toString(),children:e.name},e.id))]})]})]}),s.jsxs("div",{children:[s.jsx(_,{htmlFor:"school_year",children:"School Year"}),s.jsx(Q,{id:"school_year",type:"text",value:n.school_year,onChange:e=>h(l=>({...l,school_year:e.target.value})),placeholder:"e.g., 2024-2025",required:!0})]})]}),s.jsxs("div",{children:[s.jsx(_,{htmlFor:"notes",children:"Notes"}),s.jsx(ue,{id:"notes",value:n.notes,onChange:e=>h(l=>({...l,notes:e.target.value})),placeholder:"Additional notes about this assignment...",rows:3})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsx("input",{type:"checkbox",id:"auto_enroll_students",checked:n.auto_enroll_students,onChange:e=>h(l=>({...l,auto_enroll_students:e.target.checked})),className:"rounded border-gray-300"}),s.jsx(_,{htmlFor:"auto_enroll_students",className:"text-sm",children:"Automatically enroll all students in this academic level to this subject"})]}),s.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[s.jsx(j,{type:"button",variant:"outline",onClick:()=>{S(!1),U()},children:"Cancel"}),s.jsx(j,{type:"submit",children:y?"Update Assignment":"Assign Instructor"})]})]})]})})]})}export{cs as default};
