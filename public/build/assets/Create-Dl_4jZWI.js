import{m as z,r as M,j as e,$ as I}from"./app-LFmCwQs4.js";import{S as J,H as O}from"./sidebar-uLzoiQ7w.js";import{C as H,b as P,c as U,a as Y}from"./card-Du5Zuvvl.js";import{B as _}from"./button-q-k0Gzds.js";import{I as w}from"./input-DRJKSLgj.js";import{L as u}from"./label-Z_3mgN2p.js";import{S as p,a as f,b as v,c as y,d as m,e as R,f as V}from"./select-Df-Q7b--.js";import{A as Q}from"./arrow-left-tvhpYfec.js";import{P as W}from"./plus-BvYlqu37.js";import{S as K}from"./save-7sFcLMXe.js";/* empty css            */import"./dropdown-menu-CupMV0JZ.js";import"./Combination-CUXWXmFE.js";import"./index-BXtOgEtf.js";import"./user-DTWuFLX5.js";import"./settings-B0O-cITn.js";import"./log-out-Dw6vUkbM.js";import"./book-open-BiaHYmTh.js";import"./graduation-cap-BMkVYWob.js";import"./upload-xLSixZvc.js";import"./crown-CkG6bS2C.js";import"./index-Dcpox2Pr.js";import"./index-5l68TK6Y.js";import"./check-BODRduL2.js";function be({user:L,academicLevels:b,gradingPeriods:h,assignedSubjects:g,selectedStudent:j}){var G,F,k,A;const{data:n,setData:d,post:D,processing:S,errors:t}=z({student_id:"",subject_id:"",academic_level_id:"",grading_period_id:"0",school_year:"2024-2025",year_of_study:"",grade:""});M.useEffect(()=>{var i;console.log("Grading periods received from backend:",{count:h.length,periods:h.map(c=>({id:c.id,name:c.name,code:c.code,academic_level_id:c.academic_level_id,type:c.type,parent_id:c.parent_id}))});const r=new URLSearchParams(window.location.search),s=r.get("student_id"),x=r.get("subject_id"),o=r.get("academic_level_id"),a=r.get("academic_level_key"),l=r.get("school_year");if(s&&x&&o){d("student_id",s),d("subject_id",x),d("academic_level_id",o),d("school_year",l||"2024-2025"),d("year_of_study",""),d("grade",""),a&&b.find(q=>q.id.toString()===o)&&d("academic_level_id",o);const c=h.filter(E=>E.academic_level_id.toString()===o);console.log("Available grading periods for auto-populated student:",c);const $=window.location.pathname;window.history.replaceState({},"",$)}else j&&(d("student_id",j.id.toString()),d("subject_id",((i=j.subjectId)==null?void 0:i.toString())||""),d("academic_level_id",j.academicLevelKey||""),d("school_year","2024-2025"),d("year_of_study",""),d("grade",""))},[j,d,h,b]);const T=r=>{if(!r)return null;for(const s of g)if(s.enrolled_students.find(o=>o.student.id.toString()===r))return{subjectId:s.subject.id,academicLevelId:s.academicLevel.id,academicLevelKey:s.academicLevel.key,schoolYear:s.school_year};return null},B=r=>{if(d("student_id",r),r){const s=T(r);if(s){console.log("Student selected:",{studentId:r,subjectId:s.subjectId,academicLevelId:s.academicLevelId,academicLevelKey:s.academicLevelKey,schoolYear:s.schoolYear}),d("subject_id",s.subjectId.toString()),d("academic_level_id",s.academicLevelId.toString()),d("school_year",s.schoolYear);const x=h.filter(o=>o.academic_level_id===s.academicLevelId);console.log("Available grading periods for selected student:",x)}}else d("subject_id",""),d("academic_level_id",""),d("grade","")},C=r=>{r.preventDefault(),D(route("teacher.grades.store"),{onSuccess:()=>{},onError:s=>{}})},N=n.student_id&&n.subject_id&&n.academic_level_id;return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(J,{user:L}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(O,{user:L}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(I,{href:route("teacher.grades.index"),children:e.jsxs(_,{variant:"outline",size:"sm",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Back to Grades"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:N?"Input Grade":"Input New Grade"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:N?"Enter a grade for the selected student.":"Enter a new grade for a student in your assigned course."})]})]})}),e.jsxs(H,{className:"max-w-2xl",children:[e.jsx(P,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"Grade Information"]})}),e.jsx(Y,{children:N?e.jsxs("form",{onSubmit:C,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Student Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Student:"}),e.jsx("p",{className:"font-medium",children:((F=(G=g.find(r=>r.enrolled_students.some(s=>s.student.id.toString()===n.student_id)))==null?void 0:G.enrolled_students.find(r=>r.student.id.toString()===n.student_id))==null?void 0:F.student.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Subject:"}),e.jsx("p",{className:"font-medium",children:((k=g.find(r=>r.subject.id.toString()===n.subject_id))==null?void 0:k.subject.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Academic Level:"}),e.jsx("p",{className:"font-medium",children:((A=b.find(r=>r.id.toString()===n.academic_level_id))==null?void 0:A.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"School Year:"}),e.jsx("p",{className:"font-medium",children:n.school_year})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"grade",children:"Grade"}),e.jsx(w,{id:"grade",type:"number",step:"1",min:"75",max:"100",placeholder:"Enter grade (75-100)",value:n.grade,onChange:r=>{const s=r.target.value;d("grade",s),s&&console.log("[SHS_GRADE_INPUT] Grade changed:",{grade:parseFloat(s),scale:"75-100"})},className:t.grade?"border-red-500":"",autoFocus:!0}),t.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.grade}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Senior High School: 75 (passing) to 100 (highest). Use whole numbers or decimals."})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(p,{value:n.grading_period_id,onValueChange:r=>d("grading_period_id",r),children:[e.jsx(f,{className:t.grading_period_id?"border-red-500":"",children:e.jsx(v,{placeholder:"Select grading period"})}),e.jsxs(y,{children:[e.jsx(m,{value:"0",children:"No Period"}),h&&h.length>0?e.jsx(e.Fragment,{children:(()=>{const r=parseInt(n.academic_level_id),s=h.filter(a=>a.academic_level_id===r);if(s.length===0)return e.jsx(m,{value:"none",disabled:!0,children:"No grading periods available for this academic level"});const x=s.filter(a=>a.parent_id===null&&a.type==="semester"),o=s.filter(a=>a.parent_id!==null&&a.period_type!=="final");if(x.length>0){const a=x.sort((l,i)=>l.sort_order-i.sort_order).map(l=>({parent:l,children:o.filter(i=>i.parent_id===l.id).sort((i,c)=>i.sort_order-c.sort_order)}));return e.jsx(e.Fragment,{children:a.map(({parent:l,children:i})=>i.length>0&&e.jsxs(R,{children:[e.jsx(V,{children:l.name}),i.map(c=>e.jsx(m,{value:c.id.toString(),children:c.name},c.id))]},l.id))})}return e.jsx(e.Fragment,{children:s.sort((a,l)=>a.sort_order-l.sort_order).map(a=>e.jsx(m,{value:a.id.toString(),children:a.name},a.id))})})()}):e.jsx(m,{value:"none",disabled:!0,children:"No grading periods available"})]})]}),t.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.grading_period_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select which grading period this grade belongs to"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(_,{type:"submit",disabled:S,className:"flex-1",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),S?"Saving...":"Save Grade"]}),e.jsx(I,{href:route("teacher.grades.index"),className:"flex-1",children:e.jsx(_,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]}):e.jsxs("form",{onSubmit:C,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"student_id",children:"Student"}),e.jsxs(p,{value:n.student_id,onValueChange:B,children:[e.jsx(f,{className:t.student_id?"border-red-500":"",children:e.jsx(v,{placeholder:"Select a student"})}),e.jsx(y,{children:g.flatMap(r=>r.enrolled_students.map(s=>e.jsxs(m,{value:s.student.id.toString(),children:[s.student.name," - ",r.subject.name]},s.student.id)))})]}),t.student_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.student_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select a student from your assigned subjects"})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"subject_id",children:"Subject"}),e.jsxs(p,{value:n.subject_id,onValueChange:r=>d("subject_id",r),children:[e.jsx(f,{className:t.subject_id?"border-red-500":"",children:e.jsx(v,{placeholder:"Select a subject"})}),e.jsx(y,{children:g.map(r=>e.jsxs(m,{value:r.subject.id.toString(),children:[r.subject.name," (",r.subject.code,")",r.subject.course&&` - ${r.subject.course.name}`]},r.subject.id))})]}),t.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.subject_id})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"academic_level_id",children:"Academic Level"}),e.jsxs(p,{value:n.academic_level_id,onValueChange:r=>d("academic_level_id",r),children:[e.jsx(f,{className:t.academic_level_id?"border-red-500":"",children:e.jsx(v,{placeholder:"Select academic level"})}),e.jsx(y,{children:b.map(r=>e.jsx(m,{value:r.id.toString(),children:r.name},r.id))})]}),t.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(p,{value:n.grading_period_id,onValueChange:r=>d("grading_period_id",r),children:[e.jsx(f,{children:e.jsx(v,{placeholder:"Select grading period (optional)"})}),e.jsxs(y,{children:[e.jsx(m,{value:"0",children:"No Period"}),h&&h.length>0?e.jsx(e.Fragment,{children:(()=>{const r=parseInt(n.academic_level_id);if(!r)return null;const s=h.filter(a=>a.academic_level_id===r);if(s.length===0)return e.jsx(m,{value:"none",disabled:!0,children:"No grading periods available for this academic level"});const x=s.filter(a=>a.parent_id===null&&a.type==="semester"),o=s.filter(a=>a.parent_id!==null&&a.period_type!=="final");if(x.length>0){const a=x.sort((l,i)=>l.sort_order-i.sort_order).map(l=>({parent:l,children:o.filter(i=>i.parent_id===l.id).sort((i,c)=>i.sort_order-c.sort_order)}));return e.jsx(e.Fragment,{children:a.map(({parent:l,children:i})=>i.length>0&&e.jsxs(R,{children:[e.jsx(V,{children:l.name}),i.map(c=>e.jsx(m,{value:c.id.toString(),children:c.name},c.id))]},l.id))})}return e.jsx(e.Fragment,{children:s.sort((a,l)=>a.sort_order-l.sort_order).map(a=>e.jsx(m,{value:a.id.toString(),children:a.name},a.id))})})()}):null]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(u,{htmlFor:"school_year",children:"School Year"}),e.jsx(w,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:n.school_year,onChange:r=>d("school_year",r.target.value),className:t.school_year?"border-red-500":""}),t.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.school_year})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(w,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1, 2, 3, 4",value:n.year_of_study,onChange:r=>d("year_of_study",r.target.value),className:t.year_of_study?"border-red-500":""}),t.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.year_of_study}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Required for college level"})]})]}),e.jsxs("div",{children:[e.jsx(u,{htmlFor:"grade",children:"Grade"}),e.jsx(w,{id:"grade",type:"number",step:"1",min:"75",max:"100",placeholder:"Enter grade (75-100)",value:n.grade,onChange:r=>{const s=r.target.value;d("grade",s),s&&console.log("[SHS_GRADE_INPUT] Grade changed:",{grade:parseFloat(s),scale:"75-100"})},className:t.grade?"border-red-500":""}),t.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.grade}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Senior High School: 75 (passing) to 100 (highest). Use whole numbers or decimals."})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(_,{type:"submit",disabled:S,className:"flex-1",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),S?"Saving...":"Save Grade"]}),e.jsx(I,{href:route("teacher.grades.index"),className:"flex-1",children:e.jsx(_,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]})})]}),e.jsxs(H,{children:[e.jsx(P,{children:e.jsx(U,{children:"Help & Guidelines"})}),e.jsx(Y,{children:e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Student:"})," Select a student from your assigned subjects"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Subject:"})," Automatically populated when student is selected"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Grade Scale:"})," Senior High School uses 75-100 percentage scale (75 passing, 100 highest)"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Validation:"})," Grades are automatically submitted for validation after saving"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Editing:"})," You can edit grades before they are validated by the registrar"]})]})})]})]})})]})]})}export{be as default};
