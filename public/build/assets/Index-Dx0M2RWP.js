import{r,m as ce,u as de,j as e,$ as B,S as H}from"./app-Dx1SMQx2.js";import{S as oe,H as me}from"./sidebar-CqXtZ4Hq.js";import{C as I,b as K,c as Y,a as q}from"./card-9go3GCLh.js";import{B as m}from"./button-BMSLlibz.js";import{I as he}from"./input-De4gOnZ0.js";import{B as xe}from"./badge-BlkZpHlP.js";import{P as pe}from"./PasswordResetModal-bNth8D5v.js";import{S as f,a as u,b as j,c as g,d as S}from"./select-Be94Qdml.js";import{D as fe,b as ue,c as je,d as ge,e as Se,f as Ne}from"./dialog-DcZcggc3.js";import{S as ve}from"./search-hWCGN70W.js";import{U as G}from"./upload-CxSM2vKk.js";import{U as be}from"./users-BHrFzUaQ.js";import{E as _e}from"./eye-Ch0Ezh7p.js";import{S as Ce}from"./square-pen-e8Gh2Gyl.js";import{K as we}from"./key-CQgUl1J1.js";import{T as ke}from"./trash-2-BwHzXP6R.js";import{D as Ue}from"./download-g0XsWs-u.js";/* empty css            */import"./dropdown-menu-moJO61D9.js";import"./Combination-Cc0sQ3xl.js";import"./index-BgjEcbCf.js";import"./separator--4xyZcsD.js";import"./chevron-right-BWQ3Pm6q.js";import"./crown-BXjQ_I8d.js";import"./building-2-GzRLd-Ou.js";import"./user-cog-M9Cqtx7p.js";import"./book-open-DUfRk0-3.js";import"./user-check-wcs0I_Bj.js";import"./graduation-cap-ZwcQlNCd.js";import"./notebook-C3Mio5Mt.js";import"./chart-no-axes-column-increasing-DcOICOUk.js";import"./label-BKRGNydM.js";import"./alert-BvWkEjz0.js";import"./rotate-ccw-C8-1bRaE.js";import"./index-dtBCCdfF.js";import"./index-D5BKAJ9M.js";import"./check-BjWljo-6.js";function hs({user:E,users:N,filters:w,roles:ye,currentRole:p,yearLevel:l,sections:O=[],specificYearLevels:k={},tracks:R=[],strands:b=[],departments:J=[],courses:_=[]}){const[v,U]=r.useState(null),[y,z]=r.useState(null),[Q,D]=r.useState(!1),[t,C]=r.useState(""),[c,V]=r.useState(""),[i,$]=r.useState(""),[d,T]=r.useState(""),[n,F]=r.useState(""),[o,P]=r.useState(""),{delete:W}=ce(),M=r.useRef(null),{addToast:h}=de(),X=r.useMemo(()=>i&&b.length>0?b.filter(s=>s.track_id===parseInt(i)):b,[i,b]),Z=r.useMemo(()=>n&&_.length>0?_.filter(s=>s.department_id===parseInt(n)):_,[n,_]),L=r.useMemo(()=>{let s=O;return t&&(l==="elementary"||l==="junior_highschool")&&(s=s.filter(a=>a.specific_year_level===t)),l==="senior_highschool"&&(i&&(s=s.filter(a=>a.track_id===parseInt(i))),d&&(s=s.filter(a=>a.strand_id===parseInt(d))),t&&(s=s.filter(a=>a.specific_year_level===t))),l==="college"&&(n&&(s=s.filter(a=>a.department_id===parseInt(n))),o&&(s=s.filter(a=>a.course_id===parseInt(o))),t&&(s=s.filter(a=>a.specific_year_level===t))),s},[t,i,d,n,o,O,l]);r.useEffect(()=>{V("")},[t,i,d,n,o]),r.useEffect(()=>{T("")},[i]),r.useEffect(()=>{P("")},[n]);const ee=s=>{U(s)},se=s=>{z(s)},le=()=>{if(!c&&(l==="elementary"||l==="junior_highschool")){h("Please select a grade level and section first.","error");return}if(!c&&l==="senior_highschool"){h("Please select track, strand, and section first.","error");return}if(!c&&l==="college"){h("Please select department, course, year level, and section first.","error");return}const s={};l&&(s.academic_level=l),t&&(s.specific_year_level=t),i&&(s.track_id=i),d&&(s.strand_id=d),n&&(s.department_id=n),o&&(s.course_id=o),c&&(s.section_id=c),window.location.href=route("registrar.students.template",s),h("Downloading CSV template...","success")},ae=()=>{var s;if(!c&&(l==="elementary"||l==="junior_highschool")){h("Please select a grade level and section first.","error");return}if(!c&&l==="senior_highschool"){h("Please select track, strand, and section first.","error");return}if(!c&&l==="college"){h("Please select department, course, year level, and section first.","error");return}(s=M.current)==null||s.click()},te=()=>{var s;l?D(!0):(s=M.current)==null||s.click()},re=s=>{var A;const a=(A=s.target.files)==null?void 0:A[0];if(!a)return;const x=new FormData;x.append("file",a),l&&x.append("academic_level",l),t&&x.append("specific_year_level",t),i&&x.append("track_id",i),d&&x.append("strand_id",d),n&&x.append("department_id",n),o&&x.append("course_id",o),c&&x.append("section_id",c),H.post(route("registrar.students.upload"),x,{forceFormData:!0,onSuccess:()=>{h("Students CSV uploaded successfully.","success"),D(!1),C(""),V(""),$(""),T(""),F(""),P(""),H.reload()},onError:ne=>{console.error("CSV upload failed:",ne),h("CSV upload failed. Please check the file format.","error")},preserveScroll:!0}),s.target.value=""},ie=()=>{if(v){let s;p&&p!=="student"?s=route(`registrar.${p}s.destroy`,v.id):l?s=route("registrar.students.destroy",v.id):s=route("registrar.users.destroy",v.id),W(s,{onSuccess:()=>{U(null)}})}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(oe,{user:E}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(me,{user:E}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:l?`${l.charAt(0).toUpperCase()+l.slice(1).replace("_"," ")} Students`:p?`${p.charAt(0).toUpperCase()+p.slice(1)} Management`:"User Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:l?`Manage ${l.replace("_"," ")} student accounts.`:"Manage user accounts and permissions."})]}),e.jsxs(I,{children:[e.jsx(K,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5"}),"Search & Filters"]})}),e.jsx(q,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsx("div",{className:"flex-1",children:e.jsx(he,{placeholder:"Search users by name or email...",defaultValue:(w==null?void 0:w.search)||""})}),e.jsx(m,{children:"Search"})]}),l&&e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end w-full lg:w-auto",children:[e.jsx("input",{type:"file",accept:".csv,text/csv",ref:M,className:"hidden",onChange:re}),e.jsxs(m,{variant:"outline",className:"flex items-center gap-2",onClick:te,children:[e.jsx(G,{className:"h-4 w-4"}),"CSV Upload Manager"]})]})]})})]}),e.jsxs(I,{children:[e.jsx(K,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(be,{className:"h-5 w-5"}),"Users (",N.total,")"]})}),e.jsxs(q,{children:[e.jsxs("div",{className:"space-y-4",children:[N.data.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.year_level&&e.jsx("p",{className:"text-xs text-gray-400 capitalize",children:s.year_level.replace("_"," ")})]}),e.jsx(xe,{variant:"secondary",children:s.user_role})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(B,{href:route("registrar.users.show",s.id),children:e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"View"]})}),e.jsx(B,{href:route("registrar.users.edit",s.id),children:e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Edit"]})}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>se(s),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"Reset Password"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>ee(s),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]},s.id)),N.data.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No users found."})})]}),N.last_page>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("div",{className:"flex gap-2",children:Array.from({length:N.last_page},(s,a)=>a+1).map(s=>e.jsx(m,{variant:s===N.current_page?"default":"outline",size:"sm",children:s},s))})})]})]})]})})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Confirm Delete"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete ",e.jsx("strong",{children:v.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(m,{variant:"outline",onClick:()=>U(null),children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:ie,children:"Delete User"})]})]})}),y&&e.jsx(pe,{user:y,isOpen:!!y,onClose:()=>z(null),routeName:p?`registrar.${p}s.reset-password`:"registrar.users.reset-password"}),e.jsx(fe,{open:Q,onOpenChange:D,children:e.jsxs(ue,{className:"sm:max-w-[500px]",children:[e.jsxs(je,{children:[e.jsx(ge,{children:"CSV Upload Manager"}),e.jsx(Se,{children:l==="senior_highschool"?"Select the track, strand, year level, and section first, then download the template and upload your CSV file.":l==="college"?"Select the department, course, year level, and section first, then download the template and upload your CSV file.":"Select the grade level and section first, then download the template and upload your CSV file."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[(l==="elementary"||l==="junior_highschool")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Grade Level"}),e.jsxs(f,{value:t,onValueChange:C,children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Select grade level"})}),e.jsx(g,{children:Object.entries(k).map(([s,a])=>e.jsx(S,{value:s,children:a},s))})]})]}),l==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Track"}),e.jsxs(f,{value:i,onValueChange:$,children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Select track"})}),e.jsx(g,{children:R.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),l==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Strand"}),e.jsxs(f,{value:d,onValueChange:T,disabled:!i,children:[e.jsx(u,{children:e.jsx(j,{placeholder:i?"Select strand":"Select track first"})}),e.jsx(g,{children:X.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),l==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(f,{value:t,onValueChange:C,disabled:!d,children:[e.jsx(u,{children:e.jsx(j,{placeholder:d?"Select year level":"Select strand first"})}),e.jsx(g,{children:Object.entries(k).map(([s,a])=>e.jsx(S,{value:s,children:a},s))})]})]}),l==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Department"}),e.jsxs(f,{value:n,onValueChange:F,children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Select department"})}),e.jsx(g,{children:J.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),l==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Course"}),e.jsxs(f,{value:o,onValueChange:P,disabled:!n,children:[e.jsx(u,{children:e.jsx(j,{placeholder:n?"Select course":"Select department first"})}),e.jsx(g,{children:Z.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),l==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(f,{value:t,onValueChange:C,disabled:!o,children:[e.jsx(u,{children:e.jsx(j,{placeholder:o?"Select year level":"Select course first"})}),e.jsx(g,{children:Object.entries(k).map(([s,a])=>e.jsx(S,{value:s,children:a},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Section"}),e.jsxs(f,{value:c,onValueChange:V,disabled:l==="elementary"||l==="junior_highschool"||l==="senior_highschool"||l==="college"?!t:!d,children:[e.jsx(u,{children:e.jsx(j,{placeholder:l==="elementary"||l==="junior_highschool"?t?"Select section":"Select grade level first":l==="senior_highschool"||l==="college"?t?"Select section":"Select year level first":d?"Select section":"Select track and strand first"})}),e.jsx(g,{children:L.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),c&&e.jsxs("div",{className:"rounded-md bg-blue-50 p-3 text-sm text-blue-900 dark:bg-blue-950 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"Next Steps:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'Click "Download Template" to get the CSV file'}),e.jsx("li",{children:"Fill in student information (do NOT modify Student ID column)"}),e.jsx("li",{children:'Click "Upload CSV" to import the students'})]})]})]}),e.jsxs(Ne,{className:"flex gap-2",children:[e.jsxs(m,{variant:"outline",onClick:le,disabled:!c,children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Download Template"]}),e.jsxs(m,{onClick:ae,disabled:!c,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Upload CSV"]})]})]})})]})}export{hs as default};
