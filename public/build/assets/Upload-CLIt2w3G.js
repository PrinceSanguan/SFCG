import{r as h,m as z,j as e,$ as q,d as Q,C as X}from"./app-BzEPTIoL.js";import{C as D,b as U,c as I,a as T}from"./card-CtdnIBEg.js";import{B as _}from"./button-DhTuWpqg.js";import{I as S}from"./input-CjymmR-3.js";import{L as n}from"./label-mLCU927r.js";import{S as v,a as N,b as C,c as w,d as m}from"./select-D3ZNOYG1.js";import{A as M,a as E}from"./alert-BsZySlRl.js";import{S as Z,H as ee}from"./sidebar-BXX0se0d.js";import{U as G}from"./upload-B4O8QRJC.js";import{F as se}from"./file-text-DU9Czi7i.js";import{D as L}from"./download-Bz0l5jra.js";/* empty css            */import"./index-DJ8MkIIO.js";import"./Combination-CGVAPLwg.js";import"./index-DrjCr65r.js";import"./index-Bjtkehhu.js";import"./check-D5GHb6D8.js";import"./dropdown-menu-WnjX4XqU.js";import"./user-C-aC-ud8.js";import"./log-out-B4JbvLX1.js";import"./book-open-BYol5jvf.js";import"./graduation-cap-DtMV-QBO.js";import"./crown-fBr0M5iI.js";function we({user:k,assignedSubjects:j,academicLevels:f,gradingPeriods:c}){const b=h.useRef(null),[u,F]=h.useState(null),[V,x]=h.useState(0),[g,y]=h.useState(!1),{data:l,setData:o,post:O,processing:A,errors:a,reset:B}=z({csv_file:null,subject_id:"",academic_level_id:"",grading_period_id:"",school_year:"",year_of_study:""}),P=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];t&&(F(t),o("csv_file",t))},R=s=>{o("subject_id",s);const t=j.find(r=>r.subject_id.toString()===s);t&&(o("academic_level_id",t.academicLevel.id.toString()),o("school_year",t.school_year),t.gradingPeriod&&o("grading_period_id",t.gradingPeriod.id.toString()))},$=s=>{if(s.preventDefault(),!u)return;y(!0),x(0);const t=setInterval(()=>{x(r=>r>=90?(clearInterval(t),90):r+10)},200);O(route("instructor.grades.upload.store"),{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{clearInterval(t),x(100),setTimeout(()=>{y(!1),x(0),F(null),B(),b.current&&(b.current.value="")},1e3)},onError:()=>{clearInterval(t),y(!1),x(0)}})},H=()=>{window.open(route("instructor.grades.template"),"_blank")},J=()=>{if(!l.subject_id||!l.school_year){alert("Please select a subject and enter school year first");return}const s=route("instructor.grades.subject-template")+`?subject_id=${l.subject_id}&school_year=${encodeURIComponent(l.school_year)}`;window.open(s,"_blank")},K=(()=>{const s=f.find(t=>t.id.toString()===l.academic_level_id);return(s==null?void 0:s.key)||"college"})()==="college",W=h.useMemo(()=>{var d,p;if(!l.subject_id)return console.log("Upload: No subject selected, returning all periods"),c;const s=j.find(i=>i.subject_id.toString()===l.subject_id);if(!s)return console.log("Upload: No assignment found for subject_id:",l.subject_id),c;const t=s.grading_period_ids||((d=s.subject)==null?void 0:d.grading_period_ids)||[];if(console.log("=== Upload Grading Period Filtering ==="),console.log("Selected subject:",(p=s.subject)==null?void 0:p.name),console.log("Assignment grading_period_ids:",t),console.log("All grading periods:",c.length),t.length===0)return console.log("Upload: No grading_period_ids assigned, showing all periods"),c;const r=c.filter(i=>t.includes(i.id));return console.log("Upload: Filtered grading periods:",r.length,r.map(i=>({id:i.id,name:i.name}))),r},[l.subject_id,j,c]);return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Z,{user:k}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(ee,{user:k}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Grades CSV"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Bulk upload student grades using a CSV file"})]}),e.jsx(q,{href:route("instructor.grades.index"),children:e.jsx(_,{variant:"outline",children:"Back to Grades"})})]}),e.jsxs(D,{className:"max-w-2xl",children:[e.jsx(U,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Upload Grades CSV"]})}),e.jsx(T,{children:e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"csv_file",children:"CSV File"}),e.jsx("div",{className:"mt-2",children:e.jsx(S,{id:"csv_file",ref:b,type:"file",accept:".csv,.txt",onChange:P,className:"cursor-pointer",disabled:g})}),u&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(se,{className:"h-4 w-4"}),u.name," (",(u.size/1024).toFixed(1)," KB)"]}),a.csv_file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.csv_file})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"subject_id",children:"Subject (Optional for multi-subject CSV)"}),e.jsxs(v,{value:l.subject_id,onValueChange:R,children:[e.jsx(N,{className:a.subject_id?"border-red-500":"",children:e.jsx(C,{placeholder:"Select a subject (or leave blank for multi-subject CSV)"})}),e.jsx(w,{children:j.map(s=>e.jsxs(m,{value:s.subject_id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.id))})]}),a.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.subject_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Leave blank to upload grades for multiple subjects. Include Subject Code column in your CSV."})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"academic_level_id",children:"Academic Level (Optional for multi-subject CSV)"}),e.jsxs(v,{value:l.academic_level_id,onValueChange:s=>o("academic_level_id",s),children:[e.jsx(N,{className:a.academic_level_id?"border-red-500":"",children:e.jsx(C,{placeholder:"Select academic level (optional)"})}),e.jsx(w,{children:f.map(s=>e.jsx(m,{value:s.id.toString(),children:s.name},s.id))})]}),a.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(v,{value:l.grading_period_id,onValueChange:s=>o("grading_period_id",s),children:[e.jsx(N,{className:a.grading_period_id?"border-red-500":"",children:e.jsx(C,{placeholder:"Select grading period (optional)"})}),e.jsxs(w,{children:[e.jsx(m,{value:"0",children:"No Period"}),(()=>{const s=f.find(r=>r.id.toString()===l.academic_level_id),t=W.filter(r=>r.academic_level_id.toString()===l.academic_level_id);return(s==null?void 0:s.key)==="college"?t.filter(d=>(d.code==="COL_S1"||d.code==="COL_S2")&&!d.code.includes("_")).map(d=>{const p=t.filter(i=>i.code.startsWith(d.code+"_")&&!i.code.includes("_FA")).sort((i,Y)=>i.sort_order-Y.sort_order);return e.jsxs("div",{children:[e.jsx(m,{value:d.id.toString(),className:"font-semibold",children:d.name}),p.map(i=>e.jsxs(m,{value:i.id.toString(),className:"pl-6 text-sm",children:["• ",i.name]},i.id))]},d.id)}):t.filter(r=>!r.name.toLowerCase().includes("final average")).sort((r,d)=>r.sort_order-d.sort_order).map(r=>e.jsx(m,{value:r.id.toString(),children:r.name},r.id))})()]})]}),a.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.grading_period_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"school_year",children:"School Year *"}),e.jsx(S,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:l.school_year,onChange:s=>o("school_year",s.target.value),className:a.school_year?"border-red-500":""}),a.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.school_year})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(S,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1",value:l.year_of_study,onChange:s=>o("year_of_study",s.target.value),className:a.year_of_study?"border-red-500":""}),a.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.year_of_study})]}),e.jsxs(M,{children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsxs(E,{children:[e.jsx("strong",{children:"Grade System:"})," ",K?"College uses 1.0-5.0 scale (1.0 highest, 3.0 passing)":"Elementary to Senior High uses 75-100 scale (75 passing)"]})]}),g&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Uploading... ",V,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${V}%`}})})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs(_,{type:"submit",disabled:A||g||!u||!l.school_year,className:"w-full",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),g?"Uploading...":"Upload Grades"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(_,{type:"button",variant:"outline",onClick:J,disabled:!l.subject_id||!l.school_year,className:"w-full",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Download Subject Template"]}),e.jsxs(_,{type:"button",variant:"outline",onClick:H,className:"w-full",children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Multi-Subject Template"]})]}),l.subject_id&&l.school_year&&e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Tip: Download the subject template to get a pre-filled CSV with your enrolled students!"})]})]})})]}),e.jsxs(D,{children:[e.jsx(U,{children:e.jsx(I,{children:"CSV Format Instructions"})}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-green-600",children:"Subject-Specific Template (Recommended for College):"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 mb-3",children:[e.jsx("li",{children:"• Select a subject and school year above"}),e.jsx("li",{children:'• Click "Download Subject Template" to get a pre-filled CSV with enrolled students'}),e.jsxs("li",{children:["• Fill in ",e.jsx("strong",{children:"MIDTERM"})," and ",e.jsx("strong",{children:"FINAL TERM"})," grade columns"]}),e.jsx("li",{children:"• Upload the completed CSV"}),e.jsx("li",{children:"• The system will create separate grade entries for midterm and final periods"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This format is perfect for uploading grades for a specific subject with all enrolled students already listed!"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Multi-Subject CSV Format:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 mb-3",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Subject Code:"})," Subject code (e.g., DBMS01, WEBDEV01)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Grading Period:"})," Period code (e.g., COL_S1_M, COL_S2_M) - Optional"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Upload grades for multiple subjects and students in a single CSV file. Each row represents one grade entry."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Grade Values:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"College:"})," 1.0 to 5.0 (3.0 = passing)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Elementary/Senior High:"})," 75 to 100 (75 = passing)"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Example Multi-Subject CSV:"}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded text-xs font-mono overflow-x-auto",children:[e.jsx("div",{children:"Student ID,Student Name,Subject Code,Grade,Grading Period,Notes"}),e.jsx("div",{children:"CO-2024-001,John Doe,DBMS01,1.5,COL_S1_M,Good performance"}),e.jsx("div",{children:"CO-2024-001,John Doe,WEBDEV01,1.75,COL_S1_M,Excellent work"}),e.jsx("div",{children:"CO-2024-002,Jane Smith,DBMS01,2.0,COL_S1_M,Satisfactory"})]})]})]}),e.jsxs(M,{children:[e.jsx(X,{className:"h-4 w-4 text-green-600"}),e.jsxs(E,{children:[e.jsx("strong",{children:"Tip:"})," Download the template to see the exact format. The system will automatically detect existing grades and update them, or create new ones if they don't exist. You can upload grades for multiple subjects and semesters in one file!"]})]})]})]})]})})]})]})}export{we as default};
