import{m as T,r as b,j as e,$ as P}from"./app-Bf0VEOBc.js";import{C as O,a as M,b as R,c as Y}from"./card-BFvsoICp.js";import{B as v}from"./button-BSqbYWk0.js";import{I as q}from"./input-CEAc_Sgw.js";import{L as W}from"./label-BVgGkm3w.js";import{S as z,a as K,b as Q,c as J,d as h,e as N,f as k}from"./select-BRlNDrkW.js";import{S as X,H as Z}from"./sidebar-CPpQ6Js2.js";import{A as ee}from"./arrow-left-B0ieP4nl.js";import{S as se}from"./square-pen-DW4qnmtm.js";import{S as te}from"./save-MNulfZMK.js";/* empty css            */import"./index-Kf14M9Kd.js";import"./Combination-CT-LzSsG.js";import"./index-CMiXmo__.js";import"./index-DPulQNaq.js";import"./chevron-down-BN57fxWa.js";import"./check-C25aqtg1.js";import"./dropdown-menu-B-Quhz9R.js";import"./user-p1gOztwP.js";import"./log-out-D4wFLlvd.js";import"./book-open-DCgXVRgM.js";import"./graduation-cap-BJswJ5im.js";import"./upload-D56JR5oW.js";import"./crown-Ub7UbgK3.js";function Ce({user:S,grade:t,gradingPeriods:g,assignedSubjects:p}){var A,G,E,D,$,I,U;const j=s=>{const r={1:"99-100%",1.1:"97-98%",1.2:"95-96%",1.3:"93-94%",1.4:"91-92%",1.5:"90%",1.6:"89%",1.7:"88%",1.8:"87%",1.9:"86%",2:"85%",2.1:"84%",2.2:"83%",2.3:"82%",2.4:"81%",2.5:"80%",2.6:"79%",2.7:"78%",2.8:"77%",2.9:"76%",3:"75%",3.1:"74%",3.2:"73%",3.3:"72%",3.4:"71%",3.5:"70%",5:"Below 70%"},i=Math.round(s*10)/10;return r[i]||""},_=s=>s>=1&&s<=1.2?"Excellent":s>=1.3&&s<=1.5?"Superior":s>=1.6&&s<=1.8?"Very Good":s>=1.9&&s<=2.1?"Good":s>=2.2&&s<=2.4?"Average":s>=2.5&&s<=2.7?"Satisfactory":s>=2.8&&s<=3?"Fair":s>3&&s<=3.5?"Conditional":s===5?"Failing":"",{data:d,setData:w,put:V,processing:C,errors:u}=T({grade:t.grade.toString(),grading_period_id:((A=t.grading_period_id)==null?void 0:A.toString())||"0"}),f=b.useMemo(()=>{const s=new Set;return p.forEach(r=>{r.enrolled_students.forEach(i=>{i.semester&&s.add(i.semester.toLowerCase())})}),Array.from(s)},[p]),L=b.useMemo(()=>f.some(s=>s.includes("1st")||s.includes("first")),[f]),F=b.useMemo(()=>f.some(s=>s.includes("2nd")||s.includes("second")),[f]),l=b.useMemo(()=>{var m,x;const s=t.subject_id,r=t.grading_period_id;console.log("=== Edit Grading Period Filtering ==="),console.log("Current grade subject_id:",s),console.log("Current grade subject:",(m=t.subject)==null?void 0:m.name),console.log("Current grade grading_period_id:",r),console.log("Current grade grading_period:",t.gradingPeriod);const i=p.find(n=>n.subject.id===s);if(!i)return console.log("Edit: No assignment found for current subject, showing all periods"),g;const c=i.grading_period_ids||((x=i.subject)==null?void 0:x.grading_period_ids)||[];if(console.log("Assignment grading_period_ids:",c),console.log("All grading periods:",g.length),c.length===0)return console.log("Edit: No grading_period_ids assigned, showing all periods"),g;const a=g.filter(n=>c.includes(n.id));if(console.log("Edit: Filtered grading periods:",a.length,a.map(n=>({id:n.id,name:n.name}))),r&&!a.find(n=>n.id===r)){const n=g.find(y=>y.id===r);n&&(console.log("Edit: Adding current grading period to list:",{id:n.id,name:n.name}),a.push(n),a.sort((y,H)=>y.sort_order-H.sort_order))}return a},[t.subject_id,t.grading_period_id,t.gradingPeriod,p,g]),o=()=>{var r,i,c,a,m;if(console.log("Academic Level Data:",t.academicLevel),console.log("Academic Level Key:",(r=t.academicLevel)==null?void 0:r.key),console.log("Academic Level Name:",(i=t.academicLevel)==null?void 0:i.name),console.log("Subject Course:",(c=t.subject)==null?void 0:c.course),console.log("Full Grade Object:",t),(a=t.academicLevel)!=null&&a.key){const x=t.academicLevel.key==="college";return console.log("Using direct academic level, Is College:",x),x?"college":t.academicLevel.key}if((m=t.subject)!=null&&m.course)return console.log("Using course fallback, assuming college level"),"college";const s=typeof t.grade=="string"?parseFloat(t.grade):t.grade;return s>=1&&s<=5?(console.log("Using grade value fallback, assuming college level (1-5 scale)"),"college"):(console.log("Using default fallback: elementary"),"elementary")},B=s=>{s.preventDefault(),V(route("instructor.grades.update",t.id),{onSuccess:()=>{console.log("Grade updated successfully")},onError:r=>{console.log("Grade update failed:",r)}})};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(X,{user:S}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(Z,{user:S}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{href:route("instructor.grades.show-student",[t.student_id,t.subject_id]),children:e.jsxs(v,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Back to Student"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Edit Grade"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Update the grade for ",t.student.name," in ",t.subject.name]})]})]})}),t.days_remaining!==void 0&&e.jsx(O,{className:`max-w-2xl border-l-4 ${t.days_remaining===0?"border-red-500 bg-red-50 dark:bg-red-900/20":t.days_remaining<=1?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":t.days_remaining<=2?"border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20":"border-blue-500 bg-blue-50 dark:bg-blue-900/20"}`,children:e.jsx(M,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${t.days_remaining===0?"bg-red-100 dark:bg-red-800":t.days_remaining<=1?"bg-orange-100 dark:bg-orange-800":t.days_remaining<=2?"bg-yellow-100 dark:bg-yellow-800":"bg-blue-100 dark:bg-blue-800"}`,children:e.jsx("svg",{className:`h-5 w-5 ${t.days_remaining===0?"text-red-600 dark:text-red-300":t.days_remaining<=1?"text-orange-600 dark:text-orange-300":t.days_remaining<=2?"text-yellow-600 dark:text-yellow-300":"text-blue-600 dark:text-blue-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold ${t.days_remaining===0?"text-red-900 dark:text-red-100":t.days_remaining<=1?"text-orange-900 dark:text-orange-100":t.days_remaining<=2?"text-yellow-900 dark:text-yellow-100":"text-blue-900 dark:text-blue-100"}`,children:t.days_remaining===0?"⚠️ Last Day to Edit!":t.days_remaining===1?"⏰ 1 Day Remaining":`⏰ ${t.days_remaining} Days Remaining`}),e.jsxs("p",{className:`text-sm mt-1 ${t.days_remaining===0?"text-red-700 dark:text-red-200":t.days_remaining<=1?"text-orange-700 dark:text-orange-200":t.days_remaining<=2?"text-yellow-700 dark:text-yellow-200":"text-blue-700 dark:text-blue-200"}`,children:[t.days_remaining===0?"This is your last opportunity to edit this grade before the 5-day window expires.":t.days_remaining===1?"You have 1 day left to edit this grade within the 5-day edit window.":`You have ${t.days_remaining} days left to edit this grade within the 5-day edit window.`,t.edit_status==="locked"&&" Once submitted for validation, this grade cannot be edited."]}),e.jsxs("p",{className:`text-xs mt-2 ${t.days_remaining===0?"text-red-600 dark:text-red-300":t.days_remaining<=2?"text-yellow-600 dark:text-yellow-300":"text-blue-600 dark:text-blue-300"}`,children:["Grade created: ",new Date(t.created_at).toLocaleString()," • Status: ",t.is_submitted_for_validation?"Submitted for Validation":"Draft"]})]})]})})}),e.jsxs(O,{className:"max-w-2xl",children:[e.jsx(R,{children:e.jsxs(Y,{className:"flex items-center gap-2",children:[e.jsx(se,{className:"h-5 w-5"}),"Grade Information"]})}),e.jsxs(M,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-6",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3",children:"Current Grade Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Student:"}),e.jsx("p",{className:"font-medium",children:((G=t.student)==null?void 0:G.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Subject:"}),e.jsxs("p",{className:"font-medium",children:[((E=t.subject)==null?void 0:E.name)||"Unknown"," (",((D=t.subject)==null?void 0:D.code)||"N/A",")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Academic Level:"}),e.jsx("p",{className:"font-medium",children:(($=t.academicLevel)==null?void 0:$.name)||"Unknown"}),!((I=t.academicLevel)!=null&&I.name)&&e.jsxs("p",{className:"text-xs text-yellow-600 mt-1",children:["Detected: ",o()==="college"?"College (5-1 scale)":"Elementary/Senior High (75-100 scale)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"School Year:"}),e.jsx("p",{className:"font-medium",children:t.school_year||"N/A"})]}),((U=t.subject)==null?void 0:U.course)&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Course:"}),e.jsxs("p",{className:"font-medium",children:[t.subject.course.name," (",t.subject.course.code,")"]})]})]})]}),e.jsxs("form",{onSubmit:B,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(W,{htmlFor:"grade",children:"Grade"}),e.jsx(q,{id:"grade",type:"number",step:o()==="college"?"0.1":"0.01",min:o()==="college"?"1.0":"75",max:o()==="college"?"5.0":"100",placeholder:o()==="college"?"Valid: 1.0-3.5 or 5.0":"Enter grade (0-100)",value:d.grade,onChange:s=>{const r=s.target.value;if(w("grade",r),r&&o()==="college"){const i=parseFloat(r);console.log("[GRADE_EDIT] Grade changed:",{grade:i,percentage:j(i),quality:_(i),student:t.student.name})}},className:u.grade?"border-red-500":"",autoFocus:!0}),u.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.grade}),d.grade&&o()==="college"&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-950 rounded-md border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:[j(parseFloat(d.grade))&&e.jsxs(e.Fragment,{children:[j(parseFloat(d.grade)),_(parseFloat(d.grade))&&` - ${_(parseFloat(d.grade))}`]}),!j(parseFloat(d.grade))&&e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Invalid grade (use 1.0-3.5 or 5.0)"})]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:o()==="college"?"Valid grades: 1.0-3.5 (0.1 increments) or 5.0. 3.0 is passing (75%).":"Elementary to Senior High: 75 (passing) to 100 (highest)."})]}),e.jsxs("div",{children:[e.jsx(W,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(z,{value:d.grading_period_id,onValueChange:s=>w("grading_period_id",s),children:[e.jsx(K,{className:u.grading_period_id?"border-red-500":"",children:e.jsx(Q,{placeholder:"Select grading period"})}),e.jsxs(J,{children:[e.jsx(h,{value:"0",children:"No Period"}),l&&l.length>0?e.jsxs(e.Fragment,{children:[L&&l.filter(s=>s.code.startsWith("COL_S1_")&&!s.code.includes("_FA")).length>0&&e.jsxs(N,{children:[e.jsx(k,{children:"First Semester"}),l.filter(s=>s.code.startsWith("COL_S1_")&&!s.code.includes("_FA")).sort((s,r)=>s.sort_order-r.sort_order).map(s=>e.jsx(h,{value:s.id.toString(),children:s.name},s.id))]}),F&&l.filter(s=>s.code.startsWith("COL_S2_")&&!s.code.includes("_FA")).length>0&&e.jsxs(N,{children:[e.jsx(k,{children:"Second Semester"}),l.filter(s=>s.code.startsWith("COL_S2_")&&!s.code.includes("_FA")).sort((s,r)=>s.sort_order-r.sort_order).map(s=>e.jsx(h,{value:s.id.toString(),children:s.name},s.id))]}),(()=>{const s=l.filter(a=>a.code.startsWith("COL_S1_")&&!a.code.includes("_FA")),r=l.filter(a=>a.code.startsWith("COL_S2_")&&!a.code.includes("_FA")),i=L&&s.length>0,c=F&&r.length>0;return!i&&!c?e.jsxs(N,{children:[e.jsx(k,{children:"Available Grading Periods"}),l.filter(a=>!a.code.includes("_FA")).sort((a,m)=>a.sort_order-m.sort_order).map(a=>e.jsx(h,{value:a.id.toString(),children:a.name},a.id))]}):null})()]}):e.jsx(h,{value:"none",disabled:!0,children:"No grading periods assigned to this subject"})]})]}),u.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:u.grading_period_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select which grading period this grade belongs to"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(v,{type:"submit",disabled:C,className:"flex-1",children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),C?"Updating...":"Update Grade"]}),e.jsx(P,{href:route("instructor.grades.show-student",[t.student_id,t.subject_id]),className:"flex-1",children:e.jsx(v,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]})]})]})]})})]})]})}export{Ce as default};
