import{c as A,r as o,j as e,L as q,$ as y,X as N,C as z}from"./app-DDII9HhH.js";import{H}from"./header-DvV7OMo7.js";import{S as O}from"./sidebar-CRoDqs2g.js";import{C as g,b as v,c as w,d as b,a as u}from"./card-D07m7gMr.js";import{B as n}from"./button-DXrvcmA2.js";import{B as S}from"./badge-1xcu611Q.js";import{I as P}from"./input-BmXRpMLV.js";import{L as C}from"./label-eWcCo5v0.js";import{S as X,a as G,b as K,c as V,d as k}from"./select-DE_6tRoY.js";import{A as J}from"./arrow-left-DlH31aNs.js";import{F as Q}from"./filter-fA-O0Xtg.js";import{S as W}from"./search-BCrz5nKy.js";import{U as _}from"./users-DqFhZmfP.js";import{T as Y}from"./triangle-alert-C8IhFm0a.js";import{C as Z}from"./clock-YSJemCA6.js";/* empty css            */import"./dropdown-menu-B_fnoprz.js";import"./Combination-CjKBS6xB.js";import"./index-JuYvo5xb.js";import"./separator-BqHQRHGZ.js";import"./chevron-right-BOzxW_-M.js";import"./crown-CeXaD_Th.js";import"./building-2-CThWSM9q.js";import"./user-cog-AFzEmo05.js";import"./book-open-B6c1fpNO.js";import"./user-check-CC2sRs2e.js";import"./graduation-cap-I5YI9Xe2.js";import"./notebook-ClSqw8Mv.js";import"./chart-no-axes-column-increasing-CxsMWIm9.js";import"./shield-DVtSEr6Z.js";import"./index-Bj6IIrOj.js";import"./index-DF2IYx7E.js";import"./check-CXC9Mpci.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],se=A("Globe",ee);/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]],ae=A("Monitor",te);function Re({user:p,sessions:r,filters:d,users:F,userRoles:re}){const[m,x]=o.useState(d),[j,le]=o.useState(!1),[l,i]=o.useState([]);o.useEffect(()=>{x(d)},[d]);const f=(s,t)=>{x(a=>({...a,[s]:t}))},L=()=>{const s=new URLSearchParams;Object.entries(m).forEach(([a,c])=>{c&&c!=="all"&&s.append(a,c)});const t=`${route("admin.security.login-sessions")}?${s.toString()}`;window.location.href=t},T=()=>{x({}),window.location.href=route("admin.security.login-sessions")},E=s=>{const a=Math.floor(Date.now()/1e3)-s;return a<60?"Just now":a<3600?`${Math.floor(a/60)}m ago`:a<86400?`${Math.floor(a/3600)}h ago`:`${Math.floor(a/86400)}d ago`},M=s=>Math.floor(Date.now()/1e3)-s<1800,$=s=>M(s)?{label:"Active",variant:"default",icon:z}:{label:"Inactive",variant:"secondary",icon:Z},I=s=>({admin:"bg-red-100 text-red-800",registrar:"bg-purple-100 text-purple-800",principal:"bg-blue-100 text-blue-800",chairperson:"bg-indigo-100 text-indigo-800",teacher:"bg-green-100 text-green-800",instructor:"bg-teal-100 text-teal-800",adviser:"bg-orange-100 text-orange-800",student:"bg-gray-100 text-gray-800",parent:"bg-pink-100 text-pink-800"})[s]||"bg-gray-100 text-gray-800",U=async s=>{var t;if(confirm("Are you sure you want to terminate this session?"))try{await fetch(route("admin.security.terminate-session",{sessionId:s}),{method:"DELETE",headers:{"X-CSRF-TOKEN":((t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.getAttribute("content"))||""}}),window.location.reload()}catch(a){console.error("Failed to terminate session:",a)}},B=()=>{l.length===r.data.length?i([]):i(r.data.map(s=>s.id))},D=async()=>{var s;if(l.length!==0&&confirm(`Are you sure you want to terminate ${l.length} selected sessions?`))try{for(const t of l)await fetch(route("admin.security.terminate-session",{sessionId:t}),{method:"DELETE",headers:{"X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""}});i([]),window.location.reload()}catch(t){console.error("Failed to terminate sessions:",t)}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(O,{user:p}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(H,{user:p}),e.jsxs("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:[e.jsx(q,{title:"Login Sessions - System Audit & Security"}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(y,{href:route("admin.security.index"),children:e.jsxs(n,{variant:"ghost",size:"sm",children:[e.jsx(J,{className:"w-4 h-4 mr-2"}),"Back to Security"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Login Sessions"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"Monitor and manage active user login sessions"})]})]}),e.jsx("div",{className:"flex gap-3",children:l.length>0&&e.jsxs(n,{variant:"destructive",onClick:D,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(N,{className:"w-4 h-4 mr-2"}),"Terminate Selected (",l.length,")"]})})]}),e.jsxs(g,{children:[e.jsxs(v,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Filter Sessions"]}),e.jsx(b,{children:"Filter sessions by user, role, and search terms"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"user-filter",children:"User"}),e.jsxs(X,{value:m.user_id||"all",onValueChange:s=>f("user_id",s),children:[e.jsx(G,{children:e.jsx(K,{placeholder:"Select user"})}),e.jsxs(V,{children:[e.jsx(k,{value:"all",children:"All Users"}),F.map(s=>{var t;return e.jsxs(k,{value:((t=s.id)==null?void 0:t.toString())||"",children:[s.name," (",s.email,")"]},s.id)})]})]})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(C,{htmlFor:"search",children:"Search"}),e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),e.jsx(P,{id:"search",placeholder:"Search by user name, email, IP address, or user agent...",value:m.search||"",onChange:s=>f("search",s.target.value),className:"pl-10"})]})]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(n,{onClick:L,disabled:j,children:j?"Applying...":"Apply Filters"}),e.jsx(n,{variant:"outline",onClick:T,children:"Clear All"})]})]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",r.data.length," of ",r.total," sessions"]}),e.jsxs("div",{className:"text-sm text-gray-600",children:["Page ",r.current_page," of ",r.last_page]})]}),e.jsxs(g,{children:[e.jsxs(v,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-5 h-5"}),"Active Login Sessions"]}),e.jsx(b,{children:"Monitor user sessions and manage access control"})]}),e.jsx(u,{children:r.data.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4 p-3 bg-gray-50 rounded-lg font-medium text-sm",children:[e.jsx("div",{className:"w-8",children:e.jsx("input",{type:"checkbox",checked:l.length===r.data.length,onChange:B,className:"rounded border-gray-300"})}),e.jsx("div",{className:"flex-1",children:"User & Session Info"}),e.jsx("div",{className:"w-32",children:"Status"}),e.jsx("div",{className:"w-32",children:"Last Activity"}),e.jsx("div",{className:"w-32",children:"Actions"})]}),r.data.map(s=>{const t=$(s.last_activity),a=t.icon;return e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50 transition-colors",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8",children:e.jsx("input",{type:"checkbox",checked:l.includes(s.id),onChange:c=>{c.target.checked?i(h=>[...h,s.id]):i(h=>h.filter(R=>R!==s.id))},className:"rounded border-gray-300"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.name||"Unknown User"}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email||"No email"})]}),s.user_role&&e.jsx(S,{className:I(s.user_role),children:s.user_role})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(se,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"font-mono",children:s.ip_address})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"truncate max-w-xs",children:s.user_agent})]})]}),s.last_login_at&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Last login: ",new Date(s.last_login_at).toLocaleString()]})]}),e.jsx("div",{className:"w-32",children:e.jsxs(S,{variant:t.variant,className:"flex items-center gap-1",children:[e.jsx(a,{className:"w-3 h-3"}),t.label]})}),e.jsx("div",{className:"w-32 text-sm text-gray-600",children:E(s.last_activity,s.last_activity_formatted)}),e.jsx("div",{className:"w-32 flex gap-2",children:e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>U(s.id),className:"text-red-600 hover:text-red-700",children:[e.jsx(N,{className:"w-4 h-4 mr-1"}),"Terminate"]})})]})},s.id)})]}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(_,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No sessions found"}),e.jsx("p",{className:"text-gray-500",children:"Try adjusting your filters or search criteria"})]})})]}),r.last_page>1&&e.jsx("div",{className:"flex items-center justify-center",children:e.jsx("nav",{className:"flex items-center gap-2",children:r.links.map((s,t)=>e.jsx(y,{href:s.url||"#",className:`px-3 py-2 text-sm rounded-md ${s.active?"bg-blue-600 text-white":"bg-white text-gray-700 border hover:bg-gray-50"} ${s.url?"":"opacity-50 cursor-not-allowed"}`,onClick:a=>!s.url&&a.preventDefault(),children:s.label.replace("&laquo;","«").replace("&raquo;","»")},t))})}),e.jsx(g,{className:"border-yellow-200 bg-yellow-50",children:e.jsx(u,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Y,{className:"w-5 h-5 text-yellow-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-yellow-800",children:"Security Notice"}),e.jsx("p",{className:"text-sm text-yellow-700 mt-1",children:"Terminating sessions will immediately log out users from their current session. Use this feature carefully, especially for active users. All session terminations are logged for audit purposes."})]})]})})})]})]})]})]})}export{Re as default};
