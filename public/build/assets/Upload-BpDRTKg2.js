import{r as u,m as Y,j as e,$ as K,d as z,C as J}from"./app-D_cncWZy.js";import{C as N,b as S,c as w,a as C}from"./card-2Yr24dx1.js";import{B as j}from"./button-B5IqMApH.js";import{I as f}from"./input-B8LC8tXV.js";import{L as m}from"./label-BBnTIkwG.js";import{S as k,a as F,b as T,c as D,d as V}from"./select-RbwQF39u.js";import{A as I,a as A}from"./alert-FhsfOsDW.js";import{S as q,H as Q}from"./sidebar-BYkDandm.js";import{U}from"./upload-D785vT3m.js";import{F as W}from"./file-text-CCl8r_cm.js";import{D as G}from"./download-s-aTKoNq.js";/* empty css            */import"./index-DWA7Dxvr.js";import"./Combination-6mY3ZfrW.js";import"./index-ppH3R8WA.js";import"./index-B4DE-kcv.js";import"./check-BR4kDTMl.js";import"./dropdown-menu-BoYpNruq.js";import"./user-D2P30J7A.js";import"./log-out-CjiyLnQ-.js";import"./book-open--ySsZ53h.js";import"./graduation-cap-QEYUSGtW.js";import"./crown-CXrFokOv.js";function _e({user:b,assignedSubjects:n,academicLevels:x,gradingPeriods:p}){const g=u.useRef(null),[c,_]=u.useState(null),[v,o]=u.useState(0),[h,y]=u.useState(!1),{data:a,setData:d,post:L,processing:P,errors:l,reset:R}=Y({csv_file:null,subject_id:"",academic_level_id:"",school_year:"",year_of_study:""});if(!n||!Array.isArray(n)||!x||!Array.isArray(x)||!p||!Array.isArray(p))return e.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects and academic data."}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(n)]})]})})});const $=s=>{var r;const t=(r=s.target.files)==null?void 0:r[0];t&&(_(t),d("csv_file",t))},B=s=>{var r;d("subject_id",s);const t=n.find(i=>i.subject.id.toString()===s);if(t){console.log("Subject selected:",{subjectId:s,subject:t.subject.name,academicLevel:t.academicLevel.name,gradingPeriod:((r=t.gradingPeriod)==null?void 0:r.name)||"None",schoolYear:t.school_year}),d("academic_level_id",t.academicLevel.id.toString()),d("school_year",t.school_year);const i=p.filter(O=>O.academic_level_id.toString()===t.academicLevel.id.toString());console.log("Available grading periods for academic level:",i)}},E=s=>{if(s.preventDefault(),!c)return;y(!0),o(0);const t=new FormData;t.append("csv_file",c),t.append("subject_id",a.subject_id),t.append("academic_level_id",a.academic_level_id),t.append("school_year",a.school_year),t.append("year_of_study",a.year_of_study||"");const r=setInterval(()=>{o(i=>i>=90?(clearInterval(r),90):i+10)},200);L(route("teacher.grades.upload.store"),t,{forceFormData:!0,onSuccess:()=>{o(100),setTimeout(()=>{y(!1),o(0),_(null),R(),g.current&&(g.current.value="")},1e3)},onError:()=>{y(!1),o(0)}})},M=()=>{var r;const s=a.academic_level_id&&((r=x.find(i=>i.id.toString()===a.academic_level_id))==null?void 0:r.key)||"senior_highschool",t=route("teacher.grades.template")+"?academic_level="+s;console.log("Downloading CSV template for academic level:",s),window.open(t,"_blank")},H=()=>{if(!a.subject_id||!a.school_year){alert("Please select a subject and enter school year first");return}const s=route("teacher.grades.subject-template")+`?subject_id=${a.subject_id}&school_year=${encodeURIComponent(a.school_year)}`;window.open(s,"_blank")};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(q,{user:b}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(Q,{user:b}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Grades CSV"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Bulk upload student grades using a CSV file"})]}),e.jsx(K,{href:route("teacher.grades.index"),children:e.jsx(j,{variant:"outline",children:"Back to Grades"})})]}),e.jsxs(N,{className:"max-w-2xl",children:[e.jsx(S,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(U,{className:"h-5 w-5"}),"Upload Grades CSV"]})}),e.jsx(C,{children:e.jsxs("form",{onSubmit:E,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"csv_file",children:"CSV File"}),e.jsx("div",{className:"mt-2",children:e.jsx(f,{id:"csv_file",ref:g,type:"file",accept:".csv,.txt",onChange:$,className:"cursor-pointer",disabled:h})}),c&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(W,{className:"h-4 w-4"}),c.name," (",(c.size/1024).toFixed(1)," KB)"]}),l.csv_file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.csv_file})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"subject_id",children:"Subject *"}),e.jsxs(k,{value:a.subject_id,onValueChange:B,children:[e.jsx(F,{className:l.subject_id?"border-red-500":"",children:e.jsx(T,{placeholder:"Select a subject"})}),e.jsx(D,{children:n.map(s=>e.jsxs(V,{value:s.subject.id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.id))})]}),l.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.subject_id})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"academic_level_id",children:"Academic Level *"}),e.jsxs(k,{value:a.academic_level_id,onValueChange:s=>d("academic_level_id",s),children:[e.jsx(F,{className:l.academic_level_id?"border-red-500":"",children:e.jsx(T,{placeholder:"Select academic level"})}),e.jsx(D,{children:x.map(s=>e.jsx(V,{value:s.id.toString(),children:s.name},s.id))})]}),l.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"school_year",children:"School Year *"}),e.jsx(f,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:a.school_year,onChange:s=>d("school_year",s.target.value),className:l.school_year?"border-red-500":""}),l.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.school_year})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(f,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1",value:a.year_of_study,onChange:s=>d("year_of_study",s.target.value),className:l.year_of_study?"border-red-500":""}),l.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.year_of_study})]}),e.jsxs(I,{children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs(A,{children:[e.jsx("strong",{children:"Grade System:"})," Teachers use 1.0-5.0 scale (1.0 highest, 3.0 passing)"]})]}),h&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Uploading... ",v,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${v}%`}})})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs(j,{type:"submit",disabled:P||h||!c||!a.subject_id||!a.academic_level_id||!a.school_year,className:"w-full",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),h?"Uploading...":"Upload Grades"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(j,{type:"button",variant:"outline",onClick:H,disabled:!a.subject_id||!a.school_year,className:"w-full",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Download Subject Template"]}),e.jsxs(j,{type:"button",variant:"outline",onClick:M,className:"w-full",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Multi-Subject Template"]})]}),a.subject_id&&a.school_year&&e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Tip: Download the subject template to get a pre-filled CSV with your enrolled students!"})]})]})})]}),e.jsxs(N,{children:[e.jsx(S,{children:e.jsx(w,{children:"CSV Format Instructions"})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-green-600",children:"Subject-Specific Template (Recommended):"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 mb-3",children:[e.jsx("li",{children:"â€¢ Select a subject and school year above"}),e.jsx("li",{children:'â€¢ Click "Download Subject Template" to get a pre-filled CSV with enrolled students'}),e.jsxs("li",{children:["â€¢ Fill in ",e.jsx("strong",{children:"MIDTERM"})," and ",e.jsx("strong",{children:"FINAL TERM"})," grade columns (1.0-5.0 scale)"]}),e.jsx("li",{children:"â€¢ Upload the completed CSV"}),e.jsx("li",{children:"â€¢ The system will create separate grade entries for midterm and final periods"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This format is perfect for uploading grades for a specific subject with all enrolled students already listed!"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Multi-Subject CSV Format:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 mb-3",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Subject Code:"})," Subject code (e.g., MATH101, ENG102)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grading Period:"})," Period code (optional)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Use this format for uploading grades across multiple subjects in one file."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Single-Subject CSV Format:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 mb-3",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Simple 4-column format for uploading one grade per student. Subject and grading period must be selected in the form above."})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Grade Values:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grading Scale:"})," 1.0 to 5.0 (1.0 = highest, 3.0 = passing)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Sample Grades:"})," 1.0, 1.25, 1.5, 1.75, 2.0, 2.25, 2.5, 2.75, 3.0, 4.0, 5.0"]})]})]})]}),e.jsxs(I,{children:[e.jsx(J,{className:"h-4 w-4 text-green-600"}),e.jsxs(A,{children:[e.jsx("strong",{children:"Tip:"})," The system will automatically detect the CSV format and process it accordingly. It will update existing grades or create new ones if they don't exist. Grades can be edited within 5 days of creation if not yet submitted for validation."]})]})]})]})]})})]})]})}export{_e as default};
