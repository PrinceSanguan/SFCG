import{r as n,j as e,$ as N,S as I}from"./app-CYvxa7jT.js";import{S as U,H as q}from"./sidebar-BK2e6bZE.js";import{C as D,b as F,c as Y,a as V}from"./card-NQw11Qdd.js";import{B as x}from"./button-V-FopNJN.js";import{B}from"./badge-02MczTBV.js";import{I as z}from"./input-9ChW2aP7.js";import{D as R,b as J,c as K,d as Q}from"./dialog-C4CON0Pw.js";import{S as W}from"./search-BKmUVJX8.js";import{P as M}from"./plus-DjOJiXgS.js";import{U as X}from"./upload-p_3PcSip.js";import{S as Z}from"./square-pen-CXAxSn_X.js";/* empty css            */import"./dropdown-menu-BhRqOfwu.js";import"./Combination-tNc9cCf7.js";import"./index-FsUecGkA.js";import"./user-Crn7FotS.js";import"./log-out-vRcsfu3z.js";import"./book-open-BDDsgmpM.js";import"./graduation-cap-DYpiabXW.js";import"./crown-ChNBq_U7.js";function be({user:f,grades:m,assignedSubjects:l}){var _;const[g,O]=n.useState(""),[o,T]=n.useState(""),[v,j]=n.useState(!1),[k,w]=n.useState(null);if(console.log("GradesIndex props:",{user:f,grades:m,assignedSubjects:l}),console.log("assignedSubjects type:",typeof l),console.log("assignedSubjects is array:",Array.isArray(l)),console.log("assignedSubjects length:",l==null?void 0:l.length),!l||!Array.isArray(l))return console.log("Safety check failed - showing loading state"),e.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects."}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(l)]})]})})});const $=(r,d)=>d==="college"?r<=1.5?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":r<=2.5?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":r<=3?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":r>=90?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":r>=80?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":r>=75?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",y=(r,d)=>r===0?"No Grade":d==="college"?r<=1.5?"Superior":r<=2?"Very Good":r<=2.5?"Good":r<=3?"Satisfactory":"Failing":r>=95?"Outstanding":r>=90?"Very Good":r>=85?"Good":r>=80?"Satisfactory":r>=75?"Fair":"Failing",E=r=>{if(!r||!l||!Array.isArray(l))return[];console.log("Getting students for subject ID:",r);const d=l.filter(t=>{var i,c;return((c=(i=t.subject)==null?void 0:i.id)==null?void 0:c.toString())===r});if(console.log("Found assignments:",d.length),d.length===0)return[];const s=new Map;d.forEach(t=>{t.enrolled_students&&t.enrolled_students.forEach(i=>{var S,P,G,L;const c=i.student.id;if(!s.has(c)){const C=((S=m==null?void 0:m.data)==null?void 0:S.filter(A=>A.student.id===c&&A.subject.id.toString()===r))||[],h=C.length>0?C[0]:null;s.set(c,{id:i.student.id,name:i.student.name,email:i.student.email,student_number:i.student.student_number,latestGrade:h?h.grade:0,latestGradeDate:h?h.updated_at:"",academicLevel:{key:((P=t.academicLevel)==null?void 0:P.key)||"",name:((G=t.academicLevel)==null?void 0:G.name)||""},gradingPeriod:t.gradingPeriod?{name:t.gradingPeriod.name}:void 0,schoolYear:i.school_year,enrolledInPeriods:[]})}const u=s.get(c);(L=t.gradingPeriod)!=null&&L.name&&u.enrolledInPeriods.push(t.gradingPeriod.full_name||t.gradingPeriod.name)})});const a=Array.from(s.values());return console.log("Returning students:",a.length),a},p=n.useMemo(()=>{if(!l||!Array.isArray(l))return console.log("No assignedSubjects available"),[];console.log("Processing assignments for grouping:",l);const r=l.reduce((s,a)=>{var i,c,u;if(!((i=a==null?void 0:a.subject)!=null&&i.id)||!((c=a==null?void 0:a.subject)!=null&&c.name)||!((u=a==null?void 0:a.academicLevel)!=null&&u.name))return console.log("Skipping assignment - missing required structure:",a),s;const t=a.subject.id;return s[t]||(s[t]={subject:a.subject,academicLevel:a.academicLevel,schoolYear:a.school_year,assignments:[]}),s[t].assignments.push({assignmentId:a.id,gradingPeriodId:a.grading_period_id,gradingPeriod:a.gradingPeriod||null,sectionId:a.section_id,enrolledStudents:a.enrolled_students||[]}),s},{}),d=Object.values(r).map(s=>{const a=s.assignments.map(t=>{var i,c;return((i=t.gradingPeriod)==null?void 0:i.full_name)||((c=t.gradingPeriod)==null?void 0:c.name)}).filter(t=>!!t);return{id:s.subject.id.toString(),name:s.subject.name,code:s.subject.code||"N/A",academicLevel:s.academicLevel.name,schoolYear:s.schoolYear||"N/A",gradingPeriods:a.length>0?a.join(", "):"No Period",assignments:s.assignments}});return console.log("Grouped available subjects:",d),d},[l]),H=r=>{var s,a;if(!o||!l)return;const d=l.filter(t=>t.subject.id.toString()===o);if(d.length===0){console.error("No subject assignment found for selectedSubject:",o);return}if(d.length===1){const t=d[0];console.log("Creating grade for subject (single period):",{subjectId:t.subject.id,subjectName:t.subject.name,studentId:r.id,gradingPeriod:((s=t.gradingPeriod)==null?void 0:s.full_name)||((a=t.gradingPeriod)==null?void 0:a.name)}),I.visit(route("instructor.grades.create",{student_id:r.id,subject_id:t.subject.id,assignment_id:t.id,academic_level_id:t.academic_level_id,academic_level_key:t.academicLevel.key,grading_period_id:t.grading_period_id,school_year:t.school_year}))}else console.log("Multiple assignments found, showing period selector"),window.__pendingGradeStudent=r,w(o),j(!0)},b=o?E(o).filter(r=>r.name.toLowerCase().includes(g.toLowerCase())||r.email.toLowerCase().includes(g.toLowerCase())):[];return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(U,{user:f}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(q,{user:f}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Grade Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"View and manage student grades for your assigned subjects."})]}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx(z,{placeholder:"Search students or subjects...",value:g,onChange:r=>O(r.target.value),className:"pl-10 w-full sm:w-64"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{href:route("instructor.grades.create"),className:o?"":"pointer-events-none",children:e.jsxs(x,{className:"flex items-center gap-2",disabled:!o,children:[e.jsx(M,{className:"h-4 w-4"}),"Input Grade"]})}),e.jsx(N,{href:route("instructor.grades.upload"),children:e.jsxs(x,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Upload CSV"]})})]})]}),e.jsxs(D,{children:[e.jsxs(F,{children:[e.jsx(Y,{className:"text-lg",children:"Select Subject"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a subject to view and manage student grades"})]}),e.jsx(V,{children:p.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:p.map(r=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${o===r.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 dark:border-gray-700 dark:hover:border-gray-600 dark:hover:bg-gray-800/50"}`,onClick:()=>T(o===r.id?"":r.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.code}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:[r.academicLevel," â€¢ SY ",r.schoolYear," â€¢ ",r.gradingPeriods]})]}),e.jsx("div",{className:`w-3 h-3 rounded-full ${o===r.id?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`})]})},r.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Subjects Assigned"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"You haven't been assigned to any subjects yet."})]})})]}),o&&e.jsxs(D,{children:[e.jsx(F,{children:e.jsxs(Y,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Student Grades - ",(_=p.find(r=>r.id===o))==null?void 0:_.name]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[b.length," students"]})]})}),e.jsx(V,{children:b.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Student"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Latest Grade"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Status"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Last Updated"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:b.map(r=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.email})]})}),e.jsx("td",{className:"p-3",children:r.latestGrade===0?e.jsx(B,{variant:"outline",className:"text-gray-500",children:"No Grade"}):e.jsx(B,{className:$(r.latestGrade,r.academicLevel.key),children:r.latestGrade})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`text-sm ${y(r.latestGrade,r.academicLevel.key)==="No Grade"?"text-gray-600 dark:text-gray-400":["Superior","Very Good","Good","Satisfactory","Fair","Outstanding"].includes(y(r.latestGrade,r.academicLevel.key))?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:y(r.latestGrade,r.academicLevel.key)})}),e.jsx("td",{className:"p-3 text-sm text-gray-600 dark:text-gray-400",children:r.latestGradeDate?new Date(r.latestGradeDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(N,{href:route("instructor.grades.show-student",[r.id,o]),children:e.jsxs(x,{variant:"outline",size:"sm",onClick:d=>d.stopPropagation(),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"View Details"]})}),e.jsxs(x,{size:"sm",onClick:d=>{d.stopPropagation(),H(r)},children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Input Grade"]})]})})]},r.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ‘¥"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Students Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:g?"No students match your search criteria.":"No students are enrolled in this subject."})]})})]})]})})]}),v&&k&&l&&e.jsx(R,{open:v,onOpenChange:j,children:e.jsxs(J,{className:"sm:max-w-md",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Select Grading Period"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"This subject has multiple grading periods. Please select which period you want to input grades for."})]}),e.jsx("div",{className:"space-y-2 mt-4",children:l.filter(r=>r.subject.id.toString()===k).map(r=>{var d,s;return e.jsx(x,{onClick:()=>{var t,i;const a=window.__pendingGradeStudent;console.log("Selected grading period:",((t=r.gradingPeriod)==null?void 0:t.full_name)||((i=r.gradingPeriod)==null?void 0:i.name)),a&&I.visit(route("instructor.grades.create",{student_id:a.id,subject_id:r.subject.id,assignment_id:r.id,academic_level_id:r.academic_level_id,academic_level_key:r.academicLevel.key,grading_period_id:r.grading_period_id,school_year:r.school_year})),j(!1),w(null),delete window.__pendingGradeStudent},variant:"outline",className:"w-full justify-start h-auto py-4 px-4",children:e.jsxs("div",{className:"flex flex-col items-start text-left",children:[e.jsx("span",{className:"font-medium",children:((d=r.gradingPeriod)==null?void 0:d.full_name)||((s=r.gradingPeriod)==null?void 0:s.name)||"No Period Assigned"}),e.jsxs("span",{className:"text-xs text-muted-foreground mt-1",children:[r.school_year," â€¢ ",r.subject.code]})]})},r.id)})})]})})]})}export{be as default};
