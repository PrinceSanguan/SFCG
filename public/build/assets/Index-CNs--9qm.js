import{r,m as oe,u as he,j as e,$ as H,S as I}from"./app-xClj_mvu.js";import{S as me,H as xe}from"./sidebar-BVjt7xdN.js";import{C as K,b as q,c as G,a as R}from"./card-BEqEns8e.js";import{B as m}from"./button-DoqQC-FK.js";import{I as pe}from"./input-BrIkwTrw.js";import{B as fe}from"./badge-BpStAMef.js";import{P as ue}from"./PasswordResetModal-a--GOrN_.js";import{S as f,a as u,b as j,c as g,d as S}from"./select-CuHymX7Z.js";import{D as je,b as ge,c as Se,d as Ne,e as be,f as ve}from"./dialog-B2Mf3V3z.js";import{S as _e}from"./search-CMgj_fn7.js";import{U as J}from"./upload-aN2JQj3o.js";import{U as Ce}from"./users-B5BEkpFp.js";import{E as we}from"./eye-DjiOudb2.js";import{S as ye}from"./square-pen-BTvyWu-v.js";import{K as Ue}from"./key-BZLuM6Dk.js";import{T as ke}from"./trash-2-E_cA76jJ.js";import{D as De}from"./download-CsJpqq2r.js";/* empty css            */import"./dropdown-menu-qYVmUv3X.js";import"./Combination-DSConw3b.js";import"./index-CM9l-FhE.js";import"./separator-Cv6N_3UO.js";import"./chevron-right-xbCvfCC1.js";import"./crown-D8ObGBAN.js";import"./building-2-BVmTlzA2.js";import"./user-cog-CwcHGJUn.js";import"./book-open-mpYb3m8z.js";import"./user-check-BVuVdk6i.js";import"./graduation-cap-BcybyV3A.js";import"./notebook-BvUUicAX.js";import"./chart-no-axes-column-increasing-FpE5RTPd.js";import"./label-B4tAClcW.js";import"./alert-686hvaLP.js";import"./rotate-ccw-sarftRvJ.js";import"./index-isl2M0Eb.js";import"./index-DkSkC0u5.js";import"./check-DktrIPxn.js";function ps({user:E,users:b,filters:y,roles:Ve,currentRole:p,yearLevel:l,sections:O=[],specificYearLevels:U={},tracks:Q=[],strands:_=[],departments:W=[],courses:C=[]}){const[v,k]=r.useState(null),[D,z]=r.useState(null),[X,V]=r.useState(!1),[N,$]=r.useState(""),[t,w]=r.useState(""),[n,P]=r.useState(""),[i,F]=r.useState(""),[d,T]=r.useState(""),[c,A]=r.useState(""),[o,M]=r.useState(""),{delete:Z}=oe(),Y=r.useRef(null),{addToast:h}=he(),L=r.useMemo(()=>i&&_.length>0?_.filter(s=>s.track_id===parseInt(i)):_,[i,_]),ee=r.useMemo(()=>c&&C.length>0?C.filter(s=>s.department_id===parseInt(c)):C,[c,C]),se=r.useMemo(()=>{let s=O;return t&&(l==="elementary"||l==="junior_highschool")&&(s=s.filter(a=>a.specific_year_level===t)),l==="senior_highschool"&&(i&&(s=s.filter(a=>a.track_id===parseInt(i))),d&&(s=s.filter(a=>a.strand_id===parseInt(d))),t&&(s=s.filter(a=>a.specific_year_level===t))),l==="college"&&(c&&(s=s.filter(a=>a.department_id===parseInt(c))),o&&(s=s.filter(a=>a.course_id===parseInt(o))),t&&(s=s.filter(a=>a.specific_year_level===t))),s},[t,i,d,c,o,O,l]);r.useEffect(()=>{P("")},[t,i,d,c,o]),r.useEffect(()=>{T("")},[i]),r.useEffect(()=>{M("")},[c]);const le=s=>{k(s)},ae=s=>{z(s)},te=()=>{if(!N){h("Please enter a school year first.","error");return}if(!n&&(l==="elementary"||l==="junior_highschool")){h("Please select a grade level and section first.","error");return}if(!n&&l==="senior_highschool"){h("Please select track, strand, and section first.","error");return}if(!n&&l==="college"){h("Please select department, course, year level, and section first.","error");return}const s={};l&&(s.academic_level=l),N&&(s.school_year=N),t&&(s.specific_year_level=t),i&&(s.track_id=i),d&&(s.strand_id=d),c&&(s.department_id=c),o&&(s.course_id=o),n&&(s.section_id=n),window.location.href=route("registrar.students.template",s),h("Downloading CSV template...","success")},re=()=>{var s;if(!N){h("Please enter a school year first.","error");return}if(!n&&(l==="elementary"||l==="junior_highschool")){h("Please select a grade level and section first.","error");return}if(!n&&l==="senior_highschool"){h("Please select track, strand, and section first.","error");return}if(!n&&l==="college"){h("Please select department, course, year level, and section first.","error");return}(s=Y.current)==null||s.click()},ie=()=>{var s;l?V(!0):(s=Y.current)==null||s.click()},ce=s=>{var B;const a=(B=s.target.files)==null?void 0:B[0];if(!a)return;const x=new FormData;x.append("file",a),l&&x.append("academic_level",l),N&&x.append("school_year",N),t&&x.append("specific_year_level",t),i&&x.append("track_id",i),d&&x.append("strand_id",d),c&&x.append("department_id",c),o&&x.append("course_id",o),n&&x.append("section_id",n),I.post(route("registrar.students.upload"),x,{forceFormData:!0,onSuccess:()=>{h("Students CSV uploaded successfully.","success"),V(!1),$(""),w(""),P(""),F(""),T(""),A(""),M(""),I.reload()},onError:de=>{console.error("CSV upload failed:",de),h("CSV upload failed. Please check the file format.","error")},preserveScroll:!0}),s.target.value=""},ne=()=>{if(v){let s;p&&p!=="student"?s=route(`registrar.${p}s.destroy`,v.id):l?s=route("registrar.students.destroy",v.id):s=route("registrar.users.destroy",v.id),Z(s,{onSuccess:()=>{k(null)}})}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(me,{user:E}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(xe,{user:E}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:l?`${l.charAt(0).toUpperCase()+l.slice(1).replace("_"," ")} Students`:p?`${p.charAt(0).toUpperCase()+p.slice(1)} Management`:"User Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:l?`Manage ${l.replace("_"," ")} student accounts.`:"Manage user accounts and permissions."})]}),e.jsxs(K,{children:[e.jsx(q,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"Search & Filters"]})}),e.jsx(R,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsx("div",{className:"flex-1",children:e.jsx(pe,{placeholder:"Search users by name or email...",defaultValue:(y==null?void 0:y.search)||""})}),e.jsx(m,{children:"Search"})]}),l&&e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end w-full lg:w-auto",children:[e.jsx("input",{type:"file",accept:".csv,text/csv",ref:Y,className:"hidden",onChange:ce}),e.jsxs(m,{variant:"outline",className:"flex items-center gap-2",onClick:ie,children:[e.jsx(J,{className:"h-4 w-4"}),"CSV Upload Manager"]})]})]})})]}),e.jsxs(K,{children:[e.jsx(q,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Users (",b.total,")"]})}),e.jsxs(R,{children:[e.jsxs("div",{className:"space-y-4",children:[b.data.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.year_level&&e.jsx("p",{className:"text-xs text-gray-400 capitalize",children:s.year_level.replace("_"," ")})]}),e.jsx(fe,{variant:"secondary",children:s.user_role})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(H,{href:route("registrar.users.show",s.id),children:e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"View"]})}),e.jsx(H,{href:route("registrar.users.edit",s.id),children:e.jsxs(m,{variant:"outline",size:"sm",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Edit"]})}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>ae(s),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Reset Password"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>le(s),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]},s.id)),b.data.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No users found."})})]}),b.last_page>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("div",{className:"flex gap-2",children:Array.from({length:b.last_page},(s,a)=>a+1).map(s=>e.jsx(m,{variant:s===b.current_page?"default":"outline",size:"sm",children:s},s))})})]})]})]})})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Confirm Delete"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete ",e.jsx("strong",{children:v.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(m,{variant:"outline",onClick:()=>k(null),children:"Cancel"}),e.jsx(m,{variant:"destructive",onClick:ne,children:"Delete User"})]})]})}),D&&e.jsx(ue,{user:D,isOpen:!!D,onClose:()=>z(null),routeName:p?`registrar.${p}s.reset-password`:"registrar.users.reset-password"}),e.jsx(je,{open:X,onOpenChange:V,children:e.jsxs(ge,{className:"sm:max-w-[500px] max-h-[90vh] flex flex-col",children:[e.jsxs(Se,{children:[e.jsx(Ne,{children:"CSV Upload Manager"}),e.jsx(be,{children:l==="senior_highschool"?"Enter the school year, then select the track, strand, year level, and section, then download the template and upload your CSV file.":l==="college"?"Enter the school year, then select the department, course, year level, and section, then download the template and upload your CSV file.":"Enter the school year, then select the grade level and section, then download the template and upload your CSV file."})]}),e.jsxs("div",{className:"space-y-4 py-4 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["School Year ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"e.g., 2024-2025",value:N,onChange:s=>$(s.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Format: YYYY-YYYY (e.g., 2024-2025)"})]}),(l==="elementary"||l==="junior_highschool")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Grade Level"}),e.jsxs(f,{value:t,onValueChange:w,children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Select grade level"})}),e.jsx(g,{children:Object.entries(U).map(([s,a])=>e.jsx(S,{value:s,children:a},s))})]})]}),l==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Track"}),e.jsxs(f,{value:i,onValueChange:F,children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Select track"})}),e.jsx(g,{children:Q.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),l==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Strand"}),e.jsxs(f,{value:d,onValueChange:T,disabled:!i,children:[e.jsx(u,{children:e.jsx(j,{placeholder:i?"Select strand":"Select track first"})}),e.jsx(g,{children:L.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),l==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(f,{value:t,onValueChange:w,disabled:!d,children:[e.jsx(u,{children:e.jsx(j,{placeholder:d?"Select year level":"Select strand first"})}),e.jsx(g,{children:Object.entries(U).map(([s,a])=>e.jsx(S,{value:s,children:a},s))})]})]}),l==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Department"}),e.jsxs(f,{value:c,onValueChange:A,children:[e.jsx(u,{children:e.jsx(j,{placeholder:"Select department"})}),e.jsx(g,{children:W.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),l==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Course"}),e.jsxs(f,{value:o,onValueChange:M,disabled:!c,children:[e.jsx(u,{children:e.jsx(j,{placeholder:c?"Select course":"Select department first"})}),e.jsx(g,{children:ee.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),l==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(f,{value:t,onValueChange:w,disabled:!o,children:[e.jsx(u,{children:e.jsx(j,{placeholder:o?"Select year level":"Select course first"})}),e.jsx(g,{children:Object.entries(U).map(([s,a])=>e.jsx(S,{value:s,children:a},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Section"}),e.jsxs(f,{value:n,onValueChange:P,disabled:l==="elementary"||l==="junior_highschool"||l==="senior_highschool"||l==="college"?!t:!d,children:[e.jsx(u,{children:e.jsx(j,{placeholder:l==="elementary"||l==="junior_highschool"?t?"Select section":"Select grade level first":l==="senior_highschool"||l==="college"?t?"Select section":"Select year level first":d?"Select section":"Select track and strand first"})}),e.jsx(g,{children:se.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),n&&e.jsxs("div",{className:"rounded-md bg-blue-50 p-3 text-sm text-blue-900 dark:bg-blue-950 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"Next Steps:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'Click "Download Template" to get the CSV file'}),e.jsx("li",{children:'Click "Upload CSV" to import the students'})]})]})]}),e.jsxs(ve,{className:"flex gap-2 flex-shrink-0",children:[e.jsxs(m,{variant:"outline",onClick:te,disabled:!n,children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Download Template"]}),e.jsxs(m,{onClick:re,disabled:!n,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Upload CSV"]})]})]})})]})}export{ps as default};
