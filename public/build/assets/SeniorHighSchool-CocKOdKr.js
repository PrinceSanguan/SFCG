import{r as H,u as Be,m as Ve,j as e,C as ke,S as ze,X as Ie}from"./app-Dx5wNk5j.js";import{H as Xe}from"./header-CibeWQvD.js";import{S as Ke}from"./sidebar-BNHWwgqC.js";import{C as X,b as K,c as J,a as L}from"./card-BMH1KQmK.js";import{B as x}from"./button-etGNcxL8.js";import{I as h}from"./input-BEaMQ84V.js";import{L as o}from"./label-BOQbYBnq.js";import{S as M,a as D,b as $,c as E,d as f}from"./select-j2YPB6Lu.js";import{C as Ge}from"./checkbox-9NhzPk0a.js";import{B as c}from"./badge-C-djbvNJ.js";import{A as Je,a as Le}from"./alert-DN7edruV.js";import{D as We,b as Ze,c as Ye,d as es,e as ss}from"./dialog-CB0mq8_M.js";import{A as as}from"./arrow-left-C2ZxgBSs.js";import{P as ls}from"./plus-BhkcwfuR.js";import{T as y}from"./trophy-BdzcASvz.js";import{U as rs}from"./upload-SwD0M6iR.js";import"./dropdown-menu-CEEk6xRP.js";import"./Combination-BQzR5vku.js";import"./index-DxaACQP9.js";import"./separator-DGL766Lm.js";import"./chevron-down-wF6ejKKe.js";import"./users-BUKT3z__.js";import"./chevron-right-BtJ-VpPz.js";import"./crown-D-tQwAyU.js";import"./building-2-BCbyEr4C.js";import"./user-cog-B4td0U_S.js";import"./book-open-DgKNStGF.js";import"./user-check-Gjs4xNas.js";import"./graduation-cap-BFIq8Weu.js";import"./notebook-1KRFCdnL.js";import"./chart-no-axes-column-increasing-CYhyNlz1.js";import"./shield-DTb1zVg7.js";import"./index-DIqt_v0N.js";import"./index-UV7Lx2p3.js";import"./check-CoS5fav-.js";function Us({user:W,honorTypes:j,criteria:S,schoolYears:T,qualifiedStudents:C=[],honorResults:U=[],currentSchoolYear:A="2024-2025",gradeLevels:g={},sections:F=[],strands:k=[],filters:n}){var ae,le,re,te,ne,de,ie,oe,ce,me,xe,he,ge,ue,pe,je,_e,be,Ne,ve,ye;const[q,w]=H.useState(null),[Q,O]=H.useState(null),[i,_]=H.useState({min_gpa:"",max_gpa:"",min_grade:"",min_grade_all:"",min_year:"",max_year:"",require_consistent_honor:!1}),[Pe,B]=H.useState(!1),[d,Me]=H.useState(null),[De,V]=H.useState(!1),{addToast:z}=Be(),{data:b,setData:N,post:$e,processing:Ee,errors:Z,reset:Te}=Ve({academic_level_id:"3",honor_type_id:"",school_year:"2024-2025",min_gpa:"",max_gpa:"",min_grade:"",min_grade_all:"",min_year:"",max_year:"",require_consistent_honor:!1}),Y=s=>{var a;if(typeof s!="number"||!S||S.length===0)return null;const l=[...S].filter(r=>r.honorType&&(r.min_gpa!==null||r.max_gpa!==null)).sort((r,t)=>(t.min_gpa??0)-(r.min_gpa??0));for(const r of l){const t=r.min_gpa===null||s>=r.min_gpa,m=r.max_gpa===null||s<=r.max_gpa;if(t&&m)return((a=r.honorType)==null?void 0:a.name)||null}return null},ee=s=>{var l,a,r;return((l=s==null?void 0:s.honor_type)==null?void 0:l.name)||((a=s==null?void 0:s.honorType)==null?void 0:a.name)||((r=j==null?void 0:j.find(t=>t.id===(s==null?void 0:s.honor_type_id)))==null?void 0:r.name)||"Unknown Honor Type"},se=s=>{var l,a,r;return((l=s==null?void 0:s.honor_type)==null?void 0:l.scope)||((a=s==null?void 0:s.honorType)==null?void 0:a.scope)||((r=j==null?void 0:j.find(t=>t.id===(s==null?void 0:s.honor_type_id)))==null?void 0:r.scope)||"Unknown"},Qe=s=>{s.preventDefault(),$e("/admin/academic/honors/criteria",{onSuccess:()=>{w({type:"success",text:"Criteria saved successfully!"}),Te(),B(!1),window.location.reload()},onError:()=>w({type:"error",text:"Failed to save criteria."})})},Re=s=>{var l,a,r,t,m,u;O(s),_({min_gpa:((l=s.min_gpa)==null?void 0:l.toString())||"",max_gpa:((a=s.max_gpa)==null?void 0:a.toString())||"",min_grade:((r=s.min_grade)==null?void 0:r.toString())||"",min_grade_all:((t=s.min_grade_all)==null?void 0:t.toString())||"",min_year:((m=s.min_year)==null?void 0:m.toString())||"",max_year:((u=s.max_year)==null?void 0:u.toString())||"",require_consistent_honor:s.require_consistent_honor})},Ue=()=>{O(null),_({min_gpa:"",max_gpa:"",min_grade:"",min_grade_all:"",min_year:"",max_year:"",require_consistent_honor:!1})},qe=s=>{var a;const l={...Q,min_gpa:parseFloat(i.min_gpa)||null,max_gpa:parseFloat(i.max_gpa)||null,min_grade:parseFloat(i.min_grade)||null,min_grade_all:parseFloat(i.min_grade_all)||null,min_year:parseInt(i.min_year)||null,max_year:parseInt(i.max_year)||null,require_consistent_honor:i.require_consistent_honor};fetch(`/admin/academic/honors/criteria/${s}`,{method:"PUT",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((a=document.querySelector('meta[name="csrf-token"]'))==null?void 0:a.getAttribute("content"))||""},body:JSON.stringify(l)}).then(r=>{if(!r.ok)throw new Error(`HTTP ${r.status}`);return r.json()}).then(()=>{w({type:"success",text:"Criteria updated successfully!"}),O(null),window.location.reload()}).catch(()=>w({type:"error",text:"Failed to update criteria."}))},Oe=s=>{var l;window.confirm("Are you sure you want to delete this criterion?")&&fetch(`/admin/academic/honors/criteria/${s}`,{method:"DELETE",headers:{"X-CSRF-TOKEN":((l=document.querySelector('meta[name="csrf-token"]'))==null?void 0:l.getAttribute("content"))||""}}).then(a=>{if(!a.ok)throw new Error(`HTTP ${a.status}`);return a.json()}).then(()=>{w({type:"success",text:"Criteria deleted successfully!"}),window.location.reload()}).catch(()=>w({type:"error",text:"Failed to delete criteria."}))};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Ke,{user:W}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(Xe,{user:W}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>window.history.back(),className:"flex items-center gap-2",children:[e.jsx(as,{className:"h-4 w-4"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Senior High School Honor Criteria"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Manage honor criteria for Senior High School level students."})]})}),q&&e.jsxs(Je,{className:q.type==="success"?"border-green-500":"border-red-500",children:[e.jsx(ke,{className:"h-4 w-4"}),e.jsx(Le,{children:q.text})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(x,{onClick:()=>B(!0),className:"flex items-center gap-2",children:[e.jsx(ls,{className:"h-4 w-4"}),"Add New Criteria"]})}),Pe&&e.jsxs(X,{children:[e.jsx(K,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Add Honor Criteria"]})}),e.jsx(L,{children:e.jsxs("form",{onSubmit:Qe,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"honor_type_id",children:"Honor Type"}),j&&j.length>0?e.jsxs(M,{value:b.honor_type_id||"",onValueChange:s=>N("honor_type_id",s),children:[e.jsx(D,{children:e.jsx($,{placeholder:"Select honor"})}),e.jsx(E,{children:j.filter(s=>s.id&&s.name).map(s=>e.jsx(f,{value:s.id.toString(),children:s.name},s.id))})]}):e.jsx("div",{className:"p-2 text-sm text-gray-500 bg-gray-100 rounded border",children:"Loading honor types..."}),Z.honor_type_id&&e.jsx("p",{className:"text-sm text-red-500",children:Z.honor_type_id})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"school_year",children:"School Year"}),e.jsxs(M,{value:b.school_year||"",onValueChange:s=>N("school_year",s),children:[e.jsx(D,{children:e.jsx($,{placeholder:"Select school year"})}),e.jsx(E,{children:(T!=null&&T.length?T:["2024-2025"]).filter(s=>s&&s.trim()!=="").map(s=>e.jsx(f,{value:s,children:s},s))})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"min_gpa",children:"Min GPA"}),e.jsx(h,{id:"min_gpa",type:"number",step:"0.01",value:b.min_gpa,onChange:s=>N("min_gpa",s.target.value),placeholder:"e.g., 90.0"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"max_gpa",children:"Max GPA"}),e.jsx(h,{id:"max_gpa",type:"number",step:"0.01",value:b.max_gpa,onChange:s=>N("max_gpa",s.target.value),placeholder:"e.g., 97.0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"min_grade",children:"Min Grade (any)"}),e.jsx(h,{id:"min_grade",type:"number",value:b.min_grade,onChange:s=>N("min_grade",s.target.value),placeholder:"e.g., 90"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"min_grade_all",children:"Min Grade (all)"}),e.jsx(h,{id:"min_grade_all",type:"number",value:b.min_grade_all,onChange:s=>N("min_grade_all",s.target.value),placeholder:"e.g., 93"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"min_year",children:"Min Year"}),e.jsx(h,{id:"min_year",type:"number",value:b.min_year,onChange:s=>N("min_year",s.target.value),placeholder:"e.g., 2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"max_year",children:"Max Year"}),e.jsx(h,{id:"max_year",type:"number",value:b.max_year,onChange:s=>N("max_year",s.target.value),placeholder:"e.g., 3"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ge,{id:"require_consistent_honor",checked:!!b.require_consistent_honor,onCheckedChange:s=>N("require_consistent_honor",s)}),e.jsx(o,{htmlFor:"require_consistent_honor",children:"Require consistent honor standing"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{type:"submit",disabled:Ee,children:"Save Criteria"}),e.jsx(x,{type:"button",variant:"outline",onClick:()=>B(!1),children:"Cancel"})]})]})})]}),e.jsxs(X,{children:[e.jsx(K,{children:e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Existing Criteria (",S.length,")"]})}),e.jsx(L,{children:S.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(y,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No honor criteria set for Senior High School"}),e.jsx("p",{className:"text-sm",children:'Use the "Add New Criteria" button to create criteria for this level.'})]}):e.jsx("div",{className:"grid gap-4",children:S.map(s=>e.jsx("div",{className:"border rounded-lg p-4 bg-white shadow-sm",children:(Q==null?void 0:Q.id)===s.id?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-lg",children:ee(s)}),e.jsx(c,{variant:"secondary",children:se(s)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:`edit_min_gpa_${s.id}`,children:"Min GPA"}),e.jsx(h,{id:`edit_min_gpa_${s.id}`,type:"number",step:"0.01",value:i.min_gpa,onChange:l=>_({...i,min_gpa:l.target.value}),placeholder:"e.g., 90.0"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`edit_max_gpa_${s.id}`,children:"Max GPA"}),e.jsx(h,{id:`edit_max_gpa_${s.id}`,type:"number",step:"0.01",value:i.max_gpa,onChange:l=>_({...i,max_gpa:l.target.value}),placeholder:"e.g., 97.0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:`edit_min_grade_${s.id}`,children:"Min Grade (any)"}),e.jsx(h,{id:`edit_min_grade_${s.id}`,type:"number",value:i.min_grade,onChange:l=>_({...i,min_grade:l.target.value}),placeholder:"e.g., 90"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`edit_min_grade_all_${s.id}`,children:"Min Grade (all)"}),e.jsx(h,{id:`edit_min_grade_all_${s.id}`,type:"number",value:i.min_grade_all,onChange:l=>_({...i,min_grade_all:l.target.value}),placeholder:"e.g., 93"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:`edit_min_year_${s.id}`,children:"Min Year"}),e.jsx(h,{id:`edit_min_year_${s.id}`,type:"number",value:i.min_year,onChange:l=>_({...i,min_year:l.target.value}),placeholder:"e.g., 2"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:`edit_max_year_${s.id}`,children:"Max Year"}),e.jsx(h,{id:`edit_max_year_${s.id}`,type:"number",value:i.max_year,onChange:l=>_({...i,max_year:l.target.value}),placeholder:"e.g., 3"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ge,{id:`edit_require_consistent_${s.id}`,checked:i.require_consistent_honor,onCheckedChange:l=>_({...i,require_consistent_honor:l})}),e.jsx(o,{htmlFor:`edit_require_consistent_${s.id}`,children:"Require consistent honor standing"})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:Ue,children:"Cancel"}),e.jsx(x,{size:"sm",onClick:()=>qe(s.id),children:"Update Criteria"})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"font-medium text-lg",children:ee(s)}),e.jsx(c,{variant:"secondary",children:se(s)})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[s.min_gpa&&e.jsxs("div",{className:"bg-blue-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Min GPA:"})," ",s.min_gpa]}),s.max_gpa&&e.jsxs("div",{className:"bg-green-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium text-green-700",children:"Max GPA:"})," ",s.max_gpa]}),s.min_grade&&e.jsxs("div",{className:"bg-yellow-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium text-yellow-700",children:"Min Grade:"})," ",s.min_grade]}),s.min_grade_all&&e.jsxs("div",{className:"bg-purple-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium text-purple-700",children:"Min Grade (All):"})," ",s.min_grade_all]}),s.min_year&&s.max_year&&e.jsxs("div",{className:"bg-indigo-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium text-indigo-700",children:"Years:"})," ",s.min_year,"-",s.max_year]}),s.require_consistent_honor&&e.jsx("div",{className:"col-span-2",children:e.jsx(c,{variant:"outline",className:"bg-orange-50 text-orange-700 border-orange-200",children:"Requires Consistent Honor Standing"})})]}),e.jsxs("div",{className:"flex justify-end mt-4 gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>Re(s),children:"Edit"}),e.jsx(x,{variant:"destructive",size:"sm",onClick:()=>Oe(s.id),children:"Delete"})]})]})},s.id))})})]}),e.jsxs(X,{children:[e.jsxs(K,{children:[e.jsxs(J,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Qualified Senior High School Students (",C.length,")"]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:["School Year: ",A," â€¢ Click on a student to view detailed grades and honor calculation"]}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"grade_level_filter",children:"Grade Level"}),e.jsxs(M,{value:(n==null?void 0:n.grade_level)||"all",onValueChange:s=>{const l=new URL(window.location.href);s&&s!=="all"?l.searchParams.set("grade_level",s):l.searchParams.delete("grade_level"),window.location.href=l.toString()},children:[e.jsx(D,{children:e.jsx($,{placeholder:"All Grade Levels"})}),e.jsxs(E,{children:[e.jsx(f,{value:"all",children:"All Grade Levels"}),g&&Object.entries(g).map(([s,l])=>e.jsx(f,{value:s,children:l},s))]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"strand_filter",children:"Strand"}),e.jsxs(M,{value:(n==null?void 0:n.strand_id)||"all",onValueChange:s=>{const l=new URL(window.location.href);s&&s!=="all"?l.searchParams.set("strand_id",s):l.searchParams.delete("strand_id"),window.location.href=l.toString()},children:[e.jsx(D,{children:e.jsx($,{placeholder:"All Strands"})}),e.jsxs(E,{children:[e.jsx(f,{value:"all",children:"All Strands"}),k&&k.map(s=>e.jsx(f,{value:s.id.toString(),children:s.name},s.id))]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"section_filter",children:"Section"}),e.jsxs(M,{value:(n==null?void 0:n.section_id)||"all",onValueChange:s=>{const l=new URL(window.location.href);s&&s!=="all"?l.searchParams.set("section_id",s):l.searchParams.delete("section_id"),window.location.href=l.toString()},children:[e.jsx(D,{children:e.jsx($,{placeholder:"All Sections"})}),e.jsxs(E,{children:[e.jsx(f,{value:"all",children:"All Sections"}),F&&F.map(s=>e.jsxs(f,{value:s.id.toString(),children:[s.name," (",s.code,")",s.specific_year_level&&` - ${s.specific_year_level.replace("grade_","Grade ")}`]},s.id))]})]})]}),e.jsx("div",{className:"flex items-end",children:e.jsx(x,{variant:"outline",onClick:()=>{const s=new URL(window.location.href);s.searchParams.delete("grade_level"),s.searchParams.delete("strand_id"),s.searchParams.delete("section_id"),window.location.href=s.toString()},className:"w-full",children:"Clear Filters"})})]}),((n==null?void 0:n.grade_level)||(n==null?void 0:n.section_id)||(n==null?void 0:n.strand_id))&&e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"Active Filters:"}),(n==null?void 0:n.grade_level)&&e.jsxs("span",{className:"ml-2",children:["Grade Level: ",e.jsx(c,{variant:"secondary",children:(g==null?void 0:g[n.grade_level])||n.grade_level})]}),(n==null?void 0:n.strand_id)&&e.jsxs("span",{className:"ml-2",children:["Strand: ",e.jsx(c,{variant:"secondary",children:((ae=k==null?void 0:k.find(s=>s.id.toString()===n.strand_id))==null?void 0:ae.name)||n.strand_id})]}),(n==null?void 0:n.section_id)&&e.jsxs("span",{className:"ml-2",children:["Section: ",e.jsx(c,{variant:"secondary",children:((le=F==null?void 0:F.find(s=>s.id.toString()===n.section_id))==null?void 0:le.name)||n.section_id})]})]})})]})]}),e.jsx(L,{children:C.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx(y,{className:"h-12 w-12 mx-auto mb-2 text-gray-300"}),e.jsx("p",{children:"No students found"}),e.jsx("p",{className:"text-sm",children:"Students need to meet honor criteria to appear here."})]}):e.jsx("div",{className:"space-y-4",children:(()=>{const s=C.filter(a=>{var r;return(r=a.result)==null?void 0:r.qualified}),l=C.filter(a=>{var r;return!((r=a.result)!=null&&r.qualified)});return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Ready to submit ",s.length," student",s.length!==1?"s":""," for approval"]}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[s.length," qualified, ",l.length," not qualified"]})]}),e.jsxs(x,{onClick:()=>{console.log("[SHS Submit] Starting submission process..."),console.log("[SHS Submit] Qualified students count:",s.length),console.log("[SHS Submit] Current school year:",A),console.log("[SHS Submit] Honor results count:",U.length);const a=s.filter(t=>!U.some(u=>u.student_id===t.student.id&&u.school_year===A)),r=s.length-a.length;if(console.log("[SHS Submit] Total qualified students:",s.length),console.log("[SHS Submit] Already submitted count:",r),console.log("[SHS Submit] Students to submit count:",a.length),console.log("[SHS Submit] Student names to submit:",a.map(t=>t.student.name)),r>0&&console.log("[SHS Submit] Already submitted students:",s.filter(t=>U.some(m=>m.student_id===t.student.id&&m.school_year===A)).map(t=>t.student.name)),a.length===0){console.log("[SHS Submit] All students already submitted - blocking submission"),z("All qualified students have already been submitted for approval.","warning");return}confirm(`Submit ${a.length} qualified student(s) for principal approval?`)?(console.log("[SHS Submit] User confirmed. Sending data..."),console.log("[SHS Submit] Submitting students:",a.map(t=>({id:t.student.id,name:t.student.name}))),ze.post(route("admin.academic.honors.senior-high-school.generate-results"),{school_year:A},{onSuccess:t=>{console.log("[SHS Submit] Success response:",t),z(`Successfully submitted ${a.length} student(s) for approval!`,"success")},onError:t=>{console.error("[SHS Submit] Error response:",t),z("Failed to submit students for approval. Please try again.","error")}})):console.log("[SHS Submit] User cancelled submission")},className:"flex items-center gap-2",children:[e.jsx(rs,{className:"h-4 w-4"}),"Submit for Approval"]})]}),e.jsx("div",{className:"grid gap-4",children:C.map((a,r)=>{var m,u,G,P,v;const t=(m=a.result)==null?void 0:m.qualified;return e.jsx("div",{className:`border rounded-lg p-4 shadow-sm hover:shadow-md cursor-pointer transition-shadow ${t?"bg-white border-green-200":"bg-gray-50 border-gray-300 opacity-75"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm font-medium text-gray-500",children:["#",r+1]}),e.jsx("h4",{className:"font-semibold text-lg",children:a.student.name})]}),e.jsxs("div",{className:"flex gap-2",children:[t?e.jsx(c,{className:"text-xs bg-green-100 text-green-800 border-green-300",children:"âœ… Qualified"}):e.jsx(c,{className:"text-xs bg-red-100 text-red-800 border-red-300",children:"âŒ Not Qualified"}),e.jsx(c,{variant:"outline",className:"text-xs",children:a.student.student_number}),a.student.specific_year_level&&e.jsx(c,{variant:"secondary",className:"text-xs",children:(g==null?void 0:g[a.student.specific_year_level])||a.student.specific_year_level.replace("grade_","Grade ")}),a.student.section&&e.jsx(c,{variant:"outline",className:"text-xs bg-blue-50 text-blue-700",children:a.student.section.name})]})]}),!t&&((u=a.result)==null?void 0:u.reason)&&e.jsxs("div",{className:"mb-2 text-sm text-red-600 bg-red-50 border border-red-200 rounded p-2",children:[e.jsx("strong",{children:"Reason:"})," ",a.result.reason,a.result.failed_grades&&a.result.failed_grades.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsxs("p",{className:"text-xs font-semibold mb-1",children:["Failed Grades (",a.result.failed_grades.length,"):"]}),e.jsxs("ul",{className:"text-xs space-y-1",children:[a.result.failed_grades.slice(0,3).map((p,R)=>e.jsxs("li",{children:["â€¢ ",p.subject," (",p.period,"): ",e.jsx("span",{className:"font-bold",children:p.grade.toFixed(2)})]},R)),a.result.failed_grades.length>3&&e.jsxs("li",{className:"text-gray-500 italic",children:["... and ",a.result.failed_grades.length-3,' more (click "View Details" to see all)']})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 text-sm",children:[e.jsxs("div",{className:"bg-blue-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium text-blue-700",children:"Average Grade:"}),e.jsx("div",{className:"text-lg font-bold",children:a.result.average_grade})]}),e.jsxs("div",{className:"bg-yellow-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium text-yellow-700",children:"Min Grade:"}),e.jsx("div",{className:"text-lg font-bold",children:a.result.min_grade})]}),e.jsxs("div",{className:"bg-green-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium text-green-700",children:"Total Quarters:"}),e.jsx("div",{className:"text-lg font-bold",children:((G=a.result.quarter_averages)==null?void 0:G.length)??((v=(P=a.result.grades_breakdown)==null?void 0:P.periods)==null?void 0:v.length)??0})]}),e.jsxs("div",{className:"bg-purple-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium text-purple-700",children:"Honor:"}),e.jsx("div",{className:"font-bold",children:(()=>{var R,fe,Se,we,He,Ce,Ae,Fe;if(console.log("[SHS Honor Column] Student:",a.student.name),console.log("[SHS Honor Column] Result:",a.result),console.log("[SHS Honor Column] Qualifications:",(R=a.result)==null?void 0:R.qualifications),console.log("[SHS Honor Column] Average Grade:",(fe=a.result)==null?void 0:fe.average_grade),((we=(Se=a.result)==null?void 0:Se.qualifications)==null?void 0:we.length)>0){const I=(Ce=(He=a.result.qualifications[0])==null?void 0:He.honor_type)==null?void 0:Ce.name;if(console.log("[SHS Honor Column] Honor from qualifications:",I),I)return e.jsx(c,{className:"bg-purple-100 text-purple-800 border-purple-200",children:I})}const p=Y((Ae=a.result)==null?void 0:Ae.average_grade);return console.log("[SHS Honor Column] Derived honor from average:",p),p?e.jsx(c,{className:"bg-purple-100 text-purple-800 border-purple-200",children:p}):(Fe=a.result)!=null&&Fe.qualified?(console.log("[SHS Honor Column] Showing Computing... (qualified but no honor)"),e.jsx(c,{className:"bg-yellow-100 text-yellow-800 border-yellow-200",children:"Computing..."})):(console.log("[SHS Honor Column] Showing N/A (not qualified)"),e.jsx("span",{className:"text-gray-500",children:"N/A"}))})()})]})]})]}),e.jsx("div",{className:"ml-4",children:e.jsx(x,{variant:"outline",size:"sm",onClick:()=>{var p;console.log("[SHS Modal] Opening details for:",a.student.name),console.log("[SHS Modal] Student result:",a.result),console.log("[SHS Modal] Qualifications array:",(p=a.result)==null?void 0:p.qualifications),Me(a),V(!0)},children:"View Details"})})]})},a.student.id)})})]})})()})})]})]})})]}),e.jsx(We,{open:De,onOpenChange:V,children:e.jsxs(Ze,{className:"max-w-[95vw] w-[95vw] max-h-[95vh] overflow-y-auto",children:[e.jsxs(Ye,{children:[e.jsxs(es,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-purple-600"}),"Student Honor Details"]}),e.jsx(ss,{children:"Detailed grade breakdown and honor calculation"})]}),d&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3 text-gray-900",children:"Student Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-3 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Name:"}),e.jsx("p",{className:"font-semibold text-gray-900",children:d.student.name})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Student Number:"}),e.jsx("p",{className:"font-semibold text-gray-900",children:d.student.student_number})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Grade Level:"}),e.jsx("p",{className:"font-semibold text-gray-900",children:(g==null?void 0:g[d.student.specific_year_level||""])||((re=d.student.specific_year_level)==null?void 0:re.replace("grade_","Grade "))||"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Section:"}),e.jsx("p",{className:"font-semibold text-gray-900",children:((te=d.student.section)==null?void 0:te.name)||"N/A"})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-purple-50 to-pink-50 p-4 rounded-lg border border-purple-200",children:[e.jsxs("h3",{className:"font-semibold text-lg mb-3 text-gray-900 flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5 text-purple-600"}),"Honor Achievement"]}),e.jsx("div",{className:"space-y-2",children:(()=>{var s,l,a,r,t,m,u,G,P;if(console.log("[SHS Honor Achievement] Selected student:",d.student.name),console.log("[SHS Honor Achievement] Qualifications:",(s=d.result)==null?void 0:s.qualifications),console.log("[SHS Honor Achievement] Qualifications length:",(a=(l=d.result)==null?void 0:l.qualifications)==null?void 0:a.length),console.log("[SHS Honor Achievement] Average grade:",(r=d.result)==null?void 0:r.average_grade),((m=(t=d.result)==null?void 0:t.qualifications)==null?void 0:m.length)>0){const v=d.result.qualifications[d.result.qualifications.length-1];return console.log("[SHS Honor Achievement] Highest honor:",v),console.log("[SHS Honor Achievement] Honor type name:",(u=v.honor_type)==null?void 0:u.name),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-5 w-5 text-green-600"}),e.jsx(c,{className:"bg-purple-600 text-white text-base py-1 px-3",children:((G=v.honor_type)==null?void 0:G.name)||"Unknown Honor"})]})}else{const v=Y((P=d.result)==null?void 0:P.average_grade);return console.log("[SHS Honor Achievement] Derived honor from average:",v),e.jsx("p",{className:"text-gray-600",children:v||"No honor qualification found"})}})()})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-lg mb-3 text-gray-900",children:"Grade Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-blue-50 p-3 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"text-sm text-blue-700 font-medium",children:"Average Grade"}),e.jsx("p",{className:"text-2xl font-bold text-blue-900",children:((de=(ne=d.result)==null?void 0:ne.average_grade)==null?void 0:de.toFixed(2))||"N/A"}),e.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"100 is highest"})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded-lg border border-green-200",children:[e.jsx("span",{className:"text-sm text-green-700 font-medium",children:"Best Grade"}),e.jsx("p",{className:"text-2xl font-bold text-green-900",children:((oe=(ie=d.result)==null?void 0:ie.max_grade)==null?void 0:oe.toFixed(2))||"N/A"}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Highest score"})]}),e.jsxs("div",{className:"bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:[e.jsx("span",{className:"text-sm text-yellow-700 font-medium",children:"Worst Grade"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-900",children:((me=(ce=d.result)==null?void 0:ce.min_grade)==null?void 0:me.toFixed(2))||"N/A"}),e.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"Lowest score"})]})]})]}),((he=(xe=d.result)==null?void 0:xe.grades_breakdown)==null?void 0:he.subjects)&&Object.keys(d.result.grades_breakdown.subjects).length>0&&e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"font-semibold text-xl mb-4 text-gray-900",children:"Grade Breakdown by Semester"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 p-4",children:[e.jsxs("h4",{className:"font-bold text-lg text-white flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"First Semester"]}),((ge=d.result.grades_breakdown.semester_summaries)==null?void 0:ge.first_semester)&&e.jsxs("p",{className:"text-blue-100 text-sm mt-1",children:["Average: ",e.jsx("span",{className:"font-bold text-white",children:((ue=d.result.grades_breakdown.semester_summaries.first_semester.average)==null?void 0:ue.toFixed(2))||"N/A"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-semibold text-gray-700",children:"Subject"}),e.jsx("th",{className:"text-center p-3 font-semibold text-gray-700",children:"Midterm"}),e.jsx("th",{className:"text-center p-3 font-semibold text-gray-700",children:"Pre-Final"}),e.jsx("th",{className:"text-center p-3 font-semibold text-gray-700 bg-blue-50",children:"Average"})]})}),e.jsx("tbody",{children:Object.entries(d.result.grades_breakdown.subjects).map(([s,l],a)=>{const r=l.SHS_S1_MT||l.m1||l.Q1||null,t=l.SHS_S1_PF||l["Pre-final"]||l.Q2||null;return r===null&&t===null?null:e.jsxs("tr",{className:a%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium text-gray-900",children:s}),e.jsx("td",{className:"p-3 text-center text-gray-700",children:r!==null?r.toFixed(2):"-"}),e.jsx("td",{className:"p-3 text-center text-gray-700",children:t!==null?t.toFixed(2):"-"}),e.jsx("td",{className:"p-3 text-center font-bold text-blue-900 bg-blue-50",children:r!==null&&t!==null?((r+t)/2).toFixed(2):r!==null?r.toFixed(2):t!==null?t.toFixed(2):"-"})]},a)})})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 overflow-hidden",children:[e.jsxs("div",{className:"bg-gradient-to-r from-purple-500 to-purple-600 p-4",children:[e.jsxs("h4",{className:"font-bold text-lg text-white flex items-center gap-2",children:[e.jsx(y,{className:"h-5 w-5"}),"Second Semester"]}),((pe=d.result.grades_breakdown.semester_summaries)==null?void 0:pe.second_semester)&&e.jsxs("p",{className:"text-purple-100 text-sm mt-1",children:["Average: ",e.jsx("span",{className:"font-bold text-white",children:((je=d.result.grades_breakdown.semester_summaries.second_semester.average)==null?void 0:je.toFixed(2))||"N/A"})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-semibold text-gray-700",children:"Subject"}),e.jsx("th",{className:"text-center p-3 font-semibold text-gray-700",children:"Midterm"}),e.jsx("th",{className:"text-center p-3 font-semibold text-gray-700",children:"Pre-Final"}),e.jsx("th",{className:"text-center p-3 font-semibold text-gray-700 bg-purple-50",children:"Average"})]})}),e.jsx("tbody",{children:Object.entries(d.result.grades_breakdown.subjects).map(([s,l],a)=>{const r=l.SHS_S2_MT||l.m2||l.Q3||null,t=l.SHS_S2_PF||l["pre-final2"]||l.Q4||null;return r===null&&t===null?null:e.jsxs("tr",{className:a%2===0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"p-3 font-medium text-gray-900",children:s}),e.jsx("td",{className:"p-3 text-center text-gray-700",children:r!==null?r.toFixed(2):"-"}),e.jsx("td",{className:"p-3 text-center text-gray-700",children:t!==null?t.toFixed(2):"-"}),e.jsx("td",{className:"p-3 text-center font-bold text-purple-900 bg-purple-50",children:r!==null&&t!==null?((r+t)/2).toFixed(2):r!==null?r.toFixed(2):t!==null?t.toFixed(2):"-"})]},a)})})]})})]})]}),e.jsx("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 p-4 rounded-lg border-2 border-green-300",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold text-lg text-green-900",children:"Overall Academic Performance"}),e.jsx("p",{className:"text-sm text-green-700 mt-1",children:"Combined average across all semesters"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-4xl font-bold text-green-900",children:((be=(_e=d.result)==null?void 0:_e.average_grade)==null?void 0:be.toFixed(2))||"N/A"}),e.jsx("p",{className:"text-sm text-green-600 mt-1",children:"Final GPA (1.0 is highest)"})]})]})})]}),!((Ne=d.result)!=null&&Ne.qualified)&&((ve=d.result)!=null&&ve.failed_grades)&&d.result.failed_grades.length>0?e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg border-2 border-red-300",children:[e.jsxs("h3",{className:"font-semibold text-lg text-red-900 mb-3 flex items-center gap-2",children:[e.jsx(Ie,{className:"h-5 w-5"}),"Disqualification Details"]}),e.jsxs("p",{className:"text-sm text-red-800 mb-4",children:[e.jsx("strong",{children:"Reason:"})," ",d.result.reason]}),e.jsx("div",{className:"bg-white rounded-lg border border-red-200 overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-red-100 border-b border-red-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3 font-semibold text-red-900",children:"Subject"}),e.jsx("th",{className:"text-left p-3 font-semibold text-red-900",children:"Period"}),e.jsx("th",{className:"text-center p-3 font-semibold text-red-900",children:"Grade"}),e.jsx("th",{className:"text-center p-3 font-semibold text-red-900",children:"Required"})]})}),e.jsx("tbody",{children:d.result.failed_grades.map((s,l)=>e.jsxs("tr",{className:l%2===0?"bg-white":"bg-red-50",children:[e.jsx("td",{className:"p-3 font-medium text-gray-900",children:s.subject}),e.jsx("td",{className:"p-3 text-gray-700",children:s.period}),e.jsx("td",{className:"p-3 text-center",children:e.jsx(c,{variant:"destructive",className:"font-bold",children:s.grade.toFixed(2)})}),e.jsx("td",{className:"p-3 text-center text-gray-600",children:"â‰¥ 85"})]},l))})]})}),e.jsx("div",{className:"mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded",children:e.jsxs("p",{className:"text-sm text-yellow-800",children:["ðŸ’¡ ",e.jsx("strong",{children:"Note:"})," To qualify for honors, ALL grades must be 85 or above, even if the period average meets the honor threshold (90+)."]})})]}):e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:[e.jsx("h3",{className:"font-semibold text-sm text-gray-700 mb-2",children:"Qualification Status"}),e.jsx("p",{className:"text-sm text-gray-900",children:((ye=d.result)==null?void 0:ye.reason)||"N/A"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(x,{onClick:()=>V(!1),variant:"outline",children:"Close"})})]})]})})]})}export{Us as default};
