import{m as Z,R as k,r as O,K as U,j as e,$ as P,S as G}from"./app-h60rEgzE.js";import{H as ee}from"./header-DDIGV6PF.js";import{S as ie}from"./sidebar-BcpkLs1z.js";import{C as g,b as S,c as b,a as N}from"./card-CWYWwXiB.js";import{B as ne}from"./badge-QN8QHdgv.js";import{B as j}from"./button-Cf-3KuVl.js";import{I as m}from"./input-BpOUNz7A.js";import{L as d}from"./label-CfjKGwBL.js";import{S as r,a as u,b as p,c as _,d as h}from"./select-BwLsxDFn.js";import{A as t,a as s}from"./alert-DFkkIqpD.js";import{P as ae}from"./PasswordResetModal-XUTjItuv.js";import{A as ce}from"./arrow-left-CAa4qh_s.js";import{S as le}from"./save-ET8khaLJ.js";import{R as de}from"./rotate-ccw-CN66qtyp.js";/* empty css            */import"./dropdown-menu-C7IjDfPR.js";import"./Combination-CZJLarlp.js";import"./index-BFEtJ0zY.js";import"./separator-B6yToEW3.js";import"./users-BWux7v9-.js";import"./chevron-right-CMVFfibE.js";import"./crown-BVCmpPnp.js";import"./building-2-DQUqwPFG.js";import"./user-cog-CJiF4UPQ.js";import"./book-open-DqTHd1pD.js";import"./user-check-Dw2GBAlL.js";import"./graduation-cap-CXXzcNYi.js";import"./notebook-DJRSkTlK.js";import"./chart-no-axes-column-increasing-DmrfAclB.js";import"./shield-DwcdCFAT.js";import"./index-6x9MyNx1.js";import"./index-Hky3KEgx.js";import"./check-fkvXk6yg.js";import"./dialog-CCsewRTN.js";import"./eye-CmvkEHdJ.js";const te=x=>{if(!x)return"";const n=new Date(x);if(isNaN(n.getTime()))return"";const C=n.getFullYear(),a=String(n.getMonth()+1).padStart(2,"0"),y=String(n.getDate()).padStart(2,"0");return`${C}-${a}-${y}`};function Oe({user:x,targetUser:n,roles:C,errors:a,yearLevels:y,specificYearLevels:w,strands:D,courses:R,departments:A}){var B,M,H,T;const{data:c,setData:l,put:J,processing:L}=Z({name:(n==null?void 0:n.name)||"",email:(n==null?void 0:n.email)||"",user_role:(n==null?void 0:n.user_role)||"",academic_level:(n==null?void 0:n.year_level)||"",specific_year_level:(n==null?void 0:n.specific_year_level)||"",strand_id:((B=n==null?void 0:n.strand_id)==null?void 0:B.toString())||"",course_id:((M=n==null?void 0:n.course_id)==null?void 0:M.toString())||"",department_id:((H=n==null?void 0:n.department_id)==null?void 0:H.toString())||"",section_id:((T=n==null?void 0:n.section_id)==null?void 0:T.toString())||"",student_number:(n==null?void 0:n.student_number)||"",birth_date:te(n==null?void 0:n.birth_date),gender:(n==null?void 0:n.gender)||"",phone_number:(n==null?void 0:n.phone_number)||"",address:(n==null?void 0:n.address)||"",emergency_contact_name:(n==null?void 0:n.emergency_contact_name)||"",emergency_contact_phone:(n==null?void 0:n.emergency_contact_phone)||"",emergency_contact_relationship:(n==null?void 0:n.emergency_contact_relationship)||""}),[v,E]=k.useState([]),[F,V]=k.useState(!1),[z,$]=O.useState(!1),[I,f]=O.useState(""),{errors:K}=U().props;if(!x||!n)return e.jsx("div",{children:"Loading..."});k.useEffect(()=>{const i={};if(!c.academic_level){E([]);return}c.academic_level&&(i.academic_level_key=c.academic_level),c.specific_year_level&&(i.specific_year_level=c.specific_year_level),c.strand_id&&(i.strand_id=c.strand_id.toString()),c.department_id&&(i.department_id=c.department_id.toString()),c.course_id&&(i.course_id=c.course_id.toString());const o=new URLSearchParams(i).toString();V(!0),fetch(route("admin.academic.api.sections")+(o?`?${o}`:"")).then(async q=>{if(!q.ok)throw new Error("Failed to load sections");const Y=await q.json();E(Y||[])}).catch(()=>E([])).finally(()=>V(!1))},[c.academic_level,c.specific_year_level,c.strand_id,c.department_id,c.course_id]);const Q=i=>{var o;if(i.preventDefault(),!c.section_id||c.section_id===""){f("Please select a section. This field is required."),(o=document.getElementById("section_id"))==null||o.scrollIntoView({behavior:"smooth",block:"center"});return}if(v.length===0){f("No sections are available for the selected academic level and course. Please contact the administrator to create sections first.");return}f(""),J(route("admin.students.update",n.id))},W=()=>{$(!0)},X=i=>{switch(i){case"admin":return"default";case"registrar":case"teacher":case"instructor":case"adviser":case"chairperson":case"principal":return"secondary";case"student":case"parent":return"outline";default:return"outline"}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(ie,{user:x}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(ee,{user:x}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(P,{href:route("admin.students.index"),children:e.jsxs(j,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Back to Students"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Edit Student"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Update student information and role assignments."})]})]}),e.jsxs(g,{children:[e.jsx(S,{children:e.jsx(b,{children:"Current Student Information"})}),e.jsx(N,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Name"}),e.jsx("p",{className:"text-lg",children:n.name})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Email"}),e.jsx("p",{className:"text-lg",children:n.email})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Current Role"}),e.jsx(ne,{variant:X(n.user_role),className:"mt-1",children:C[n.user_role]||n.user_role})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Member Since"}),e.jsx("p",{className:"text-lg",children:new Date(n.created_at).toLocaleDateString()})]})]})})]}),e.jsxs(g,{children:[e.jsx(S,{children:e.jsx(b,{children:"Update Student Information"})}),e.jsx(N,{children:e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"name",children:"Full Name *"}),e.jsx(m,{id:"name",type:"text",value:c.name,onChange:i=>l("name",i.target.value),placeholder:"Enter full name",required:!0}),(a==null?void 0:a.name)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.name})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:"Email Address *"}),e.jsx(m,{id:"email",type:"email",value:c.email,onChange:i=>l("email",i.target.value),placeholder:"Enter email address",required:!0}),(a==null?void 0:a.email)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.email})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"academic_level",children:"Academic Level *"}),e.jsxs(r,{value:c.academic_level,onValueChange:i=>{l("academic_level",i),l("specific_year_level",""),l("strand_id",""),l("course_id",""),l("department_id",""),l("section_id","")},children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Select academic level"})}),e.jsx(_,{children:(y||{elementary:"Elementary",junior_highschool:"Junior High School",senior_highschool:"Senior High School",college:"College"})&&Object.entries(y||{elementary:"Elementary",junior_highschool:"Junior High School",senior_highschool:"Senior High School",college:"College"}).map(([i,o])=>e.jsx(h,{value:i,children:o},i))})]}),(a==null?void 0:a.academic_level)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.academic_level})})]}),c.academic_level&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"specific_year_level",children:"Year Level *"}),e.jsxs(r,{value:c.specific_year_level,onValueChange:i=>{l("specific_year_level",i),l("section_id","")},children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Select year level"})}),e.jsx(_,{children:w&&w[c.academic_level]&&Object.entries(w[c.academic_level]).map(([i,o])=>e.jsx(h,{value:i,children:o},i))})]}),(a==null?void 0:a.specific_year_level)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.specific_year_level})})]}),c.academic_level==="senior_highschool"&&c.specific_year_level&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"strand_id",children:"Strand *"}),e.jsxs(r,{value:c.strand_id,onValueChange:i=>{l("strand_id",i),l("section_id","")},children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Select a strand"})}),e.jsx(_,{children:D&&D.map(i=>e.jsxs(h,{value:i.id.toString(),children:[i.name," (",i.code,")",i.track?` - ${i.track.name}`:""]},i.id))})]}),(a==null?void 0:a.strand_id)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.strand_id})})]}),c.academic_level==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"department_id",children:"Department *"}),e.jsxs(r,{value:c.department_id,onValueChange:i=>{l("department_id",i),l("course_id",""),l("section_id","")},children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Select a department"})}),e.jsx(_,{children:A&&A.filter(i=>i.academic_level_id===4).map(i=>e.jsxs(h,{value:i.id.toString(),children:[i.name," (",i.code,")"]},i.id))})]}),(a==null?void 0:a.department_id)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.department_id})})]}),c.academic_level==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"course_id",children:"Course *"}),e.jsxs(r,{value:c.course_id,onValueChange:i=>{l("course_id",i),l("section_id","")},disabled:!c.department_id,children:[e.jsx(u,{children:e.jsx(p,{placeholder:c.department_id?"Select a course":"Select department first"})}),e.jsx(_,{children:R&&R.filter(i=>!c.department_id||i.department_id.toString()===c.department_id).map(i=>e.jsxs(h,{value:i.id.toString(),children:[i.name," (",i.code,")"]},i.id))})]}),(a==null?void 0:a.course_id)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.course_id})})]}),c.academic_level&&e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(d,{htmlFor:"section_id",children:"Section *"}),e.jsxs(r,{value:c.section_id,onValueChange:i=>{l("section_id",i),f("")},disabled:F||!c.specific_year_level&&c.academic_level!=="college",children:[e.jsx(u,{id:"section_id",children:e.jsx(p,{placeholder:F?"Loading sections...":v.length?"Select a section":"No sections available"})}),e.jsx(_,{children:v.map(i=>e.jsxs(h,{value:i.id.toString(),children:[i.name,i.code?` (${i.code})`:"",typeof i.max_students=="number"&&typeof i.current_students=="number"?` â€¢ ${i.current_students}/${i.max_students}`:""]},i.id))})]}),((a==null?void 0:a.section_id)||I)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:(a==null?void 0:a.section_id)||I})}),v.length===0&&!F&&e.jsx(t,{children:e.jsx(s,{children:"No sections are available for the selected academic level and course combination. Please contact the administrator to create sections before adding students."})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"student_number",children:"Student Number"}),e.jsx(m,{id:"student_number",type:"text",value:c.student_number,onChange:i=>l("student_number",i.target.value),placeholder:"e.g. EL-2025-000123"}),(a==null?void 0:a.student_number)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.student_number})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{children:"Last Login"}),e.jsx("div",{className:"p-3 bg-gray-50 rounded border dark:bg-gray-800",children:n.last_login_at?new Date(n.last_login_at).toLocaleString():"Never logged in"})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:"Personal Information"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"birth_date",children:"Birth Date"}),e.jsx(m,{id:"birth_date",type:"date",value:c.birth_date,onChange:i=>l("birth_date",i.target.value)}),(a==null?void 0:a.birth_date)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.birth_date})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"gender",children:"Gender"}),e.jsxs(r,{value:c.gender,onValueChange:i=>l("gender",i),children:[e.jsx(u,{children:e.jsx(p,{placeholder:"Select gender"})}),e.jsxs(_,{children:[e.jsx(h,{value:"male",children:"Male"}),e.jsx(h,{value:"female",children:"Female"}),e.jsx(h,{value:"other",children:"Other"})]})]}),(a==null?void 0:a.gender)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.gender})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"phone_number",children:"Phone Number"}),e.jsx(m,{id:"phone_number",type:"tel",value:c.phone_number,onChange:i=>l("phone_number",i.target.value),placeholder:"Enter phone number"}),(a==null?void 0:a.phone_number)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.phone_number})})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(d,{htmlFor:"address",children:"Address"}),e.jsx(m,{id:"address",type:"text",value:c.address,onChange:i=>l("address",i.target.value),placeholder:"Enter complete address"}),(a==null?void 0:a.address)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.address})})]})]})]}),e.jsxs("div",{className:"border-t pt-6",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-4",children:"Emergency Contact"}),e.jsxs("div",{className:"grid gap-6 md:grid-cols-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"emergency_contact_name",children:"Emergency Contact Name"}),e.jsx(m,{id:"emergency_contact_name",type:"text",value:c.emergency_contact_name,onChange:i=>l("emergency_contact_name",i.target.value),placeholder:"Enter emergency contact name"}),(a==null?void 0:a.emergency_contact_name)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.emergency_contact_name})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"emergency_contact_phone",children:"Emergency Contact Phone"}),e.jsx(m,{id:"emergency_contact_phone",type:"tel",value:c.emergency_contact_phone,onChange:i=>l("emergency_contact_phone",i.target.value),placeholder:"Enter emergency contact phone"}),(a==null?void 0:a.emergency_contact_phone)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.emergency_contact_phone})})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(d,{htmlFor:"emergency_contact_relationship",children:"Relationship"}),e.jsx(m,{id:"emergency_contact_relationship",type:"text",value:c.emergency_contact_relationship,onChange:i=>l("emergency_contact_relationship",i.target.value),placeholder:"e.g., Father, Mother, Guardian, etc."}),(a==null?void 0:a.emergency_contact_relationship)&&e.jsx(t,{variant:"destructive",children:e.jsx(s,{children:a.emergency_contact_relationship})})]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-6",children:[e.jsxs(j,{type:"submit",disabled:L||v.length===0||!c.section_id,className:"flex items-center gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),L?"Updating...":"Update Student"]}),e.jsx(P,{href:route("admin.students.index"),children:e.jsx(j,{type:"button",variant:"outline",children:"Cancel"})})]})]})})]}),e.jsxs(g,{children:[e.jsx(S,{children:e.jsx(b,{children:"Password Management"})}),e.jsx(N,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Reset the student's password to allow them to regain access to their account. A new temporary password will be generated."}),e.jsxs(j,{onClick:W,variant:"outline",className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"Reset Password"]})]})})]}),e.jsxs(g,{children:[e.jsx(S,{children:e.jsx(b,{children:"Additional Actions"})}),e.jsx(N,{children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(P,{href:route("admin.students.show",n.id),children:e.jsx(j,{variant:"outline",children:"View Full Profile"})}),n.id!==x.id&&e.jsx(j,{variant:"destructive",onClick:()=>{confirm("Are you sure you want to delete this student? This action cannot be undone.")&&G.delete(route("admin.students.destroy",n.id),{onSuccess:()=>{G.visit(route("admin.students.index"))},onError:i=>{console.error("Delete failed:",i)}})},children:"Delete Student"})]})})]})]})})]}),e.jsx(ae,{user:n,isOpen:z,onClose:()=>$(!1),errors:K})]})}export{Oe as default};
