import{r,K as he,u as xe,j as e,$ as C,S as b}from"./app-CPVuaUyW.js";import{H as pe}from"./header-CeiV6l8I.js";import{S as me}from"./sidebar-BBLGtzjj.js";import{C as q,a as G,b as ge,c as fe}from"./card-I9XnqY-P.js";import{B as je}from"./badge-BtLRiEBI.js";import{B as g}from"./button-TmCAEztk.js";import{I as ue}from"./input-B4XbihpH.js";import{P as Se}from"./PasswordResetModal-Ct8Xaji5.js";import{S as j,a as u,b as S,c as _,d as N}from"./select-DBIDRFAc.js";import{D as _e,b as Ne,c as ye,d as we,e as Ce,f as be}from"./dialog-C-CHPyZZ.js";import{S as ke}from"./search-DHlV265O.js";import{P as ve}from"./plus-C6AKuicI.js";import{U as J}from"./upload-B7cjCwpN.js";import{D as Q}from"./download-B9CULgC0.js";import{E as De}from"./eye-DNXbTreL.js";import{S as Ve}from"./square-pen-baDK2gnW.js";import{R as Te}from"./rotate-ccw-CY2pqEgK.js";import{T as Pe}from"./trash-2-CX3qsELf.js";/* empty css            */import"./dropdown-menu-D5wJaO3L.js";import"./Combination-11n-k1xF.js";import"./index-tEkW_jyA.js";import"./separator-DIo7NCj3.js";import"./users-iWnFA-n0.js";import"./chevron-right-odkdP2ln.js";import"./crown-CRggEu0y.js";import"./building-2-BlK2e8GB.js";import"./user-cog-D4IJ0cl1.js";import"./book-open-oIFCJ6ev.js";import"./user-check-CEal4AA3.js";import"./graduation-cap-Bk3NHoQY.js";import"./notebook-CwvBSWGe.js";import"./chart-no-axes-column-increasing-dSdbgFne.js";import"./shield-Bi-XbMBj.js";import"./label-BdYcMX0_.js";import"./alert-Bmwa_vsE.js";import"./index-rx26uqRS.js";import"./index-nCH46j7S.js";import"./check-DdTJz3zl.js";function js({user:k,users:h,filters:o,roles:W,currentAcademicLevel:a,sections:y=[],specificYearLevels:V={},tracks:X=[],strands:T=[],departments:Z=[],courses:P=[]}){const[z,U]=r.useState(o.search||""),[E,I]=r.useState(null),[L,M]=r.useState(!1),[l,v]=r.useState(""),[i,w]=r.useState(""),[d,F]=r.useState(""),[x,R]=r.useState(""),[c,B]=r.useState(""),[f,O]=r.useState(""),{errors:A,flash:p}=he().props,H=r.useRef(null),{addToast:m}=xe();if(!k)return e.jsx("div",{children:"Loading..."});r.useEffect(()=>{p!=null&&p.success&&m(p.success,"success"),p!=null&&p.warning&&m(p.warning,"warning"),p!=null&&p.error&&m(p.error,"error")},[p]);const ee=r.useMemo(()=>a==="senior_highschool"&&d?T.filter(s=>s.track_id.toString()===d):T,[a,d,T]),se=r.useMemo(()=>a==="college"&&c?P.filter(s=>s.department_id.toString()===c):P,[a,c,P]),ae=r.useMemo(()=>a==="elementary"||a==="junior_highschool"?l&&y.length>0?y.filter(s=>s.specific_year_level===l):y:a==="senior_highschool"?d&&x&&l?y.filter(s=>{var t,n;return((t=s.track_id)==null?void 0:t.toString())===d&&((n=s.strand_id)==null?void 0:n.toString())===x&&s.specific_year_level===l}):[]:a==="college"?c&&f&&l?y.filter(s=>{var t,n;return((t=s.department_id)==null?void 0:t.toString())===c&&((n=s.course_id)==null?void 0:n.toString())===f&&s.specific_year_level===l}):[]:y,[a,l,d,x,c,f,y]);r.useEffect(()=>{a==="senior_highschool"&&(R(""),w(""))},[d,a]),r.useEffect(()=>{a==="senior_highschool"&&w("")},[x,a]),r.useEffect(()=>{a==="college"&&(O(""),w(""))},[c,a]),r.useEffect(()=>{a==="college"&&w("")},[f,a]),r.useEffect(()=>{w("")},[l]);const $=()=>{b.get(route("admin.students.index"),{search:z},{preserveState:!0,replace:!0})},D=s=>{const t=o.sort_direction||"desc",n=o.sort_by===s&&t==="desc"?"asc":"desc";b.get(route("admin.students.index"),{...o,sort_by:s,sort_direction:n},{preserveState:!0,replace:!0})},te=s=>{confirm("Are you sure you want to delete this student? This action cannot be undone.")&&b.delete(route("admin.students.destroy",s),{onSuccess:()=>{b.reload()},onError:t=>{console.error("Delete failed:",t)}})},le=s=>{I(s)},re=()=>{a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?M(!0):K()},ne=()=>{if(!i&&(a==="elementary"||a==="junior_highschool")){m("Please select a grade level and section first.","error");return}if(!i&&a==="senior_highschool"){m("Please select track, strand, and section first.","error");return}if(!i&&a==="college"){m("Please select department, course, year level, and section first.","error");return}const s={};a&&(s.academic_level=a),l&&(s.specific_year_level=l),d&&(s.track_id=d),x&&(s.strand_id=x),c&&(s.department_id=c),f&&(s.course_id=f),i&&(s.section_id=i),window.location.href=route("admin.students.template",s),m("Downloading CSV template...","success")},K=()=>{const s=a?{academic_level:a}:{};window.location.href=route("admin.students.template",s)},oe=()=>{var s;if(!i&&(a==="elementary"||a==="junior_highschool")){m("Please select a grade level and section first.","error");return}if(!i&&a==="senior_highschool"){m("Please select track, strand, and section first.","error");return}if(!i&&a==="college"){m("Please select department, course, year level, and section first.","error");return}(s=H.current)==null||s.click()},ie=s=>{var Y;const t=(Y=s.target.files)==null?void 0:Y[0];if(!t)return;const n=new FormData;n.append("file",t),a&&n.append("academic_level",a),l&&n.append("specific_year_level",l),d&&n.append("track_id",d),x&&n.append("strand_id",x),c&&n.append("department_id",c),f&&n.append("course_id",f),i&&n.append("section_id",i),b.post(route("admin.students.upload"),n,{forceFormData:!0,onSuccess:()=>{m("Students CSV uploaded successfully.","success"),M(!1),v(""),w(""),F(""),R(""),B(""),O(""),b.reload()},onError:ce=>{console.error("CSV upload failed:",ce),m("CSV upload failed. Please check the file format.","error")},preserveScroll:!0}),s.target.value=""},de=s=>{switch(s){case"admin":return"default";case"registrar":case"teacher":case"instructor":case"adviser":case"chairperson":case"principal":return"secondary";case"student":case"parent":return"outline";default:return"outline"}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(me,{user:k}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(pe,{user:k}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[a?a.charAt(0).toUpperCase()+a.slice(1).replace("_"," "):"Students"," Management"]}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Create, manage, and monitor ",a?a.replace("_"," "):"student"," accounts in the school system."]})]}),e.jsx(q,{children:e.jsx(G,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:flex-wrap lg:items-center lg:justify-between",children:[e.jsx("div",{className:"flex flex-col gap-3 md:flex-row md:flex-wrap md:items-center flex-1 min-w-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ue,{placeholder:"Search students...",value:z,onChange:s=>U(s.target.value),onKeyDown:s=>s.key==="Enter"&&$(),className:"w-64"}),e.jsx(g,{onClick:$,variant:"outline",children:e.jsx(ke,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end w-full lg:w-auto",children:[a&&e.jsx(C,{href:route(`admin.students.${a.replace("_","-")}.create`),children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-4 w-4"}),"Add New ",a.charAt(0).toUpperCase()+a.slice(1).replace("_"," ")]})}),e.jsx("input",{type:"file",accept:".csv,text/csv",ref:H,className:"hidden",onChange:ie}),e.jsxs(g,{variant:"outline",className:"flex items-center gap-2",onClick:re,children:[e.jsx(J,{className:"h-4 w-4"}),a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?"CSV Upload Manager":"Upload CSV"]}),!(a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college")&&e.jsxs(g,{variant:"outline",className:"flex items-center gap-2",onClick:K,children:[e.jsx(Q,{className:"h-4 w-4"}),"Download Template"]})]})]})})}),e.jsxs(q,{children:[e.jsx(ge,{children:e.jsxs(fe,{children:[a?a.charAt(0).toUpperCase()+a.slice(1).replace("_"," "):"Students"," (",h.total," total)"]})}),e.jsxs(G,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>D("name"),children:["Name",o.sort_by==="name"&&e.jsx("span",{className:"ml-1",children:o.sort_direction==="desc"?"↓":"↑"})]}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>D("student_number"),children:["Student ID",o.sort_by==="student_number"&&e.jsx("span",{className:"ml-1",children:o.sort_direction==="desc"?"↓":"↑"})]}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>D("email"),children:["Email",o.sort_by==="email"&&e.jsx("span",{className:"ml-1",children:o.sort_direction==="desc"?"↓":"↑"})]}),e.jsx("th",{className:"p-3 text-left",children:"Role"}),e.jsx("th",{className:"p-3 text-left",children:"Parents"}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>D("created_at"),children:["Created",o.sort_by==="created_at"&&e.jsx("span",{className:"ml-1",children:o.sort_direction==="desc"?"↓":"↑"})]}),e.jsx("th",{className:"p-3 text-left",children:"Last Login"}),e.jsx("th",{className:"p-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:h.data.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"p-3 font-medium",children:s.name}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.student_number||"—"}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.email}),e.jsx("td",{className:"p-3",children:e.jsx(je,{variant:de(s.user_role),children:W[s.user_role]||s.user_role})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.parents&&s.parents.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.parents.slice(0,2).map(t=>e.jsx(C,{href:route("admin.parents.show",t.id),className:"underline",children:t.name},t.id)),s.parents.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.parents.length-2," more"]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"No parents linked"})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString():"Never"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{href:route("admin.students.show",s.id),children:e.jsx(g,{variant:"outline",size:"sm",children:e.jsx(De,{className:"h-3 w-3"})})}),e.jsx(C,{href:route("admin.students.edit",s.id),children:e.jsx(g,{variant:"outline",size:"sm",children:e.jsx(Ve,{className:"h-3 w-3"})})}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>le(s),children:e.jsx(Te,{className:"h-3 w-3"})}),s.id!==k.id&&e.jsx(g,{variant:"destructive",size:"sm",onClick:()=>te(s.id),children:e.jsx(Pe,{className:"h-3 w-3"})})]})})]},s.id))})]})}),h.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",h.from," to ",h.to," of ",h.total," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h.current_page>1&&e.jsx(C,{href:route("admin.students.index",{...o,page:h.current_page-1}),children:e.jsx(g,{variant:"outline",size:"sm",children:"Previous"})}),e.jsxs("span",{className:"text-sm",children:["Page ",h.current_page," of ",h.last_page]}),h.current_page<h.last_page&&e.jsx(C,{href:route("admin.students.index",{...o,page:h.current_page+1}),children:e.jsx(g,{variant:"outline",size:"sm",children:"Next"})})]})]})]})]})]})})]}),E&&e.jsx(Se,{user:E,isOpen:!!E,onClose:()=>I(null),errors:A}),e.jsx(_e,{open:L,onOpenChange:M,children:e.jsxs(Ne,{className:"sm:max-w-[500px]",children:[e.jsxs(ye,{children:[e.jsx(we,{children:"CSV Upload Manager"}),e.jsx(Ce,{children:a==="senior_highschool"?"Select the track, strand, year level, and section first, then download the template and upload your CSV file.":a==="college"?"Select the department, course, year level, and section first, then download the template and upload your CSV file.":"Select the grade level and section first, then download the template and upload your CSV file."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[(a==="elementary"||a==="junior_highschool")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Grade Level"}),e.jsxs(j,{value:l,onValueChange:v,children:[e.jsx(u,{children:e.jsx(S,{placeholder:"Select grade level"})}),e.jsx(_,{children:Object.entries(V).map(([s,t])=>e.jsx(N,{value:s,children:t},s))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Track"}),e.jsxs(j,{value:d,onValueChange:F,children:[e.jsx(u,{children:e.jsx(S,{placeholder:"Select track"})}),e.jsx(_,{children:X.map(s=>e.jsx(N,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Strand"}),e.jsxs(j,{value:x,onValueChange:R,disabled:!d,children:[e.jsx(u,{children:e.jsx(S,{placeholder:d?"Select strand":"Select track first"})}),e.jsx(_,{children:ee.map(s=>e.jsx(N,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(j,{value:l,onValueChange:v,disabled:!x,children:[e.jsx(u,{children:e.jsx(S,{placeholder:x?"Select year level":"Select strand first"})}),e.jsx(_,{children:Object.entries(V).map(([s,t])=>e.jsx(N,{value:s,children:t},s))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Department"}),e.jsxs(j,{value:c,onValueChange:B,children:[e.jsx(u,{children:e.jsx(S,{placeholder:"Select department"})}),e.jsx(_,{children:Z.map(s=>e.jsx(N,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Course"}),e.jsxs(j,{value:f,onValueChange:O,disabled:!c,children:[e.jsx(u,{children:e.jsx(S,{placeholder:c?"Select course":"Select department first"})}),e.jsx(_,{children:se.map(s=>e.jsx(N,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(j,{value:l,onValueChange:v,disabled:!f,children:[e.jsx(u,{children:e.jsx(S,{placeholder:f?"Select year level":"Select course first"})}),e.jsx(_,{children:Object.entries(V).map(([s,t])=>e.jsx(N,{value:s,children:t},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Section"}),e.jsxs(j,{value:i,onValueChange:w,disabled:a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?!l:!x,children:[e.jsx(u,{children:e.jsx(S,{placeholder:a==="elementary"||a==="junior_highschool"?l?"Select section":"Select grade level first":a==="senior_highschool"||a==="college"?l?"Select section":"Select year level first":x?"Select section":"Select track and strand first"})}),e.jsx(_,{children:ae.map(s=>e.jsx(N,{value:s.id.toString(),children:s.name},s.id))})]})]}),i&&e.jsxs("div",{className:"rounded-md bg-blue-50 p-3 text-sm text-blue-900 dark:bg-blue-950 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"Next Steps:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'Click "Download Template" to get the CSV file'}),e.jsx("li",{children:"Fill in student information (do NOT modify Student ID column)"}),e.jsx("li",{children:'Click "Upload CSV" to import the students'})]})]})]}),e.jsxs(be,{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",onClick:ne,disabled:!i,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Download Template"]}),e.jsxs(g,{onClick:oe,disabled:!i,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Upload CSV"]})]})]})})]})}export{js as default};
