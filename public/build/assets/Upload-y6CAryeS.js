import{r as y,m as J,j as e,$ as M,d as Q,C as W}from"./app-m3UQBMcP.js";import{C as V,b as L,c as G,a as P}from"./card-Cb3vhp8k.js";import{B as N}from"./button-DufCHHPz.js";import{I as S}from"./input-DsSiTzZC.js";import{L as h}from"./label-Dbl2zI4H.js";import{S as C,a as w,b as F,c as k,d as u,e as X,f as Z}from"./select-D08EJ6rm.js";import{A as T,a as B}from"./alert-CeazM8YQ.js";import{S as ee,H as se}from"./sidebar-CcQ_Z7nj.js";import{U as E}from"./upload-BInlXbR0.js";import{F as re}from"./file-text-DkYa2lRa.js";import{D as ae}from"./download-BwkDPMbn.js";/* empty css            */import"./index-BWILvfpH.js";import"./Combination-1fZyme7-.js";import"./index-B2WO6HMh.js";import"./index-DzDddJKI.js";import"./check-iTPGTtBJ.js";import"./dropdown-menu-BKqTm_Lw.js";import"./user-DwK-efK6.js";import"./log-out-D3daJ2dm.js";import"./book-open-C3JW_-nm.js";import"./graduation-cap-CDEpafuX.js";import"./crown-C-6ar9uZ.js";function Fe({user:A,assignedSubjects:g,academicLevels:_,gradingPeriods:m}){const v=y.useRef(null),[x,D]=y.useState(null),[I,j]=y.useState(0),[f,b]=y.useState(!1),{data:t,setData:d,post:H,processing:R,errors:a,reset:$}=J({csv_file:null,subject_id:"",academic_level_id:"",grading_period_id:"",school_year:"",year_of_study:""});if(!g||!Array.isArray(g)||!_||!Array.isArray(_)||!m||!Array.isArray(m))return e.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects and academic data."}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(g)]})]})})});const K=s=>{var i;const r=(i=s.target.files)==null?void 0:i[0];r&&(D(r),d("csv_file",r))},Y=s=>{var i;d("subject_id",s);const r=g.find(n=>n.subject.id.toString()===s);if(r){console.log("Subject selected:",{subjectId:s,subject:r.subject.name,academicLevel:r.academicLevel.name,gradingPeriod:((i=r.gradingPeriod)==null?void 0:i.name)||"None",schoolYear:r.school_year}),d("academic_level_id",r.academicLevel.id.toString()),d("school_year",r.school_year),r.gradingPeriod&&d("grading_period_id",r.gradingPeriod.id.toString());const n=m.filter(l=>l.academic_level_id.toString()===r.academicLevel.id.toString());console.log("Available grading periods for academic level:",n)}},O=s=>{if(s.preventDefault(),!x)return;b(!0),j(0);const r=new FormData;r.append("csv_file",x),r.append("subject_id",t.subject_id),r.append("academic_level_id",t.academic_level_id),r.append("grading_period_id",t.grading_period_id||""),r.append("school_year",t.school_year),r.append("year_of_study",t.year_of_study||"");const i=setInterval(()=>{j(n=>n>=90?(clearInterval(i),90):n+10)},200);H(route("teacher.grades.upload.store"),r,{forceFormData:!0,onSuccess:()=>{j(100),setTimeout(()=>{b(!1),j(0),D(null),$(),v.current&&(v.current.value="")},1e3)},onError:()=>{b(!1),j(0)}})},q=()=>{const s=U(),r=route("teacher.grades.template")+"?academic_level="+s;console.log("Downloading CSV template for academic level:",s),window.open(r,"_blank")},U=()=>{const s=_.find(r=>r.id.toString()===t.academic_level_id);return(s==null?void 0:s.key)||"college"},z=U()==="college";return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(ee,{user:A}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(se,{user:A}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Grades CSV"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Bulk upload student grades using a CSV file"})]}),e.jsx(M,{href:route("teacher.grades.index"),children:e.jsx(N,{variant:"outline",children:"Back to Grades"})})]}),e.jsxs(V,{className:"max-w-2xl",children:[e.jsx(L,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Upload Grades CSV"]})}),e.jsx(P,{children:e.jsxs("form",{onSubmit:O,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(h,{htmlFor:"csv_file",children:"CSV File"}),e.jsx("div",{className:"mt-2",children:e.jsx(S,{id:"csv_file",ref:v,type:"file",accept:".csv,.txt",onChange:K,className:"cursor-pointer",disabled:f})}),x&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(re,{className:"h-4 w-4"}),x.name," (",(x.size/1024).toFixed(1)," KB)"]}),a.csv_file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.csv_file})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"subject_id",children:"Subject *"}),e.jsxs(C,{value:t.subject_id,onValueChange:Y,children:[e.jsx(w,{className:a.subject_id?"border-red-500":"",children:e.jsx(F,{placeholder:"Select a subject"})}),e.jsx(k,{children:g.map(s=>e.jsxs(u,{value:s.subject.id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.id))})]}),a.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.subject_id})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"academic_level_id",children:"Academic Level *"}),e.jsxs(C,{value:t.academic_level_id,onValueChange:s=>d("academic_level_id",s),children:[e.jsx(w,{className:a.academic_level_id?"border-red-500":"",children:e.jsx(F,{placeholder:"Select academic level"})}),e.jsx(k,{children:_.map(s=>e.jsx(u,{value:s.id.toString(),children:s.name},s.id))})]}),a.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(C,{value:t.grading_period_id,onValueChange:s=>d("grading_period_id",s),children:[e.jsx(w,{className:a.grading_period_id?"border-red-500":"",children:e.jsx(F,{placeholder:"Select grading period (optional)"})}),e.jsxs(k,{children:[e.jsx(u,{value:"0",children:"No Period"}),m&&m.length>0?e.jsx(e.Fragment,{children:(()=>{const s=parseInt(t.academic_level_id);if(!s)return null;const r=m.filter(l=>l.academic_level_id===s);if(r.length===0)return e.jsx(u,{value:"none",disabled:!0,children:"No grading periods available for this academic level"});const i=r.filter(l=>l.parent_id===null&&l.type==="semester"),n=r.filter(l=>l.parent_id!==null&&l.period_type!=="final");if(i.length>0){const l=i.sort((c,o)=>c.sort_order-o.sort_order).map(c=>({parent:c,children:n.filter(o=>o.parent_id===c.id).sort((o,p)=>o.sort_order-p.sort_order)}));return e.jsx(e.Fragment,{children:l.map(({parent:c,children:o})=>o.length>0&&e.jsxs(X,{children:[e.jsx(Z,{children:c.name}),o.map(p=>e.jsx(u,{value:p.id.toString(),children:p.name},p.id))]},c.id))})}return e.jsx(e.Fragment,{children:r.sort((l,c)=>l.sort_order-c.sort_order).map(l=>e.jsx(u,{value:l.id.toString(),children:l.name},l.id))})})()}):null]})]}),a.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.grading_period_id})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"school_year",children:"School Year *"}),e.jsx(S,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:t.school_year,onChange:s=>d("school_year",s.target.value),className:a.school_year?"border-red-500":""}),a.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.school_year})]}),e.jsxs("div",{children:[e.jsx(h,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(S,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1",value:t.year_of_study,onChange:s=>d("year_of_study",s.target.value),className:a.year_of_study?"border-red-500":""}),a.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:a.year_of_study})]}),e.jsxs(T,{children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsxs(B,{children:[e.jsx("strong",{children:"Grade System:"})," ",z?"College uses 1.0-5.0 scale (1.0 highest, 3.0 passing)":"Elementary to Senior High uses 75-100 scale (75 passing)"]})]}),f&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Uploading... ",I,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${I}%`}})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(N,{type:"submit",disabled:R||f||!x||!t.subject_id||!t.academic_level_id||!t.school_year,className:"flex-1",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),f?"Uploading...":"Upload Grades"]}),e.jsxs(N,{type:"button",variant:"outline",onClick:q,className:"flex-1",children:[e.jsx(ae,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})]})})]}),e.jsxs(V,{children:[e.jsx(L,{children:e.jsx(G,{children:"CSV Format Instructions"})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Required Columns:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Grade Values:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"College:"})," 1.0 to 5.0 (3.0 = passing)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Elementary/Senior High:"})," 75 to 100 (75 = passing)"]})]})]})]}),e.jsxs(T,{children:[e.jsx(W,{className:"h-4 w-4 text-green-600"}),e.jsxs(B,{children:[e.jsx("strong",{children:"Tip:"})," Download the template to see the exact format. The system will automatically detect existing grades and update them, or create new ones if they don't exist."]})]})]})]})]})})]})]})}export{Fe as default};
