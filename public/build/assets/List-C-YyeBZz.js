import{r as d,K as U,u as L,j as e,$ as m,S as h}from"./app-IMEnsp40.js";import{H as A}from"./header-CxUZ0yOH.js";import{S as ee}from"./sidebar-BLQi_Ul6.js";import{C as D,a as T,b as se,c as ae}from"./card-ActY1l0m.js";import{B as te}from"./badge-BPWuta3i.js";import{B as n}from"./button-ybHkzRjt.js";import{I as le}from"./input-NxjD2LeM.js";import{P as re}from"./PasswordResetModal-Br75v9jW.js";import{S as V,a as P,b as R,c as E,d as M}from"./select-CRPUFa3U.js";import{D as ne,b as oe,c as ie,d as de,e as ce,f as me}from"./dialog-BjBpva1d.js";import{S as he}from"./search-Hf0Ws1H0.js";import{P as xe}from"./plus-DdnThl4P.js";import{U as O}from"./upload-CBZx0IBI.js";import{D as z}from"./download-CqmDFH_1.js";import{E as pe}from"./eye-JxMIsJo6.js";import{S as ge}from"./square-pen-CVd6NWEP.js";import{R as je}from"./rotate-ccw-DxeOxFCw.js";import{T as ue}from"./trash-2-iWAvXKm_.js";/* empty css            */import"./dropdown-menu-pvwXQzS0.js";import"./Combination-DR_xufGu.js";import"./index-BSDN4gnA.js";import"./separator-B85SRsMh.js";import"./users-DaOfzjw-.js";import"./chevron-right-CCb-Ann-.js";import"./crown-C4FvSlU1.js";import"./building-2-BqnzLDzH.js";import"./user-cog-1D1nrJRX.js";import"./book-open-CFJwDtbm.js";import"./user-check-BfMG_V_Z.js";import"./graduation-cap-B-Cup5EX.js";import"./notebook-De12OSG-.js";import"./chart-no-axes-column-increasing-CNaEkms2.js";import"./shield-CbvdHpYV.js";import"./label-CpJi_eJg.js";import"./alert-BYMFuh3X.js";import"./index-ad2bicAI.js";import"./index-DZtr8s3E.js";import"./check-JMRTAxac.js";function ts({user:p,users:r,filters:t,roles:I,currentAcademicLevel:a,sections:g=[],specificYearLevels:F={}}){const[y,B]=d.useState(t.search||""),[u,S]=d.useState(null),[H,f]=d.useState(!1),[o,w]=d.useState(""),[i,N]=d.useState(""),[$,_]=d.useState([]),{errors:K}=U().props,v=d.useRef(null),{addToast:x}=L();if(!p)return e.jsx("div",{children:"Loading..."});d.useEffect(()=>{if(o&&g.length>0){const s=g.filter(l=>l.specific_year_level===o);_(s),N("")}else _(g)},[o,g]);const C=()=>{h.get(route("admin.students.index"),{search:y},{preserveState:!0,replace:!0})},j=s=>{const l=t.sort_direction||"desc",c=t.sort_by===s&&l==="desc"?"asc":"desc";h.get(route("admin.students.index"),{...t,sort_by:s,sort_direction:c},{preserveState:!0,replace:!0})},Y=s=>{confirm("Are you sure you want to delete this student? This action cannot be undone.")&&h.delete(route("admin.students.destroy",s),{onSuccess:()=>{h.reload()},onError:l=>{console.error("Delete failed:",l)}})},q=s=>{S(s)},G=()=>{a==="elementary"||a==="junior_highschool"?f(!0):k()},J=()=>{if(!i&&(a==="elementary"||a==="junior_highschool")){x("Please select a grade level and section first.","error");return}const s={};a&&(s.academic_level=a),o&&(s.specific_year_level=o),i&&(s.section_id=i),window.location.href=route("admin.students.template",s),x("Downloading CSV template...","success")},k=()=>{const s=a?{academic_level:a}:{};window.location.href=route("admin.students.template",s)},Q=()=>{var s;if(!i&&(a==="elementary"||a==="junior_highschool")){x("Please select a grade level and section first.","error");return}(s=v.current)==null||s.click()},W=s=>{var b;const l=(b=s.target.files)==null?void 0:b[0];if(!l)return;const c=new FormData;c.append("file",l),a&&c.append("academic_level",a),o&&c.append("specific_year_level",o),i&&c.append("section_id",i),h.post(route("admin.students.upload"),c,{forceFormData:!0,onSuccess:()=>{x("Students CSV uploaded successfully.","success"),f(!1),w(""),N(""),h.reload()},onError:Z=>{console.error("CSV upload failed:",Z),x("CSV upload failed. Please check the file format.","error")},preserveScroll:!0}),s.target.value=""},X=s=>{switch(s){case"admin":return"default";case"registrar":case"teacher":case"instructor":case"adviser":case"chairperson":case"principal":return"secondary";case"student":case"parent":return"outline";default:return"outline"}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(ee,{user:p}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(A,{user:p}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[a?a.charAt(0).toUpperCase()+a.slice(1).replace("_"," "):"Students"," Management"]}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Create, manage, and monitor ",a?a.replace("_"," "):"student"," accounts in the school system."]})]}),e.jsx(D,{children:e.jsx(T,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:flex-wrap lg:items-center lg:justify-between",children:[e.jsx("div",{className:"flex flex-col gap-3 md:flex-row md:flex-wrap md:items-center flex-1 min-w-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(le,{placeholder:"Search students...",value:y,onChange:s=>B(s.target.value),onKeyDown:s=>s.key==="Enter"&&C(),className:"w-64"}),e.jsx(n,{onClick:C,variant:"outline",children:e.jsx(he,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end w-full lg:w-auto",children:[a&&e.jsx(m,{href:route(`admin.students.${a.replace("_","-")}.create`),children:e.jsxs(n,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),"Add New ",a.charAt(0).toUpperCase()+a.slice(1).replace("_"," ")]})}),e.jsx("input",{type:"file",accept:".csv,text/csv",ref:v,className:"hidden",onChange:W}),e.jsxs(n,{variant:"outline",className:"flex items-center gap-2",onClick:G,children:[e.jsx(O,{className:"h-4 w-4"}),a==="elementary"||a==="junior_highschool"?"CSV Upload Manager":"Upload CSV"]}),!(a==="elementary"||a==="junior_highschool")&&e.jsxs(n,{variant:"outline",className:"flex items-center gap-2",onClick:k,children:[e.jsx(z,{className:"h-4 w-4"}),"Download Template"]})]})]})})}),e.jsxs(D,{children:[e.jsx(se,{children:e.jsxs(ae,{children:[a?a.charAt(0).toUpperCase()+a.slice(1).replace("_"," "):"Students"," (",r.total," total)"]})}),e.jsxs(T,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>j("name"),children:["Name",t.sort_by==="name"&&e.jsx("span",{className:"ml-1",children:t.sort_direction==="desc"?"↓":"↑"})]}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>j("student_number"),children:["Student ID",t.sort_by==="student_number"&&e.jsx("span",{className:"ml-1",children:t.sort_direction==="desc"?"↓":"↑"})]}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>j("email"),children:["Email",t.sort_by==="email"&&e.jsx("span",{className:"ml-1",children:t.sort_direction==="desc"?"↓":"↑"})]}),e.jsx("th",{className:"p-3 text-left",children:"Role"}),e.jsx("th",{className:"p-3 text-left",children:"Parents"}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>j("created_at"),children:["Created",t.sort_by==="created_at"&&e.jsx("span",{className:"ml-1",children:t.sort_direction==="desc"?"↓":"↑"})]}),e.jsx("th",{className:"p-3 text-left",children:"Last Login"}),e.jsx("th",{className:"p-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:r.data.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"p-3 font-medium",children:s.name}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.student_number||"—"}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.email}),e.jsx("td",{className:"p-3",children:e.jsx(te,{variant:X(s.user_role),children:I[s.user_role]||s.user_role})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.parents&&s.parents.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.parents.slice(0,2).map(l=>e.jsx(m,{href:route("admin.parents.show",l.id),className:"underline",children:l.name},l.id)),s.parents.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.parents.length-2," more"]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"No parents linked"})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString():"Never"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(m,{href:route("admin.students.show",s.id),children:e.jsx(n,{variant:"outline",size:"sm",children:e.jsx(pe,{className:"h-3 w-3"})})}),e.jsx(m,{href:route("admin.students.edit",s.id),children:e.jsx(n,{variant:"outline",size:"sm",children:e.jsx(ge,{className:"h-3 w-3"})})}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>q(s),children:e.jsx(je,{className:"h-3 w-3"})}),s.id!==p.id&&e.jsx(n,{variant:"destructive",size:"sm",onClick:()=>Y(s.id),children:e.jsx(ue,{className:"h-3 w-3"})})]})})]},s.id))})]})}),r.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",r.from," to ",r.to," of ",r.total," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[r.current_page>1&&e.jsx(m,{href:route("admin.students.index",{...t,page:r.current_page-1}),children:e.jsx(n,{variant:"outline",size:"sm",children:"Previous"})}),e.jsxs("span",{className:"text-sm",children:["Page ",r.current_page," of ",r.last_page]}),r.current_page<r.last_page&&e.jsx(m,{href:route("admin.students.index",{...t,page:r.current_page+1}),children:e.jsx(n,{variant:"outline",size:"sm",children:"Next"})})]})]})]})]})]})})]}),u&&e.jsx(re,{user:u,isOpen:!!u,onClose:()=>S(null),errors:K}),e.jsx(ne,{open:H,onOpenChange:f,children:e.jsxs(oe,{className:"sm:max-w-[500px]",children:[e.jsxs(ie,{children:[e.jsx(de,{children:"CSV Upload Manager"}),e.jsx(ce,{children:"Select the grade level and section first, then download the template and upload your CSV file."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Grade Level"}),e.jsxs(V,{value:o,onValueChange:w,children:[e.jsx(P,{children:e.jsx(R,{placeholder:"Select grade level"})}),e.jsx(E,{children:Object.entries(F).map(([s,l])=>e.jsx(M,{value:s,children:l},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Section"}),e.jsxs(V,{value:i,onValueChange:N,disabled:!o,children:[e.jsx(P,{children:e.jsx(R,{placeholder:o?"Select section":"Select grade level first"})}),e.jsx(E,{children:$.map(s=>e.jsx(M,{value:s.id.toString(),children:s.name},s.id))})]})]}),i&&e.jsxs("div",{className:"rounded-md bg-blue-50 p-3 text-sm text-blue-900 dark:bg-blue-950 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"Next Steps:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'Click "Download Template" to get the CSV file'}),e.jsx("li",{children:"Fill in student information (do NOT modify Student ID column)"}),e.jsx("li",{children:'Click "Upload CSV" to import the students'})]})]})]}),e.jsxs(me,{className:"flex gap-2",children:[e.jsxs(n,{variant:"outline",onClick:J,disabled:!i,children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Download Template"]}),e.jsxs(n,{onClick:Q,disabled:!i,children:[e.jsx(O,{className:"h-4 w-4 mr-2"}),"Upload CSV"]})]})]})})]})}export{ts as default};
