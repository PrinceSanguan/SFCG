import{r as D,u as Ye,j as e,$ as We,S as de}from"./app-B9ix2fbL.js";import{H as Re}from"./header-DnrbbhWZ.js";import{S as Xe}from"./sidebar-CHDjzt8g.js";import{C as te,a as ne,b as we,c as Fe}from"./card-DbmPiGwN.js";import{B as S}from"./button-allnsB2r.js";import{I as F}from"./input-BUQYHPex.js";import{L as c}from"./label-DvO_fItG.js";import{S as p,a as v,b as f,c as y,d as u}from"./select-B0AGQ-2I.js";import{B as b}from"./badge-D3hF8MtD.js";import{D as Ge,a as Ke,b as Ee,c as De,d as Te,e as $e,f as Ae}from"./dialog-RRzrb2Vl.js";import{T as Qe,a as Ze,b as V,c as Ie}from"./tabs-rEsHscgL.js";import{A as J,a as Y}from"./alert-GQEmHqS-.js";import{A as Le}from"./arrow-left-BY7L84s8.js";import{P as ce}from"./plus-CTX26bN5.js";import{B as W}from"./book-open-B-B3t7-L.js";import{S as oe}from"./square-pen-BGiaMxY7.js";import{T as he}from"./trash-2-hx0FWfY6.js";import{H as es}from"./hash-D06urUYD.js";import{C as He}from"./clock-DjS3uByM.js";/* empty css            */import"./dropdown-menu-C7cwdDN8.js";import"./Combination-xYBHKVMi.js";import"./index-C3g94cMv.js";import"./separator-CjbxDUn7.js";import"./users-BCcFYHHK.js";import"./chevron-right-BDqttHfz.js";import"./crown-CElC_csn.js";import"./building-2-DkPIeuZ7.js";import"./user-cog-8_h9YFAW.js";import"./user-check-fMX9V67z.js";import"./graduation-cap-Bdq6dGzq.js";import"./notebook-DoC9CgQw.js";import"./chart-no-axes-column-increasing-CLHNASJ5.js";import"./shield-BHIKi0Y9.js";import"./index-pEVb0lKv.js";import"./index-CBJIcWHq.js";import"./check-BS3W2Pzf.js";function Ps({user:me,subjects:R=[],academicLevels:g=[],gradingPeriods:k=[],courses:X=[],departments:xe=[],yearLevels:K={},shsYearLevels:Q={},tracks:_e=[],strands:ge=[],sections:G=[]}){var ve,fe,ye,Ne,Se,be,ke,Ce;const[Ve,Pe]=D.useState("all"),[A,ue]=D.useState(null),{addToast:w}=Ye(),[r,_]=D.useState({name:"",code:"",description:"",academic_level_id:"",grade_levels:[],selected_grade_level:"",grading_period_ids:[],semester_ids:[],department_id:"",course_id:"",semester_id:"",units:0,hours_per_week:0,is_core:!1,is_active:!0,track_id:"",strand_id:"",shs_year_level:"",jhs_year_level:"",college_year_level:"",section_id:""}),[Be,T]=D.useState(!1),[d,j]=D.useState(null),[Me,P]=D.useState(!1),[B,M]=D.useState(1),[C,Z]=D.useState({}),[$,q]=D.useState(null),qe=()=>{M(1),q(null),Z({}),_({name:"",code:"",description:"",academic_level_id:"",grade_levels:[],selected_grade_level:"",grading_period_ids:[],semester_ids:[],department_id:"",course_id:"",semester_id:"",units:0,hours_per_week:0,is_core:!1,is_active:!0,track_id:"",strand_id:"",shs_year_level:"",jhs_year_level:"",college_year_level:"",section_id:""}),T(!0)},Oe=s=>{q(s),_(i=>({...i,academic_level_id:s.id.toString()})),M(2)},Ue=()=>{M(1),q(null),_(s=>({...s,academic_level_id:""}))},je=()=>{T(!1),M(1),q(null),_({name:"",code:"",description:"",academic_level_id:"",grade_levels:[],selected_grade_level:"",grading_period_ids:[],semester_ids:[],department_id:"",course_id:"",semester_id:"",units:0,hours_per_week:0,is_core:!1,is_active:!0,track_id:"",strand_id:"",shs_year_level:"",jhs_year_level:"",college_year_level:"",section_id:""})},O=s=>R.filter(i=>i.academic_level.key===s),L=s=>{const i=O("elementary");return s?i.filter(l=>!l.grade_levels||l.grade_levels.length===0||l.grade_levels.includes(s)):i},pe=s=>{const i=k.filter(l=>{const a=l.academic_level_id===s,t=l.period_type==="final";return a&&!t});return console.log("[SUBJECTS] getGradingPeriodsByLevel - Filtering:",{levelId:s,totalPeriods:k.filter(l=>l.academic_level_id===s).length,filteredPeriods:i.length,excludedFinalPeriods:k.filter(l=>l.academic_level_id===s&&l.period_type==="final").length,periodNames:i.map(l=>({id:l.id,name:l.name,period_type:l.period_type}))}),i},U=s=>k.filter(i=>i.academic_level_id===s&&i.parent_id==null&&(i.type==="semester"||/semester/i.test(i.name))),z=s=>{if(!s)return[];const i=k.find(a=>a.id.toString()===s);if(!i)return[];console.log("[SUBJECTS] Filtering grading periods for semester:",{semesterId:s,semesterName:i.name,academicLevelId:i.academic_level_id});const l=k.filter(a=>{var m;const t=((m=a.parent_id)==null?void 0:m.toString())===s,o=a.academic_level_id===i.academic_level_id,n=a.period_type==="final",h=t&&o&&!n;return t&&console.log("[SUBJECTS] Period filter result:",{periodId:a.id,periodName:a.name,periodType:a.type,period_type:a.period_type,shouldInclude:h,reasons:{matchesParent:t,matchesLevel:o,isFinalPeriodType:n,explanation:n?"EXCLUDED: period_type is final":"INCLUDED: period_type is not final"}}),h});return console.log("[SUBJECTS] getPeriodsBySemester result:",{semesterId:s,semesterName:i.name,totalMatchingParent:k.filter(a=>{var t;return((t=a.parent_id)==null?void 0:t.toString())===s}).length,filteredCount:l.length,excludedFinalAverage:k.filter(a=>{var t;return((t=a.parent_id)==null?void 0:t.toString())===s&&a.period_type==="final"}).length,includedPeriods:l.map(a=>({id:a.id,name:a.name,period_type:a.period_type}))}),l},I=[{value:"grade_1",label:"Grade 1"},{value:"grade_2",label:"Grade 2"},{value:"grade_3",label:"Grade 3"},{value:"grade_4",label:"Grade 4"},{value:"grade_5",label:"Grade 5"},{value:"grade_6",label:"Grade 6"}],ee=()=>{if(!r.academic_level_id)return!1;const s=g.find(i=>i.id.toString()===r.academic_level_id);return(s==null?void 0:s.key)==="elementary"},ze=()=>{if(console.log("Form submission started:",r),!r.name||!r.code||!r.academic_level_id){console.log("Validation failed: Missing required fields"),w("Please fill in all required fields (Name, Code, and Academic Level).","error");return}if(ee()&&r.grade_levels.length===0){console.log("Validation failed: No grade levels selected for elementary"),w("Please select at least one grade level for elementary subjects.","error");return}console.log("Form validation passed, submitting..."),console.log("Form data being sent:",JSON.stringify(r,null,2));const s={...r,description:r.description||null,grading_period_ids:r.grading_period_ids.length>0?r.grading_period_ids:null,semester_ids:r.semester_ids.length>0?r.semester_ids:null,course_id:r.course_id||null,department_id:r.department_id||null,section_id:r.section_id||null,strand_id:r.strand_id||null,track_id:r.track_id||null,shs_year_level:r.shs_year_level||null,jhs_year_level:r.jhs_year_level||null,college_year_level:r.college_year_level||null};de.post(route("admin.academic.subjects.store"),s,{preserveScroll:!0,onSuccess:i=>{console.log("Subject created successfully:",i),w("Subject created successfully!","success"),_({name:"",code:"",description:"",academic_level_id:"",grade_levels:[],selected_grade_level:"",grading_period_ids:[],department_id:"",course_id:"",semester_id:"",units:0,hours_per_week:0,is_core:!1,is_active:!0,track_id:"",strand_id:"",shs_year_level:"",jhs_year_level:"",college_year_level:"",section_id:""}),Z({}),T(!1)},onError:i=>{if(console.log("Subject creation failed:",i),console.log("Error details:",JSON.stringify(i,null,2)),Z(i),i.code){const l=`${r.code}_${Date.now().toString().slice(-4)}`;w(`Subject code "${r.code}" already exists. Try "${l}" instead.`,"error"),_(a=>({...a,code:l}))}else if(i.name)w(`Subject name error: ${i.name}`,"error");else if(i.strand_id)w("Strand is required for Senior High School subjects.","error");else if(i.section_id)w("Section is required. Please select a section.","error");else if(i.shs_year_level)w("Year level is required for Senior High School subjects.","error");else{const l=Object.entries(i).map(([a,t])=>`${a}: ${t}`).join(", ");w(`Failed to create subject. ${l}`,"error")}}})},Je=s=>{const i={name:s.name,code:s.code,description:s.description||"",academic_level_id:s.academic_level_id,grade_levels:s.grade_levels||[],grading_period_ids:s.grading_period_ids||[],semester_ids:s.semester_ids||[],shs_year_level:s.shs_year_level||null,jhs_year_level:s.jhs_year_level||null,college_year_level:s.college_year_level||null,strand_id:s.strand_id||null,course_id:s.course_id||"",units:s.units,hours_per_week:s.hours_per_week,is_core:s.is_core,is_active:s.is_active};console.log("Updating subject with data:",i),de.put(route("admin.academic.subjects.update",s.id),i,{preserveScroll:!0,onSuccess:()=>{console.log("Subject updated successfully"),w("Subject updated successfully!","success"),P(!1)},onError:l=>{console.error("Subject update failed:",l),w("Failed to update subject. Please check the form and try again.","error")}})},se=s=>{confirm(`Delete subject ${s.name}?`)&&de.delete(route("admin.academic.subjects.destroy",s.id),{preserveScroll:!0,onSuccess:()=>{w("Subject deleted successfully!","success")},onError:()=>{w("Failed to delete subject. Please try again.","error")}})},ie=s=>{var n,h;console.log("=== OPENING EDIT MODAL ==="),console.log("Subject data:",s);const i=s.course_id?X.find(m=>m.id===s.course_id):null,l=s.department_id||(i==null?void 0:i.department_id),a=(s.semester_ids||[]).map(m=>typeof m=="number"?m:parseInt(m)),t=(s.grading_period_ids||[]).map(m=>typeof m=="number"?m:parseInt(m)),o={...s,track_id:((n=s.track_id)==null?void 0:n.toString())||"",strand_id:((h=s.strand_id)==null?void 0:h.toString())||"",semester_ids:a,grading_period_ids:t,section_id:s.section_id||void 0,jhs_year_level:s.jhs_year_level||"",shs_year_level:s.shs_year_level||"",college_year_level:s.college_year_level||"",department_id:l,course_id:s.course_id,grade_levels:s.grade_levels||[]};console.log("Edit data prepared:",{track_id:o.track_id,strand_id:o.strand_id,semester_ids:o.semester_ids,grading_period_ids:o.grading_period_ids,section_id:o.section_id,shs_year_level:o.shs_year_level,jhs_year_level:o.jhs_year_level,grade_levels:o.grade_levels}),j(o),P(!0)},re=s=>s?e.jsx(b,{variant:"default",className:"bg-green-100 text-green-800",children:"Active"}):e.jsx(b,{variant:"secondary",children:"Inactive"}),le=s=>s?e.jsx(b,{variant:"default",className:"bg-blue-100 text-blue-800",children:"Core"}):e.jsx(b,{variant:"outline",children:"Elective"}),H=s=>{switch(s){case"elementary":return"ðŸŽ“";case"junior_highschool":return"ðŸ“š";case"senior_highschool":return"ðŸŽ¯";case"college":return"ðŸ›ï¸";default:return"ðŸ“–"}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Xe,{user:me}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(Re,{user:me}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("div",{className:"mb-4",children:e.jsx(We,{href:route("admin.academic.index"),children:e.jsxs(S,{variant:"outline",size:"sm",className:"flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4"}),"Back to Academic & Curriculum"]})})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Manage Subjects per Level"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Create and manage subjects for each academic level with appropriate grading periods."})]}),e.jsx(te,{children:e.jsx(ne,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"font-semibold",children:"Subjects"}),e.jsxs(Ge,{open:Be,onOpenChange:T,children:[e.jsx(Ke,{asChild:!0,children:e.jsxs(S,{onClick:qe,className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-4 w-4"}),"Add Subject"]})}),e.jsxs(Ee,{className:"w-[95vw] max-w-[900px] max-h-[85vh] overflow-y-auto",children:[e.jsxs(De,{children:[e.jsx(Te,{children:B===1?"Select Academic Level":`Add New Subject - ${$==null?void 0:$.name}`}),e.jsx($e,{children:B===1?"Choose the academic level for your new subject":`Create a new subject for ${$==null?void 0:$.name}`})]}),B===1?e.jsx("div",{className:"space-y-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:g.map(s=>e.jsx("div",{onClick:()=>Oe(s),className:"p-6 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition-all duration-200",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"text-2xl",children:H(s.key)}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[s.key==="elementary"&&"Grades 1-6 with grade level selection",s.key==="junior_highschool"&&"Grades 7-10 with year level selection",s.key==="senior_highschool"&&"Grades 11-12 with track and strand selection",s.key==="college"&&"College courses with department and course selection"]})]})]})},s.id))})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-name",children:"Name"}),e.jsx(F,{id:"subject-name",placeholder:"e.g., Mathematics, English, Science",value:r.name,onChange:s=>_({...r,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-code",children:"Code"}),e.jsx(F,{id:"subject-code",placeholder:"e.g., MATH101, ENG101",value:r.code,onChange:s=>_({...r,code:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-description",children:"Description"}),e.jsx(F,{id:"subject-description",placeholder:"Brief description of the subject",value:r.description,onChange:s=>_({...r,description:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 border-b pb-2",children:"Academic Classification"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-level",children:"Academic Level"}),e.jsxs("div",{className:"relative",children:[e.jsxs(p,{value:r.academic_level_id,onValueChange:s=>_({...r,academic_level_id:s,grading_period_ids:[],course_id:""}),disabled:!0,children:[e.jsx(v,{className:"bg-gray-50 cursor-not-allowed",children:e.jsx(f,{placeholder:"Select academic level"})}),e.jsx(y,{children:g.map(s=>e.jsx(u,{value:s.id.toString(),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:H(s.key)}),s.name]})},s.id))})]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-xs text-gray-500 bg-blue-100 px-2 py-1 rounded",children:"Selected"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Academic level was selected in the previous step"})]}),(()=>{const s=g.find(a=>a.id.toString()===r.academic_level_id),i=(s==null?void 0:s.key)==="elementary"||(s==null?void 0:s.key)==="junior_highschool";if(console.log("Debug - Generic Period - Selected Level:",s),console.log("Debug - Generic Period - Should Show:",i),!i)return null;const l=r.academic_level_id?pe(parseInt(r.academic_level_id)).filter(a=>a.parent_id==null):[];return e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-grading",children:"Grading Periods"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md",children:l.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No grading periods available"}):l.map(a=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`gp-${a.id}`,checked:r.grading_period_ids.includes(a.id.toString()),onChange:t=>{const o=a.id.toString();t.target.checked?_({...r,grading_period_ids:[...r.grading_period_ids,o]}):_({...r,grading_period_ids:r.grading_period_ids.filter(n=>n!==o)})},className:"rounded border-gray-300"}),e.jsxs(c,{htmlFor:`gp-${a.id}`,className:"text-sm font-normal cursor-pointer",children:[a.name," (",a.code,")"]})]},a.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select one or more grading periods for this subject"})]})})()]}),(()=>{const s=g.find(a=>a.id.toString()===r.academic_level_id),i=(s==null?void 0:s.key)==="senior_highschool",l=(s==null?void 0:s.key)==="college";return(i||l)&&e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-year-level",children:"Year Level"}),e.jsxs(p,{value:i?r.shs_year_level:r.college_year_level||"",onValueChange:a=>{_(i?t=>({...t,shs_year_level:a}):t=>({...t,college_year_level:a}))},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select year level"})}),e.jsx(y,{children:i?Object.entries(Q).map(([a,t])=>e.jsx(u,{value:a,children:t},a)):Object.entries(K).map(([a,t])=>e.jsx(u,{value:a,children:t},a))})]})]})})(),r.academic_level_id&&((ve=g.find(s=>s.id.toString()===r.academic_level_id))==null?void 0:ve.key)==="senior_highschool"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-track",children:"Track"}),e.jsxs(p,{value:r.track_id,onValueChange:s=>_(i=>({...i,track_id:s,strand_id:""})),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select track"})}),e.jsx(y,{children:(_e||[]).map(s=>e.jsxs(u,{value:s.id.toString(),children:[s.name," (",s.code,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-strand",children:"Strand"}),e.jsxs(p,{value:r.strand_id,onValueChange:s=>_(i=>({...i,strand_id:s})),disabled:!r.track_id,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select strand"})}),e.jsx(y,{children:ge.filter(s=>r.track_id&&s.track_id.toString()===String(r.track_id)).map(s=>e.jsxs(u,{value:s.id.toString(),children:[s.name," (",s.code,")"]},s.id))})]})]})]}),r.academic_level_id&&((fe=g.find(s=>s.id.toString()===r.academic_level_id))==null?void 0:fe.key)==="college"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-dept",children:"Department"}),e.jsxs(p,{value:r.department_id,onValueChange:s=>_({...r,department_id:s,course_id:"",semester_id:"",grading_period_id:""}),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select department"})}),e.jsx(y,{children:xe.map(s=>e.jsx(u,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-course",children:"Course"}),e.jsxs(p,{value:r.course_id,onValueChange:s=>_({...r,course_id:s}),disabled:!r.department_id,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select course (required for college subjects)"})}),e.jsx(y,{children:X.filter(s=>{var i;return!r.department_id||((i=s.department_id)==null?void 0:i.toString())===r.department_id}).map(s=>e.jsxs(u,{value:s.id.toString(),children:[s.code," - ",s.name]},s.id))})]})]})]})]}),ee()&&e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-grade-level",children:"Grade Level"}),e.jsxs(p,{value:r.selected_grade_level,onValueChange:s=>{_({...r,selected_grade_level:s,grade_levels:[s]})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select Grade Level"})}),e.jsx(y,{children:I.map(s=>e.jsx(u,{value:s.value,children:s.label},s.value))})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select the grade level this subject applies to"})]}),ee()&&r.selected_grade_level&&e.jsxs("div",{children:[e.jsx(c,{htmlFor:"section_id",children:"Section *"}),e.jsxs(p,{value:r.section_id,onValueChange:s=>_({...r,section_id:s}),required:!0,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select section (required)"})}),e.jsx(y,{children:G.filter(i=>{const l=g.find(a=>a.id===i.academic_level_id);return(l==null?void 0:l.key)==="elementary"&&i.specific_year_level===r.selected_grade_level}).map(i=>e.jsx(u,{value:i.id.toString(),children:i.name},i.id))})]}),(C==null?void 0:C.section_id)&&e.jsx(J,{variant:"destructive",children:e.jsx(Y,{children:C.section_id})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a specific section for this subject (required)"})]}),(()=>{const s=g.find(l=>l.id.toString()===r.academic_level_id);if((s==null?void 0:s.key)!=="junior_highschool")return null;const i=[{value:"grade_7",label:"Grade 7"},{value:"grade_8",label:"Grade 8"},{value:"grade_9",label:"Grade 9"},{value:"grade_10",label:"Grade 10"}];return e.jsxs("div",{children:[e.jsx(c,{htmlFor:"jhs-year",children:"Year Level"}),e.jsxs(p,{value:r.jhs_year_level,onValueChange:l=>_(a=>({...a,jhs_year_level:l})),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select year level"})}),e.jsx(y,{children:i.map(l=>e.jsx(u,{value:l.value,children:l.label},l.value))})]})]})})(),(()=>{const s=g.find(i=>i.id.toString()===r.academic_level_id);return(s==null?void 0:s.key)!=="junior_highschool"||!r.jhs_year_level?null:e.jsxs("div",{children:[e.jsx(c,{htmlFor:"section_id",children:"Section *"}),e.jsxs(p,{value:r.section_id,onValueChange:i=>_({...r,section_id:i}),required:!0,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select section (required)"})}),e.jsx(y,{children:G.filter(l=>{const a=g.find(t=>t.id===l.academic_level_id);return(a==null?void 0:a.key)==="junior_highschool"&&l.specific_year_level===r.jhs_year_level}).map(l=>e.jsx(u,{value:l.id.toString(),children:l.name},l.id))})]}),(C==null?void 0:C.section_id)&&e.jsx(J,{variant:"destructive",children:e.jsx(Y,{children:C.section_id})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a specific section for this subject (required)"})]})})(),(()=>{const s=g.find(a=>a.id.toString()===r.academic_level_id),i=(s==null?void 0:s.key)==="senior_highschool",l=(s==null?void 0:s.key)==="college";if(i){const a=r.academic_level_id?U(parseInt(r.academic_level_id)):[];return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Semesters"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md",children:a.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No semesters available"}):a.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`sem-${t.id}`,checked:r.semester_ids.includes(t.id.toString()),onChange:o=>{const n=t.id.toString();o.target.checked?_({...r,semester_ids:[...r.semester_ids,n]}):_({...r,semester_ids:r.semester_ids.filter(h=>h!==n),grading_period_ids:r.grading_period_ids.filter(h=>{var x;const m=k.find(N=>N.id.toString()===h);return((x=m==null?void 0:m.parent_id)==null?void 0:x.toString())!==n})})},className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:`sem-${t.id}`,className:"text-sm font-normal cursor-pointer",children:t.name})]},t.id))})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Grading Periods"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md max-h-48 overflow-y-auto",children:r.semester_ids.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Select a semester first"}):r.semester_ids.map(t=>{const o=k.find(h=>h.id.toString()===t),n=z(t);return!o||n.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-semibold text-blue-600 border-l-4 border-blue-600 pl-2",children:[o.name," Periods:"]}),n.map(h=>e.jsxs("div",{className:"flex items-center space-x-2 ml-6",children:[e.jsx("input",{type:"checkbox",id:`shs-gp-${h.id}`,checked:r.grading_period_ids.includes(h.id.toString()),onChange:m=>{const x=h.id.toString();m.target.checked?_({...r,grading_period_ids:[...r.grading_period_ids,x]}):_({...r,grading_period_ids:r.grading_period_ids.filter(N=>N!==x)})},className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:`shs-gp-${h.id}`,className:"text-sm font-normal cursor-pointer",children:h.name})]},h.id))]},t)})})]})]})}if(l){const a=r.academic_level_id?U(parseInt(r.academic_level_id)):[];return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Semesters"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md",children:a.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No semesters available"}):a.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`college-sem-${t.id}`,checked:r.semester_ids.includes(t.id.toString()),onChange:o=>{const n=t.id.toString();o.target.checked?_({...r,semester_ids:[...r.semester_ids,n]}):_({...r,semester_ids:r.semester_ids.filter(h=>h!==n),grading_period_ids:r.grading_period_ids.filter(h=>{var x;const m=k.find(N=>N.id.toString()===h);return((x=m==null?void 0:m.parent_id)==null?void 0:x.toString())!==n})})},className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:`college-sem-${t.id}`,className:"text-sm font-normal cursor-pointer",children:t.name})]},t.id))})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Grading Periods"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md max-h-48 overflow-y-auto",children:r.semester_ids.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Select a semester first"}):r.semester_ids.map(t=>{const o=k.find(h=>h.id.toString()===t),n=z(t);return!o||n.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-semibold text-blue-600 border-l-4 border-blue-600 pl-2",children:[o.name," Periods:"]}),n.map(h=>e.jsxs("div",{className:"flex items-center space-x-2 ml-6",children:[e.jsx("input",{type:"checkbox",id:`college-gp-${h.id}`,checked:r.grading_period_ids.includes(h.id.toString()),onChange:m=>{const x=h.id.toString();m.target.checked?_({...r,grading_period_ids:[...r.grading_period_ids,x]}):_({...r,grading_period_ids:r.grading_period_ids.filter(N=>N!==x)})},className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:`college-gp-${h.id}`,className:"text-sm font-normal cursor-pointer",children:h.name})]},h.id))]},t)})})]})]})}return null})(),(()=>{const s=g.find(i=>i.id.toString()===r.academic_level_id);return(s==null?void 0:s.key)!=="senior_highschool"||!r.track_id||!r.strand_id||!r.shs_year_level?(console.log("SHS Section field hidden:",{is_shs:(s==null?void 0:s.key)==="senior_highschool",track_id:r.track_id,strand_id:r.strand_id,shs_year_level:r.shs_year_level,reason:r.track_id?r.strand_id?r.shs_year_level?"Not SHS":"No year level":"No strand":"No track"}),null):e.jsxs("div",{children:[e.jsx(c,{htmlFor:"section_id",children:"Section *"}),e.jsxs(p,{value:r.section_id,onValueChange:i=>_({...r,section_id:i}),required:!0,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select section (required)"})}),e.jsx(y,{children:(()=>{console.log("=== SHS Section Filtering ==="),console.log("Form values:",{track_id:r.track_id,strand_id:r.strand_id,shs_year_level:r.shs_year_level}),console.log("Total sections available:",G.length);const i=G.filter(l=>{var m,x;const a=g.find(N=>N.id===l.academic_level_id),t=(a==null?void 0:a.key)==="senior_highschool",o=((m=l.track_id)==null?void 0:m.toString())===r.track_id,n=((x=l.strand_id)==null?void 0:x.toString())===r.strand_id,h=l.specific_year_level===r.shs_year_level;return console.log(`Section ${l.id} (${l.name}):`,{track_id:l.track_id,strand_id:l.strand_id,specific_year_level:l.specific_year_level,isShs:t,matchesTrack:o,matchesStrand:n,matchesYearLevel:h,included:t&&o&&n&&h}),t&&o&&n&&h});return console.log("Filtered SHS sections count:",i.length),console.log("Filtered SHS sections:",i.map(l=>({id:l.id,name:l.name,year_level:l.specific_year_level}))),i.length===0?e.jsx(u,{value:"no-sections",disabled:!0,children:"No sections available for this combination"}):i.map(l=>e.jsx(u,{value:l.id.toString(),children:l.name},l.id))})()})]}),(C==null?void 0:C.section_id)&&e.jsx(J,{variant:"destructive",children:e.jsx(Y,{children:C.section_id})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a specific section for this subject (required). Make sure Track, Strand, and Year Level are selected above."})]})})(),(()=>{const s=g.find(i=>i.id.toString()===r.academic_level_id);return(s==null?void 0:s.key)!=="college"||!r.department_id||!r.course_id||!r.college_year_level?null:e.jsxs("div",{children:[e.jsx(c,{htmlFor:"section_id",children:"Section *"}),e.jsxs(p,{value:r.section_id,onValueChange:i=>_({...r,section_id:i}),required:!0,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select section (required)"})}),e.jsx(y,{children:(()=>{const i=G.filter(l=>{var t,o;const a=g.find(n=>n.id===l.academic_level_id);return(a==null?void 0:a.key)==="college"&&((t=l.department_id)==null?void 0:t.toString())===r.department_id&&((o=l.course_id)==null?void 0:o.toString())===r.course_id&&l.specific_year_level===r.college_year_level});return i.length===0?e.jsx(u,{value:"no-sections",disabled:!0,children:"No sections available for this year level"}):i.map(l=>e.jsx(u,{value:l.id.toString(),children:l.name},l.id))})()})]}),(C==null?void 0:C.section_id)&&e.jsx(J,{variant:"destructive",children:e.jsx(Y,{children:C.section_id})}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a specific section for this subject (required)"})]})})(),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 border-b pb-2",children:"Subject Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-units",children:"Units"}),e.jsx(F,{id:"subject-units",type:"number",min:"0",step:"0.5",value:r.units,onChange:s=>_({...r,units:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject-hours",children:"Hours per Week"}),e.jsx(F,{id:"subject-hours",type:"number",min:"0",value:r.hours_per_week,onChange:s=>_({...r,hours_per_week:parseInt(s.target.value)||0})})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"subject-core",type:"checkbox",checked:r.is_core,onChange:s=>_({...r,is_core:s.target.checked}),className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:"subject-core",children:"Core Subject"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"subject-active",type:"checkbox",checked:r.is_active,onChange:s=>_({...r,is_active:s.target.checked}),className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:"subject-active",children:"Active"})]})]})]})]}),e.jsx(Ae,{children:B===1?e.jsx(e.Fragment,{children:e.jsx(S,{variant:"outline",onClick:je,children:"Cancel"})}):e.jsxs(e.Fragment,{children:[e.jsx(S,{variant:"outline",onClick:Ue,children:"Back"}),e.jsx(S,{variant:"outline",onClick:je,children:"Cancel"}),e.jsx(S,{onClick:ze,children:"Create Subject"})]})})]})]})]})})}),e.jsxs(Qe,{value:Ve,onValueChange:Pe,className:"w-full",children:[e.jsxs(Ze,{className:"grid w-full grid-cols-5",children:[e.jsx(V,{value:"all",children:"All Subjects"}),e.jsx(V,{value:"elementary",children:"Elementary"}),e.jsx(V,{value:"junior_highschool",children:"Junior High"}),e.jsx(V,{value:"senior_highschool",children:"Senior High"}),e.jsx(V,{value:"college",children:"College"})]}),e.jsx(Ie,{value:"all",className:"space-y-4",children:e.jsxs(te,{children:[e.jsx(we,{children:e.jsxs(Fe,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5"}),"All Subjects (",R.length,")"]})}),e.jsx(ne,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Code"}),e.jsx("th",{className:"text-left p-3",children:"Name"}),e.jsx("th",{className:"text-left p-3",children:"Level"}),e.jsx("th",{className:"text-left p-3",children:"Grade Levels"}),e.jsx("th",{className:"text-left p-3",children:"Period"}),e.jsx("th",{className:"text-left p-3",children:"Course"}),e.jsx("th",{className:"text-left p-3",children:"Units"}),e.jsx("th",{className:"text-left p-3",children:"Hours"}),e.jsx("th",{className:"text-left p-3",children:"Type"}),e.jsx("th",{className:"text-left p-3",children:"Status"}),e.jsx("th",{className:"text-left p-3",children:"Actions"})]})}),e.jsx("tbody",{children:R.map(s=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3",children:e.jsx(b,{variant:"outline",className:"font-mono",children:s.code})}),e.jsx("td",{className:"p-3 font-medium",children:s.name}),e.jsx("td",{className:"p-3",children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:H(s.academic_level.key)}),s.academic_level.name]})}),e.jsx("td",{className:"p-3",children:(()=>{if(s.academic_level.key==="elementary"&&s.grade_levels&&s.grade_levels.length>0)return e.jsx("div",{className:"flex flex-wrap gap-1",children:s.grade_levels.map(i=>{var l;return e.jsx(b,{variant:"secondary",className:"text-xs",children:((l=I.find(a=>a.value===i))==null?void 0:l.label)||i},i)})});if(s.academic_level.key==="junior_highschool"&&s.jhs_year_level){const i={grade_7:"Grade 7",grade_8:"Grade 8",grade_9:"Grade 9",grade_10:"Grade 10"};return e.jsx(b,{variant:"secondary",className:"text-xs",children:i[s.jhs_year_level]||s.jhs_year_level})}if(s.academic_level.key==="senior_highschool"&&s.shs_year_level){const i=Q;return e.jsx(b,{variant:"secondary",className:"text-xs",children:i[s.shs_year_level]||s.shs_year_level})}if(s.academic_level.key==="college"&&s.college_year_level){const i=K;return e.jsx(b,{variant:"secondary",className:"text-xs",children:i[s.college_year_level]||s.college_year_level})}return e.jsx("span",{className:"text-gray-400",children:"-"})})()}),e.jsx("td",{className:"p-3",children:s.grading_periods&&s.grading_periods.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:s.grading_periods.map(i=>e.jsx(b,{variant:"outline",className:"text-xs",children:i.name},i.id))}):s.grading_period?e.jsx(b,{variant:"outline",children:s.grading_period.name}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"p-3",children:s.course?e.jsx(b,{variant:"outline",className:"bg-blue-100 text-blue-800",children:s.course.code}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"p-3",children:s.units}),e.jsx("td",{className:"p-3",children:s.hours_per_week}),e.jsx("td",{className:"p-3",children:le(s.is_core)}),e.jsx("td",{className:"p-3",children:re(s.is_active)}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>ie(s),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>se(s),className:"text-red-600 hover:text-red-700",children:e.jsx(he,{className:"h-4 w-4"})})]})})]},s.id))})]})})})]})}),g.map(s=>e.jsx(Ie,{value:s.key,className:"space-y-4",children:e.jsxs(te,{children:[e.jsx(we,{children:e.jsxs(Fe,{className:"flex items-center gap-2",children:[e.jsx("span",{children:H(s.key)}),s.name," Subjects (",s.key==="elementary"?L(A||void 0).length:O(s.key).length,")"]})}),e.jsx(ne,{children:s.key==="elementary"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsx(c,{className:"text-sm font-medium",children:"Filter by Grade Level:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(S,{variant:A===null?"default":"outline",size:"sm",onClick:()=>ue(null),children:"All Grades"}),I.map(i=>e.jsx(S,{variant:A===i.value?"default":"outline",size:"sm",onClick:()=>ue(i.value),children:i.label},i.value))]})]}),L(A||void 0).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No subjects defined"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:["Get started by creating the first subject for ",s.name,"."]}),e.jsxs(S,{variant:"outline",onClick:()=>{_({...r,academic_level_id:s.id.toString()}),T(!0)},className:"border-blue-300 text-blue-600 hover:bg-blue-50",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add First Subject"]})]}):e.jsx("div",{className:"overflow-x-auto rounded border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-800",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-3",children:"Code"}),e.jsx("th",{className:"text-left p-3",children:"Name"}),e.jsx("th",{className:"text-left p-3",children:"Grade Levels"}),e.jsx("th",{className:"text-left p-3",children:"Period"}),e.jsx("th",{className:"text-left p-3",children:"Units"}),e.jsx("th",{className:"text-left p-3",children:"Hours/Week"}),e.jsx("th",{className:"text-left p-3",children:"Type"}),e.jsx("th",{className:"text-left p-3",children:"Status"}),e.jsx("th",{className:"text-left p-3",children:"Actions"})]})}),e.jsx("tbody",{children:L(A||void 0).map(i=>e.jsxs("tr",{className:"border-t",children:[e.jsx("td",{className:"p-3 font-mono",children:i.code}),e.jsx("td",{className:"p-3",children:i.name}),e.jsx("td",{className:"p-3",children:i.grade_levels&&i.grade_levels.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:i.grade_levels.map(l=>{var a;return e.jsx(b,{variant:"secondary",className:"text-xs",children:((a=I.find(t=>t.value===l))==null?void 0:a.label)||l},l)})}):e.jsx(b,{variant:"outline",className:"text-xs text-gray-500",children:"All Grades"})}),e.jsx("td",{className:"p-3",children:i.grading_periods&&i.grading_periods.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:i.grading_periods.map(l=>e.jsx(b,{variant:"outline",className:"text-xs",children:l.code},l.id))}):i.grading_period?e.jsx(b,{variant:"outline",className:"text-xs",children:i.grading_period.code}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"p-3",children:i.units}),e.jsx("td",{className:"p-3",children:i.hours_per_week}),e.jsx("td",{className:"p-3",children:le(i.is_core)}),e.jsx("td",{className:"p-3",children:re(i.is_active)}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>ie(i),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>se(i),className:"text-red-600 hover:text-red-700",children:e.jsx(he,{className:"h-4 w-4"})})]})})]},i.id))})]})})]}):e.jsx(e.Fragment,{children:O(s.key).length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(W,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No subjects defined"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:["Get started by creating the first subject for ",s.name,"."]}),e.jsxs(S,{variant:"outline",onClick:()=>{_({...r,academic_level_id:s.id.toString()}),T(!0)},className:"border-blue-300 text-blue-600 hover:bg-blue-50",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Add First Subject"]})]}):e.jsx("div",{className:"grid gap-4",children:O(s.key).map(i=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg bg-gray-50 dark:bg-gray-800",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900 rounded-lg",children:e.jsx(W,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold text-gray-900 dark:text-gray-100",children:i.name}),e.jsxs(b,{variant:"outline",className:"text-xs font-mono bg-gray-100 dark:bg-gray-600",children:[e.jsx(es,{className:"h-3 w-3 mr-1"}),i.code]})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-600 dark:text-gray-400",children:[i.grading_periods&&i.grading_periods.length>0?e.jsxs("div",{className:"flex items-center gap-1 flex-wrap",children:[e.jsx(He,{className:"h-3 w-3"}),i.grading_periods.map((l,a)=>e.jsxs("span",{children:[l.name,a<i.grading_periods.length-1?", ":""]},l.id))]}):i.grading_period&&e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(He,{className:"h-3 w-3"}),i.grading_period.name]}),e.jsxs("span",{children:[i.units," units"]}),e.jsxs("span",{children:[i.hours_per_week," hrs/week"]})]})]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[le(i.is_core),re(i.is_active),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(S,{variant:"outline",size:"sm",onClick:()=>ie(i),children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(S,{variant:"outline",size:"sm",onClick:()=>se(i),className:"text-red-600 hover:text-red-700",children:e.jsx(he,{className:"h-4 w-4"})})]})]})]},i.id))})})})]})},s.key))]})]})})]}),e.jsx(Ge,{open:Me,onOpenChange:P,children:e.jsxs(Ee,{className:"w-[95vw] max-w-[900px] max-h-[85vh] overflow-y-auto",children:[e.jsxs(De,{children:[e.jsxs(Te,{children:["Edit Subject - ",(ye=d==null?void 0:d.academic_level)==null?void 0:ye.name]}),e.jsxs($e,{children:["Update the subject details for ",(Ne=d==null?void 0:d.academic_level)==null?void 0:Ne.name]})]}),d&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 border-b pb-2",children:"Basic Information"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-name",children:"Name"}),e.jsx(F,{id:"edit-subject-name",placeholder:"e.g., Mathematics, English, Science",value:d.name,onChange:s=>j({...d,name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-code",children:"Code"}),e.jsx(F,{id:"edit-subject-code",placeholder:"e.g., MATH101, ENG101",value:d.code,onChange:s=>j({...d,code:s.target.value})})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-description",children:"Description"}),e.jsx(F,{id:"edit-subject-description",placeholder:"Brief description of the subject",value:d.description||"",onChange:s=>j({...d,description:s.target.value})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 border-b pb-2",children:"Academic Classification"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-level",children:"Academic Level"}),e.jsxs("div",{className:"relative",children:[e.jsxs(p,{value:d.academic_level_id.toString(),onValueChange:s=>j({...d,academic_level_id:Number(s),grading_period_id:void 0,course_id:void 0}),disabled:!0,children:[e.jsx(v,{className:"bg-gray-50 cursor-not-allowed",children:e.jsx(f,{placeholder:"Select academic level"})}),e.jsx(y,{children:g.map(s=>e.jsx(u,{value:s.id.toString(),children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:H(s.key)}),s.name]})},s.id))})]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none",children:e.jsx("span",{className:"text-xs text-gray-500 bg-blue-100 px-2 py-1 rounded",children:"Selected"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Academic level cannot be changed when editing"})]}),(()=>{const s=g.find(t=>t.id===d.academic_level_id);if(!((s==null?void 0:s.key)==="elementary"||(s==null?void 0:s.key)==="junior_highschool"))return null;const l=d.academic_level_id?pe(d.academic_level_id).filter(t=>t.parent_id==null):[],a=d.grading_period_ids||(d.grading_period_id?[d.grading_period_id]:[]);return e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-grading",children:"Grading Periods"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md",children:l.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No grading periods available"}):l.map(t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`edit-gp-${t.id}`,checked:a.includes(t.id),onChange:o=>{const n=t.id;let h=[...a];o.target.checked?h.includes(n)||h.push(n):h=h.filter(m=>m!==n),j({...d,grading_period_ids:h})},className:"rounded border-gray-300"}),e.jsxs(c,{htmlFor:`edit-gp-${t.id}`,className:"text-sm font-normal cursor-pointer",children:[t.name," (",t.code,")"]})]},t.id))}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select one or more grading periods for this subject"})]})})(),(()=>{var l;const s=g.find(a=>a.id===d.academic_level_id);if((s==null?void 0:s.key)!=="elementary")return null;const i=((l=d.grade_levels)==null?void 0:l[0])||"";return e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-elem-grade",children:"Grade Level"}),e.jsxs(p,{value:i,onValueChange:a=>j({...d,grade_levels:[a]}),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select grade level"})}),e.jsx(y,{children:I.map(a=>e.jsx(u,{value:a.value,children:a.label},a.value))})]})]})})(),(()=>{var l,a;const s=g.find(t=>t.id===d.academic_level_id);if((s==null?void 0:s.key)!=="elementary")return null;const i=((l=d.grade_levels)==null?void 0:l[0])||"";return console.log("Elementary Edit Modal - Grade Level:",i),console.log("Elementary Edit Modal - Section ID:",d.section_id),i?e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-elem-section",children:"Section *"}),e.jsxs(p,{value:((a=d.section_id)==null?void 0:a.toString())||"",onValueChange:t=>{console.log("Elementary Section Changed:",t),j({...d,section_id:parseInt(t)})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select section"})}),e.jsx(y,{children:(()=>{const t=G.filter(o=>{const n=g.find(h=>h.id===o.academic_level_id);return(n==null?void 0:n.key)==="elementary"&&o.specific_year_level===i});return console.log("Available Elementary Sections:",t),console.log("Looking for section with ID:",d.section_id),t.length===0?e.jsx(u,{value:"no-sections",disabled:!0,children:"No sections available"}):t.map(o=>e.jsx(u,{value:o.id.toString(),children:o.name},o.id))})()})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a specific section for this subject"})]}):null})(),(()=>{const s=g.find(l=>l.id===d.academic_level_id);if((s==null?void 0:s.key)!=="junior_highschool")return null;const i=[{value:"grade_7",label:"Grade 7"},{value:"grade_8",label:"Grade 8"},{value:"grade_9",label:"Grade 9"},{value:"grade_10",label:"Grade 10"}];return e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-jhs-year",children:"Year Level"}),e.jsxs(p,{value:d.jhs_year_level||"",onValueChange:l=>j({...d,jhs_year_level:l}),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select year level"})}),e.jsx(y,{children:i.map(l=>e.jsx(u,{value:l.value,children:l.label},l.value))})]})]})})(),(()=>{var i;const s=g.find(l=>l.id===d.academic_level_id);return(s==null?void 0:s.key)!=="junior_highschool"||!d.jhs_year_level?null:(console.log("JHS Edit Modal - Year Level:",d.jhs_year_level),console.log("JHS Edit Modal - Section ID:",d.section_id),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-jhs-section",children:"Section *"}),e.jsxs(p,{value:((i=d.section_id)==null?void 0:i.toString())||"",onValueChange:l=>{console.log("JHS Section Changed:",l),j({...d,section_id:parseInt(l)})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select section"})}),e.jsx(y,{children:(()=>{const l=G.filter(a=>{const t=g.find(o=>o.id===a.academic_level_id);return(t==null?void 0:t.key)==="junior_highschool"&&a.specific_year_level===d.jhs_year_level});return console.log("Available JHS Sections:",l),console.log("Looking for section with ID:",d.section_id),l.length===0?e.jsx(u,{value:"no-sections",disabled:!0,children:"No sections available"}):l.map(a=>e.jsx(u,{value:a.id.toString(),children:a.name},a.id))})()})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a specific section for this subject"})]}))})()]}),(()=>{const s=g.find(a=>a.id===d.academic_level_id),i=(s==null?void 0:s.key)==="senior_highschool",l=(s==null?void 0:s.key)==="college";return(i||l)&&e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-year-level",children:"Year Level"}),e.jsxs(p,{value:i?d.shs_year_level||"":d.college_year_level||"",onValueChange:a=>{j(i?{...d,shs_year_level:a}:{...d,college_year_level:a})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select year level"})}),e.jsx(y,{children:i?Object.entries(Q).map(([a,t])=>e.jsx(u,{value:a,children:t},a)):Object.entries(K).map(([a,t])=>e.jsx(u,{value:a,children:t},a))})]})]})})(),d.academic_level_id&&((Se=g.find(s=>s.id===d.academic_level_id))==null?void 0:Se.key)==="senior_highschool"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-track",children:"Track"}),e.jsxs(p,{value:d.track_id||"",onValueChange:s=>j({...d,track_id:s,strand_id:""}),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select track"})}),e.jsx(y,{children:(_e||[]).map(s=>e.jsxs(u,{value:s.id.toString(),children:[s.name," (",s.code,")"]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-strand",children:"Strand"}),e.jsxs(p,{value:d.strand_id||"",onValueChange:s=>j({...d,strand_id:s}),disabled:!d.track_id,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select strand"})}),e.jsx(y,{children:ge.filter(s=>d.track_id&&s.track_id.toString()===String(d.track_id)).map(s=>e.jsxs(u,{value:s.id.toString(),children:[s.name," (",s.code,")"]},s.id))})]})]})]}),(()=>{var i;const s=g.find(l=>l.id===d.academic_level_id);return(s==null?void 0:s.key)!=="senior_highschool"||!d.track_id||!d.strand_id||!d.shs_year_level?null:(console.log("SHS Edit Modal - Track ID:",d.track_id),console.log("SHS Edit Modal - Strand ID:",d.strand_id),console.log("SHS Edit Modal - Year Level:",d.shs_year_level),console.log("SHS Edit Modal - Section ID:",d.section_id),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-shs-section",children:"Section *"}),e.jsxs(p,{value:((i=d.section_id)==null?void 0:i.toString())||"",onValueChange:l=>{console.log("SHS Section Changed:",l),j({...d,section_id:parseInt(l)})},children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select section"})}),e.jsx(y,{children:(()=>{const l=G.filter(a=>{var o,n;const t=g.find(h=>h.id===a.academic_level_id);return(t==null?void 0:t.key)==="senior_highschool"&&((o=a.track_id)==null?void 0:o.toString())===d.track_id&&((n=a.strand_id)==null?void 0:n.toString())===d.strand_id&&a.specific_year_level===d.shs_year_level});return console.log("Available SHS Sections:",l),console.log("Looking for section with ID:",d.section_id),l.length===0?e.jsx(u,{value:"no-sections",disabled:!0,children:"No sections available"}):l.map(a=>e.jsx(u,{value:a.id.toString(),children:a.name},a.id))})()})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a specific section for this subject"})]}))})(),d.academic_level_id&&((be=g.find(s=>s.id===d.academic_level_id))==null?void 0:be.key)==="college"&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-dept",children:"Department"}),e.jsxs(p,{value:((ke=d.department_id)==null?void 0:ke.toString())||"",onValueChange:s=>j({...d,department_id:Number(s),course_id:void 0,semester_id:void 0,grading_period_id:void 0}),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select department"})}),e.jsx(y,{children:xe.map(s=>e.jsx(u,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-course",children:"Course"}),e.jsxs(p,{value:((Ce=d.course_id)==null?void 0:Ce.toString())||"",onValueChange:s=>j({...d,course_id:Number(s)}),disabled:!d.department_id,children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select course (required for college subjects)"})}),e.jsx(y,{children:X.filter(s=>!d.department_id||s.department_id===d.department_id).map(s=>e.jsxs(u,{value:s.id.toString(),children:[s.code," - ",s.name]},s.id))})]})]})]}),(()=>{var i;const s=g.find(l=>l.id===d.academic_level_id);return(s==null?void 0:s.key)!=="college"||!d.department_id||!d.course_id||!d.college_year_level?null:e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-college-section",children:"Section *"}),e.jsxs(p,{value:((i=d.section_id)==null?void 0:i.toString())||"",onValueChange:l=>j({...d,section_id:parseInt(l)}),children:[e.jsx(v,{children:e.jsx(f,{placeholder:"Select section"})}),e.jsx(y,{children:(()=>{const l=G.filter(a=>{const t=g.find(o=>o.id===a.academic_level_id);return(t==null?void 0:t.key)==="college"&&a.department_id===d.department_id&&a.course_id===d.course_id&&a.specific_year_level===d.college_year_level});return l.length===0?e.jsx(u,{value:"no-sections",disabled:!0,children:"No sections available"}):l.map(a=>e.jsx(u,{value:a.id.toString(),children:a.name},a.id))})()})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Select a specific section for this subject"})]})})()]}),(()=>{const s=g.find(a=>a.id===d.academic_level_id),i=(s==null?void 0:s.key)==="senior_highschool",l=(s==null?void 0:s.key)==="college";if(i){const a=d.academic_level_id?U(d.academic_level_id):[],t=d.semester_ids||[],o=d.grading_period_ids||[];return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Semesters"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md",children:a.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No semesters available"}):a.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`edit-sem-${n.id}`,checked:t.includes(n.id),onChange:h=>{const m=n.id;h.target.checked?j({...d,semester_ids:[...t,m]}):j({...d,semester_ids:t.filter(x=>x!==m),grading_period_ids:o.filter(x=>{const N=k.find(E=>E.id===x);return(N==null?void 0:N.parent_id)!==m})})},className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:`edit-sem-${n.id}`,className:"text-sm font-normal cursor-pointer",children:n.name})]},n.id))})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Grading Periods"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md max-h-48 overflow-y-auto",children:t.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Select a semester first"}):t.map(n=>{const h=k.find(x=>x.id===n),m=z(n.toString());return!h||m.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-semibold text-blue-600 border-l-4 border-blue-600 pl-2",children:[h.name," Periods:"]}),m.map(x=>e.jsxs("div",{className:"flex items-center space-x-2 ml-6",children:[e.jsx("input",{type:"checkbox",id:`edit-shs-gp-${x.id}`,checked:o.includes(x.id),onChange:N=>{const E=x.id;N.target.checked?j({...d,grading_period_ids:[...o,E]}):j({...d,grading_period_ids:o.filter(ae=>ae!==E)})},className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:`edit-shs-gp-${x.id}`,className:"text-sm font-normal cursor-pointer",children:x.name})]},x.id))]},n)})})]})]})}if(l){const a=d.academic_level_id?U(d.academic_level_id):[],t=d.semester_ids||[],o=d.grading_period_ids||[];return e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{children:"Semesters"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md",children:a.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"No semesters available"}):a.map(n=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{type:"checkbox",id:`edit-college-sem-${n.id}`,checked:t.includes(n.id),onChange:h=>{const m=n.id;h.target.checked?j({...d,semester_ids:[...t,m]}):j({...d,semester_ids:t.filter(x=>x!==m),grading_period_ids:o.filter(x=>{const N=k.find(E=>E.id===x);return(N==null?void 0:N.parent_id)!==m})})},className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:`edit-college-sem-${n.id}`,className:"text-sm font-normal cursor-pointer",children:n.name})]},n.id))})]}),e.jsxs("div",{children:[e.jsx(c,{children:"Grading Periods"}),e.jsx("div",{className:"space-y-2 p-3 border rounded-md max-h-48 overflow-y-auto",children:t.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"Select a semester first"}):t.map(n=>{const h=k.find(x=>x.id===n),m=z(n.toString());return!h||m.length===0?null:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"text-sm font-semibold text-blue-600 border-l-4 border-blue-600 pl-2",children:[h.name," Periods:"]}),m.map(x=>e.jsxs("div",{className:"flex items-center space-x-2 ml-6",children:[e.jsx("input",{type:"checkbox",id:`edit-college-gp-${x.id}`,checked:o.includes(x.id),onChange:N=>{const E=x.id;N.target.checked?j({...d,grading_period_ids:[...o,E]}):j({...d,grading_period_ids:o.filter(ae=>ae!==E)})},className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:`edit-college-gp-${x.id}`,className:"text-sm font-normal cursor-pointer",children:x.name})]},x.id))]},n)})})]})]})}return null})(),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-700 border-b pb-2",children:"Subject Details"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-units",children:"Units"}),e.jsx(F,{id:"edit-subject-units",type:"number",min:"0",step:"0.5",value:d.units,onChange:s=>j({...d,units:parseFloat(s.target.value)||0})})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"edit-subject-hours",children:"Hours per Week"}),e.jsx(F,{id:"edit-subject-hours",type:"number",min:"0",value:d.hours_per_week,onChange:s=>j({...d,hours_per_week:parseInt(s.target.value)||0})})]})]}),e.jsxs("div",{className:"flex items-center space-x-6",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"edit-subject-core",type:"checkbox",checked:d.is_core,onChange:s=>j({...d,is_core:s.target.checked}),className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:"edit-subject-core",children:"Core Subject"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("input",{id:"edit-subject-active",type:"checkbox",checked:d.is_active,onChange:s=>j({...d,is_active:s.target.checked}),className:"rounded border-gray-300"}),e.jsx(c,{htmlFor:"edit-subject-active",children:"Active"})]})]})]})]}),e.jsxs(Ae,{children:[e.jsx(S,{variant:"outline",onClick:()=>P(!1),children:"Cancel"}),e.jsx(S,{onClick:()=>d&&Je(d),children:"Update Subject"})]})]})})]})}export{Ps as default};
