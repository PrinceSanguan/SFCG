import{m as ee,r as j,j as e,$ as E}from"./app-BQijAbPr.js";import{S as H,H as q}from"./sidebar-Bcs_Fl_x.js";import{C as B,b as W,c as z,a as K}from"./card-D7EX2X2y.js";import{B as f}from"./button-B2cFpUt2.js";import{I as F}from"./input-CXQaUJCJ.js";import{L as m}from"./label-D69GS-PD.js";import{S as p,a as b,b as v,c as y,d as i,e as I,f as L}from"./select-BSwL2Oi9.js";import{A as se}from"./arrow-left-BllXVsDC.js";import{P as te}from"./plus-BTbIIF9f.js";import{S as $}from"./save-qQ5h40sA.js";/* empty css            */import"./dropdown-menu-BdYkNrbA.js";import"./Combination-BsU_uZOx.js";import"./index-DwzqCC42.js";import"./user-M6YF5Doj.js";import"./log-out-DT42IUOn.js";import"./book-open-CHWRGv6V.js";import"./graduation-cap-5yp7GkOs.js";import"./upload-rRp2q8Mb.js";import"./crown-DC0BMG-R.js";import"./index-C7fC9uCz.js";import"./index-YpT5oHkH.js";import"./check-DKsHW04W.js";function Ce({user:S,academicLevels:A,gradingPeriods:n,assignedSubjects:c,selectedStudent:u}){var D,M,R;const N=new URLSearchParams(window.location.search),G=N.get("student_id")||"",_=N.get("subject_id")||"",k=N.get("academic_level_id")||"",P=N.get("school_year")||"2024-2025",{data:r,setData:a,post:Z,processing:w,errors:d}=ee({student_id:G,subject_id:_,academic_level_id:k,grading_period_id:"0",school_year:P,year_of_study:"",grade:""}),[O,J]=j.useState(!1),o=j.useMemo(()=>{var l,U;if(!r.subject_id)return console.log("No subject selected, returning all periods"),n;const s=c.find(g=>g.subject.id.toString()===r.subject_id);if(!s)return console.log("No assignment found for subject_id:",r.subject_id),n;const t=s.grading_period_ids||((l=s.subject)==null?void 0:l.grading_period_ids)||[];if(console.log("=== Grading Period Filtering ==="),console.log("Selected subject:",(U=s.subject)==null?void 0:U.name),console.log("Assignment grading_period_ids:",t),console.log("All grading periods:",n.length),t.length===0)return console.log("No grading_period_ids assigned, showing all periods"),n;const x=n.filter(g=>t.includes(g.id));return console.log("Filtered grading periods:",x.length,x.map(g=>({id:g.id,name:g.name}))),x},[r.subject_id,c,n]),C=j.useMemo(()=>{const s=new Set;return o.forEach(t=>{t.code.includes("_S1_")&&s.add("first"),t.code.includes("_S2_")&&s.add("second")}),console.log("Available semesters:",Array.from(s)),Array.from(s)},[o]),T=j.useMemo(()=>C.includes("first"),[C]),V=j.useMemo(()=>C.includes("second"),[C]);j.useEffect(()=>{var s;if(!O){if(G||_||k){console.log("=== FORM INITIALIZATION ==="),console.log("URL Params:",{initialStudentId:G,initialSubjectId:_,initialAcademicLevelId:k,initialSchoolYear:P}),console.log("Form Data After Init:",r),console.log("Assigned Subjects:",c.map(l=>({assignmentId:l.id,subjectId:l.subject.id,subjectName:l.subject.name})));const t=c.find(l=>l.subject.id.toString()===_);t?console.log("✓ Found matching subject:",t.subject.name):(console.error("✗ Subject not found in assignedSubjects! subject_id:",_),console.log("Available subject IDs:",c.map(l=>l.subject.id)));const x=window.location.pathname;window.history.replaceState({},"",x)}else u&&(console.log("=== FALLBACK TO SELECTED STUDENT PROP ==="),a("student_id",u.id.toString()),a("subject_id",((s=u.subjectId)==null?void 0:s.toString())||""),a("academic_level_id",u.academicLevelKey||""),a("school_year","2024-2025"),a("year_of_study",""),a("grade",""),console.log("Form data set from selectedStudent prop:",{student_id:u.id,subject_id:u.subjectId}));J(!0)}},[]);const Q=s=>{if(!s)return null;for(const t of c)if(t.enrolled_students.find(l=>l.student.id.toString()===s))return{subjectId:t.subject.id,academicLevelId:t.academicLevel.id,academicLevelKey:t.academicLevel.key,schoolYear:t.school_year};return null},X=s=>{if(a("student_id",s),s){const t=Q(s);t&&(a("subject_id",t.subjectId.toString()),a("academic_level_id",t.academicLevelId.toString()),a("school_year",t.schoolYear))}else a("subject_id",""),a("academic_level_id",""),a("grade","")},Y=s=>{s.preventDefault(),console.log("Form submitted with data:",r),console.log("Has pre-selected student:",h),Z(route("instructor.grades.store"),{onSuccess:()=>{console.log("Grade created successfully")},onError:t=>{console.log("Grade creation failed:",t)}})},h=r.student_id&&r.subject_id&&r.academic_level_id;return console.log("Form data:",r),console.log("hasPreSelectedStudent:",h),console.log("Academic Levels:",A),console.log("Grading Periods:",n),console.log("Grading Periods Length:",n==null?void 0:n.length),O?e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(H,{user:S}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(q,{user:S}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{href:route("instructor.grades.index"),children:e.jsxs(f,{variant:"outline",size:"sm",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Back to Grades"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:h?"Input Grade":"Input New Grade"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:h?"Enter a grade for the selected student.":"Enter a new grade for a student in your assigned course."})]})]})}),e.jsxs(B,{className:"max-w-2xl",children:[e.jsx(W,{children:e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5"}),"Grade Information"]})}),e.jsx(K,{children:h?e.jsxs("form",{onSubmit:Y,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Student Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Student:"}),e.jsx("p",{className:"font-medium",children:((M=(D=c.find(s=>s.enrolled_students.some(t=>t.student.id.toString()===r.student_id)))==null?void 0:D.enrolled_students.find(s=>s.student.id.toString()===r.student_id))==null?void 0:M.student.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Subject:"}),e.jsx("p",{className:"font-medium",children:(()=>{const s=c.find(t=>t.subject.id.toString()===r.subject_id);return console.log("Looking for subject_id:",r.subject_id,"Found:",s==null?void 0:s.subject.name),(s==null?void 0:s.subject.name)||"Unknown"})()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Academic Level:"}),e.jsx("p",{className:"font-medium",children:((R=A.find(s=>s.id.toString()===r.academic_level_id))==null?void 0:R.name)||"College"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"School Year:"}),e.jsx("p",{className:"font-medium",children:r.school_year})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"grade",children:"Grade"}),e.jsx(F,{id:"grade",type:"number",step:"0.1",min:"1.0",max:"5.0",placeholder:"Enter grade (1.0-5.0)",value:r.grade,onChange:s=>a("grade",s.target.value),className:d.grade?"border-red-500":"",autoFocus:!0}),d.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.grade}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"College: 1.0 (highest) to 5.0 (lowest). 3.0 is passing (equivalent to 75)."})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(p,{value:r.grading_period_id,onValueChange:s=>a("grading_period_id",s),children:[e.jsx(b,{className:d.grading_period_id?"border-red-500":"",children:e.jsx(v,{placeholder:"Select grading period"})}),e.jsxs(y,{children:[e.jsx(i,{value:"0",children:"No Period"}),o&&o.length>0?e.jsxs(e.Fragment,{children:[T&&e.jsxs(I,{children:[e.jsx(L,{children:"First Semester"}),o.filter(s=>s.code.startsWith("COL_S1_")&&!s.code.includes("_FA")).sort((s,t)=>s.sort_order-t.sort_order).map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))]}),V&&e.jsxs(I,{children:[e.jsx(L,{children:"Second Semester"}),o.filter(s=>s.code.startsWith("COL_S2_")&&!s.code.includes("_FA")).sort((s,t)=>s.sort_order-t.sort_order).map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))]})]}):e.jsx(i,{value:"debug",disabled:!0,children:r.subject_id?"No grading periods assigned to this subject":"Select a subject first"})]})]}),d.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.grading_period_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select which grading period this grade belongs to"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(f,{type:"submit",disabled:w,className:"flex-1",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),w?"Saving...":"Save Grade"]}),e.jsx(E,{href:route("instructor.grades.index"),className:"flex-1",children:e.jsx(f,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]}):e.jsxs("form",{onSubmit:Y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"student_id",children:"Student"}),e.jsxs(p,{value:r.student_id,onValueChange:X,children:[e.jsx(b,{className:d.student_id?"border-red-500":"",children:e.jsx(v,{placeholder:"Select a student"})}),e.jsx(y,{children:c.flatMap(s=>s.enrolled_students.map(t=>e.jsxs(i,{value:t.student.id.toString(),children:[t.student.name," - ",s.subject.name]},t.student.id)))})]}),d.student_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.student_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select a student from your assigned subjects"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"subject_id",children:"Subject"}),e.jsxs(p,{value:r.subject_id,onValueChange:s=>a("subject_id",s),children:[e.jsx(b,{className:d.subject_id?"border-red-500":"",children:e.jsx(v,{placeholder:"Select a subject"})}),e.jsx(y,{children:c.map(s=>e.jsxs(i,{value:s.subject.id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.subject.id))})]}),d.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.subject_id})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"academic_level_id",children:"Academic Level"}),e.jsxs(p,{value:r.academic_level_id,onValueChange:s=>a("academic_level_id",s),children:[e.jsx(b,{className:d.academic_level_id?"border-red-500":"",children:e.jsx(v,{placeholder:"Select academic level"})}),e.jsx(y,{children:A.map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))})]}),d.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(p,{value:r.grading_period_id,onValueChange:s=>a("grading_period_id",s),children:[e.jsx(b,{children:e.jsx(v,{placeholder:"Select grading period (optional)"})}),e.jsxs(y,{children:[e.jsx(i,{value:"0",children:"No Period"}),o&&o.length>0?e.jsxs(e.Fragment,{children:[T&&e.jsxs(I,{children:[e.jsx(L,{children:"First Semester"}),o.filter(s=>s.code.startsWith("COL_S1_")&&!s.code.includes("_FA")).sort((s,t)=>s.sort_order-t.sort_order).map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))]}),V&&e.jsxs(I,{children:[e.jsx(L,{children:"Second Semester"}),o.filter(s=>s.code.startsWith("COL_S2_")&&!s.code.includes("_FA")).sort((s,t)=>s.sort_order-t.sort_order).map(s=>e.jsx(i,{value:s.id.toString(),children:s.name},s.id))]})]}):e.jsx(i,{value:"debug",disabled:!0,children:r.subject_id?"No grading periods assigned to this subject":"Select a subject first"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"school_year",children:"School Year"}),e.jsx(F,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:r.school_year,onChange:s=>a("school_year",s.target.value),className:d.school_year?"border-red-500":""}),d.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.school_year})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(F,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1, 2, 3, 4",value:r.year_of_study,onChange:s=>a("year_of_study",s.target.value),className:d.year_of_study?"border-red-500":""}),d.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.year_of_study}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Required for college level"})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"grade",children:"Grade"}),e.jsx(F,{id:"grade",type:"number",step:"0.1",min:"1.0",max:"5.0",placeholder:"Enter grade (1.0-5.0)",value:r.grade,onChange:s=>a("grade",s.target.value),className:d.grade?"border-red-500":""}),d.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.grade}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"College: 1.0 (highest) to 5.0 (lowest). 3.0 is passing (equivalent to 75)."})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(f,{type:"submit",disabled:w,className:"flex-1",children:[e.jsx($,{className:"h-4 w-4 mr-2"}),w?"Saving...":"Save Grade"]}),e.jsx(E,{href:route("instructor.grades.index"),className:"flex-1",children:e.jsx(f,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]})})]}),e.jsxs(B,{children:[e.jsx(W,{children:e.jsx(z,{children:"Help & Guidelines"})}),e.jsx(K,{children:e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Student:"})," Select a student from your assigned subjects"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Subject:"})," Automatically populated when student is selected"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Grade Scale:"})," College uses 1.0-5.0 scale (1.0 highest, 5.0 lowest, 3.0 passing equivalent to 75%)"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Validation:"})," Grades are automatically submitted for validation after saving"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Editing:"})," You can edit grades before they are validated by the registrar"]})]})})]})]})})]})]}):e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(H,{user:S}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(q,{user:S}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading form..."})]})})})]})]})}export{Ce as default};
