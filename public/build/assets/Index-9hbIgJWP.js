import{r as _,m as B,j as e,S as A}from"./app-Cp9NjWYG.js";import{H as fe}from"./header-61PYOAdR.js";import{S as Ne}from"./sidebar-DTz7hyEI.js";import{C as v,a as b,b as ye,c as _e}from"./card-BQSU5Dlj.js";import{B as x}from"./button-DZaBrzx3.js";import{S as V,a as J,b as q,c as Q,d as L}from"./select-DzRaXHEp.js";import{T as ve,a as be,b as X,c as u,d as ke,e as h}from"./table-D3AKY_D5.js";import{D as Se,a as we,b as De,c as O,d as Ce}from"./dropdown-menu-atARtuT6.js";import{B as k}from"./badge-Ku9AI2a2.js";import{A as Z}from"./arrow-left-CnGIO4tT.js";import{P as Y,E as Be,a as Ae}from"./printer-BxPy6LiF.js";import{D as T}from"./download-CwVxIylM.js";import{S as Le}from"./school-Jk5dhuz9.js";import{B as Oe}from"./book-open-tyrdWMvg.js";import{G as Te}from"./graduation-cap-DClvfwMN.js";import{U as Ge}from"./users-DgF2Pe0N.js";import{F as G}from"./file-text-DJJN_kUH.js";/* empty css            */import"./separator-1a82sZ3g.js";import"./index-6PVpn6-Y.js";import"./Combination-CFAD2So3.js";import"./chevron-right-CF7hqmYx.js";import"./crown-CJ6-i-19.js";import"./building-2-C5bpFo5H.js";import"./user-cog-DBac9lkp.js";import"./user-check-D5RGchtY.js";import"./notebook-Zf0HsR62.js";import"./chart-no-axes-column-increasing-CbgLZnUP.js";import"./shield-BEiPjfCs.js";import"./index-DmRWeeiQ.js";import"./index-CXvyxhQA.js";import"./check-sTGVbyFp.js";const P=[{key:"elementary",name:"Elementary",icon:Le,color:"bg-blue-500 hover:bg-blue-600",iconColor:"text-blue-600"},{key:"junior_highschool",name:"Junior High School",icon:Oe,color:"bg-green-500 hover:bg-green-600",iconColor:"text-green-600"},{key:"senior_highschool",name:"Senior High School",icon:Te,color:"bg-orange-500 hover:bg-orange-600",iconColor:"text-orange-600"},{key:"college",name:"College",icon:Ge,color:"bg-purple-500 hover:bg-purple-600",iconColor:"text-purple-600"}];function us({user:H,academicLevels:S,templates:ee,allHonors:j=[],generatedCertificates:c=[],schoolYears:w,currentSchoolYear:se}){var z,R;const[d,U]=_.useState(null),[r,le]=_.useState(se||(w==null?void 0:w[0])||"2024-2025"),[f,E]=_.useState(""),[o,D]=_.useState([]),[g,I]=_.useState([]),{setData:te,post:ae,processing:ie}=B({student_id:"",template_id:"",academic_level_id:"",school_year:r}),{setData:ce,post:ne,processing:W}=B({student_ids:[],template_id:"",academic_level_id:"",school_year:r}),{setData:F,post:M,processing:C}=B({certificate_ids:[]}),{setData:re,post:de,processing:$}=B({academic_level_id:"",school_year:r,honor_type_id:""}),K=s=>j.length?j.filter(l=>l&&l.academic_level&&l.academic_level.key===s&&l.school_year===r).sort((l,t)=>l.year_level!==t.year_level?(l.year_level||"").localeCompare(t.year_level||""):l.section_id!==t.section_id?(l.section_id||0)-(t.section_id||0):s==="college"?(l.gpa||0)-(t.gpa||0):(t.gpa||0)-(l.gpa||0)):[],oe=s=>{const l=S.find(t=>t.key===s);return l?ee.filter(t=>t.academic_level_id===l.id&&t.is_active):[]},me=s=>{te({student_id:s.student.id.toString(),template_id:f,academic_level_id:s.academic_level.id.toString(),school_year:r}),ae(route("admin.academic.certificates.generate"),{onSuccess:()=>{A.reload()}})},xe=()=>{if(o.length===0||!f)return;const s=S.find(l=>l.key===d);s&&(ce({student_ids:o,template_id:f,academic_level_id:s.id.toString(),school_year:r}),ne(route("admin.academic.certificates.generate-bulk"),{onSuccess:()=>{D([]),A.reload()}}))},ue=s=>{D(l=>l.includes(s)?l.filter(t=>t!==s):[...l,s])},he=()=>{const l=K(d).map(t=>t.student.id);D(o.length===l.length?[]:l)},pe=()=>{const s=S.find(l=>l.key===d);s&&(re({academic_level_id:s.id.toString(),school_year:r,honor_type_id:""}),de(route("admin.academic.certificates.bulk-generate-by-level"),{onSuccess:()=>{A.reload()}}))},ge=(s,l)=>{l.stopPropagation(),I(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},je=()=>{if(g.length===0)return;const s=[];g.forEach(l=>{j.filter(a=>{var n;return((n=a==null?void 0:a.academic_level)==null?void 0:n.key)===l&&a.school_year===r}).forEach(a=>{const n=c==null?void 0:c.find(i=>i.student.id===a.student.id&&i.academic_level.id===a.academic_level.id&&i.school_year===a.school_year);n&&s.push(n.id)})}),s.length>0?(F({certificate_ids:s}),M(route("admin.academic.certificates.bulk-print-pdf"))):alert("No generated certificates found for selected categories. Please generate certificates first.")},p=d?K(d):[],y=d?oe(d):[];return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Ne,{user:H}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(fe,{user:H}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>A.get("/admin/academic"),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Back to Academic"]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Certificate Management"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Generate and manage honor certificates by academic level."})]}),e.jsx(v,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"School Year:"}),e.jsxs(V,{value:r,onValueChange:le,children:[e.jsx(J,{className:"w-40",children:e.jsx(q,{})}),e.jsx(Q,{children:w.map(s=>e.jsx(L,{value:s,children:s},s))})]})]})})}),d?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(x,{variant:"outline",onClick:()=>{U(null),D([]),E("")},children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Back to Categories"]}),e.jsxs("h2",{className:"text-2xl font-bold",children:[(z=P.find(s=>s.key===d))==null?void 0:z.name," Honor Students"]}),e.jsxs(k,{variant:"outline",children:[p.length," students"]})]})}),e.jsxs(v,{children:[e.jsx(ye,{children:e.jsx(_e,{children:"Certificate Generation"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Select Certificate Template",y.length===0&&e.jsx("span",{className:"ml-2 text-xs text-red-600 font-normal",children:"(No templates - Run: php artisan db:seed --class=CertificateTemplateSeeder)"})]}),e.jsxs(V,{value:f,onValueChange:E,children:[e.jsx(J,{className:y.length===0?"border-red-300":"",children:e.jsx(q,{placeholder:y.length>0?"Choose a template...":"⚠️ No templates available - seed database first"})}),e.jsx(Q,{children:y.length>0?y.map(s=>e.jsx(L,{value:s.id.toString(),children:s.name},s.id)):e.jsx(L,{value:"none",disabled:!0,children:"No templates available - run CertificateTemplateSeeder"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{onClick:pe,disabled:p.length===0||$,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),$?"Generating All...":"Generate All Missing Certificates"]}),e.jsxs(Se,{children:[e.jsx(we,{asChild:!0,children:e.jsxs(x,{variant:"outline",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"More Actions"]})}),e.jsxs(De,{align:"end",className:"w-56",children:[e.jsxs(O,{onClick:xe,disabled:o.length===0||!f||W,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),W?"Generating...":`Generate ${o.length} Selected`]}),e.jsxs(O,{onClick:()=>{console.log("[BULK DOWNLOAD] Starting bulk certificate download"),console.log("[BULK DOWNLOAD] Selected students:",o),console.log("[BULK DOWNLOAD] Selected category data:",p),console.log("[BULK DOWNLOAD] Generated certificates:",c);const s=p.filter(l=>o.includes(l.student.id)).map(l=>{const t=c==null?void 0:c.find(a=>a.student.id===l.student.id&&a.academic_level.id===l.academic_level.id);return console.log(`[BULK DOWNLOAD] Student ${l.student.name} - Certificate ID:`,t==null?void 0:t.id),t==null?void 0:t.id}).filter(l=>l!==void 0);console.log("[BULK DOWNLOAD] Final certificate IDs:",s),s.length>0?(console.log("[BULK DOWNLOAD] Submitting form with certificate IDs:",s),F({certificate_ids:s}),M(route("admin.academic.certificates.bulk-print-pdf"),{onSuccess:()=>{console.log("[BULK DOWNLOAD] Download successful")},onError:l=>{console.error("[BULK DOWNLOAD] Download failed:",l),alert("Failed to download certificates. Please check console for errors.")}})):(console.warn("[BULK DOWNLOAD] No certificate IDs found - certificates may not be generated yet"),alert("No certificates found for selected students. Please generate certificates first."))},disabled:o.length===0||C,children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),C?"Preparing...":`Download ${o.length} Selected`]}),e.jsx(Ce,{}),e.jsxs(O,{onClick:()=>{var s;return window.open(`/admin/academic/certificates/honor-roll/pdf?academic_level_id=${(s=S.find(l=>l.key===d))==null?void 0:s.id}&school_year=${r}`,"_blank")},children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),"Honor Roll PDF"]})]})]})]})]})})]}),e.jsx(v,{children:e.jsx(b,{children:p.length>0?e.jsxs(ve,{children:[e.jsx(be,{children:e.jsxs(X,{children:[e.jsx(u,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:o.length===p.length&&p.length>0,onChange:he})}),e.jsx(u,{children:"Rank"}),e.jsx(u,{children:"Student Name"}),e.jsx(u,{children:"Student Number"}),e.jsx(u,{children:"Year Level"}),e.jsx(u,{children:"Section"}),e.jsx(u,{children:"Honor Type"}),e.jsx(u,{children:"GPA"}),e.jsx(u,{children:"Certificate"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(ke,{children:p.map((s,l)=>{var t,a;return!s||!s.student?null:e.jsxs(X,{children:[e.jsx(h,{children:e.jsx("input",{type:"checkbox",checked:o.includes(s.student.id),onChange:()=>ue(s.student.id)})}),e.jsxs(h,{className:"font-medium",children:["#",l+1]}),e.jsx(h,{className:"font-medium",children:s.student.name}),e.jsx(h,{children:s.student.student_number||"N/A"}),e.jsx(h,{children:s.year_level||s.student.year_level||"N/A"}),e.jsx(h,{children:((t=s.student.section)==null?void 0:t.name)||"N/A"}),e.jsx(h,{children:e.jsx(k,{variant:"secondary",children:((a=s.honor_type)==null?void 0:a.name)||"Unknown Honor"})}),e.jsx(h,{className:"font-mono",children:s.gpa?s.gpa.toFixed(2):"N/A"}),e.jsx(h,{children:(()=>{const n=c==null?void 0:c.find(i=>i.student.id===s.student.id&&i.academic_level.id===s.academic_level.id&&i.school_year===s.school_year);return n?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"default",className:"text-xs",children:"Generated"}),e.jsx("span",{className:"text-xs text-gray-500",children:n.serial_number})]}):e.jsx(k,{variant:"outline",className:"text-xs",children:"Pending"})})()}),e.jsx(h,{children:e.jsx("div",{className:"flex gap-1",children:(()=>{const n=c==null?void 0:c.find(i=>i.student.id===s.student.id&&i.academic_level.id===s.academic_level.id&&i.school_year===s.school_year);return n?e.jsxs(e.Fragment,{children:[e.jsx(x,{size:"sm",variant:"outline",onClick:()=>window.open(route("admin.academic.certificates.download",n.id),"_blank"),className:"h-8 px-2",children:e.jsx(T,{className:"h-3 w-3"})}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>window.open(route("admin.academic.certificates.print",n.id),"_blank"),className:"h-8 px-2",children:e.jsx(Ae,{className:"h-3 w-3"})})]}):e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>me(s),disabled:!f||ie,className:"h-8 px-2",children:[e.jsx(G,{className:"h-3 w-3 mr-1"}),"Generate"]})})()})})]},s.id||l)})})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Honor Students Found"}),e.jsxs("p",{className:"text-sm",children:["No approved honor students for ",(R=P.find(s=>s.key===d))==null?void 0:R.name," in ",r,"."]})]})})})]}):e.jsxs(e.Fragment,{children:[g.length>0&&e.jsx(v,{className:"bg-blue-50 border-blue-200",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{className:"h-5 w-5 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-900",children:[g.length," ",g.length===1?"category":"categories"," selected"]}),e.jsx(k,{variant:"secondary",children:(()=>{let s=0;return g.forEach(l=>{j.filter(a=>{var n;return((n=a==null?void 0:a.academic_level)==null?void 0:n.key)===l&&a.school_year===r}).forEach(a=>{(c==null?void 0:c.find(i=>i.student.id===a.student.id&&i.academic_level.id===a.academic_level.id&&i.school_year===a.school_year))&&s++})}),`${s} certificates`})()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>I([]),children:"Clear Selection"}),e.jsxs(x,{size:"sm",onClick:je,disabled:C,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(T,{className:"h-4 w-4 mr-2"}),C?"Preparing...":"Download Selected"]})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:P.map(s=>{const l=s.icon,t=j.filter(i=>{var m;return((m=i==null?void 0:i.academic_level)==null?void 0:m.key)===s.key&&i.school_year===r}).length,a=j.filter(m=>{var N;return((N=m==null?void 0:m.academic_level)==null?void 0:N.key)===s.key&&m.school_year===r}).filter(m=>c==null?void 0:c.some(N=>N.student.id===m.student.id&&N.academic_level.id===m.academic_level.id&&N.school_year===m.school_year)).length,n=g.includes(s.key);return e.jsx(v,{className:`cursor-pointer transition-all hover:shadow-lg ${n?"ring-2 ring-blue-500 bg-blue-50":""}`,onClick:()=>U(s.key),children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("input",{type:"checkbox",checked:n,onChange:i=>ge(s.key,i),onClick:i=>i.stopPropagation(),className:"h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"})}),e.jsx("div",{className:"p-4 rounded-full bg-gray-100",children:e.jsx(l,{className:`h-8 w-8 ${s.iconColor}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t," honor students"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[a," certificates generated"]})]}),e.jsx(x,{className:`w-full ${s.color} text-white`,children:"View Students"})]})})},s.key)})})]})]})})]})]})}export{us as default};
