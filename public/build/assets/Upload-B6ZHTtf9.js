import{r as u,m as q,j as e,$ as z,d as W,C as J}from"./app-UQ7gFYkn.js";import{C as k,b as D,c as U,a as I}from"./card-OQypK_El.js";import{B as _}from"./button-B4qDo9F3.js";import{I as f}from"./input-DWl0J7hz.js";import{L as n}from"./label-NpvLk_cv.js";import{S as y,a as v,b,c as N,d as m}from"./select-RZeDtR0M.js";import{A as V,a as A}from"./alert-Dw48nky0.js";import{S as M,H as Q}from"./sidebar-CksbnRXO.js";import{U as G}from"./upload-N0T1Z4Zt.js";import{F as X}from"./file-text-CPq0DpR6.js";import{D as Z}from"./download-vpkCsA3u.js";/* empty css            */import"./index-DXaO-Nbq.js";import"./Combination-Db_bS9fT.js";import"./index-D_K-1Jet.js";import"./index-BRUquS9u.js";import"./check-Mpm2NyYL.js";import"./dropdown-menu-CnXDpmmf.js";import"./user-toc-NqBR.js";import"./log-out-Bg77S40J.js";import"./book-open-C16vuBve.js";import"./graduation-cap-BffXGCF5.js";import"./crown-D6N2pQi5.js";function Se({user:S,assignedSubjects:C,academicLevels:j,gradingPeriods:P}){const g=u.useRef(null),[o,w]=u.useState(null),[F,x]=u.useState(0),[h,p]=u.useState(!1),{data:t,setData:d,post:T,processing:L,errors:l,reset:B}=q({csv_file:null,subject_id:"",academic_level_id:"",grading_period_id:"",school_year:"",year_of_study:""}),E=s=>{var a;const r=(a=s.target.files)==null?void 0:a[0];r&&(w(r),d("csv_file",r))},H=s=>{d("subject_id",s);const r=C.find(a=>a.subject_id.toString()===s);r&&(d("academic_level_id",r.academicLevel.id.toString()),d("school_year",r.school_year),r.gradingPeriod&&d("grading_period_id",r.gradingPeriod.id.toString()))},$=s=>{if(s.preventDefault(),!o)return;p(!0),x(0);const r=new FormData;r.append("csv_file",o),r.append("subject_id",t.subject_id),r.append("academic_level_id",t.academic_level_id),r.append("grading_period_id",t.grading_period_id||""),r.append("school_year",t.school_year),r.append("year_of_study",t.year_of_study||"");const a=setInterval(()=>{x(i=>i>=90?(clearInterval(a),90):i+10)},200);T(route("instructor.grades.upload.store"),{data:r,onSuccess:()=>{x(100),setTimeout(()=>{p(!1),x(0),w(null),B(),g.current&&(g.current.value="")},1e3)},onError:()=>{p(!1),x(0)}})},R=()=>{window.open(route("instructor.grades.template"),"_blank")},K=(()=>{const s=j.find(r=>r.id.toString()===t.academic_level_id);return(s==null?void 0:s.key)||"college"})()==="college";return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(M,{user:S}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(Q,{user:S}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Grades CSV"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Bulk upload student grades using a CSV file"})]}),e.jsx(z,{href:route("instructor.grades.index"),children:e.jsx(_,{variant:"outline",children:"Back to Grades"})})]}),e.jsxs(k,{className:"max-w-2xl",children:[e.jsx(D,{children:e.jsxs(U,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Upload Grades CSV"]})}),e.jsx(I,{children:e.jsxs("form",{onSubmit:$,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"csv_file",children:"CSV File"}),e.jsx("div",{className:"mt-2",children:e.jsx(f,{id:"csv_file",ref:g,type:"file",accept:".csv,.txt",onChange:E,className:"cursor-pointer",disabled:h})}),o&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(X,{className:"h-4 w-4"}),o.name," (",(o.size/1024).toFixed(1)," KB)"]}),l.csv_file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.csv_file})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"subject_id",children:"Subject *"}),e.jsxs(y,{value:t.subject_id,onValueChange:H,children:[e.jsx(v,{className:l.subject_id?"border-red-500":"",children:e.jsx(b,{placeholder:"Select a subject"})}),e.jsx(N,{children:C.map(s=>e.jsxs(m,{value:s.subject_id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.id))})]}),l.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.subject_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"academic_level_id",children:"Academic Level *"}),e.jsxs(y,{value:t.academic_level_id,onValueChange:s=>d("academic_level_id",s),children:[e.jsx(v,{className:l.academic_level_id?"border-red-500":"",children:e.jsx(b,{placeholder:"Select academic level"})}),e.jsx(N,{children:j.map(s=>e.jsx(m,{value:s.id.toString(),children:s.name},s.id))})]}),l.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(y,{value:t.grading_period_id,onValueChange:s=>d("grading_period_id",s),children:[e.jsx(v,{className:l.grading_period_id?"border-red-500":"",children:e.jsx(b,{placeholder:"Select grading period (optional)"})}),e.jsxs(N,{children:[e.jsx(m,{value:"0",children:"No Period"}),(()=>{const s=j.find(a=>a.id.toString()===t.academic_level_id),r=P.filter(a=>a.academic_level_id.toString()===t.academic_level_id);return(s==null?void 0:s.key)==="college"?r.filter(i=>(i.code==="COL_S1"||i.code==="COL_S2")&&!i.code.includes("_")).map(i=>{const O=r.filter(c=>c.code.startsWith(i.code+"_")&&!c.code.includes("_FA")).sort((c,Y)=>c.sort_order-Y.sort_order);return e.jsxs("div",{children:[e.jsx(m,{value:i.id.toString(),className:"font-semibold",children:i.name}),O.map(c=>e.jsxs(m,{value:c.id.toString(),className:"pl-6 text-sm",children:["• ",c.name]},c.id))]},i.id)}):r.filter(a=>!a.name.toLowerCase().includes("final average")).sort((a,i)=>a.sort_order-i.sort_order).map(a=>e.jsx(m,{value:a.id.toString(),children:a.name},a.id))})()]})]}),l.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.grading_period_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"school_year",children:"School Year *"}),e.jsx(f,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:t.school_year,onChange:s=>d("school_year",s.target.value),className:l.school_year?"border-red-500":""}),l.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.school_year})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(f,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1",value:t.year_of_study,onChange:s=>d("year_of_study",s.target.value),className:l.year_of_study?"border-red-500":""}),l.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.year_of_study})]}),e.jsxs(V,{children:[e.jsx(W,{className:"h-4 w-4"}),e.jsxs(A,{children:[e.jsx("strong",{children:"Grade System:"})," ",K?"College uses 1.0-5.0 scale (1.0 highest, 3.0 passing)":"Elementary to Senior High uses 75-100 scale (75 passing)"]})]}),h&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Uploading... ",F,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${F}%`}})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(_,{type:"submit",disabled:L||h||!o||!t.subject_id||!t.academic_level_id||!t.school_year,className:"flex-1",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),h?"Uploading...":"Upload Grades"]}),e.jsxs(_,{type:"button",variant:"outline",onClick:R,className:"flex-1",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})]})})]}),e.jsxs(k,{children:[e.jsx(D,{children:e.jsx(U,{children:"CSV Format Instructions"})}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Required Columns:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Grade Values:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"College:"})," 1.0 to 5.0 (3.0 = passing)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Elementary/Senior High:"})," 75 to 100 (75 = passing)"]})]})]})]}),e.jsxs(V,{children:[e.jsx(J,{className:"h-4 w-4 text-green-600"}),e.jsxs(A,{children:[e.jsx("strong",{children:"Tip:"})," Download the template to see the exact format. The system will automatically detect existing grades and update them, or create new ones if they don't exist."]})]})]})]})]})})]})]})}export{Se as default};
