import{m as T,r as j,j as e,$ as E}from"./app-CYvxa7jT.js";import{C as A,a as D,b as O,c as R}from"./card-NQw11Qdd.js";import{B as y}from"./button-V-FopNJN.js";import{I as P}from"./input-9ChW2aP7.js";import{L as $}from"./label-CH-1azTc.js";import{S as W,a as Y,b as q,c as z,d as b,e as U,f as I}from"./select-DG6ocbrG.js";import{S as K,H as Q}from"./sidebar-2zldFq0j.js";import{A as J}from"./arrow-left-yUMHYQ5M.js";import{S as X}from"./square-pen-CXAxSn_X.js";import{S as Z}from"./save-ePHzDnT4.js";/* empty css            */import"./index-FsUecGkA.js";import"./Combination-tNc9cCf7.js";import"./index-SMqgKLad.js";import"./index-JUXPyEUT.js";import"./check-Cbc373iW.js";import"./dropdown-menu-BhRqOfwu.js";import"./user-Crn7FotS.js";import"./log-out-vRcsfu3z.js";import"./book-open-BDDsgmpM.js";import"./graduation-cap-DYpiabXW.js";import"./upload-p_3PcSip.js";import"./crown-ChNBq_U7.js";function Ne({user:_,grade:s,gradingPeriods:c,assignedSubjects:u}){var k,w,S,C,L,F,G;const g=t=>{const r={1.1:"97-98%",1.2:"95-96%",1.3:"93-94%",1.4:"91-92%",1.5:"90%",1.6:"89%",1.7:"88%",1.8:"87%",1.9:"86%",2:"85%",2.1:"84%",2.2:"83%",2.3:"82%",2.4:"81%",2.5:"80%",2.6:"79%",2.7:"78%",2.8:"77%",2.9:"76%",3:"75%",3.1:"74%",3.2:"73%",3.3:"72%",3.4:"71%",3.5:"70%",5:"Below 70%"},a=Math.round(t*10)/10;return r[a]||""},f=t=>t>=1&&t<=1.2?"Excellent":t>=1.3&&t<=1.5?"Superior":t>=1.6&&t<=1.8?"Very Good":t>=1.9&&t<=2.1?"Good":t>=2.2&&t<=2.4?"Average":t>=2.5&&t<=2.7?"Satisfactory":t>=2.8&&t<=3?"Fair":t>3&&t<=3.5?"Conditional":t===5?"Failing":"",{data:l,setData:v,put:M,processing:N,errors:d}=T({grade:s.grade.toString(),grading_period_id:((k=s.grading_period_id)==null?void 0:k.toString())||"0"}),h=j.useMemo(()=>{const t=new Set;return u.forEach(r=>{r.enrolled_students.forEach(a=>{a.semester&&t.add(a.semester.toLowerCase())})}),Array.from(t)},[u]),V=j.useMemo(()=>h.some(t=>t.includes("1st")||t.includes("first")),[h]),B=j.useMemo(()=>h.some(t=>t.includes("2nd")||t.includes("second")),[h]),p=j.useMemo(()=>{var m,x;const t=s.subject_id;console.log("=== Edit Grading Period Filtering ==="),console.log("Current grade subject_id:",t),console.log("Current grade subject:",(m=s.subject)==null?void 0:m.name);const r=u.find(i=>i.subject.id===t);if(!r)return console.log("Edit: No assignment found for current subject, showing all periods"),c;const a=r.grading_period_ids||((x=r.subject)==null?void 0:x.grading_period_ids)||[];if(console.log("Assignment grading_period_ids:",a),console.log("All grading periods:",c.length),a.length===0)return console.log("Edit: No grading_period_ids assigned, showing all periods"),c;const o=c.filter(i=>a.includes(i.id));return console.log("Edit: Filtered grading periods:",o.length,o.map(i=>({id:i.id,name:i.name}))),o},[s.subject_id,u,c]),n=()=>{var r,a,o,m,x;if(console.log("Academic Level Data:",s.academicLevel),console.log("Academic Level Key:",(r=s.academicLevel)==null?void 0:r.key),console.log("Academic Level Name:",(a=s.academicLevel)==null?void 0:a.name),console.log("Subject Course:",(o=s.subject)==null?void 0:o.course),console.log("Full Grade Object:",s),(m=s.academicLevel)!=null&&m.key){const i=s.academicLevel.key==="college";return console.log("Using direct academic level, Is College:",i),i?"college":s.academicLevel.key}if((x=s.subject)!=null&&x.course)return console.log("Using course fallback, assuming college level"),"college";const t=parseFloat(s.grade);return t>=1&&t<=5?(console.log("Using grade value fallback, assuming college level (1-5 scale)"),"college"):(console.log("Using default fallback: elementary"),"elementary")},H=t=>{t.preventDefault(),M(route("adviser.grades.update",s.id),{onSuccess:()=>{console.log("Grade updated successfully")},onError:r=>{console.log("Grade update failed:",r)}})};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(K,{user:_}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(Q,{user:_}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{href:route("adviser.grades.show-student",[s.student_id,s.subject_id]),children:e.jsxs(y,{variant:"outline",size:"sm",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Back to Student"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Edit Grade"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Update the grade for ",s.student.name," in ",s.subject.name]})]})]})}),s.days_remaining!==void 0&&e.jsx(A,{className:`max-w-2xl border-l-4 ${s.days_remaining===0?"border-red-500 bg-red-50 dark:bg-red-900/20":s.days_remaining===1?"border-orange-500 bg-orange-50 dark:bg-orange-900/20":s.days_remaining===2?"border-yellow-500 bg-yellow-50 dark:bg-yellow-900/20":"border-blue-500 bg-blue-50 dark:bg-blue-900/20"}`,children:e.jsx(D,{className:"pt-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:`p-2 rounded-full ${s.days_remaining===0?"bg-red-100 dark:bg-red-800":s.days_remaining===1?"bg-orange-100 dark:bg-orange-800":s.days_remaining===2?"bg-yellow-100 dark:bg-yellow-800":"bg-blue-100 dark:bg-blue-800"}`,children:e.jsx("svg",{className:`h-5 w-5 ${s.days_remaining===0?"text-red-600 dark:text-red-300":s.days_remaining===1?"text-orange-600 dark:text-orange-300":s.days_remaining===2?"text-yellow-600 dark:text-yellow-300":"text-blue-600 dark:text-blue-300"}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:`font-semibold ${s.days_remaining===0?"text-red-900 dark:text-red-100":s.days_remaining===1?"text-orange-900 dark:text-orange-100":s.days_remaining===2?"text-yellow-900 dark:text-yellow-100":"text-blue-900 dark:text-blue-100"}`,children:s.days_remaining===0?"⚠️ Last Day to Edit!":s.days_remaining===1?"⏰ 1 Day Remaining":`⏰ ${s.days_remaining} Days Remaining`}),e.jsxs("p",{className:`text-sm mt-1 ${s.days_remaining===0?"text-red-700 dark:text-red-200":s.days_remaining===1?"text-orange-700 dark:text-orange-200":s.days_remaining===2?"text-yellow-700 dark:text-yellow-200":"text-blue-700 dark:text-blue-200"}`,children:[s.days_remaining===0?"This is your last opportunity to edit this grade before the 3-day window expires.":s.days_remaining===1?"You have 1 day left to edit this grade within the 3-day edit window.":`You have ${s.days_remaining} days left to edit this grade within the 3-day edit window.`,s.edit_status==="locked"&&" Once submitted for validation, this grade cannot be edited."]}),e.jsxs("p",{className:`text-xs mt-2 ${s.days_remaining===0?"text-red-600 dark:text-red-300":s.days_remaining<=1?"text-orange-600 dark:text-orange-300":"text-blue-600 dark:text-blue-300"}`,children:["Grade created: ",new Date(s.created_at).toLocaleString()," • Status: ",s.is_submitted_for_validation?"Submitted for Validation":"Draft"]})]})]})})}),e.jsxs(A,{className:"max-w-2xl",children:[e.jsx(O,{children:e.jsxs(R,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Grade Information"]})}),e.jsxs(D,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-6",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3",children:"Current Grade Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Student:"}),e.jsx("p",{className:"font-medium",children:((w=s.student)==null?void 0:w.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Subject:"}),e.jsxs("p",{className:"font-medium",children:[((S=s.subject)==null?void 0:S.name)||"Unknown"," (",((C=s.subject)==null?void 0:C.code)||"N/A",")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Academic Level:"}),e.jsx("p",{className:"font-medium",children:((L=s.academicLevel)==null?void 0:L.name)||"Unknown"}),!((F=s.academicLevel)!=null&&F.name)&&e.jsxs("p",{className:"text-xs text-yellow-600 mt-1",children:["Detected: ",n()==="college"?"College (5-1 scale)":"Elementary/Senior High (75-100 scale)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"School Year:"}),e.jsx("p",{className:"font-medium",children:s.school_year||"N/A"})]}),((G=s.subject)==null?void 0:G.course)&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Course:"}),e.jsxs("p",{className:"font-medium",children:[s.subject.course.name," (",s.subject.course.code,")"]})]})]})]}),e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx($,{htmlFor:"grade",children:"Grade"}),e.jsx(P,{id:"grade",type:"number",step:n()==="college"?"0.1":"0.01",min:n()==="college"?"1.0":"75",max:n()==="college"?"5.0":"100",placeholder:n()==="college"?"Valid: 1.1-3.5 or 5.0":"Enter grade (0-100)",value:l.grade,onChange:t=>{const r=t.target.value;if(v("grade",r),r&&n()==="college"){const a=parseFloat(r);console.log("[GRADE_EDIT] Grade changed:",{grade:a,percentage:g(a),quality:f(a),student:s.student.name})}},className:d.grade?"border-red-500":"",autoFocus:!0}),d.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.grade}),l.grade&&n()==="college"&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-950 rounded-md border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:[g(parseFloat(l.grade))&&e.jsxs(e.Fragment,{children:[g(parseFloat(l.grade)),f(parseFloat(l.grade))&&` - ${f(parseFloat(l.grade))}`]}),!g(parseFloat(l.grade))&&e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Invalid grade (use 1.1-3.5 or 5.0)"})]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:n()==="college"?"Valid grades: 1.1-3.5 (0.1 increments) or 5.0. 3.0 is passing (75%).":"Elementary to Senior High: 75 (passing) to 100 (highest)."})]}),e.jsxs("div",{children:[e.jsx($,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(W,{value:l.grading_period_id,onValueChange:t=>v("grading_period_id",t),children:[e.jsx(Y,{className:d.grading_period_id?"border-red-500":"",children:e.jsx(q,{placeholder:"Select grading period"})}),e.jsxs(z,{children:[e.jsx(b,{value:"0",children:"No Period"}),p&&p.length>0?e.jsxs(e.Fragment,{children:[V&&e.jsxs(U,{children:[e.jsx(I,{children:"First Semester"}),p.filter(t=>t.code.startsWith("COL_S1_")&&!t.code.includes("_FA")).sort((t,r)=>t.sort_order-r.sort_order).map(t=>e.jsx(b,{value:t.id.toString(),children:t.name},t.id))]}),B&&e.jsxs(U,{children:[e.jsx(I,{children:"Second Semester"}),p.filter(t=>t.code.startsWith("COL_S2_")&&!t.code.includes("_FA")).sort((t,r)=>t.sort_order-r.sort_order).map(t=>e.jsx(b,{value:t.id.toString(),children:t.name},t.id))]})]}):e.jsx(b,{value:"none",disabled:!0,children:"No grading periods assigned to this subject"})]})]}),d.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:d.grading_period_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select which grading period this grade belongs to"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(y,{type:"submit",disabled:N,className:"flex-1",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),N?"Updating...":"Update Grade"]}),e.jsx(E,{href:route("instructor.grades.show-student",[s.student_id,s.subject_id]),className:"flex-1",children:e.jsx(y,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]})]})]})]})})]})]})}export{Ne as default};
