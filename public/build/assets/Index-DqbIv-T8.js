import{r as S,R as se,m as ae,j as e,C as re}from"./app-_ACoLM-P.js";import{S as ne,H as le}from"./sidebar-DnnWkgaB.js";import{C as R,b as A,c as P,a as M}from"./card-Ct-Sq1CI.js";import{B as j}from"./button-B6aJWj-6.js";import{I as p}from"./input-Dh9V7yTb.js";import{L as n}from"./label-D4aZ_aw6.js";import{S as u,a as _,b as y,c as v,d as f}from"./select-lW6xcZNp.js";import{C as ie}from"./checkbox-Dfr2Zz2L.js";import{B as T}from"./badge-Uzvnt-JJ.js";import{T as te,a as de,b as $,c as k,d as ce,e as w}from"./table-BynydlET.js";import{T as oe,a as he,b as G,c as me}from"./tabs-Dv258t_e.js";import{A as D,a as J}from"./alert-BrFzMnu2.js";import{T as q}from"./trophy-CLvfev5b.js";import{G as xe}from"./graduation-cap-DJD8Uj71.js";/* empty css            */import"./dropdown-menu-DTo2vNa_.js";import"./Combination-CbhOSQl6.js";import"./index-BwE486B4.js";import"./separator-DZLNz4YP.js";import"./users-BOfkElcp.js";import"./chevron-right-EitJIQyZ.js";import"./crown-Bb0On0y8.js";import"./user-cog-PcEXeHCL.js";import"./book-open-IqCtqkzB.js";import"./chart-no-axes-column-increasing-Lmr0HkKk.js";import"./shield-1NtmXhSw.js";import"./index-BIK_VqV1.js";import"./index-D0rFmsK2.js";function $e({user:E,academicLevels:r,honorTypes:b,criteria:L,schoolYears:h,honorResults:z,groupedHonorResults:H}){const[m,B]=S.useState(null),[x,K]=S.useState(()=>"2024-2025"),[N,V]=S.useState(!1),[F,g]=S.useState(null);se.useEffect(()=>{if(r&&r.length>0){const s=r[0].id;B(s)}},[r]);const{data:l,setData:i,post:Q,processing:X,errors:C,reset:U}=ae({academic_level_id:"",honor_type_id:"",school_year:x,min_gpa:"",max_gpa:"",min_grade:"",min_grade_all:"",min_year:"",max_year:"",require_consistent_honor:!1}),W=s=>{s.preventDefault(),Q("/admin/academic/honors/criteria",{onSuccess:()=>{g({type:"success",text:"Criteria saved successfully!"}),U(),window.location.reload()},onError:()=>g({type:"error",text:"Failed to save criteria."})})},I=()=>{var s;if(!m){g({type:"error",text:"Please select an academic level first."});return}V(!0),fetch("/admin/academic/honors/generate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":((s=document.querySelector('meta[name="csrf-token"]'))==null?void 0:s.getAttribute("content"))||""},body:JSON.stringify({academic_level_id:m,school_year:x})}).then(a=>{if(!a.ok)throw new Error(`HTTP ${a.status}`);return a.json()}).then(a=>g({type:a.success?"success":"error",text:a.message||(a.success?"Honor roll generated successfully!":"Failed to generate honor roll.")})).catch(()=>g({type:"error",text:"Failed to generate honor roll. Please try again."})).finally(()=>V(!1))},Z=()=>{if(!m){g({type:"error",text:"Please select an academic level first."});return}window.open(`/admin/academic/honors/export?academic_level_id=${m}&school_year=${x}`)},Y=s=>L.filter(a=>a.academic_level_id===s&&a.honorType),ee=s=>{const a=String(s);let t=H==null?void 0:H[a];if(!t){t={};for(const c of z){if(c.academic_level_id!==s||c.school_year!==x)continue;const d=String(c.honor_type_id);t[d]||(t[d]=[]),t[d].push(c)}}return t||{}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(ne,{user:E}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(le,{user:E}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Honor Tracking & Ranking"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Set honor criteria, generate honor rolls, and track student achievements."})]}),e.jsx(j,{variant:"outline",onClick:()=>window.history.back(),children:"Back to Academic"})]}),(!r||r.length===0)&&e.jsx(D,{className:"border-yellow-500",children:e.jsx(J,{children:"Loading academic levels and honor data..."})}),F&&e.jsxs(D,{className:F.type==="success"?"border-green-500":"border-red-500",children:[e.jsx(re,{className:"h-4 w-4"}),e.jsx(J,{children:F.text})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(R,{children:[e.jsx(A,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Set Honor Criteria"]})}),e.jsx(M,{children:e.jsxs("form",{onSubmit:W,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"academic_level_id",children:"Academic Level"}),r&&r.length>0?e.jsxs(u,{value:l.academic_level_id,onValueChange:s=>i("academic_level_id",s),children:[e.jsx(_,{children:e.jsx(y,{placeholder:"Select level"})}),e.jsx(v,{children:r.map(s=>e.jsx(f,{value:s.id.toString(),children:s.name},s.id))})]}):e.jsx("div",{className:"p-2 text-sm text-gray-500 bg-gray-100 rounded border",children:"Loading academic levels..."}),C.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500",children:C.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"honor_type_id",children:"Honor Type"}),b&&b.length>0?e.jsxs(u,{value:l.honor_type_id,onValueChange:s=>i("honor_type_id",s),children:[e.jsx(_,{children:e.jsx(y,{placeholder:"Select honor"})}),e.jsx(v,{children:b.map(s=>e.jsx(f,{value:s.id.toString(),children:s.name},s.id))})]}):e.jsx("div",{className:"p-2 text-sm text-gray-500 bg-gray-100 rounded border",children:"Loading honor types..."}),C.honor_type_id&&e.jsx("p",{className:"text-sm text-red-500",children:C.honor_type_id})]})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"school_year",children:"School Year"}),e.jsxs(u,{value:l.school_year,onValueChange:s=>i("school_year",s),children:[e.jsx(_,{children:e.jsx(y,{placeholder:"Select school year"})}),e.jsx(v,{children:(h!=null&&h.length?h:["2024-2025"]).map(s=>e.jsx(f,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"min_gpa",children:"Min GPA"}),e.jsx(p,{id:"min_gpa",type:"number",step:"0.01",value:l.min_gpa,onChange:s=>i("min_gpa",s.target.value),placeholder:"e.g., 90.0"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"max_gpa",children:"Max GPA"}),e.jsx(p,{id:"max_gpa",type:"number",step:"0.01",value:l.max_gpa,onChange:s=>i("max_gpa",s.target.value),placeholder:"e.g., 97.0"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"min_grade",children:"Min Grade (any)"}),e.jsx(p,{id:"min_grade",type:"number",value:l.min_grade,onChange:s=>i("min_grade",s.target.value),placeholder:"e.g., 90"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"min_grade_all",children:"Min Grade (all)"}),e.jsx(p,{id:"min_grade_all",type:"number",value:l.min_grade_all,onChange:s=>i("min_grade_all",s.target.value),placeholder:"e.g., 93"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"min_year",children:"Min Year"}),e.jsx(p,{id:"min_year",type:"number",value:l.min_year,onChange:s=>i("min_year",s.target.value),placeholder:"e.g., 2"})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"max_year",children:"Max Year"}),e.jsx(p,{id:"max_year",type:"number",value:l.max_year,onChange:s=>i("max_year",s.target.value),placeholder:"e.g., 3"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(ie,{id:"require_consistent_honor",checked:!!l.require_consistent_honor,onCheckedChange:s=>i("require_consistent_honor",s===!0)}),e.jsx(n,{htmlFor:"require_consistent_honor",children:"Require consistent honor standing"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{type:"submit",disabled:X,children:"Save Criteria"}),e.jsx(j,{type:"button",variant:"outline",onClick:I,disabled:N,children:N?"Generating...":"Generate Honor Roll"}),e.jsx(j,{type:"button",variant:"outline",onClick:Z,children:"Export Honor List"})]})]})})]}),e.jsxs(R,{children:[e.jsx(A,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5"}),"Generate Honor Roll"]})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(n,{children:"Academic Level"}),r&&r.length>0?e.jsxs(u,{value:m?m.toString():void 0,onValueChange:s=>B(Number(s)),children:[e.jsx(_,{children:e.jsx(y,{placeholder:"Select level to generate honor roll"})}),e.jsx(v,{children:r.map(s=>e.jsx(f,{value:s.id.toString(),children:s.name},s.id))})]}):e.jsx("div",{className:"p-2 text-sm text-gray-500 bg-gray-100 rounded border",children:"Loading academic levels..."})]}),e.jsxs("div",{children:[e.jsx(n,{children:"School Year"}),h&&h.length>0?e.jsxs(u,{value:x,onValueChange:K,children:[e.jsx(_,{children:e.jsx(y,{placeholder:"Select school year"})}),e.jsx(v,{children:h.map(s=>e.jsx(f,{value:s,children:s},s))})]}):e.jsx("div",{className:"p-2 text-sm text-gray-500 bg-gray-100 rounded border",children:"Loading school years..."})]}),e.jsx(j,{onClick:I,disabled:!m||N,className:"w-full",children:N?"Generating...":"Generate Honor Roll"})]})]})]}),e.jsxs(R,{children:[e.jsx(A,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(q,{className:"h-5 w-5"}),"Existing Criteria"]})}),e.jsx(M,{children:e.jsxs(oe,{defaultValue:"elementary",className:"w-full",children:[e.jsxs(he,{className:"grid w-full grid-cols-4",children:[e.jsx(G,{value:"elementary",children:"Elementary"}),e.jsx(G,{value:"junior_highschool",children:"Junior High"}),e.jsx(G,{value:"senior_highschool",children:"Senior High"}),e.jsx(G,{value:"college",children:"College"})]}),r&&r.length>0?r.map(s=>e.jsx(me,{value:s.key,children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[s.name," Honor Criteria"]}),e.jsx(j,{variant:"outline",size:"sm",children:"Refresh Results"})]}),e.jsx("div",{className:"grid gap-4",children:Y(s.id).map(a=>a.honorType?e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h4",{className:"font-medium",children:a.honorType.name}),e.jsx(T,{variant:"secondary",children:a.honorType.scope})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2 text-sm",children:[a.min_gpa&&e.jsxs("div",{children:["Min GPA: ",e.jsx("span",{className:"font-medium",children:a.min_gpa})]}),a.max_gpa&&e.jsxs("div",{children:["Max GPA: ",e.jsx("span",{className:"font-medium",children:a.max_gpa})]}),a.min_grade&&e.jsxs("div",{children:["Min Grade: ",e.jsx("span",{className:"font-medium",children:a.min_grade})]}),a.min_year&&a.max_year&&e.jsxs("div",{children:["Years: ",e.jsxs("span",{className:"font-medium",children:[a.min_year,"-",a.max_year]})]}),a.require_consistent_honor&&e.jsx("div",{className:"col-span-2",children:e.jsx(T,{variant:"outline",children:"Requires Consistent Honor"})})]})]},a.id):e.jsx("div",{className:"border rounded-lg p-4 bg-red-50",children:e.jsx("p",{className:"text-red-600 text-sm",children:"Invalid honor type data"})},a.id))}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("h4",{className:"text-lg font-semibold mb-4",children:["Honor Roll Results - ",x]}),e.jsx("div",{className:"space-y-4",children:(()=>{const a=ee(s.id),t=Object.keys(a);return t.length===0?e.jsx("div",{className:"text-sm text-gray-500",children:"No honor results found for this level and school year."}):t.map(c=>{const d=a[c],O=b.find(o=>o.id===Number(c));return!d||d.length===0||!O?null:e.jsxs("div",{className:"border rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(q,{className:"h-4 w-4 text-yellow-600"}),e.jsx("h5",{className:"font-medium",children:O.name}),e.jsxs(T,{variant:"secondary",children:[d.length," student",d.length!==1?"s":""]})]}),e.jsxs(te,{children:[e.jsx(de,{children:e.jsxs($,{children:[e.jsx(k,{children:"Student"}),e.jsx(k,{children:"Student ID"}),e.jsx(k,{children:"GPA"}),e.jsx(k,{children:"Status"})]})}),e.jsx(ce,{children:d.map(o=>e.jsxs($,{children:[e.jsx(w,{children:o.student.name}),e.jsx(w,{children:o.student.student_number}),e.jsx(w,{children:o.gpa}),e.jsx(w,{children:e.jsx(T,{variant:o.is_overridden?"destructive":"default",children:o.is_overridden?"Overridden":"Qualified"})})]},o.id))})]})]},`${s.id}-${c}`)})})()})]})]})},s.key)):e.jsx("div",{className:"p-4 text-center text-gray-500",children:"No academic levels found. Please check your database configuration."})]})})]})]})})]})]})}export{$e as default};
