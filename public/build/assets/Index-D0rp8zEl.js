import{r as y,m as T,j as e,S as B}from"./app-CpH95Mt4.js";import{H as fe}from"./header-D8d8CQHE.js";import{S as _e}from"./sidebar-CqQCo7z5.js";import{C as N,a as b,b as ve,c as ye}from"./card-SPPPDE2O.js";import{B as x}from"./button-CrVRlYes.js";import{S as q,a as Q,b as W,c as X,d as G}from"./select-79k_YOqi.js";import{T as Ne,a as be,b as Z,c as h,d as ke,e as u}from"./table-C7Ot5WTp.js";import{D as Se,a as we,b as Ce,c as A,d as De}from"./dropdown-menu-T-lED-GI.js";import{B as k}from"./badge-DOxgXIap.js";import{A as Y}from"./arrow-left-D6s31BXA.js";import{P as K,E as Te,a as Be}from"./printer-C9DnYMUf.js";import{D as P}from"./download-BVdnAnY6.js";import{S as Ge}from"./school-C6fm_67E.js";import{B as Ae}from"./book-open-Cfwoay2O.js";import{G as Pe}from"./graduation-cap-DN404-SJ.js";import{U as He}from"./users-DKBwEJnm.js";import{F as H}from"./file-text-1Ld6fKLp.js";/* empty css            */import"./separator-DYgM1OJj.js";import"./index-DuHgze9U.js";import"./Combination-DdMefgW5.js";import"./chevron-right-BBz7i5j3.js";import"./crown-DB2Pym4R.js";import"./building-2-CESUk-pW.js";import"./user-cog-CryIPB8p.js";import"./user-check-BKq3DT-V.js";import"./notebook-ByhRpL9R.js";import"./chart-no-axes-column-increasing-BPfjOVY_.js";import"./shield-BuLm7PxV.js";import"./index-ClJ_Ix8n.js";import"./index-D7tr1OXf.js";import"./check-wavKsgL9.js";const E=[{key:"elementary",name:"Elementary",icon:Ge,color:"bg-blue-500 hover:bg-blue-600",iconColor:"text-blue-600"},{key:"junior_highschool",name:"Junior High School",icon:Ae,color:"bg-green-500 hover:bg-green-600",iconColor:"text-green-600"},{key:"senior_highschool",name:"Senior High School",icon:Pe,color:"bg-orange-500 hover:bg-orange-600",iconColor:"text-orange-600"},{key:"college",name:"College",icon:He,color:"bg-purple-500 hover:bg-purple-600",iconColor:"text-purple-600"}];function hs({user:$,academicLevels:S,templates:ee,allHonors:j=[],generatedCertificates:n=[],schoolYears:w,currentSchoolYear:se}){var O,J;const[r,M]=y.useState(null),[d,le]=y.useState(se||(w==null?void 0:w[0])||"2024-2025"),[f,F]=y.useState(""),[m,C]=y.useState([]),[p,I]=y.useState([]),{setData:ae,post:te,processing:ie}=T({student_id:"",template_id:"",academic_level_id:"",school_year:d}),{setData:ce,post:ne,processing:z}=T({student_ids:[],template_id:"",academic_level_id:"",school_year:d}),{setData:R,post:L,processing:D}=T({certificate_ids:[]}),{setData:de,post:re,processing:V}=T({academic_level_id:"",school_year:d,honor_type_id:""}),U=s=>j.length?j.filter(l=>l&&l.academic_level&&l.academic_level.key===s&&l.school_year===d).sort((l,a)=>l.year_level!==a.year_level?(l.year_level||"").localeCompare(a.year_level||""):l.section_id!==a.section_id?(l.section_id||0)-(a.section_id||0):(a.gpa||0)-(l.gpa||0)):[],oe=s=>{const l=S.find(a=>a.key===s);return l?ee.filter(a=>a.academic_level_id===l.id&&a.is_active):[]},me=s=>{ae({student_id:s.student.id.toString(),template_id:f,academic_level_id:s.academic_level.id.toString(),school_year:d}),te(route("admin.academic.certificates.generate"),{onSuccess:()=>{B.reload()}})},xe=()=>{if(m.length===0||!f)return;const s=S.find(l=>l.key===r);s&&(ce({student_ids:m,template_id:f,academic_level_id:s.id.toString(),school_year:d}),ne(route("admin.academic.certificates.generate-bulk"),{onSuccess:()=>{C([]),B.reload()}}))},he=s=>{C(l=>l.includes(s)?l.filter(a=>a!==s):[...l,s])},ue=()=>{const l=U(r).map(a=>a.student.id);C(m.length===l.length?[]:l)},pe=()=>{const s=S.find(l=>l.key===r);s&&(de({academic_level_id:s.id.toString(),school_year:d,honor_type_id:""}),re(route("admin.academic.certificates.bulk-generate-by-level"),{onSuccess:()=>{B.reload()}}))},ge=(s,l)=>{l.stopPropagation(),I(a=>a.includes(s)?a.filter(t=>t!==s):[...a,s])},je=()=>{if(p.length===0)return;const s=[];p.forEach(l=>{j.filter(t=>{var c;return((c=t==null?void 0:t.academic_level)==null?void 0:c.key)===l&&t.school_year===d}).forEach(t=>{const c=n==null?void 0:n.find(i=>i.student.id===t.student.id&&i.academic_level.id===t.academic_level.id&&i.school_year===t.school_year);c&&s.push(c.id)})}),s.length>0?(R({certificate_ids:s}),L(route("admin.academic.certificates.bulk-print-pdf"))):alert("No generated certificates found for selected categories. Please generate certificates first.")},g=r?U(r):[],v=r?oe(r):[];return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(_e,{user:$}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(fe,{user:$}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(x,{variant:"outline",size:"sm",onClick:()=>B.get("/admin/academic"),children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Back to Academic"]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Certificate Management"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Generate and manage honor certificates by academic level."})]}),e.jsx(N,{children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"School Year:"}),e.jsxs(q,{value:d,onValueChange:le,children:[e.jsx(Q,{className:"w-40",children:e.jsx(W,{})}),e.jsx(X,{children:w.map(s=>e.jsx(G,{value:s,children:s},s))})]})]})})}),r?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(x,{variant:"outline",onClick:()=>{M(null),C([]),F("")},children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Back to Categories"]}),e.jsxs("h2",{className:"text-2xl font-bold",children:[(O=E.find(s=>s.key===r))==null?void 0:O.name," Honor Students"]}),e.jsxs(k,{variant:"outline",children:[g.length," students"]})]})}),e.jsxs(N,{children:[e.jsx(ve,{children:e.jsx(ye,{children:"Certificate Generation"})}),e.jsx(b,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Select Certificate Template",v.length===0&&e.jsx("span",{className:"ml-2 text-xs text-red-600 font-normal",children:"(No templates - Run: php artisan db:seed --class=CertificateTemplateSeeder)"})]}),e.jsxs(q,{value:f,onValueChange:F,children:[e.jsx(Q,{className:v.length===0?"border-red-300":"",children:e.jsx(W,{placeholder:v.length>0?"Choose a template...":"⚠️ No templates available - seed database first"})}),e.jsx(X,{children:v.length>0?v.map(s=>e.jsx(G,{value:s.id.toString(),children:s.name},s.id)):e.jsx(G,{value:"none",disabled:!0,children:"No templates available - run CertificateTemplateSeeder"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(x,{onClick:pe,disabled:g.length===0||V,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),V?"Generating All...":"Generate All Missing Certificates"]}),e.jsxs(Se,{children:[e.jsx(we,{asChild:!0,children:e.jsxs(x,{variant:"outline",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"More Actions"]})}),e.jsxs(Ce,{align:"end",className:"w-56",children:[e.jsxs(A,{onClick:xe,disabled:m.length===0||!f||z,children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),z?"Generating...":`Generate ${m.length} Selected`]}),e.jsxs(A,{onClick:()=>{const s=g.filter(l=>m.includes(l.student.id)).map(l=>{const a=n==null?void 0:n.find(t=>t.student.id===l.student.id&&t.academic_level.id===l.academic_level.id);return a==null?void 0:a.id}).filter(l=>l!==void 0);s.length>0&&(R({certificate_ids:s}),L(route("admin.academic.certificates.bulk-print-pdf")))},disabled:m.length===0||D,children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),D?"Preparing...":`Download ${m.length} Selected`]}),e.jsx(De,{}),e.jsxs(A,{onClick:()=>{var s;return window.open(`/admin/academic/certificates/honor-roll/pdf?academic_level_id=${(s=S.find(l=>l.key===r))==null?void 0:s.id}&school_year=${d}`,"_blank")},children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Honor Roll PDF"]})]})]})]})]})})]}),e.jsx(N,{children:e.jsx(b,{children:g.length>0?e.jsxs(Ne,{children:[e.jsx(be,{children:e.jsxs(Z,{children:[e.jsx(h,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:m.length===g.length&&g.length>0,onChange:ue})}),e.jsx(h,{children:"Rank"}),e.jsx(h,{children:"Student Name"}),e.jsx(h,{children:"Student Number"}),e.jsx(h,{children:"Year Level"}),e.jsx(h,{children:"Section"}),e.jsx(h,{children:"Honor Type"}),e.jsx(h,{children:"GPA"}),e.jsx(h,{children:"Certificate"}),e.jsx(h,{children:"Actions"})]})}),e.jsx(ke,{children:g.map((s,l)=>{var a,t;return!s||!s.student?null:e.jsxs(Z,{children:[e.jsx(u,{children:e.jsx("input",{type:"checkbox",checked:m.includes(s.student.id),onChange:()=>he(s.student.id)})}),e.jsxs(u,{className:"font-medium",children:["#",l+1]}),e.jsx(u,{className:"font-medium",children:s.student.name}),e.jsx(u,{children:s.student.student_number||"N/A"}),e.jsx(u,{children:s.year_level||s.student.year_level||"N/A"}),e.jsx(u,{children:((a=s.student.section)==null?void 0:a.name)||"N/A"}),e.jsx(u,{children:e.jsx(k,{variant:"secondary",children:((t=s.honor_type)==null?void 0:t.name)||"Unknown Honor"})}),e.jsx(u,{className:"font-mono",children:s.gpa?s.gpa.toFixed(2):"N/A"}),e.jsx(u,{children:(()=>{const c=n==null?void 0:n.find(i=>i.student.id===s.student.id&&i.academic_level.id===s.academic_level.id&&i.school_year===s.school_year);return c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"default",className:"text-xs",children:"Generated"}),e.jsx("span",{className:"text-xs text-gray-500",children:c.serial_number})]}):e.jsx(k,{variant:"outline",className:"text-xs",children:"Pending"})})()}),e.jsx(u,{children:e.jsx("div",{className:"flex gap-1",children:(()=>{const c=n==null?void 0:n.find(i=>i.student.id===s.student.id&&i.academic_level.id===s.academic_level.id&&i.school_year===s.school_year);return c?e.jsxs(e.Fragment,{children:[e.jsx(x,{size:"sm",variant:"outline",onClick:()=>window.open(`/admin/academic/certificates/${c.id}/download`,"_blank"),className:"h-8 px-2",children:e.jsx(P,{className:"h-3 w-3"})}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>window.open(`/admin/academic/certificates/${c.id}/print`,"_blank"),className:"h-8 px-2",children:e.jsx(Be,{className:"h-3 w-3"})})]}):e.jsxs(x,{size:"sm",variant:"outline",onClick:()=>me(s),disabled:!f||ie,className:"h-8 px-2",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),"Generate"]})})()})})]},s.id||l)})})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Honor Students Found"}),e.jsxs("p",{className:"text-sm",children:["No approved honor students for ",(J=E.find(s=>s.key===r))==null?void 0:J.name," in ",d,"."]})]})})})]}):e.jsxs(e.Fragment,{children:[p.length>0&&e.jsx(N,{className:"bg-blue-50 border-blue-200",children:e.jsx(b,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(K,{className:"h-5 w-5 text-blue-600"}),e.jsxs("span",{className:"font-medium text-blue-900",children:[p.length," ",p.length===1?"category":"categories"," selected"]}),e.jsx(k,{variant:"secondary",children:(()=>{let s=0;return p.forEach(l=>{j.filter(t=>{var c;return((c=t==null?void 0:t.academic_level)==null?void 0:c.key)===l&&t.school_year===d}).forEach(t=>{(n==null?void 0:n.find(i=>i.student.id===t.student.id&&i.academic_level.id===t.academic_level.id&&i.school_year===t.school_year))&&s++})}),`${s} certificates`})()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{variant:"outline",size:"sm",onClick:()=>I([]),children:"Clear Selection"}),e.jsxs(x,{size:"sm",onClick:je,disabled:D,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),D?"Preparing...":"Download Selected"]})]})]})})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:E.map(s=>{const l=s.icon,a=j.filter(i=>{var o;return((o=i==null?void 0:i.academic_level)==null?void 0:o.key)===s.key&&i.school_year===d}).length,t=j.filter(o=>{var _;return((_=o==null?void 0:o.academic_level)==null?void 0:_.key)===s.key&&o.school_year===d}).filter(o=>n==null?void 0:n.some(_=>_.student.id===o.student.id&&_.academic_level.id===o.academic_level.id&&_.school_year===o.school_year)).length,c=p.includes(s.key);return e.jsx(N,{className:`cursor-pointer transition-all hover:shadow-lg ${c?"ring-2 ring-blue-500 bg-blue-50":""}`,onClick:()=>M(s.key),children:e.jsx(b,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("input",{type:"checkbox",checked:c,onChange:i=>ge(s.key,i),onClick:i=>i.stopPropagation(),className:"h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"})}),e.jsx("div",{className:"p-4 rounded-full bg-gray-100",children:e.jsx(l,{className:`h-8 w-8 ${s.iconColor}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a," honor students"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[t," certificates generated"]})]}),e.jsx(x,{className:`w-full ${s.color} text-white`,children:"View Students"})]})})},s.key)})})]})]})})]})]})}export{hs as default};
