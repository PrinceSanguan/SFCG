import{c as je,r as j,K as fe,m as b,j as e,S as N}from"./app-DiT6tx-7.js";import{S as ye,H as ve}from"./sidebar-BWo8AOi4.js";import{C as k,a as S,b as _e,c as be}from"./card-BxOKbS7d.js";import{B as m}from"./button-B6Dyd-Cf.js";import{S as z,a as O,b as U,c as q,d as G}from"./select-D_gKVo7T.js";import{T as Ne,a as ke,b as J,c as x,d as Se,e as h}from"./table-C6cARu9c.js";import{D as we,a as Ce,b as De,c as K,d as Te}from"./dropdown-menu-DmiDltBs.js";import{B as w}from"./badge-DBfAb0pD.js";import{A as Q}from"./arrow-left-a-Da-Lc3.js";import{S as Be}from"./school-BKppPDZx.js";import{B as Ge}from"./book-open-sYCuQjBM.js";import{G as Ae}from"./graduation-cap-Bo8_b7cO.js";import{U as Pe}from"./users-BQpMYexc.js";import{F as A}from"./file-text-mjqIjNOc.js";import{D as P}from"./download-Dkcb0Iot.js";import{E as Ee,P as Me}from"./printer-PvWlg4e9.js";/* empty css            */import"./separator-Pingabc4.js";import"./index-BPUJh7Lt.js";import"./chevron-down-Y82qWR2A.js";import"./chevron-right-D5u2fWv5.js";import"./building-2-DGl2Z5kD.js";import"./crown-DhmNohoE.js";import"./user-cog-dxFl2AKT.js";import"./user-check-DjOtu6H2.js";import"./notebook-JZH7xpdn.js";import"./chart-no-axes-column-increasing-qEnkUVXM.js";import"./Combination-ChCyZElm.js";import"./index-BUHoBmKK.js";import"./index-BD23ZqfH.js";import"./check-NXhXA8Mz.js";/**
 * @license lucide-react v0.475.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],Ie=je("Package",He),E=[{key:"elementary",name:"Elementary",icon:Be,color:"bg-blue-500 hover:bg-blue-600",iconColor:"text-blue-600"},{key:"junior_highschool",name:"Junior High School",icon:Ge,color:"bg-green-500 hover:bg-green-600",iconColor:"text-green-600"},{key:"senior_highschool",name:"Senior High School",icon:Ae,color:"bg-orange-500 hover:bg-orange-600",iconColor:"text-orange-600"},{key:"college",name:"College",icon:Pe,color:"bg-purple-500 hover:bg-purple-600",iconColor:"text-purple-600"}];function St({user:M,academicLevels:y,honorTypes:Fe=[],templates:W,allHonors:C=[],generatedCertificates:r=[],schoolYears:v,currentSchoolYear:X,stats:Le}){var $,V,R;const[c,H]=j.useState(null),[d,Z]=j.useState(X||(v==null?void 0:v[0])||"2024-2025"),[p,I]=j.useState(""),[u,_]=j.useState([]),[$e,Ve]=j.useState([]),[Re,ze]=j.useState(!1),{props:Y}=fe(),ee=Y.csrf_token||(($=document.querySelector('meta[name="csrf-token"]'))==null?void 0:$.content)||"",{data:Oe,setData:te,post:se,processing:ae}=b({student_id:"",template_id:"",academic_level_id:"",school_year:d}),{data:Ue,setData:le,post:ie,processing:F}=b({student_ids:[],template_id:"",academic_level_id:"",school_year:d}),{data:qe,setData:ne,post:ce,processing:D}=b({certificate_ids:[]}),{data:Je,setData:re,post:de,processing:L}=b({academic_level_id:"",school_year:d,honor_type_id:""}),oe=()=>{const s=T(c||"").filter(i=>u.includes(i.student.id)).map(i=>{const n=r==null?void 0:r.find(B=>B.student.id===i.student.id&&B.academic_level.id===i.academic_level.id&&B.school_year===i.school_year);return n==null?void 0:n.id}).filter(i=>i!==void 0);if(s.length===0){alert("No certificates found for selected students. Please generate certificates first.");return}let a=document.getElementById("download-iframe");a||(a=document.createElement("iframe"),a.id="download-iframe",a.name="download-iframe",a.style.display="none",document.body.appendChild(a));const l=document.createElement("form");l.method="POST",l.action=route("registrar.academic.certificates.bulk-print-pdf"),l.target="download-iframe";const o=document.createElement("input");o.type="hidden",o.name="_token",o.value=ee,l.appendChild(o),s.forEach(i=>{const n=document.createElement("input");n.type="hidden",n.name="certificate_ids[]",n.value=i.toString(),l.appendChild(n)}),document.body.appendChild(l),l.submit(),document.body.removeChild(l)},T=t=>C.length?C.filter(s=>s&&s.academic_level&&s.academic_level.key===t&&s.school_year===d).sort((s,a)=>s.year_level!==a.year_level?(s.year_level||"").localeCompare(a.year_level||""):s.section_id!==a.section_id?(s.section_id||0)-(a.section_id||0):(s.gpa||0)-(a.gpa||0)):[],me=t=>{const s=y.find(a=>a.key===t);return s?W.filter(a=>a.academic_level_id===s.id&&a.is_active):[]},xe=t=>{te({student_id:t.student.id.toString(),template_id:p,academic_level_id:t.academic_level.id.toString(),school_year:d}),se(route("registrar.academic.certificates.generate"),{onSuccess:()=>{N.reload()}})},he=()=>{if(u.length===0||!p)return;const t=y.find(s=>s.key===c);t&&(le({student_ids:u,template_id:p,academic_level_id:t.id.toString(),school_year:d}),ie(route("registrar.academic.certificates.generate-bulk"),{onSuccess:()=>{_([]),N.reload()}}))},ue=t=>{_(s=>s.includes(t)?s.filter(a=>a!==t):[...s,t])},pe=()=>{const s=T(c).map(a=>a.student.id);_(u.length===s.length?[]:s)},ge=()=>{const t=y.find(s=>s.key===c);t&&(re({academic_level_id:t.id.toString(),school_year:d,honor_type_id:""}),de(route("registrar.academic.certificates.bulk-generate-by-level"),{onSuccess:()=>{N.reload()}}))},g=c?T(c):[],f=c?me(c):[];return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(ye,{user:M}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(ve,{user:M}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>N.get("/registrar/academic"),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Back to Academic"]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Certificate Management"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Generate and manage honor certificates by academic level."})]}),e.jsx(k,{children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"School Year:"}),e.jsxs(z,{value:d,onValueChange:Z,children:[e.jsx(O,{className:"w-40",children:e.jsx(U,{})}),e.jsx(q,{children:v.map(t=>e.jsx(G,{value:t,children:t},t))})]})]})})}),c?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(m,{variant:"outline",onClick:()=>{H(null),_([]),I("")},children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Back to Categories"]}),e.jsxs("h2",{className:"text-2xl font-bold",children:[(V=E.find(t=>t.key===c))==null?void 0:V.name," Honor Students"]}),e.jsxs(w,{variant:"outline",children:[g.length," students"]})]})}),e.jsxs(k,{children:[e.jsx(_e,{children:e.jsx(be,{children:"Certificate Generation"})}),e.jsx(S,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Select Certificate Template",f.length===0&&e.jsx("span",{className:"ml-2 text-xs text-red-600 font-normal",children:"(No templates - Run: php artisan db:seed --class=CertificateTemplateSeeder)"})]}),e.jsxs(z,{value:p,onValueChange:I,children:[e.jsx(O,{className:f.length===0?"border-red-300":"",children:e.jsx(U,{placeholder:f.length>0?"Choose a template...":"⚠️ No templates available - seed database first"})}),e.jsx(q,{children:f.length>0?f.map(t=>e.jsx(G,{value:t.id.toString(),children:t.name},t.id)):e.jsx(G,{value:"none",disabled:!0,children:"No templates available - run CertificateTemplateSeeder"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[u.length>0?e.jsxs(e.Fragment,{children:[e.jsxs(m,{onClick:he,disabled:!p||F,className:"bg-green-600 hover:bg-green-700 text-white",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),F?"Generating...":`Generate ${u.length} Selected`]}),e.jsxs(m,{onClick:oe,disabled:D,className:"bg-blue-600 hover:bg-blue-700 text-white",children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),D?"Preparing...":`Download ${u.length} Selected (PDF)`]})]}):e.jsxs(m,{onClick:ge,disabled:g.length===0||L,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),L?"Generating All...":"Generate All Missing Certificates"]}),e.jsxs(we,{children:[e.jsx(Ce,{asChild:!0,children:e.jsxs(m,{variant:"outline",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"More Actions"]})}),e.jsxs(De,{align:"end",className:"w-56",children:[e.jsxs(K,{onClick:()=>{var t;return window.open(`/registrar/academic/certificates/honor-roll/pdf?academic_level_id=${(t=y.find(s=>s.key===c))==null?void 0:t.id}&school_year=${d}`,"_blank")},children:[e.jsx(P,{className:"h-4 w-4 mr-2"}),"Export Honor Roll PDF"]}),e.jsx(Te,{}),e.jsxs(K,{onClick:()=>{const t=(r==null?void 0:r.filter(s=>s.academic_level.key===c&&s.school_year===d).map(s=>s.id))||[];t.length>0?(ne({certificate_ids:t}),ce(route("registrar.academic.certificates.bulk-print-pdf"))):alert("No generated certificates found for this level.")},disabled:D,children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"Download All Certificates (This Level)"]})]})]})]})]})})]}),e.jsx(k,{children:e.jsx(S,{children:g.length>0?e.jsxs(Ne,{children:[e.jsx(ke,{children:e.jsxs(J,{children:[e.jsx(x,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:u.length===g.length&&g.length>0,onChange:pe})}),e.jsx(x,{children:"Rank"}),e.jsx(x,{children:"Student Name"}),e.jsx(x,{children:"Student Number"}),e.jsx(x,{children:"Year Level"}),e.jsx(x,{children:"Section"}),e.jsx(x,{children:"Honor Type"}),e.jsx(x,{children:"GPA"}),e.jsx(x,{children:"Certificate"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Se,{children:g.map((t,s)=>{var a,l,o;return!t||!t.student?null:e.jsxs(J,{children:[e.jsx(h,{children:e.jsx("input",{type:"checkbox",checked:u.includes(t.student.id),onChange:()=>ue(t.student.id)})}),e.jsxs(h,{className:"font-medium",children:["#",s+1]}),e.jsx(h,{className:"font-medium",children:t.student.name}),e.jsx(h,{children:t.student.student_number||"N/A"}),e.jsx(h,{children:t.year_level||t.student.year_level||"N/A"}),e.jsx(h,{children:((a=t.section)==null?void 0:a.name)||((l=t.student.section)==null?void 0:l.name)||"N/A"}),e.jsx(h,{children:e.jsx(w,{variant:"secondary",children:((o=t.honor_type)==null?void 0:o.name)||"Unknown Honor"})}),e.jsx(h,{className:"font-mono",children:t.gpa?t.gpa.toFixed(2):"N/A"}),e.jsx(h,{children:(()=>{const i=r==null?void 0:r.find(n=>n.student.id===t.student.id&&n.academic_level.id===t.academic_level.id&&n.school_year===t.school_year);return i?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{variant:"default",className:"text-xs",children:"Generated"}),e.jsx("span",{className:"text-xs text-gray-500",children:i.serial_number})]}):e.jsx(w,{variant:"outline",className:"text-xs",children:"Pending"})})()}),e.jsx(h,{children:e.jsx("div",{className:"flex gap-1",children:(()=>{const i=r==null?void 0:r.find(n=>n.student.id===t.student.id&&n.academic_level.id===t.academic_level.id&&n.school_year===t.school_year);return i?e.jsxs(e.Fragment,{children:[e.jsx(m,{size:"sm",variant:"outline",onClick:()=>window.open(`/registrar/academic/certificates/${i.id}/download`,"_blank"),className:"h-8 px-2",children:e.jsx(P,{className:"h-3 w-3"})}),e.jsx(m,{size:"sm",variant:"outline",onClick:()=>window.open(`/registrar/academic/certificates/${i.id}/print`,"_blank"),className:"h-8 px-2",children:e.jsx(Me,{className:"h-3 w-3"})})]}):e.jsxs(m,{size:"sm",variant:"outline",onClick:()=>xe(t),disabled:!p||ae,className:"h-8 px-2",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"Generate"]})})()})})]},t.id||s)})})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Honor Students Found"}),e.jsxs("p",{className:"text-sm",children:["No approved honor students for ",(R=E.find(t=>t.key===c))==null?void 0:R.name," in ",d,"."]})]})})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:E.map(t=>{const s=t.icon,a=C.filter(l=>{var o;return((o=l==null?void 0:l.academic_level)==null?void 0:o.key)===t.key&&l.school_year===d}).length;return e.jsx(k,{className:"cursor-pointer transition-all hover:shadow-lg",onClick:()=>H(t.key),children:e.jsx(S,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"p-4 rounded-full bg-gray-100",children:e.jsx(s,{className:`h-8 w-8 ${t.iconColor}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a," honor students"]})]}),e.jsx(m,{className:`w-full ${t.color} text-white`,children:"View Students"})]})})},t.key)})})]})})]})]})}export{St as default};
