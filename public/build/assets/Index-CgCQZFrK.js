import{r as _,j as r,$ as S}from"./app-amIQygQf.js";import{S as O,H as Y}from"./sidebar-BaJM3Qqv.js";import{C,b as L,c as A,a as P}from"./card-BZz6pFlG.js";import{B as j}from"./button-D-ThuB9i.js";import{B as F}from"./badge-JzcZ6yjG.js";import{I as H}from"./input-CfnKyMFp.js";import{S as M}from"./search-DhigrDAO.js";import{P as $}from"./plus-CrZafDrF.js";import{U as q}from"./upload-DmKIdr9q.js";import{S as z}from"./square-pen-Dc0zc-Qf.js";/* empty css            */import"./dropdown-menu-DX9DNke_.js";import"./Combination-B9WtIDLh.js";import"./index-DnDAp_6W.js";import"./user-Cre4oXRT.js";import"./log-out-Dccl86o2.js";import"./book-open-5YNx6lOt.js";import"./graduation-cap-D3PXwbfu.js";import"./crown-AjgVpnV1.js";function me({user:v,grades:u,assignedSubjects:s}){var G;const[y,D]=_.useState(""),[o,U]=_.useState("");if(console.log("GradesIndex props:",{user:v,grades:u,assignedSubjects:s}),console.log("assignedSubjects type:",typeof s),console.log("assignedSubjects is array:",Array.isArray(s)),console.log("assignedSubjects length:",s==null?void 0:s.length),!s||!Array.isArray(s))return console.log("Safety check failed - showing loading state"),r.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:r.jsx("div",{className:"flex-1 flex items-center justify-center",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects."}),r.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(s)]})]})})});const T=(e,a)=>a==="college"||a==="senior_highschool"?e<=1.5?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":e<=2.5?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":e<=3?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":e>=90?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":e>=80?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":e>=75?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",k=(e,a)=>e===0?"No Grade":a==="college"||a==="senior_highschool"?e<=1.5?"Superior":e<=2?"Very Good":e<=2.5?"Good":e<=3?"Satisfactory":"Failing":e>=95?"Outstanding":e>=90?"Very Good":e>=85?"Good":e>=80?"Satisfactory":e>=75?"Fair":"Failing",B=(e,a,c)=>{var N;const l=((N=u==null?void 0:u.data)==null?void 0:N.filter(d=>d.student.id===e&&d.subject.id===a))||[];if(l.length===0)return 0;if(!(c==="senior_highschool"||c==="college")){const d=l.filter(t=>t.grade!==null&&t.grade!==void 0);return d.length===0?0:d.reduce((t,i)=>t+i.grade,0)/d.length}const g=l.find(d=>{var t,i;return(i=(t=d.gradingPeriod)==null?void 0:t.code)==null?void 0:i.toUpperCase().includes("S1_MT")}),m=l.find(d=>{var t,i;return(i=(t=d.gradingPeriod)==null?void 0:t.code)==null?void 0:i.toUpperCase().includes("S1_PF")}),p=l.find(d=>{var t,i;return(i=(t=d.gradingPeriod)==null?void 0:t.code)==null?void 0:i.toUpperCase().includes("S2_MT")}),f=l.find(d=>{var t,i;return(i=(t=d.gradingPeriod)==null?void 0:t.code)==null?void 0:i.toUpperCase().includes("S2_PF")});let h=null;g!=null&&g.grade&&(m!=null&&m.grade)&&(h=(parseFloat(g.grade.toString())+parseFloat(m.grade.toString()))/2);let x=null;return p!=null&&p.grade&&(f!=null&&f.grade)&&(x=(parseFloat(p.grade.toString())+parseFloat(f.grade.toString()))/2),h!==null&&x!==null?(h+x)/2:h!==null?h:x!==null?x:0},I=e=>{var l;if(!e||!s||!Array.isArray(s))return[];const a=s.find(n=>{var g,m;return((m=(g=n.subject)==null?void 0:g.id)==null?void 0:m.toString())===e});if(!a||!a.enrolled_students)return[];const c=((l=a.academicLevel)==null?void 0:l.key)||"";return a.enrolled_students.map(n=>{var f,h;const g=B(n.student.id,parseInt(e),c),m=((f=u==null?void 0:u.data)==null?void 0:f.filter(x=>x.student.id===n.student.id&&x.subject.id===parseInt(e)))||[],p=m.length>0?m.sort((x,N)=>new Date(N.updated_at).getTime()-new Date(x.updated_at).getTime())[0].updated_at:"";return{id:n.student.id,name:n.student.name,email:n.student.email,latestGrade:g,latestGradeDate:p,academicLevel:{key:c,name:((h=a.academicLevel)==null?void 0:h.name)||""},gradingPeriod:a.gradingPeriod?{name:a.gradingPeriod.name}:void 0,schoolYear:n.school_year}})},b=(s||[]).map(e=>{var c,l,n;if(console.log("Processing subject assignment:",e),!((c=e==null?void 0:e.subject)!=null&&c.id)||!((l=e==null?void 0:e.subject)!=null&&l.name)||!((n=e==null?void 0:e.academicLevel)!=null&&n.name))return console.log("Skipping subject - missing required structure:",e),null;const a={id:e.subject.id.toString(),name:e.subject.name,code:e.subject.code||"N/A",academicLevel:e.academicLevel.name,schoolYear:e.school_year||"N/A"};return console.log("Mapped subject:",a),a}).filter(e=>e!==null),V=e=>{const a=s.find(c=>c.enrolled_students.some(l=>l.student.id===e.id));a&&(window.location.href=route("teacher.grades.create")+`?student_id=${e.id}&subject_id=${a.subject.id}&academic_level_id=${a.academicLevel.id}&academic_level_key=${a.academicLevel.key}&school_year=${a.school_year}`)},w=o?I(o).filter(e=>e.name.toLowerCase().includes(y.toLowerCase())||e.email.toLowerCase().includes(y.toLowerCase())):[];return r.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[r.jsx(O,{user:v}),r.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[r.jsx(Y,{user:v}),r.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:r.jsxs("div",{className:"flex flex-col gap-6",children:[r.jsxs("div",{className:"flex flex-col gap-2",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Grade Management"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"View and manage student grades for your assigned subjects."})]}),r.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[r.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:r.jsxs("div",{className:"relative",children:[r.jsx(M,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),r.jsx(H,{placeholder:"Search students or subjects...",value:y,onChange:e=>D(e.target.value),className:"pl-10 w-full sm:w-64"})]})}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx(S,{href:route("teacher.grades.create"),className:o?"":"pointer-events-none",children:r.jsxs(j,{className:"flex items-center gap-2",disabled:!o,children:[r.jsx($,{className:"h-4 w-4"}),"Input Grade"]})}),r.jsx(S,{href:route("teacher.grades.upload"),children:r.jsxs(j,{variant:"outline",className:"flex items-center gap-2",children:[r.jsx(q,{className:"h-4 w-4"}),"Upload CSV"]})})]})]}),r.jsxs(C,{children:[r.jsxs(L,{children:[r.jsx(A,{className:"text-lg",children:"Select Subject"}),r.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a subject to view and manage student grades"})]}),r.jsx(P,{children:b.length>0?r.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:b.map(e=>r.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${o===e.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 dark:border-gray-700 dark:hover:border-gray-600 dark:hover:bg-gray-800/50"}`,onClick:()=>U(o===e.id?"":e.id),children:r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.code}),r.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:[e.academicLevel," â€¢ ",e.schoolYear]})]}),r.jsx("div",{className:`w-3 h-3 rounded-full ${o===e.id?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`})]})},e.id))}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Subjects Assigned"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"You haven't been assigned to any subjects yet."})]})})]}),o&&r.jsxs(C,{children:[r.jsx(L,{children:r.jsxs(A,{className:"flex items-center justify-between",children:[r.jsxs("span",{children:["Student Grades - ",(G=b.find(e=>e.id===o))==null?void 0:G.name]}),r.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[w.length," students"]})]})}),r.jsx(P,{children:w.length>0?r.jsx("div",{className:"overflow-x-auto",children:r.jsxs("table",{className:"w-full",children:[r.jsx("thead",{children:r.jsxs("tr",{className:"border-b",children:[r.jsx("th",{className:"text-left p-3 font-medium",children:"Student"}),r.jsx("th",{className:"text-left p-3 font-medium",children:"Latest Grade"}),r.jsx("th",{className:"text-left p-3 font-medium",children:"Status"}),r.jsx("th",{className:"text-left p-3 font-medium",children:"Last Updated"}),r.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),r.jsx("tbody",{children:w.map(e=>r.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[r.jsx("td",{className:"p-3",children:r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})}),r.jsx("td",{className:"p-3",children:e.latestGrade===0?r.jsx(F,{variant:"outline",className:"text-gray-500",children:"No Grade"}):r.jsx(F,{className:T(e.latestGrade,e.academicLevel.key),children:e.academicLevel.key==="senior_highschool"||e.academicLevel.key==="college"?e.latestGrade.toFixed(2):Math.round(e.latestGrade)})}),r.jsx("td",{className:"p-3",children:r.jsx("span",{className:`text-sm ${k(e.latestGrade,e.academicLevel.key)==="No Grade"?"text-gray-600 dark:text-gray-400":["Superior","Very Good","Good","Satisfactory","Fair","Outstanding"].includes(k(e.latestGrade,e.academicLevel.key))?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:k(e.latestGrade,e.academicLevel.key)})}),r.jsx("td",{className:"p-3 text-sm text-gray-600 dark:text-gray-400",children:e.latestGradeDate?new Date(e.latestGradeDate).toLocaleDateString():"N/A"}),r.jsx("td",{className:"p-3",children:r.jsxs("div",{className:"flex gap-2",children:[r.jsx(S,{href:route("teacher.grades.show-student",[e.id,o]),children:r.jsxs(j,{variant:"outline",size:"sm",onClick:a=>a.stopPropagation(),children:[r.jsx(z,{className:"h-4 w-4 mr-2"}),"View Details"]})}),r.jsxs(j,{size:"sm",onClick:a=>{a.stopPropagation(),V(e)},children:[r.jsx($,{className:"h-4 w-4 mr-2"}),"Input Grade"]})]})})]},e.id))})]})}):r.jsxs("div",{className:"text-center py-8",children:[r.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ‘¥"}),r.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Students Found"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:y?"No students match your search criteria.":"No students are enrolled in this subject."})]})})]})]})})]})]})}export{me as default};
