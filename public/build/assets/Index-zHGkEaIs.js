import{r as g,j as e,$ as b,S as I}from"./app-prFOh9iI.js";import{S as $,H}from"./sidebar-D6--uojC.js";import{C as D,b as E,c as F,a as R}from"./card-CaT7C3Gm.js";import{B as m}from"./button-D77OYWMI.js";import{B as T}from"./badge-BINpEH93.js";import{I as q}from"./input-BdHg48As.js";import{D as z,b as J,c as K,d as Q}from"./dialog-B52FJcXH.js";import{S as W}from"./search-BviLGN6k.js";import{P as U}from"./plus-gL68hz8V.js";import{U as X}from"./upload-D35qUsFv.js";import{S as Z}from"./square-pen-DFyPtvxe.js";/* empty css            */import"./dropdown-menu-CE_NRutu.js";import"./Combination-D6TEEAno.js";import"./index-CwFHP2f1.js";import"./user-TX1T09qF.js";import"./log-out-baBtX2za.js";import"./book-open-B4-_vrtN.js";import"./graduation-cap-uhsc7qTg.js";import"./crown-CVr-wTrp.js";function Ne({user:f,grades:x,assignedSubjects:l}){var _;const[u,O]=g.useState(""),[c,V]=g.useState(""),[v,j]=g.useState(!1),[S,k]=g.useState(null);if(console.log("GradesIndex props:",{user:f,grades:x,assignedSubjects:l}),console.log("assignedSubjects type:",typeof l),console.log("assignedSubjects is array:",Array.isArray(l)),console.log("assignedSubjects length:",l==null?void 0:l.length),!l||!Array.isArray(l))return console.log("Safety check failed - showing loading state"),e.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects."}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(l)]})]})})});const Y=(r,i)=>i==="college"?r<=1.5?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":r<=2.5?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":r<=3?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":r>=90?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":r>=80?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":r>=75?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",p=(r,i)=>r===0?"No Grade":i==="college"?r<=1.5?"Superior":r<=2?"Very Good":r<=2.5?"Good":r<=3?"Satisfactory":"Failing":r>=95?"Outstanding":r>=90?"Very Good":r>=85?"Good":r>=80?"Satisfactory":r>=75?"Fair":"Failing",M=r=>{if(!r||!l||!Array.isArray(l))return[];console.log("Getting students for subject ID:",r);const i=l.filter(s=>{var a,o;return((o=(a=s.subject)==null?void 0:a.id)==null?void 0:o.toString())===r});if(console.log("Found assignments:",i.length),i.length===0)return[];const d=new Map;i.forEach(s=>{s.enrolled_students&&s.enrolled_students.forEach(a=>{var w,P,G,L;const o=a.student.id;if(!d.has(o)){const A=((w=x==null?void 0:x.data)==null?void 0:w.filter(C=>C.student.id===o&&C.subject.id.toString()===r))||[],h=A.length>0?A[0]:null;d.set(o,{id:a.student.id,name:a.student.name,email:a.student.email,student_number:a.student.student_number,latestGrade:h?h.grade:0,latestGradeDate:h?h.updated_at:"",academicLevel:{key:((P=s.academicLevel)==null?void 0:P.key)||"",name:((G=s.academicLevel)==null?void 0:G.name)||""},gradingPeriod:s.gradingPeriod?{name:s.gradingPeriod.name}:void 0,schoolYear:a.school_year,enrolledInPeriods:[]})}const n=d.get(o);(L=s.gradingPeriod)!=null&&L.name&&n.enrolledInPeriods.push(s.gradingPeriod.full_name||s.gradingPeriod.name)})});const t=Array.from(d.values());return console.log("Returning students:",t.length),t},y=g.useMemo(()=>{if(!l||!Array.isArray(l))return console.log("No assignedSubjects available"),[];console.log("Processing assignments for grouping:",l);const r=l.reduce((d,t)=>{var a,o,n;if(!((a=t==null?void 0:t.subject)!=null&&a.id)||!((o=t==null?void 0:t.subject)!=null&&o.name)||!((n=t==null?void 0:t.academicLevel)!=null&&n.name))return console.log("Skipping assignment - missing required structure:",t),d;const s=t.subject.id;return d[s]||(d[s]={subject:t.subject,academicLevel:t.academicLevel,schoolYear:t.school_year,assignments:[]}),d[s].assignments.push({assignmentId:t.id,gradingPeriodId:t.grading_period_id,gradingPeriod:t.gradingPeriod||null,sectionId:t.section_id,enrolledStudents:t.enrolled_students||[]}),d},{}),i=Object.values(r).map(d=>{const t=d.assignments.map(s=>{var a,o;return((a=s.gradingPeriod)==null?void 0:a.full_name)||((o=s.gradingPeriod)==null?void 0:o.name)}).filter(s=>!!s);return{id:d.subject.id.toString(),name:d.subject.name,code:d.subject.code||"N/A",academicLevel:d.academicLevel.name,schoolYear:d.schoolYear||"N/A",gradingPeriods:t.length>0?t.join(", "):"No Period",assignments:d.assignments}});return console.log("Grouped available subjects:",i),i},[l]),B=r=>{var d,t,s;if(!c||!l)return;const i=l.filter(a=>a.subject.id.toString()===c);if(i.length===0){console.error("No subject assignment found for selectedSubject:",c);return}if(i.length===1){const a=i[0];console.log("=== SINGLE ASSIGNMENT NAVIGATION ==="),console.log("Creating grade for subject (single period):",{subjectId:a.subject.id,subjectName:a.subject.name,studentId:r.id,gradingPeriod:((d=a.gradingPeriod)==null?void 0:d.full_name)||((t=a.gradingPeriod)==null?void 0:t.name),academic_level_id:a.academicLevel.id});const o=new URLSearchParams({student_id:r.id.toString(),subject_id:a.subject.id.toString(),assignment_id:a.id.toString(),academic_level_id:a.academicLevel.id.toString(),academic_level_key:a.academicLevel.key,grading_period_id:(((s=a.gradingPeriod)==null?void 0:s.id)||"0").toString(),school_year:a.school_year});console.log("Navigation URL:",route("instructor.grades.create")+"?"+o.toString()),I.visit(route("instructor.grades.create")+"?"+o.toString())}else console.log("Multiple assignments found, showing period selector"),window.__pendingGradeStudent=r,k(c),j(!0)},N=c?M(c).filter(r=>r.name.toLowerCase().includes(u.toLowerCase())||r.email.toLowerCase().includes(u.toLowerCase())):[];return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx($,{user:f}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(H,{user:f}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Grade Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"View and manage student grades for your assigned subjects."})]}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:e.jsxs("div",{className:"relative",children:[e.jsx(W,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx(q,{placeholder:"Search students or subjects...",value:u,onChange:r=>O(r.target.value),className:"pl-10 w-full sm:w-64"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{href:route("instructor.grades.create"),className:c?"":"pointer-events-none",children:e.jsxs(m,{className:"flex items-center gap-2",disabled:!c,children:[e.jsx(U,{className:"h-4 w-4"}),"Input Grade"]})}),e.jsx(b,{href:route("instructor.grades.upload"),children:e.jsxs(m,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Upload CSV"]})})]})]}),e.jsxs(D,{children:[e.jsxs(E,{children:[e.jsx(F,{className:"text-lg",children:"Select Subject"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a subject to view and manage student grades"})]}),e.jsx(R,{children:y.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:y.map(r=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${c===r.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 dark:border-gray-700 dark:hover:border-gray-600 dark:hover:bg-gray-800/50"}`,onClick:()=>V(c===r.id?"":r.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.code}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:[r.academicLevel," â€¢ SY ",r.schoolYear," â€¢ ",r.gradingPeriods]})]}),e.jsx("div",{className:`w-3 h-3 rounded-full ${c===r.id?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`})]})},r.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Subjects Assigned"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"You haven't been assigned to any subjects yet."})]})})]}),c&&e.jsxs(D,{children:[e.jsx(E,{children:e.jsxs(F,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Student Grades - ",(_=y.find(r=>r.id===c))==null?void 0:_.name]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[N.length," students"]})]})}),e.jsx(R,{children:N.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Student"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Latest Grade"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Status"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Last Updated"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:N.map(r=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.email})]})}),e.jsx("td",{className:"p-3",children:r.latestGrade===0?e.jsx(T,{variant:"outline",className:"text-gray-500",children:"No Grade"}):e.jsx(T,{className:Y(r.latestGrade,r.academicLevel.key),children:r.latestGrade})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`text-sm ${p(r.latestGrade,r.academicLevel.key)==="No Grade"?"text-gray-600 dark:text-gray-400":["Superior","Very Good","Good","Satisfactory","Fair","Outstanding"].includes(p(r.latestGrade,r.academicLevel.key))?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:p(r.latestGrade,r.academicLevel.key)})}),e.jsx("td",{className:"p-3 text-sm text-gray-600 dark:text-gray-400",children:r.latestGradeDate?new Date(r.latestGradeDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(b,{href:route("instructor.grades.show-student",[r.id,c]),children:e.jsxs(m,{variant:"outline",size:"sm",onClick:i=>i.stopPropagation(),children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"View Details"]})}),e.jsxs(m,{size:"sm",onClick:i=>{i.stopPropagation(),B(r)},children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Input Grade"]})]})})]},r.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ‘¥"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Students Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:u?"No students match your search criteria.":"No students are enrolled in this subject."})]})})]})]})})]}),v&&S&&l&&e.jsx(z,{open:v,onOpenChange:j,children:e.jsxs(J,{className:"sm:max-w-md",children:[e.jsxs(K,{children:[e.jsx(Q,{children:"Select Grading Period"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"This subject has multiple grading periods. Please select which period you want to input grades for."})]}),e.jsx("div",{className:"space-y-2 mt-4",children:l.filter(r=>r.subject.id.toString()===S).map(r=>{var i,d;return e.jsx(m,{onClick:()=>{var s,a,o;const t=window.__pendingGradeStudent;if(console.log("=== GRADING PERIOD SELECTED ==="),console.log("Selected grading period:",((s=r.gradingPeriod)==null?void 0:s.full_name)||((a=r.gradingPeriod)==null?void 0:a.name)),console.log("Full assignment object:",r),console.log("Assignment details:",{assignment_id:r.id,academic_level_id:r.academic_level_id,grading_period_id:r.grading_period_id,subject_id:r.subject.id,student_id:t==null?void 0:t.id,academicLevel:r.academicLevel,gradingPeriod:r.gradingPeriod}),t){const n=new URLSearchParams({student_id:t.id.toString(),subject_id:r.subject.id.toString(),assignment_id:r.id.toString(),academic_level_id:r.academicLevel.id.toString(),academic_level_key:r.academicLevel.key,grading_period_id:(((o=r.gradingPeriod)==null?void 0:o.id)||"0").toString(),school_year:r.school_year});console.log("Navigation URL:",route("instructor.grades.create")+"?"+n.toString()),I.visit(route("instructor.grades.create")+"?"+n.toString())}j(!1),k(null),delete window.__pendingGradeStudent},variant:"outline",className:"w-full justify-start h-auto py-4 px-4",children:e.jsxs("div",{className:"flex flex-col items-start text-left",children:[e.jsx("span",{className:"font-medium",children:((i=r.gradingPeriod)==null?void 0:i.full_name)||((d=r.gradingPeriod)==null?void 0:d.name)||"No Period Assigned"}),e.jsxs("span",{className:"text-xs text-muted-foreground mt-1",children:[r.school_year," â€¢ ",r.subject.code]})]})},r.id)})})]})})]})}export{Ne as default};
