import{r as A,j as a,$ as G}from"./app-Bo16ELxq.js";import{S as H,H as q}from"./sidebar-DCFdfx-Q.js";import{C,b as P,c as F,a as D}from"./card-BAWE0bLk.js";import{B as b}from"./button-DrIADYmM.js";import{B as U}from"./badge-yrHAWA9K.js";import{I as z}from"./input-CfMRfIFE.js";import{S as M}from"./search-B3dxRh5e.js";import{P as I}from"./plus-DGCumLx8.js";import{U as R}from"./upload-DbbB2jbc.js";import{S as J}from"./square-pen-BnIZLQxd.js";/* empty css            */import"./dropdown-menu-BEQHxIYs.js";import"./Combination-BvGnVz6S.js";import"./index-BsuDbQS5.js";import"./user-BhsCzFL6.js";import"./log-out-BQgNZq8F.js";import"./book-open-DxCjZ5qt.js";import"./graduation-cap-BQVPgUJJ.js";import"./crown-CjoeLKXp.js";function he({user:N,grades:d,assignedSubjects:c}){var _,L;const[j,T]=A.useState(""),[h,$]=A.useState("");if(console.log("=".repeat(80)),console.log("GradesIndex INITIAL LOAD"),console.log("User:",N==null?void 0:N.name),console.log("Grades received:",d),console.log("Grades.data length:",((_=d==null?void 0:d.data)==null?void 0:_.length)||0),console.log("Grades.data:",d==null?void 0:d.data),console.log("assignedSubjects:",c),console.log("assignedSubjects length:",c==null?void 0:c.length),console.log("=".repeat(80)),!c||!Array.isArray(c))return console.log("Safety check failed - showing loading state"),a.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:a.jsx("div",{className:"flex-1 flex items-center justify-center",children:a.jsxs("div",{className:"text-center",children:[a.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects."}),a.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(c)]})]})})});const B=(e,t)=>t==="college"||t==="senior_highschool"?e<=1.5?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":e<=2.5?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":e<=3?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":e>=90?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":e>=80?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":e>=75?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",k=(e,t)=>e===0?"No Grade":t==="college"||t==="senior_highschool"?e<=1.5?"Superior":e<=2?"Very Good":e<=2.5?"Good":e<=3?"Satisfactory":"Failing":e>=95?"Outstanding":e>=90?"Very Good":e>=85?"Good":e>=80?"Satisfactory":e>=75?"Fair":"Failing",O=(e,t,g)=>{var v;console.log("=== calculateOverallAverage called ==="),console.log("studentId:",e,"subjectId:",t,"academicLevelKey:",g),console.log("grades.data:",d==null?void 0:d.data);const o=((v=d==null?void 0:d.data)==null?void 0:v.filter(r=>r.student.id===e&&r.subject.id===t))||[];if(console.log("studentGrades found:",o),console.log("studentGrades length:",o.length),o.length===0)return console.log("No grades found - returning 0"),0;const y=g==="senior_highschool"||g==="college";if(console.log("isSemesterBased:",y),!y){const r=o.filter(s=>s.grade!==null&&s.grade!==void 0);if(console.log("Non-semester based - validGrades:",r),r.length===0)return 0;const n=r.reduce((s,Y)=>s+Y.grade,0)/r.length;return console.log("Non-semester based average:",n),n}console.log("Semester based - Looking for grading periods"),o.forEach(r=>{var n,s;console.log("Grade:",r.grade,"Period code:",(n=r.gradingPeriod)==null?void 0:n.code,"Period name:",(s=r.gradingPeriod)==null?void 0:s.name),console.log("FULL gradingPeriod object:",r.gradingPeriod),console.log("FULL grade object:",r)});const l=o.find(r=>{var n,s;return(s=(n=r.gradingPeriod)==null?void 0:n.code)==null?void 0:s.toUpperCase().includes("S1_MT")}),m=o.find(r=>{var n,s;return(s=(n=r.gradingPeriod)==null?void 0:n.code)==null?void 0:s.toUpperCase().includes("S1_PF")}),i=o.find(r=>{var n,s;return(s=(n=r.gradingPeriod)==null?void 0:n.code)==null?void 0:s.toUpperCase().includes("S2_MT")}),u=o.find(r=>{var n,s;return(s=(n=r.gradingPeriod)==null?void 0:n.code)==null?void 0:s.toUpperCase().includes("S2_PF")});console.log("Found periods - S1_MT:",l==null?void 0:l.grade,"S1_PF:",m==null?void 0:m.grade,"S2_MT:",i==null?void 0:i.grade,"S2_PF:",u==null?void 0:u.grade);let f=null;l!=null&&l.grade&&(m!=null&&m.grade)&&(f=(parseFloat(l.grade.toString())+parseFloat(m.grade.toString()))/2,console.log("Semester 1 Average:",f));let p=null;i!=null&&i.grade&&(u!=null&&u.grade)&&(p=(parseFloat(i.grade.toString())+parseFloat(u.grade.toString()))/2,console.log("Semester 2 Average:",p));let x=0;return f!==null&&p!==null?(x=(f+p)/2,console.log("Both semesters - Final Average:",x)):f!==null?(x=f,console.log("Semester 1 only - Final Average:",x)):p!==null?(x=p,console.log("Semester 2 only - Final Average:",x)):console.log("No complete semester grades - returning 0"),console.log("=== calculateOverallAverage returning:",x,"==="),x},E=e=>{var y;if(console.log(">>> getStudentsForSubject called with subjectId:",e),!e||!c||!Array.isArray(c))return console.log(">>> Early return - invalid params"),[];const t=c.find(l=>{var m,i;return((i=(m=l.subject)==null?void 0:m.id)==null?void 0:i.toString())===e});if(console.log(">>> Found subjectAssignment:",t),!t||!t.enrolled_students)return console.log(">>> Early return - no assignment or students"),[];const g=((y=t.academicLevel)==null?void 0:y.key)||"";console.log(">>> Academic level key:",g),console.log(">>> Enrolled students count:",t.enrolled_students.length);const o=t.enrolled_students.map(l=>{var p,x;console.log(">>> Mapping student:",l.student.name,"ID:",l.student.id);const m=O(l.student.id,parseInt(e),g),i=((p=d==null?void 0:d.data)==null?void 0:p.filter(v=>v.student.id===l.student.id&&v.subject.id===parseInt(e)))||[],u=i.length>0?i.sort((v,r)=>new Date(r.updated_at).getTime()-new Date(v.updated_at).getTime())[0].updated_at:"",f={id:l.student.id,name:l.student.name,email:l.student.email,latestGrade:m,latestGradeDate:u,academicLevel:{key:g,name:((x=t.academicLevel)==null?void 0:x.name)||""},gradingPeriod:t.gradingPeriod?{name:t.gradingPeriod.name}:void 0,schoolYear:l.school_year};return console.log(">>> Student data created:",f),f});return console.log(">>> Returning",o.length,"students"),o},S=(c||[]).map(e=>{var g,o,y;if(console.log("Processing subject assignment:",e),!((g=e==null?void 0:e.subject)!=null&&g.id)||!((o=e==null?void 0:e.subject)!=null&&o.name)||!((y=e==null?void 0:e.academicLevel)!=null&&y.name))return console.log("Skipping subject - missing required structure:",e),null;const t={id:e.subject.id.toString(),name:e.subject.name,code:e.subject.code||"N/A",academicLevel:e.academicLevel.name,schoolYear:e.school_year||"N/A"};return console.log("Mapped subject:",t),t}).filter(e=>e!==null),V=e=>{const t=c.find(g=>g.enrolled_students.some(o=>o.student.id===e.id));t&&(window.location.href=route("teacher.grades.create")+`?student_id=${e.id}&subject_id=${t.subject.id}&academic_level_id=${t.academicLevel.id}&academic_level_key=${t.academicLevel.key}&school_year=${t.school_year}`)},w=h?E(h).filter(e=>e.name.toLowerCase().includes(j.toLowerCase())||e.email.toLowerCase().includes(j.toLowerCase())):[];return a.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[a.jsx(H,{user:N}),a.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[a.jsx(q,{user:N}),a.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:a.jsxs("div",{className:"flex flex-col gap-6",children:[a.jsxs("div",{className:"flex flex-col gap-2",children:[a.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Grade Management"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"View and manage student grades for your assigned subjects."})]}),a.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[a.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:a.jsxs("div",{className:"relative",children:[a.jsx(M,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),a.jsx(z,{placeholder:"Search students or subjects...",value:j,onChange:e=>T(e.target.value),className:"pl-10 w-full sm:w-64"})]})}),a.jsxs("div",{className:"flex gap-2",children:[a.jsx(G,{href:route("teacher.grades.create"),className:h?"":"pointer-events-none",children:a.jsxs(b,{className:"flex items-center gap-2",disabled:!h,children:[a.jsx(I,{className:"h-4 w-4"}),"Input Grade"]})}),a.jsx(G,{href:route("teacher.grades.upload"),children:a.jsxs(b,{variant:"outline",className:"flex items-center gap-2",children:[a.jsx(R,{className:"h-4 w-4"}),"Upload CSV"]})})]})]}),a.jsxs(C,{children:[a.jsxs(P,{children:[a.jsx(F,{className:"text-lg",children:"Select Subject"}),a.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a subject to view and manage student grades"})]}),a.jsx(D,{children:S.length>0?a.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:S.map(e=>a.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${h===e.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 dark:border-gray-700 dark:hover:border-gray-600 dark:hover:bg-gray-800/50"}`,onClick:()=>$(h===e.id?"":e.id),children:a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{children:[a.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.code}),a.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:[e.academicLevel," â€¢ ",e.schoolYear]})]}),a.jsx("div",{className:`w-3 h-3 rounded-full ${h===e.id?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`})]})},e.id))}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Subjects Assigned"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"You haven't been assigned to any subjects yet."})]})})]}),h&&a.jsxs(C,{children:[a.jsx(P,{children:a.jsxs(F,{className:"flex items-center justify-between",children:[a.jsxs("span",{children:["Student Grades - ",(L=S.find(e=>e.id===h))==null?void 0:L.name]}),a.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[w.length," students"]})]})}),a.jsx(D,{children:w.length>0?a.jsx("div",{className:"overflow-x-auto",children:a.jsxs("table",{className:"w-full",children:[a.jsx("thead",{children:a.jsxs("tr",{className:"border-b",children:[a.jsx("th",{className:"text-left p-3 font-medium",children:"Student"}),a.jsx("th",{className:"text-left p-3 font-medium",children:"Latest Grade"}),a.jsx("th",{className:"text-left p-3 font-medium",children:"Status"}),a.jsx("th",{className:"text-left p-3 font-medium",children:"Last Updated"}),a.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),a.jsx("tbody",{children:w.map(e=>a.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[a.jsx("td",{className:"p-3",children:a.jsxs("div",{children:[a.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),a.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})}),a.jsx("td",{className:"p-3",children:e.latestGrade===0?a.jsx(U,{variant:"outline",className:"text-gray-500",children:"No Grade"}):a.jsx(U,{className:B(e.latestGrade,e.academicLevel.key),children:e.academicLevel.key==="senior_highschool"||e.academicLevel.key==="college"?e.latestGrade.toFixed(2):Math.round(e.latestGrade)})}),a.jsx("td",{className:"p-3",children:a.jsx("span",{className:`text-sm ${k(e.latestGrade,e.academicLevel.key)==="No Grade"?"text-gray-600 dark:text-gray-400":["Superior","Very Good","Good","Satisfactory","Fair","Outstanding"].includes(k(e.latestGrade,e.academicLevel.key))?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:k(e.latestGrade,e.academicLevel.key)})}),a.jsx("td",{className:"p-3 text-sm text-gray-600 dark:text-gray-400",children:e.latestGradeDate?new Date(e.latestGradeDate).toLocaleDateString():"N/A"}),a.jsx("td",{className:"p-3",children:a.jsxs("div",{className:"flex gap-2",children:[a.jsx(G,{href:route("teacher.grades.show-student",[e.id,h]),children:a.jsxs(b,{variant:"outline",size:"sm",onClick:t=>t.stopPropagation(),children:[a.jsx(J,{className:"h-4 w-4 mr-2"}),"View Details"]})}),a.jsxs(b,{size:"sm",onClick:t=>{t.stopPropagation(),V(e)},children:[a.jsx(I,{className:"h-4 w-4 mr-2"}),"Input Grade"]})]})})]},e.id))})]})}):a.jsxs("div",{className:"text-center py-8",children:[a.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ‘¥"}),a.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Students Found"}),a.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:j?"No students match your search criteria.":"No students are enrolled in this subject."})]})})]})]})})]})]})}export{he as default};
