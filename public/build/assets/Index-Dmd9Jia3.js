import{r,m as de,u as he,j as e,$ as I,S as O}from"./app-BE35O79D.js";import{S as me,H as xe}from"./sidebar-D9LY3OUf.js";import{C as K,b as q,c as G,a as J}from"./card-5wQAtQX4.js";import{B as p}from"./button-BL1FviMj.js";import{I as pe}from"./input-n2j5Q6my.js";import{B as ue}from"./badge-CUC2-kaP.js";import{P as fe}from"./PasswordResetModal-BKgy1_yD.js";import{S as u,a as f,b as j,c as g,d as S}from"./select-DZzJ1ZSz.js";import{D as je,b as ge,c as Se,d as Ne,e as ve,f as be}from"./dialog-ByLHNHeZ.js";import{S as _e}from"./search-YQVXTtQN.js";import{U as Q}from"./upload-sLbv-KKb.js";import{U as Ce}from"./users-COd_av7o.js";import{E as we}from"./eye-xBQSW4nY.js";import{S as ye}from"./square-pen-DSSfHV2A.js";import{K as Ue}from"./key-lA4ljbPF.js";import{T as ke}from"./trash-2-E3Jdqr3x.js";import{D as De}from"./download-BfeOVgC1.js";/* empty css            */import"./dropdown-menu-DTazMb-V.js";import"./Combination-X2FoKpzo.js";import"./index-MDQRH7eH.js";import"./separator-DvCpq_1Y.js";import"./chevron-right-PJZFNDip.js";import"./crown-BcneNpce.js";import"./building-2-C4Zkdet1.js";import"./user-cog-5DPM4AZi.js";import"./book-open-By-kh0iE.js";import"./user-check-CA6o2gYn.js";import"./graduation-cap-24fjwj5S.js";import"./notebook-CYzXM3iC.js";import"./chart-no-axes-column-increasing-CElGHXix.js";import"./label-Mq222Mbk.js";import"./alert-zWBQtwK2.js";import"./rotate-ccw-Ch1oA-Gu.js";import"./index-CGRaK3wc.js";import"./index-D-kUqRvi.js";import"./check-D0prF1OU.js";function ps({user:$,users:b,filters:N,roles:Ve,currentRole:h,yearLevel:a,sections:z=[],specificYearLevels:U={},tracks:R=[],strands:C=[],departments:W=[],courses:w=[]}){const[_,k]=r.useState(null),[D,F]=r.useState(null),[X,V]=r.useState(!1),[v,A]=r.useState(""),[t,y]=r.useState(""),[c,P]=r.useState(""),[i,B]=r.useState(""),[d,T]=r.useState(""),[n,H]=r.useState(""),[m,M]=r.useState(""),{delete:Z}=de(),Y=r.useRef(null),{addToast:x}=he(),L=r.useMemo(()=>i&&C.length>0?C.filter(s=>s.track_id===parseInt(i)):C,[i,C]),ee=r.useMemo(()=>n&&w.length>0?w.filter(s=>s.department_id===parseInt(n)):w,[n,w]),se=r.useMemo(()=>{let s=z;return t&&(a==="elementary"||a==="junior_highschool")&&(s=s.filter(l=>l.specific_year_level===t)),a==="senior_highschool"&&(i&&(s=s.filter(l=>l.track_id===parseInt(i))),d&&(s=s.filter(l=>l.strand_id===parseInt(d))),t&&(s=s.filter(l=>l.specific_year_level===t))),a==="college"&&(n&&(s=s.filter(l=>l.department_id===parseInt(n))),m&&(s=s.filter(l=>l.course_id===parseInt(m))),t&&(s=s.filter(l=>l.specific_year_level===t))),s},[t,i,d,n,m,z,a]);r.useEffect(()=>{P("")},[t,i,d,n,m]),r.useEffect(()=>{T("")},[i]),r.useEffect(()=>{M("")},[n]);const ae=s=>{k(s)},le=s=>{F(s)},te=()=>{if(!v){x("Please enter a school year first.","error");return}if(!c&&(a==="elementary"||a==="junior_highschool")){x("Please select a grade level and section first.","error");return}if(!c&&a==="senior_highschool"){x("Please select track, strand, and section first.","error");return}if(!c&&a==="college"){x("Please select department, course, year level, and section first.","error");return}const s={};a&&(s.academic_level=a),v&&(s.school_year=v),t&&(s.specific_year_level=t),i&&(s.track_id=i),d&&(s.strand_id=d),n&&(s.department_id=n),m&&(s.course_id=m),c&&(s.section_id=c),window.location.href=route("registrar.students.template",s),x("Downloading CSV template...","success")},re=()=>{var s;if(!v){x("Please enter a school year first.","error");return}if(!c&&(a==="elementary"||a==="junior_highschool")){x("Please select a grade level and section first.","error");return}if(!c&&a==="senior_highschool"){x("Please select track, strand, and section first.","error");return}if(!c&&a==="college"){x("Please select department, course, year level, and section first.","error");return}(s=Y.current)==null||s.click()},ie=()=>{var s;a?V(!0):(s=Y.current)==null||s.click()},ne=s=>{var E;const l=(E=s.target.files)==null?void 0:E[0];if(!l)return;const o=new FormData;o.append("file",l),a&&o.append("academic_level",a),v&&o.append("school_year",v),t&&o.append("specific_year_level",t),i&&o.append("track_id",i),d&&o.append("strand_id",d),n&&o.append("department_id",n),m&&o.append("course_id",m),c&&o.append("section_id",c),O.post(route("registrar.students.upload"),o,{forceFormData:!0,onSuccess:()=>{x("Students CSV uploaded successfully.","success"),V(!1),A(""),y(""),P(""),B(""),T(""),H(""),M(""),O.reload()},onError:oe=>{console.error("CSV upload failed:",oe),x("CSV upload failed. Please check the file format.","error")},preserveScroll:!0}),s.target.value=""},ce=()=>{if(_){let s;h&&h!=="student"?s=route(`registrar.${h}s.destroy`,_.id):a?s=route("registrar.students.destroy",_.id):s=route("registrar.users.destroy",_.id),Z(s,{onSuccess:()=>{k(null)}})}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(me,{user:$}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(xe,{user:$}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:a?`${a.charAt(0).toUpperCase()+a.slice(1).replace("_"," ")} Students`:h?`${h.charAt(0).toUpperCase()+h.slice(1)} Management`:"User Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:a?`Manage ${a.replace("_"," ")} student accounts.`:"Manage user accounts and permissions."})]}),e.jsxs(K,{children:[e.jsx(q,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(_e,{className:"h-5 w-5"}),"Search & Filters"]})}),e.jsx(J,{children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsxs("div",{className:"flex gap-4 flex-1",children:[e.jsx("div",{className:"flex-1",children:e.jsx(pe,{placeholder:"Search users by name or email...",defaultValue:(N==null?void 0:N.search)||""})}),e.jsx(p,{children:"Search"})]}),a&&e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end w-full lg:w-auto",children:[e.jsx("input",{type:"file",accept:".csv,text/csv",ref:Y,className:"hidden",onChange:ne}),e.jsxs(p,{variant:"outline",className:"flex items-center gap-2",onClick:ie,children:[e.jsx(Q,{className:"h-4 w-4"}),"CSV Upload Manager"]})]})]})})]}),e.jsxs(K,{children:[e.jsx(q,{children:e.jsxs(G,{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"h-5 w-5"}),"Users (",b.total,")"]})}),e.jsxs(J,{children:[e.jsxs("div",{className:"space-y-4",children:[b.data.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.email}),s.year_level&&e.jsx("p",{className:"text-xs text-gray-400 capitalize",children:s.year_level.replace("_"," ")})]}),e.jsx(ue,{variant:"secondary",children:s.user_role})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{href:route("registrar.users.show",s.id),children:e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(we,{className:"h-4 w-4 mr-2"}),"View"]})}),e.jsx(I,{href:route("registrar.users.edit",s.id),children:e.jsxs(p,{variant:"outline",size:"sm",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"Edit"]})}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>le(s),className:"text-blue-600 hover:text-blue-700 hover:bg-blue-50",children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Change Password"]}),e.jsxs(p,{variant:"outline",size:"sm",onClick:()=>ae(s),className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:[e.jsx(ke,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]},s.id)),b.data.length===0&&e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No users found."})})]}),b.last_page>1&&e.jsx("div",{className:"flex justify-center mt-6",children:e.jsx("div",{className:"flex gap-2",children:Array.from({length:b.last_page},(s,l)=>l+1).map(s=>e.jsx(p,{variant:s===b.current_page?"default":"outline",size:"sm",onClick:()=>{const l=new URLSearchParams;N!=null&&N.search&&l.set("search",N.search),l.set("page",s.toString());let o="registrar.users.index";h&&h!=="student"?o=`registrar.${h}s.index`:a&&(o={elementary:"registrar.students.elementary",junior_highschool:"registrar.students.junior_highschool",senior_highschool:"registrar.students.senior_highschool",college:"registrar.students.college"}[a]||"registrar.students.index"),O.visit(route(o)+"?"+l.toString(),{preserveState:!0,preserveScroll:!1})},children:s},s))})})]})]})]})})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg max-w-md w-full mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4",children:"Confirm Delete"}),e.jsxs("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:["Are you sure you want to delete ",e.jsx("strong",{children:_.name}),"? This action cannot be undone."]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(p,{variant:"outline",onClick:()=>k(null),children:"Cancel"}),e.jsx(p,{variant:"destructive",onClick:ce,children:"Delete User"})]})]})}),D&&e.jsx(fe,{user:D,isOpen:!!D,onClose:()=>F(null),routeName:h?`registrar.${h}s.reset-password`:"registrar.users.reset-password"}),e.jsx(je,{open:X,onOpenChange:V,children:e.jsxs(ge,{className:"sm:max-w-[500px] max-h-[90vh] flex flex-col",children:[e.jsxs(Se,{children:[e.jsx(Ne,{children:"CSV Upload Manager"}),e.jsx(ve,{children:a==="senior_highschool"?"Enter the school year, then select the track, strand, year level, and section, then download the template and upload your CSV file.":a==="college"?"Enter the school year, then select the department, course, year level, and section, then download the template and upload your CSV file.":"Enter the school year, then select the grade level and section, then download the template and upload your CSV file."})]}),e.jsxs("div",{className:"space-y-4 py-4 overflow-y-auto flex-1",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium",children:["School Year ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",placeholder:"e.g., 2024-2025",value:v,onChange:s=>A(s.target.value),className:"w-full rounded-md border border-gray-300 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Format: YYYY-YYYY (e.g., 2024-2025)"})]}),(a==="elementary"||a==="junior_highschool")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Grade Level"}),e.jsxs(u,{value:t,onValueChange:y,children:[e.jsx(f,{children:e.jsx(j,{placeholder:"Select grade level"})}),e.jsx(g,{children:Object.entries(U).map(([s,l])=>e.jsx(S,{value:s,children:l},s))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Track"}),e.jsxs(u,{value:i,onValueChange:B,children:[e.jsx(f,{children:e.jsx(j,{placeholder:"Select track"})}),e.jsx(g,{children:R.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Strand"}),e.jsxs(u,{value:d,onValueChange:T,disabled:!i,children:[e.jsx(f,{children:e.jsx(j,{placeholder:i?"Select strand":"Select track first"})}),e.jsx(g,{children:L.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(u,{value:t,onValueChange:y,disabled:!d,children:[e.jsx(f,{children:e.jsx(j,{placeholder:d?"Select year level":"Select strand first"})}),e.jsx(g,{children:Object.entries(U).map(([s,l])=>e.jsx(S,{value:s,children:l},s))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Department"}),e.jsxs(u,{value:n,onValueChange:H,children:[e.jsx(f,{children:e.jsx(j,{placeholder:"Select department"})}),e.jsx(g,{children:W.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Course"}),e.jsxs(u,{value:m,onValueChange:M,disabled:!n,children:[e.jsx(f,{children:e.jsx(j,{placeholder:n?"Select course":"Select department first"})}),e.jsx(g,{children:ee.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(u,{value:t,onValueChange:y,disabled:!m,children:[e.jsx(f,{children:e.jsx(j,{placeholder:m?"Select year level":"Select course first"})}),e.jsx(g,{children:Object.entries(U).map(([s,l])=>e.jsx(S,{value:s,children:l},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Section"}),e.jsxs(u,{value:c,onValueChange:P,disabled:a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?!t:!d,children:[e.jsx(f,{children:e.jsx(j,{placeholder:a==="elementary"||a==="junior_highschool"?t?"Select section":"Select grade level first":a==="senior_highschool"||a==="college"?t?"Select section":"Select year level first":d?"Select section":"Select track and strand first"})}),e.jsx(g,{children:se.map(s=>e.jsx(S,{value:s.id.toString(),children:s.name},s.id))})]})]}),c&&e.jsxs("div",{className:"rounded-md bg-blue-50 p-3 text-sm text-blue-900 dark:bg-blue-950 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"Next Steps:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'Click "Download Template" to get the CSV file'}),e.jsx("li",{children:'Click "Upload CSV" to import the students'})]})]})]}),e.jsxs(be,{className:"flex gap-2 flex-shrink-0",children:[e.jsxs(p,{variant:"outline",onClick:te,disabled:!c,children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"Download Template"]}),e.jsxs(p,{onClick:re,disabled:!c,children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Upload CSV"]})]})]})})]})}export{ps as default};
