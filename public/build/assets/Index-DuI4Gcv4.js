import{r as S,j as t,$ as _}from"./app-DAn0IDCL.js";import{S as V,H as U}from"./sidebar-CaM7wZ-v.js";import{C as L,b as A,c as C,a as P}from"./card-D27ZnC70.js";import{B as N}from"./button-z4dLpn4_.js";import{B as $}from"./badge-BFTXK6O7.js";import{I as M}from"./input-wdivmbsl.js";import{S as Y}from"./search-BUGgvl6k.js";import{P as D}from"./plus-DzzWRQ0k.js";import{U as H}from"./upload-DD4KPJtw.js";import{S as q}from"./square-pen-DELkMHFS.js";/* empty css            */import"./dropdown-menu-CzARHlKP.js";import"./Combination-Dnvc7mK-.js";import"./index-BWlM_YhN.js";import"./user-CF1VLRqP.js";import"./log-out-DYCs2SqP.js";import"./book-open-MfW7zUk2.js";import"./graduation-cap-5-wcQQVk.js";import"./crown-Cb_UgCcO.js";function me({user:p,grades:l,assignedSubjects:i}){var w,G;const[y,I]=S.useState(""),[c,F]=S.useState("");if(console.log("=".repeat(80)),console.log("GradesIndex INITIAL LOAD"),console.log("User:",p==null?void 0:p.name),console.log("Grades received:",l),console.log("Grades.data length:",((w=l==null?void 0:l.data)==null?void 0:w.length)||0),console.log("Grades.data:",l==null?void 0:l.data),console.log("assignedSubjects:",i),console.log("assignedSubjects length:",i==null?void 0:i.length),console.log("=".repeat(80)),!i||!Array.isArray(i))return console.log("Safety check failed - showing loading state"),t.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:t.jsx("div",{className:"flex-1 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects."}),t.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(i)]})]})})});const O=(e,a)=>a==="college"||a==="senior_highschool"?e<=1.5?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":e<=2.5?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":e<=3?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":e>=90?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":e>=80?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":e>=75?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",j=(e,a)=>e===0?"No Grade":a==="college"||a==="senior_highschool"?e<=1.5?"Superior":e<=2?"Very Good":e<=2.5?"Good":e<=3?"Satisfactory":"Failing":e>=95?"Outstanding":e>=90?"Very Good":e>=85?"Good":e>=80?"Satisfactory":e>=75?"Fair":"Failing",B=(e,a,m)=>{var v;console.log("=== calculateOverallAverage called ==="),console.log("studentId:",e,"subjectId:",a,"academicLevelKey:",m),console.log("grades.data:",l==null?void 0:l.data);const o=((v=l==null?void 0:l.data)==null?void 0:v.filter(r=>r.student.id===e&&r.subject.id===a))||[];if(console.log("studentGrades found:",o),console.log("studentGrades length:",o.length),o.length===0)return console.log("No grades found - returning 0"),0;const h=m==="senior_highschool"||m==="college";if(console.log("isSemesterBased:",h),!h){const r=o.filter(n=>n.grade!==null&&n.grade!==void 0);if(console.log("Non-semester based - validGrades:",r),r.length===0)return 0;const s=r.reduce((n,g)=>n+g.grade,0)/r.length;return console.log("Non-semester based average:",s),s}console.log("Semester based - Grouping by parent_id"),o.forEach(r=>{var s,n;console.log("Grade:",r.grade,"Period parent_id:",(s=r.gradingPeriod)==null?void 0:s.parent_id,"Period name:",(n=r.gradingPeriod)==null?void 0:n.name)});const d=[...new Set(o.map(r=>{var s;return(s=r.gradingPeriod)==null?void 0:s.parent_id}).filter(r=>r!=null))];if(console.log("Found parent IDs (semesters):",d),d.length===0){console.log("No parent_id structure found, using simple average");const r=o.filter(s=>s.grade!==null&&s.grade!==void 0);return r.length===0?0:r.reduce((s,n)=>s+n.grade,0)/r.length}const x=d.map(r=>{const s=o.filter(g=>{var f;return((f=g.gradingPeriod)==null?void 0:f.parent_id)===r&&g.grade!==null&&g.grade!==void 0});if(s.length===0)return null;const n=s.reduce((g,f)=>g+f.grade,0)/s.length;return console.log(`Semester (parent ${r}) average:`,n,"from",s.length,"grades"),n}).filter(r=>r!==null);if(console.log("Semester averages:",x),x.length===0)return console.log("No complete semester grades - returning 0"),0;const u=x.reduce((r,s)=>r+s,0)/x.length;return console.log("=== calculateOverallAverage returning:",u,"==="),u},E=e=>{var h;if(console.log(">>> getStudentsForSubject called with subjectId:",e),!e||!i||!Array.isArray(i))return console.log(">>> Early return - invalid params"),[];const a=i.find(d=>{var x,u;return((u=(x=d.subject)==null?void 0:x.id)==null?void 0:u.toString())===e});if(console.log(">>> Found subjectAssignment:",a),!a||!a.enrolled_students)return console.log(">>> Early return - no assignment or students"),[];const m=((h=a.academicLevel)==null?void 0:h.key)||"";console.log(">>> Academic level key:",m),console.log(">>> Enrolled students count:",a.enrolled_students.length);const o=a.enrolled_students.map(d=>{var s,n;console.log(">>> Mapping student:",d.student.name,"ID:",d.student.id);const x=B(d.student.id,parseInt(e),m),u=((s=l==null?void 0:l.data)==null?void 0:s.filter(g=>g.student.id===d.student.id&&g.subject.id===parseInt(e)))||[],v=u.length>0?u.sort((g,f)=>new Date(f.updated_at).getTime()-new Date(g.updated_at).getTime())[0].updated_at:"",r={id:d.student.id,name:d.student.name,email:d.student.email,latestGrade:x,latestGradeDate:v,academicLevel:{key:m,name:((n=a.academicLevel)==null?void 0:n.name)||""},gradingPeriod:a.gradingPeriod?{name:a.gradingPeriod.name}:void 0,schoolYear:d.school_year};return console.log(">>> Student data created:",r),r});return console.log(">>> Returning",o.length,"students"),o},b=(i||[]).map(e=>{var m,o,h;if(console.log("Processing subject assignment:",e),!((m=e==null?void 0:e.subject)!=null&&m.id)||!((o=e==null?void 0:e.subject)!=null&&o.name)||!((h=e==null?void 0:e.academicLevel)!=null&&h.name))return console.log("Skipping subject - missing required structure:",e),null;const a={id:e.subject.id.toString(),name:e.subject.name,code:e.subject.code||"N/A",academicLevel:e.academicLevel.name,schoolYear:e.school_year||"N/A"};return console.log("Mapped subject:",a),a}).filter(e=>e!==null),T=e=>{if(!c){console.error("No subject selected");return}const a=i.find(m=>m.subject.id.toString()===c);a&&(window.location.href=route("teacher.grades.create")+`?student_id=${e.id}&subject_id=${a.subject.id}&academic_level_id=${a.academicLevel.id}&academic_level_key=${a.academicLevel.key}&school_year=${a.school_year}`)},k=c?E(c).filter(e=>e.name.toLowerCase().includes(y.toLowerCase())||e.email.toLowerCase().includes(y.toLowerCase())):[];return t.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[t.jsx(V,{user:p}),t.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[t.jsx(U,{user:p}),t.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:t.jsxs("div",{className:"flex flex-col gap-6",children:[t.jsxs("div",{className:"flex flex-col gap-2",children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Grade Management"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"View and manage student grades for your assigned subjects."})]}),t.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[t.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:t.jsxs("div",{className:"relative",children:[t.jsx(Y,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),t.jsx(M,{placeholder:"Search students or subjects...",value:y,onChange:e=>I(e.target.value),className:"pl-10 w-full sm:w-64"})]})}),t.jsxs("div",{className:"flex gap-2",children:[t.jsxs(N,{className:"flex items-center gap-2",disabled:!c,onClick:()=>{if(c){const e=i.find(a=>a.subject.id.toString()===c);e&&(window.location.href=route("teacher.grades.create")+`?subject_id=${e.subject.id}&academic_level_id=${e.academicLevel.id}&academic_level_key=${e.academicLevel.key}&school_year=${e.school_year}`)}},children:[t.jsx(D,{className:"h-4 w-4"}),"Input Grade"]}),t.jsx(_,{href:route("teacher.grades.upload"),children:t.jsxs(N,{variant:"outline",className:"flex items-center gap-2",children:[t.jsx(H,{className:"h-4 w-4"}),"Upload CSV"]})})]})]}),t.jsxs(L,{children:[t.jsxs(A,{children:[t.jsx(C,{className:"text-lg",children:"Select Subject"}),t.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a subject to view and manage student grades"})]}),t.jsx(P,{children:b.length>0?t.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:b.map(e=>t.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${c===e.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 dark:border-gray-700 dark:hover:border-gray-600 dark:hover:bg-gray-800/50"}`,onClick:()=>F(c===e.id?"":e.id),children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.code}),t.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:[e.academicLevel," â€¢ ",e.schoolYear]})]}),t.jsx("div",{className:`w-3 h-3 rounded-full ${c===e.id?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`})]})},e.id))}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Subjects Assigned"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"You haven't been assigned to any subjects yet."})]})})]}),c&&t.jsxs(L,{children:[t.jsx(A,{children:t.jsxs(C,{className:"flex items-center justify-between",children:[t.jsxs("span",{children:["Student Grades - ",(G=b.find(e=>e.id===c))==null?void 0:G.name]}),t.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[k.length," students"]})]})}),t.jsx(P,{children:k.length>0?t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b",children:[t.jsx("th",{className:"text-left p-3 font-medium",children:"Student"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Latest Grade"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Status"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Last Updated"}),t.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),t.jsx("tbody",{children:k.map(e=>t.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[t.jsx("td",{className:"p-3",children:t.jsxs("div",{children:[t.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:e.name}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.email})]})}),t.jsx("td",{className:"p-3",children:e.latestGrade===0?t.jsx($,{variant:"outline",className:"text-gray-500",children:"No Grade"}):t.jsx($,{className:O(e.latestGrade,e.academicLevel.key),children:e.academicLevel.key==="senior_highschool"||e.academicLevel.key==="college"?e.latestGrade.toFixed(2):Math.round(e.latestGrade)})}),t.jsx("td",{className:"p-3",children:t.jsx("span",{className:`text-sm ${j(e.latestGrade,e.academicLevel.key)==="No Grade"?"text-gray-600 dark:text-gray-400":["Superior","Very Good","Good","Satisfactory","Fair","Outstanding"].includes(j(e.latestGrade,e.academicLevel.key))?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:j(e.latestGrade,e.academicLevel.key)})}),t.jsx("td",{className:"p-3 text-sm text-gray-600 dark:text-gray-400",children:e.latestGradeDate?new Date(e.latestGradeDate).toLocaleDateString():"N/A"}),t.jsx("td",{className:"p-3",children:t.jsxs("div",{className:"flex gap-2",children:[t.jsx(_,{href:route("teacher.grades.show-student",[e.id,c]),children:t.jsxs(N,{variant:"outline",size:"sm",onClick:a=>a.stopPropagation(),children:[t.jsx(q,{className:"h-4 w-4 mr-2"}),"View Details"]})}),t.jsxs(N,{size:"sm",onClick:a=>{a.stopPropagation(),T(e)},children:[t.jsx(D,{className:"h-4 w-4 mr-2"}),"Input Grade"]})]})})]},e.id))})]})}):t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ‘¥"}),t.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Students Found"}),t.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:y?"No students match your search criteria.":"No students are enrolled in this subject."})]})})]})]})})]})]})}export{me as default};
