import{m as ie,r as p,j as e,$ as B}from"./app-BdZV0ydf.js";import{S as Q,H as X}from"./sidebar-BVP9JA6F.js";import{C as Z,b as J,c as ee,a as se}from"./card-CZK3BcXK.js";import{B as v}from"./button-Bdf45gni.js";import{I as P}from"./input-pAPTWY2f.js";import{L as m}from"./label-qfPDT8qO.js";import{S,a as y,b as N,c as F,d as c,e as k,f as E}from"./select-DfD-sb1u.js";import{A as oe}from"./arrow-left-C4QtvzAB.js";import{P as ne}from"./plus-DchxkD29.js";import{S as re}from"./save-D1-do_2C.js";/* empty css            */import"./dropdown-menu-BEyPQi_N.js";import"./Combination-CT1l594C.js";import"./index-DrVs0QZU.js";import"./user-Cfm7oWoh.js";import"./log-out-DrvTcKvH.js";import"./book-open-9hKVM97f.js";import"./graduation-cap-Cf6-CEM_.js";import"./upload-D11L3LnB.js";import"./crown-CuhkgwNX.js";import"./index-Y_t7rCQ8.js";import"./index-CQiZT8zs.js";import"./check-DkBprbSB.js";function ke({user:w,academicLevels:D,gradingPeriods:g,assignedSubjects:o,selectedStudent:h,selectedGradingPeriodId:j,selectedAssignmentId:T}){var Y,K,$;const u=s=>{const r={1:"99-100%",1.1:"97-98%",1.2:"95-96%",1.3:"93-94%",1.4:"91-92%",1.5:"90%",1.6:"89%",1.7:"88%",1.8:"87%",1.9:"86%",2:"85%",2.1:"84%",2.2:"83%",2.3:"82%",2.4:"81%",2.5:"80%",2.6:"79%",2.7:"78%",2.8:"77%",2.9:"76%",3:"75%",3.1:"74%",3.2:"73%",3.3:"72%",3.4:"71%",3.5:"70%",5:"Below 70%"},d=Math.round(s*10)/10;return r[d]||""},_=s=>s>=1&&s<=1.2?"Excellent":s>=1.3&&s<=1.5?"Superior":s>=1.6&&s<=1.8?"Very Good":s>=1.9&&s<=2.1?"Good":s>=2.2&&s<=2.4?"Average":s>=2.5&&s<=2.7?"Satisfactory":s>=2.8&&s<=3?"Fair":s>3&&s<=3.5?"Conditional":s===5?"Failing":"",b=new URLSearchParams(window.location.search),C=b.get("student_id")||"",f=b.get("subject_id")||"",I=b.get("academic_level_id")||"",R=b.get("school_year")||"2024-2025",V=b.get("grading_period_id")||(j==null?void 0:j.toString())||"0";console.log("=== URL PARAMS EXTRACTION ==="),console.log("Full URL:",window.location.href),console.log("Search string:",window.location.search),console.log("Extracted params:",{initialStudentId:C,initialSubjectId:f,initialAcademicLevelId:I,initialSchoolYear:R,initialGradingPeriodId:V});const{data:a,setData:l,post:ae,processing:A,errors:t}=ie({student_id:C,subject_id:f,academic_level_id:I,grading_period_id:V,school_year:R,year_of_study:"",grade:""}),[M,te]=p.useState(!1),n=p.useMemo(()=>{console.log("=== Grading Period Filtering Logic Start ==="),console.log("Selected Subject ID:",a.subject_id),console.log("Selected Grading Period ID from Backend:",j),console.log("Selected Assignment ID:",T),console.log("Total Grading Periods Available:",g.length),console.log("Instructor Assignments:",o.length);const s=new Set;o.forEach(d=>{var i;(i=d.gradingPeriod)!=null&&i.id&&s.add(d.gradingPeriod.id)}),console.log("Assigned Grading Period IDs:",Array.from(s));const r=g.filter(d=>s.has(d.id));return console.log("Filtered to assigned periods only:",r.length),console.log("Assigned Periods:",r.map(d=>({id:d.id,name:d.name,full_name:d.full_name,code:d.code}))),r},[o,g,j,T]),G=p.useMemo(()=>{const s=new Set;return n.forEach(r=>{r.code.includes("_S1_")&&s.add("first"),r.code.includes("_S2_")&&s.add("second")}),console.log("Available semesters:",Array.from(s)),Array.from(s)},[n]),O=p.useMemo(()=>G.includes("first"),[G]),U=p.useMemo(()=>G.includes("second"),[G]);p.useEffect(()=>{var s;if(!M){if(C||f||I){console.log("=== FORM INITIALIZATION ==="),console.log("URL Params:",{initialStudentId:C,initialSubjectId:f,initialAcademicLevelId:I,initialSchoolYear:R,initialGradingPeriodId:V}),console.log("Selected Grading Period ID from Backend:",j),console.log("Selected Assignment ID from Backend:",T),console.log("Form Data After Init:",a),console.log("Assigned Subjects:",o.map(i=>{var q,W,z;return{assignmentId:i.id,subjectId:i.subject.id,subjectName:i.subject.name,gradingPeriodId:(q=i.gradingPeriod)==null?void 0:q.id,gradingPeriodName:((W=i.gradingPeriod)==null?void 0:W.full_name)||((z=i.gradingPeriod)==null?void 0:z.name)}}));const r=o.find(i=>i.subject.id.toString()===f);r?console.log("✓ Found matching subject:",r.subject.name):(console.error("✗ Subject not found in assignedSubjects! subject_id:",f),console.log("Available subject IDs:",o.map(i=>i.subject.id)));const d=window.location.pathname;window.history.replaceState({},"",d)}else h&&(console.log("=== FALLBACK TO SELECTED STUDENT PROP ==="),l("student_id",h.id.toString()),l("subject_id",((s=h.subjectId)==null?void 0:s.toString())||""),l("academic_level_id",h.academicLevelKey||""),l("school_year","2024-2025"),l("year_of_study",""),l("grade",""),console.log("Form data set from selectedStudent prop:",{student_id:h.id,subject_id:h.subjectId}));te(!0)}},[]);const de=s=>{if(!s)return null;for(const r of o)if(r.enrolled_students.find(i=>i.student.id.toString()===s))return{subjectId:r.subject.id,academicLevelId:r.academicLevel.id,academicLevelKey:r.academicLevel.key,schoolYear:r.school_year};return null},le=s=>{if(l("student_id",s),s){const r=de(s);r&&(l("subject_id",r.subjectId.toString()),l("academic_level_id",r.academicLevelId.toString()),l("school_year",r.schoolYear))}else l("subject_id",""),l("academic_level_id",""),l("grade","")},L=()=>"college",H=s=>{s.preventDefault(),console.log("Form submitted with data:",a),console.log("Has pre-selected student:",x),ae(route("instructor.grades.store"),{onSuccess:()=>{console.log("Grade created successfully")},onError:r=>{console.log("Grade creation failed:",r)}})},x=!!(a.student_id&&a.subject_id&&a.academic_level_id);return console.log("=== PRE-SELECTION CHECK ==="),console.log("student_id:",a.student_id),console.log("subject_id:",a.subject_id),console.log("academic_level_id:",a.academic_level_id),console.log("hasPreSelectedStudent:",x),console.log("Form data:",a),console.log("hasPreSelectedStudent:",x),console.log("Academic Levels:",D),console.log("=== Grading Period Dropdown Render ==="),console.log("Current grading_period_id value:",a.grading_period_id),console.log("Allowed Grading Periods:",n.length),console.log("Grading Periods:",g),console.log("Grading Periods Length:",g==null?void 0:g.length),console.log("Has First Semester Periods:",O),console.log("Has Second Semester Periods:",U),M?e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Q,{user:w}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(X,{user:w}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(B,{href:route("instructor.grades.index"),children:e.jsxs(v,{variant:"outline",size:"sm",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Back to Grades"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:x?"Input Grade":"Input New Grade"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:x?"Enter a grade for the selected student.":"Enter a new grade for a student in your assigned course."})]})]})}),e.jsxs(Z,{className:"max-w-2xl",children:[e.jsx(J,{children:e.jsxs(ee,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Grade Information"]})}),e.jsx(se,{children:x?e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Student Information"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Student:"}),e.jsx("p",{className:"font-medium",children:((K=(Y=o.find(s=>s.enrolled_students.some(r=>r.student.id.toString()===a.student_id)))==null?void 0:Y.enrolled_students.find(s=>s.student.id.toString()===a.student_id))==null?void 0:K.student.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Subject:"}),e.jsx("p",{className:"font-medium",children:(()=>{const s=o.find(r=>r.subject.id.toString()===a.subject_id);return console.log("Looking for subject_id:",a.subject_id,"Found:",s==null?void 0:s.subject.name),(s==null?void 0:s.subject.name)||"Unknown"})()})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Academic Level:"}),e.jsx("p",{className:"font-medium",children:(($=D.find(s=>s.id.toString()===a.academic_level_id))==null?void 0:$.name)||"College"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"School Year:"}),e.jsx("p",{className:"font-medium",children:a.school_year})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"grade",children:"Grade"}),e.jsx(P,{id:"grade",type:"number",step:"0.1",min:"1.0",max:"5.0",placeholder:"Valid: 1.0-3.5 or 5.0",value:a.grade,onChange:s=>{const r=s.target.value;if(l("grade",r),r&&L()==="college"){const d=parseFloat(r);console.log("[GRADE_INPUT] Grade changed:",{grade:d,percentage:u(d),quality:_(d)})}},className:t.grade?"border-red-500":"",autoFocus:!0}),t.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.grade}),a.grade&&L()==="college"&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-950 rounded-md border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:[u(parseFloat(a.grade))&&e.jsxs(e.Fragment,{children:[u(parseFloat(a.grade)),_(parseFloat(a.grade))&&` - ${_(parseFloat(a.grade))}`]}),!u(parseFloat(a.grade))&&e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Invalid grade (use 1.0-3.5 or 5.0)"})]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Valid grades: 1.0-3.5 (0.1 increments) or 5.0. 3.0 is passing (75%)."})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(S,{value:a.grading_period_id,onValueChange:s=>l("grading_period_id",s),children:[e.jsx(y,{className:t.grading_period_id?"border-red-500":"",children:e.jsx(N,{placeholder:"Select grading period"})}),e.jsxs(F,{children:[e.jsx(c,{value:"0",children:"No Period"}),n&&n.length>0?e.jsxs(e.Fragment,{children:[O&&e.jsxs(k,{children:[e.jsx(E,{children:"First Semester"}),n.filter(s=>s.code.startsWith("COL_S1_")&&!s.code.includes("_FA")).sort((s,r)=>s.sort_order-r.sort_order).map(s=>e.jsx(c,{value:s.id.toString(),children:s.name},s.id))]}),U&&e.jsxs(k,{children:[e.jsx(E,{children:"Second Semester"}),n.filter(s=>s.code.startsWith("COL_S2_")&&!s.code.includes("_FA")).sort((s,r)=>s.sort_order-r.sort_order).map(s=>e.jsx(c,{value:s.id.toString(),children:s.name},s.id))]})]}):e.jsx(c,{value:"debug",disabled:!0,children:a.subject_id?"No grading periods assigned to this subject":"Select a subject first"})]})]}),t.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.grading_period_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select which grading period this grade belongs to"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(v,{type:"submit",disabled:A,className:"flex-1",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),A?"Saving...":"Save Grade"]}),e.jsx(B,{href:route("instructor.grades.index"),className:"flex-1",children:e.jsx(v,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]}):e.jsxs("form",{onSubmit:H,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"student_id",children:"Student"}),e.jsxs(S,{value:a.student_id,onValueChange:le,children:[e.jsx(y,{className:t.student_id?"border-red-500":"",children:e.jsx(N,{placeholder:"Select a student"})}),e.jsx(F,{children:o.flatMap(s=>s.enrolled_students.map(r=>e.jsxs(c,{value:r.student.id.toString(),children:[r.student.name," - ",s.subject.name]},r.student.id)))})]}),t.student_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.student_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select a student from your assigned subjects"})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"subject_id",children:"Subject"}),e.jsxs(S,{value:a.subject_id,onValueChange:s=>l("subject_id",s),children:[e.jsx(y,{className:t.subject_id?"border-red-500":"",children:e.jsx(N,{placeholder:"Select a subject"})}),e.jsx(F,{children:o.map(s=>e.jsxs(c,{value:s.subject.id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.subject.id))})]}),t.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.subject_id})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"academic_level_id",children:"Academic Level"}),e.jsxs(S,{value:a.academic_level_id,onValueChange:s=>l("academic_level_id",s),children:[e.jsx(y,{className:t.academic_level_id?"border-red-500":"",children:e.jsx(N,{placeholder:"Select academic level"})}),e.jsx(F,{children:D.map(s=>e.jsx(c,{value:s.id.toString(),children:s.name},s.id))})]}),t.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(S,{value:a.grading_period_id,onValueChange:s=>l("grading_period_id",s),children:[e.jsx(y,{children:e.jsx(N,{placeholder:"Select grading period (optional)"})}),e.jsxs(F,{children:[e.jsx(c,{value:"0",children:"No Period"}),n&&n.length>0?e.jsxs(e.Fragment,{children:[O&&e.jsxs(k,{children:[e.jsx(E,{children:"First Semester"}),n.filter(s=>s.code.startsWith("COL_S1_")&&!s.code.includes("_FA")).sort((s,r)=>s.sort_order-r.sort_order).map(s=>e.jsx(c,{value:s.id.toString(),children:s.name},s.id))]}),U&&e.jsxs(k,{children:[e.jsx(E,{children:"Second Semester"}),n.filter(s=>s.code.startsWith("COL_S2_")&&!s.code.includes("_FA")).sort((s,r)=>s.sort_order-r.sort_order).map(s=>e.jsx(c,{value:s.id.toString(),children:s.name},s.id))]})]}):e.jsx(c,{value:"debug",disabled:!0,children:a.subject_id?"No grading periods assigned to this subject":"Select a subject first"})]})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(m,{htmlFor:"school_year",children:"School Year"}),e.jsx(P,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:a.school_year,onChange:s=>l("school_year",s.target.value),className:t.school_year?"border-red-500":""}),t.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.school_year})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(P,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1, 2, 3, 4",value:a.year_of_study,onChange:s=>l("year_of_study",s.target.value),className:t.year_of_study?"border-red-500":""}),t.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.year_of_study}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Required for college level"})]})]}),e.jsxs("div",{children:[e.jsx(m,{htmlFor:"grade",children:"Grade"}),e.jsx(P,{id:"grade",type:"number",step:"0.1",min:"1.0",max:"5.0",placeholder:"Valid: 1.0-3.5 or 5.0",value:a.grade,onChange:s=>{const r=s.target.value;if(l("grade",r),r&&L()==="college"){const d=parseFloat(r);console.log("[GRADE_INPUT] Grade changed:",{grade:d,percentage:u(d),quality:_(d)})}},className:t.grade?"border-red-500":""}),t.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.grade}),a.grade&&L()==="college"&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-950 rounded-md border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:[u(parseFloat(a.grade))&&e.jsxs(e.Fragment,{children:[u(parseFloat(a.grade)),_(parseFloat(a.grade))&&` - ${_(parseFloat(a.grade))}`]}),!u(parseFloat(a.grade))&&e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Invalid grade (use 1.0-3.5 or 5.0)"})]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Valid grades: 1.0-3.5 (0.1 increments) or 5.0. 3.0 is passing (75%)."})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(v,{type:"submit",disabled:A,className:"flex-1",children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),A?"Saving...":"Save Grade"]}),e.jsx(B,{href:route("instructor.grades.index"),className:"flex-1",children:e.jsx(v,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]})})]}),e.jsxs(Z,{children:[e.jsx(J,{children:e.jsx(ee,{children:"Help & Guidelines"})}),e.jsx(se,{children:e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Student:"})," Select a student from your assigned subjects"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Subject:"})," Automatically populated when student is selected"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Grade Scale:"})," College uses 1.0-5.0 scale (1.0 highest, 5.0 lowest, 3.0 passing equivalent to 75%)"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Validation:"})," Grades are automatically submitted for validation after saving"]}),e.jsxs("p",{children:["• ",e.jsx("strong",{children:"Editing:"})," You can edit grades before they are validated by the registrar"]})]})})]})]})})]})]}):e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Q,{user:w}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(X,{user:w}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Loading form..."})]})})})]})]})}export{ke as default};
