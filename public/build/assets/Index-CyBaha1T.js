import{r as c,j as e,$ as L,X as te,S as se}from"./app-DiT6tx-7.js";import{S as le,H as de}from"./sidebar-H-asXK5E.js";import{C as T,b as $,c as z,a as H}from"./card-BxOKbS7d.js";import{B as x}from"./button-B6Dyd-Cf.js";import{B as C}from"./badge-DBfAb0pD.js";import{I as A}from"./input-BjFwA1HT.js";import{D as ie,b as oe,c as ne,d as ce}from"./dialog-C359LJf-.js";import{A as me,a as xe}from"./alert-DfnAIkDx.js";import{S as ge}from"./search-D94OAPRn.js";import{P as U}from"./plus-DDURtmm3.js";import{U as ue}from"./upload-D7eV7nxA.js";import{S as q}from"./square-pen-BT1Sugtf.js";import{S as he}from"./save-B2wTf-Tw.js";/* empty css            */import"./dropdown-menu-DmiDltBs.js";import"./Combination-ChCyZElm.js";import"./index-BPUJh7Lt.js";import"./chevron-down-Y82qWR2A.js";import"./user-WP8lcBkp.js";import"./log-out-BMzskIK0.js";import"./book-open-sYCuQjBM.js";import"./graduation-cap-Bo8_b7cO.js";import"./crown-DhmNohoE.js";function $e({user:k,grades:f,assignedSubjects:d}){var I;const[j,J]=c.useState(""),[o,X]=c.useState(""),[fe,je]=c.useState(!1),[ye,pe]=c.useState(null),[K,y]=c.useState(null),[p,g]=c.useState(""),[E,u]=c.useState(""),[Q,b]=c.useState(null),[F,w]=c.useState(!1),[S,h]=c.useState(!1),[D,m]=c.useState("");if(console.log("GradesIndex props:",{user:k,grades:f,assignedSubjects:d}),console.log("assignedSubjects type:",typeof d),console.log("assignedSubjects is array:",Array.isArray(d)),console.log("assignedSubjects length:",d==null?void 0:d.length),!d||!Array.isArray(d))return console.log("Safety check failed - showing loading state"),e.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects."}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(d)]})]})})});const W=(r,t)=>t==="college"?r<=1.5?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":r<=2.5?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":r<=3?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":r>=90?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":r>=80?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":r>=75?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",G=(r,t)=>r===0?"No Grade":t==="college"?r<=1.5?"Superior":r<=2?"Very Good":r<=2.5?"Good":r<=3?"Satisfactory":"Failing":r>=95?"Outstanding":r>=90?"Very Good":r>=85?"Good":r>=80?"Satisfactory":r>=75?"Fair":"Failing",Z=r=>{if(!r||!d||!Array.isArray(d))return[];console.log("Getting students for subject ID:",r);const t=d.filter(l=>{var i,n;return((n=(i=l.subject)==null?void 0:i.id)==null?void 0:n.toString())===r});if(console.log("Found assignments:",t.length),t.length===0)return[];const s=new Map;t.forEach(l=>{l.enrolled_students&&l.enrolled_students.forEach(i=>{var O,Y,V,B;const n=i.student.id;if(!s.has(n)){const M=((O=f==null?void 0:f.data)==null?void 0:O.filter(R=>R.student.id===n&&R.subject.id.toString()===r))||[],v=M.length>0?M[0]:null;s.set(n,{id:i.student.id,name:i.student.name,email:i.student.email,student_number:i.student.student_number,latestGrade:v?v.grade:0,latestGradeDate:v?v.updated_at:"",academicLevel:{key:((Y=l.academicLevel)==null?void 0:Y.key)||"",name:((V=l.academicLevel)==null?void 0:V.name)||""},gradingPeriod:l.gradingPeriod?{name:l.gradingPeriod.name}:void 0,schoolYear:i.school_year,enrolledInPeriods:[]})}const N=s.get(n);(B=l.gradingPeriod)!=null&&B.name&&N.enrolledInPeriods.push(l.gradingPeriod.full_name||l.gradingPeriod.name)})});const a=Array.from(s.values());return console.log("Returning students:",a.length),a},P=c.useMemo(()=>{if(!d||!Array.isArray(d))return console.log("No assignedSubjects available"),[];console.log("Processing assignments for grouping:",d);const r=d.reduce((s,a)=>{var i,n,N;if(!((i=a==null?void 0:a.subject)!=null&&i.id)||!((n=a==null?void 0:a.subject)!=null&&n.name)||!((N=a==null?void 0:a.academicLevel)!=null&&N.name))return console.log("Skipping assignment - missing required structure:",a),s;const l=a.subject.id;return s[l]||(s[l]={subject:a.subject,academicLevel:a.academicLevel,schoolYear:a.school_year,assignments:[]}),s[l].assignments.push({assignmentId:a.id,gradingPeriodId:a.grading_period_id,gradingPeriod:a.gradingPeriod||null,sectionId:a.section_id,enrolledStudents:a.enrolled_students||[]}),s},{}),t=Object.values(r).map(s=>{const a=s.assignments.map(l=>{var i,n;return((i=l.gradingPeriod)==null?void 0:i.full_name)||((n=l.gradingPeriod)==null?void 0:n.name)}).filter(l=>!!l);return{id:s.subject.id.toString(),name:s.subject.name,code:s.subject.code||"N/A",academicLevel:s.academicLevel.name,schoolYear:s.schoolYear||"N/A",gradingPeriods:a.length>0?a.join(", "):"No Period",assignments:s.assignments}});return console.log("Grouped available subjects:",t),t},[d]),ee=r=>{var s;if(!o||!d)return;const t=d.filter(a=>a.subject.id.toString()===o);if(t.length===0){console.error("No subject assignment found for selectedSubject:",o);return}if(t.length===1){const a=t[0];y(r.id),g(r.latestGrade>0?r.latestGrade.toString():""),u(""),b(((s=a.gradingPeriod)==null?void 0:s.id)||null),m("")}else console.log("Multiple assignments found, showing period selector for edit"),window.__pendingGradeStudent=r,w(!0)},re=async r=>{var a;if(!o||!d||!p){m("Please enter a grade.");return}const t=parseFloat(p);if(isNaN(t)){m("Please enter a valid number.");return}if(r.academicLevel.key==="college"){if(t<1||t>5){m("College grades must be between 1.0 and 5.0");return}}else if(t<0||t>100){m("Grades must be between 0 and 100");return}h(!0),m("");const s=d.find(l=>{var i;return l.subject.id.toString()===o&&((i=l.gradingPeriod)==null?void 0:i.id)===Q});if(!s){m("Assignment not found."),h(!1);return}try{await se.post(route("instructor.grades.store"),{student_id:r.id,subject_id:s.subject.id,assignment_id:s.id,academic_level_id:s.academicLevel.id,grading_period_id:((a=s.gradingPeriod)==null?void 0:a.id)||null,school_year:s.school_year,grade:t,remarks:E||null},{preserveScroll:!0,onSuccess:()=>{y(null),g(""),u(""),b(null),h(!1)},onError:l=>{m(Object.values(l).join(", ")),h(!1)}})}catch{m("Failed to save grade. Please try again."),h(!1)}},ae=()=>{y(null),g(""),u(""),b(null),m("")},_=o?Z(o).filter(r=>r.name.toLowerCase().includes(j.toLowerCase())||r.email.toLowerCase().includes(j.toLowerCase())):[];return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(le,{user:k}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(de,{user:k}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Grade Management"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"View and manage student grades for your assigned subjects."})]}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center",children:e.jsxs("div",{className:"relative",children:[e.jsx(ge,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-gray-400"}),e.jsx(A,{placeholder:"Search students or subjects...",value:j,onChange:r=>J(r.target.value),className:"pl-10 w-full sm:w-64"})]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{href:route("instructor.grades.create"),className:o?"":"pointer-events-none",children:e.jsxs(x,{className:"flex items-center gap-2",disabled:!o,children:[e.jsx(U,{className:"h-4 w-4"}),"Input Grade"]})}),e.jsx(L,{href:route("instructor.grades.upload"),children:e.jsxs(x,{variant:"outline",className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"Upload CSV"]})})]})]}),e.jsxs(T,{children:[e.jsxs($,{children:[e.jsx(z,{className:"text-lg",children:"Select Subject"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Choose a subject to view and manage student grades"})]}),e.jsx(H,{children:P.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:P.map(r=>e.jsx("div",{className:`p-4 border rounded-lg cursor-pointer transition-colors ${o===r.id?"border-blue-500 bg-blue-50 dark:bg-blue-900/20":"border-gray-200 hover:border-gray-300 hover:bg-gray-50 dark:border-gray-700 dark:hover:border-gray-600 dark:hover:bg-gray-800/50"}`,onClick:()=>X(o===r.id?"":r.id),children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.code}),e.jsxs("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:[r.academicLevel," â€¢ SY ",r.schoolYear," â€¢ ",r.gradingPeriods]})]}),e.jsx("div",{className:`w-3 h-3 rounded-full ${o===r.id?"bg-blue-500":"bg-gray-300 dark:bg-gray-600"}`})]})},r.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Subjects Assigned"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"You haven't been assigned to any subjects yet."})]})})]}),o&&e.jsxs(T,{children:[e.jsx($,{children:e.jsxs(z,{className:"flex items-center justify-between",children:[e.jsxs("span",{children:["Student Grades - ",(I=P.find(r=>r.id===o))==null?void 0:I.name]}),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[_.length," students"]})]})}),e.jsx(H,{children:_.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3 font-medium",children:"Student"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Latest Grade"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Status"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Last Updated"}),e.jsx("th",{className:"text-left p-3 font-medium",children:"Actions"})]})}),e.jsx("tbody",{children:_.map(r=>K===r.id?e.jsx("tr",{className:"border-b bg-blue-50 dark:bg-blue-900/20",children:e.jsx("td",{className:"p-3",colSpan:5,children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.email})]}),e.jsxs(C,{className:"bg-blue-500 text-white",children:[e.jsx(q,{className:"h-3 w-3 mr-1"}),"Editing"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Grade ",r.academicLevel.key==="college"?"(1.0 - 5.0)":"(0 - 100)"]}),e.jsx(A,{type:"number",step:r.academicLevel.key==="college"?"0.25":"1",min:r.academicLevel.key==="college"?"1.0":"0",max:r.academicLevel.key==="college"?"5.0":"100",value:p,onChange:t=>g(t.target.value),placeholder:r.academicLevel.key==="college"?"e.g., 1.75":"e.g., 85",className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Remarks (Optional)"}),e.jsx(A,{type:"text",value:E,onChange:t=>u(t.target.value),placeholder:"e.g., Excellent work",className:"w-full"})]})]}),D&&e.jsx(me,{variant:"destructive",children:e.jsx(xe,{children:D})}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsxs(x,{variant:"outline",size:"sm",onClick:ae,disabled:S,children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Cancel"]}),e.jsxs(x,{size:"sm",onClick:()=>re(r),disabled:S||!p,children:[e.jsx(he,{className:"h-4 w-4 mr-2"}),S?"Saving...":"Save Grade"]})]})]})})},r.id):e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"p-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 dark:text-gray-100",children:r.name}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:r.email})]})}),e.jsx("td",{className:"p-3",children:r.latestGrade===0?e.jsx(C,{variant:"outline",className:"text-gray-500",children:"No Grade"}):e.jsx(C,{className:W(r.latestGrade,r.academicLevel.key),children:r.latestGrade})}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`text-sm ${G(r.latestGrade,r.academicLevel.key)==="No Grade"?"text-gray-600 dark:text-gray-400":["Superior","Very Good","Good","Satisfactory","Fair","Outstanding"].includes(G(r.latestGrade,r.academicLevel.key))?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:G(r.latestGrade,r.academicLevel.key)})}),e.jsx("td",{className:"p-3 text-sm text-gray-600 dark:text-gray-400",children:r.latestGradeDate?new Date(r.latestGradeDate).toLocaleDateString():"N/A"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(L,{href:route("instructor.grades.show-student",[r.id,o]),children:e.jsxs(x,{variant:"outline",size:"sm",onClick:t=>t.stopPropagation(),children:[e.jsx(q,{className:"h-4 w-4 mr-2"}),"View Details"]})}),e.jsxs(x,{size:"sm",onClick:t=>{t.stopPropagation(),ee(r)},children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Input Grade"]})]})})]},r.id))})]})}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ‘¥"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"No Students Found"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:j?"No students match your search criteria.":"No students are enrolled in this subject."})]})})]})]})})]}),F&&o&&d&&e.jsx(ie,{open:F,onOpenChange:w,children:e.jsxs(oe,{className:"sm:max-w-md",children:[e.jsxs(ne,{children:[e.jsx(ce,{children:"Select Grading Period"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"This subject has multiple grading periods. Please select which period you want to input grades for."})]}),e.jsx("div",{className:"space-y-2 mt-4",children:d.filter(r=>r.subject.id.toString()===o).map(r=>{var t,s;return e.jsx(x,{onClick:()=>{var l;const a=window.__pendingGradeStudent;a&&(y(a.id),g(a.latestGrade>0?a.latestGrade.toString():""),u(""),b(((l=r.gradingPeriod)==null?void 0:l.id)||null),m("")),w(!1),delete window.__pendingGradeStudent},variant:"outline",className:"w-full justify-start h-auto py-4 px-4",children:e.jsxs("div",{className:"flex flex-col items-start text-left",children:[e.jsx("span",{className:"font-medium",children:((t=r.gradingPeriod)==null?void 0:t.full_name)||((s=r.gradingPeriod)==null?void 0:s.name)||"No Period Assigned"}),e.jsxs("span",{className:"text-xs text-muted-foreground mt-1",children:[r.school_year," â€¢ ",r.subject.code]})]})},r.id)})})]})})]})}export{$e as default};
