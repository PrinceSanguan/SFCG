import{r as N,K as pe,m as b,j as e,S as k}from"./app-BRLfWJeb.js";import{H as ge}from"./header-OBpoW612.js";import{S as je}from"./sidebar-Cp9g303Q.js";import{C as S,a as w,b as fe,c as ye}from"./card-Cmoof86j.js";import{B as u}from"./button-CEOBxFAI.js";import{S as O,a as U,b as q,c as J,d as B}from"./select-DGslzcj5.js";import{T as ve,a as _e,b as K,c as x,d as Ne,e as h}from"./table-CzgJb4aK.js";import{D as be,a as ke,b as Se,c as G,d as we}from"./dropdown-menu-BeVjX3NF.js";import{B as C}from"./badge-BBpa_TNv.js";import{A as Q}from"./arrow-left-CNYsEfBW.js";import{S as Ce}from"./school-CQEhN8rR.js";import{B as De}from"./book-open-BTFbegHE.js";import{G as Te}from"./graduation-cap-CYPu5cnH.js";import{U as Be}from"./users-Bof5_ecw.js";import{F as A}from"./file-text-DVIi9L9M.js";import{E as Ge,P as Ae}from"./printer-CpoQDGQj.js";import{D as E}from"./download-BhgS4dBS.js";/* empty css            */import"./separator-BXjMXe_G.js";import"./index-DUsJDyDI.js";import"./chevron-down-BXpWMyEI.js";import"./chevron-right-CiIHA5wU.js";import"./crown-BcrxSINL.js";import"./building-2-D2kWXtLl.js";import"./user-cog-C2j7gNbL.js";import"./user-plus-l4TJpKEP.js";import"./user-check-7KpmJeQj.js";import"./notebook-mYY2S1nJ.js";import"./chart-no-axes-column-increasing-C18feIPj.js";import"./shield-MDuRInVn.js";import"./Combination-4HCHszUy.js";import"./index-J7AfzdMz.js";import"./index-CHBEpL2t.js";import"./check-B-PMj0Mh.js";const H=[{key:"elementary",name:"Elementary",icon:Ce,color:"bg-blue-500 hover:bg-blue-600",iconColor:"text-blue-600"},{key:"junior_highschool",name:"Junior High School",icon:De,color:"bg-green-500 hover:bg-green-600",iconColor:"text-green-600"},{key:"senior_highschool",name:"Senior High School",icon:Te,color:"bg-orange-500 hover:bg-orange-600",iconColor:"text-orange-600"},{key:"college",name:"College",icon:Be,color:"bg-purple-500 hover:bg-purple-600",iconColor:"text-purple-600"}];function ps({user:P,academicLevels:f,templates:W,allHonors:y=[],generatedCertificates:r=[],schoolYears:v,currentSchoolYear:X}){var L,V,z;const[d,M]=N.useState(null),[o,Z]=N.useState(X||(v==null?void 0:v[0])||"2024-2025"),[p,I]=N.useState(""),[m,_]=N.useState([]),{props:Y}=pe(),ee=Y.csrf_token||((L=document.querySelector('meta[name="csrf-token"]'))==null?void 0:L.content)||"",{setData:se,post:te,processing:le}=b({student_id:"",template_id:"",academic_level_id:"",school_year:o}),{setData:ae,post:ne,processing:F}=b({student_ids:[],template_id:"",academic_level_id:"",school_year:o}),{setData:Ee,post:He,processing:R}=b({certificate_ids:[]}),{setData:ie,post:ce,processing:$}=b({academic_level_id:"",school_year:o,honor_type_id:""}),re=()=>{const t=D(d||"").filter(l=>m.includes(l.student.id)).map(l=>{const i=r==null?void 0:r.find(T=>T.student.id===l.student.id&&T.academic_level.id===l.academic_level.id&&T.school_year===l.school_year);return i==null?void 0:i.id}).filter(l=>l!==void 0);if(t.length===0){alert("No certificates found for selected students. Please generate certificates first.");return}let a=document.getElementById("download-iframe");a||(a=document.createElement("iframe"),a.id="download-iframe",a.name="download-iframe",a.style.display="none",document.body.appendChild(a));const c=document.createElement("form");c.method="POST",c.action=route("admin.academic.certificates.bulk-print-pdf"),c.target="download-iframe";const n=document.createElement("input");n.type="hidden",n.name="_token",n.value=ee,c.appendChild(n),t.forEach(l=>{const i=document.createElement("input");i.type="hidden",i.name="certificate_ids[]",i.value=l.toString(),c.appendChild(i)}),document.body.appendChild(c),c.submit(),document.body.removeChild(c)},D=s=>y.length?y.filter(t=>t&&t.academic_level&&t.academic_level.key===s&&t.school_year===o).sort((t,a)=>t.year_level!==a.year_level?(t.year_level||"").localeCompare(a.year_level||""):t.section_id!==a.section_id?(t.section_id||0)-(a.section_id||0):s==="college"?(t.gpa||0)-(a.gpa||0):(a.gpa||0)-(t.gpa||0)):[],de=s=>{const t=f.find(a=>a.key===s);return t?W.filter(a=>a.academic_level_id===t.id&&a.is_active):[]},oe=s=>{se({student_id:s.student.id.toString(),template_id:p,academic_level_id:s.academic_level.id.toString(),school_year:o}),te(route("admin.academic.certificates.generate"),{onSuccess:()=>{k.reload()}})},me=()=>{if(m.length===0||!p)return;const s=f.find(t=>t.key===d);s&&(ae({student_ids:m,template_id:p,academic_level_id:s.id.toString(),school_year:o}),ne(route("admin.academic.certificates.generate-bulk"),{onSuccess:()=>{_([]),k.reload()}}))},xe=s=>{_(t=>t.includes(s)?t.filter(a=>a!==s):[...t,s])},he=()=>{const t=D(d).map(a=>a.student.id);_(m.length===t.length?[]:t)},ue=()=>{const s=f.find(t=>t.key===d);s&&(ie({academic_level_id:s.id.toString(),school_year:o,honor_type_id:""}),ce(route("admin.academic.certificates.bulk-generate-by-level"),{onSuccess:()=>{k.reload()}}))},g=d?D(d):[],j=d?de(d):[];return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(je,{user:P}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(ge,{user:P}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>k.get("/admin/academic"),children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Back to Academic"]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Certificate Management"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Generate and manage honor certificates by academic level."})]}),e.jsx(S,{children:e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"School Year:"}),e.jsxs(O,{value:o,onValueChange:Z,children:[e.jsx(U,{className:"w-40",children:e.jsx(q,{})}),e.jsx(J,{children:v.map(s=>e.jsx(B,{value:s,children:s},s))})]})]})})}),d?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(u,{variant:"outline",onClick:()=>{M(null),_([]),I("")},children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Back to Categories"]}),e.jsxs("h2",{className:"text-2xl font-bold",children:[(V=H.find(s=>s.key===d))==null?void 0:V.name," Honor Students"]}),e.jsxs(C,{variant:"outline",children:[g.length," students"]})]})}),e.jsxs(S,{children:[e.jsx(fe,{children:e.jsx(ye,{children:"Certificate Generation"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Select Certificate Template",j.length===0&&e.jsx("span",{className:"ml-2 text-xs text-red-600 font-normal",children:"(No templates - Run: php artisan db:seed --class=CertificateTemplateSeeder)"})]}),e.jsxs(O,{value:p,onValueChange:I,children:[e.jsx(U,{className:j.length===0?"border-red-300":"",children:e.jsx(q,{placeholder:j.length>0?"Choose a template...":"⚠️ No templates available - seed database first"})}),e.jsx(J,{children:j.length>0?j.map(s=>e.jsx(B,{value:s.id.toString(),children:s.name},s.id)):e.jsx(B,{value:"none",disabled:!0,children:"No templates available - run CertificateTemplateSeeder"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{onClick:ue,disabled:g.length===0||$,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),$?"Generating All...":"Generate All Missing Certificates"]}),e.jsxs(be,{children:[e.jsx(ke,{asChild:!0,children:e.jsxs(u,{variant:"outline",children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),"More Actions"]})}),e.jsxs(Se,{align:"end",className:"w-56",children:[e.jsxs(G,{onClick:me,disabled:m.length===0||!p||F,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),F?"Generating...":`Generate ${m.length} Selected`]}),e.jsxs(G,{onClick:re,disabled:m.length===0||R,children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),R?"Preparing...":`Download ${m.length} Selected`]}),e.jsx(we,{}),e.jsxs(G,{onClick:()=>{var s;return window.open(`/admin/academic/certificates/honor-roll/pdf?academic_level_id=${(s=f.find(t=>t.key===d))==null?void 0:s.id}&school_year=${o}`,"_blank")},children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Honor Roll PDF"]})]})]})]})]})})]}),e.jsx(S,{children:e.jsx(w,{children:g.length>0?e.jsxs(ve,{children:[e.jsx(_e,{children:e.jsxs(K,{children:[e.jsx(x,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:m.length===g.length&&g.length>0,onChange:he})}),e.jsx(x,{children:"Rank"}),e.jsx(x,{children:"Student Name"}),e.jsx(x,{children:"Student Number"}),e.jsx(x,{children:"Year Level"}),e.jsx(x,{children:"Section"}),e.jsx(x,{children:"Honor Type"}),e.jsx(x,{children:"GPA"}),e.jsx(x,{children:"Certificate"}),e.jsx(x,{children:"Actions"})]})}),e.jsx(Ne,{children:g.map((s,t)=>{var a,c;return!s||!s.student?null:e.jsxs(K,{children:[e.jsx(h,{children:e.jsx("input",{type:"checkbox",checked:m.includes(s.student.id),onChange:()=>xe(s.student.id)})}),e.jsxs(h,{className:"font-medium",children:["#",t+1]}),e.jsx(h,{className:"font-medium",children:s.student.name}),e.jsx(h,{children:s.student.student_number||"N/A"}),e.jsx(h,{children:s.year_level||s.student.year_level||"N/A"}),e.jsx(h,{children:((a=s.student.section)==null?void 0:a.name)||"N/A"}),e.jsx(h,{children:e.jsx(C,{variant:"secondary",children:((c=s.honor_type)==null?void 0:c.name)||"Unknown Honor"})}),e.jsx(h,{className:"font-mono",children:s.gpa?s.gpa.toFixed(2):"N/A"}),e.jsx(h,{children:(()=>{const n=r==null?void 0:r.find(l=>l.student.id===s.student.id&&l.academic_level.id===s.academic_level.id&&l.school_year===s.school_year);return n?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{variant:"default",className:"text-xs",children:"Generated"}),e.jsx("span",{className:"text-xs text-gray-500",children:n.serial_number})]}):e.jsx(C,{variant:"outline",className:"text-xs",children:"Pending"})})()}),e.jsx(h,{children:e.jsx("div",{className:"flex gap-1",children:(()=>{const n=r==null?void 0:r.find(l=>l.student.id===s.student.id&&l.academic_level.id===s.academic_level.id&&l.school_year===s.school_year);return n?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:"sm",variant:"outline",onClick:()=>window.open(route("admin.academic.certificates.download",n.id),"_blank"),className:"h-8 px-2",children:e.jsx(E,{className:"h-3 w-3"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>window.open(route("admin.academic.certificates.print",n.id),"_blank"),className:"h-8 px-2",children:e.jsx(Ae,{className:"h-3 w-3"})})]}):e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>oe(s),disabled:!p||le,className:"h-8 px-2",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"Generate"]})})()})})]},s.id||t)})})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Honor Students Found"}),e.jsxs("p",{className:"text-sm",children:["No approved honor students for ",(z=H.find(s=>s.key===d))==null?void 0:z.name," in ",o,"."]})]})})})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:H.map(s=>{const t=s.icon,a=y.filter(n=>{var l;return((l=n==null?void 0:n.academic_level)==null?void 0:l.key)===s.key&&n.school_year===o}).length,c=y.filter(l=>{var i;return((i=l==null?void 0:l.academic_level)==null?void 0:i.key)===s.key&&l.school_year===o}).filter(l=>r==null?void 0:r.some(i=>i.student.id===l.student.id&&i.academic_level.id===l.academic_level.id&&i.school_year===l.school_year)).length;return e.jsx(S,{className:"cursor-pointer transition-all hover:shadow-lg",onClick:()=>M(s.key),children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"p-4 rounded-full bg-gray-100",children:e.jsx(t,{className:`h-8 w-8 ${s.iconColor}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[a," honor students"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[c," certificates generated"]})]}),e.jsx(u,{className:`w-full ${s.color} text-white`,children:"View Students"})]})})},s.key)})})})]})})]})]})}export{ps as default};
