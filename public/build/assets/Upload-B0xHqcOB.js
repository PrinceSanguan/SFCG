import{r as u,m as Y,j as e,$ as K,d as z,C as J}from"./app-DIHDD7mr.js";import{C as N,b as S,c as w,a as C}from"./card-XbPS2Ur9.js";import{B as j}from"./button-Q6tffTke.js";import{I as f}from"./input-ae-hxt4W.js";import{L as n}from"./label-iYK_HqFM.js";import{S as k,a as F,b as T,c as D,d as V}from"./select-5jjDwFKu.js";import{C as q}from"./checkbox-CrAeVKy1.js";import{A as U,a as A}from"./alert-DqzIfJJP.js";import{S as Q,H as W}from"./sidebar-BKVNlZ4t.js";import{U as G}from"./upload-CpUUHVXS.js";import{F as X}from"./file-text-ClZ35NvK.js";import{D as I}from"./download-Cy7nKDod.js";/* empty css            */import"./index-Bx5jFb8X.js";import"./Combination-k4LP4wBr.js";import"./index-B-y6tAZt.js";import"./index-B5ThWfeP.js";import"./check-B0di2NRW.js";import"./dropdown-menu-BQptttYV.js";import"./user-BAwkapOh.js";import"./log-out-CScnyd1_.js";import"./book-open-Ba3f7ezJ.js";import"./graduation-cap-Dqu3RufD.js";import"./crown-CuB4Ntdr.js";function Ne({user:y,assignedSubjects:m,academicLevels:o,gradingPeriods:x}){const p=u.useRef(null),[c,b]=u.useState(null),[v,h]=u.useState(0),[g,_]=u.useState(!1),{data:a,setData:d,post:P,processing:$,errors:l,reset:E}=Y({csv_file:null,subject_id:"",academic_level_id:"",grading_period_ids:[],school_year:"",year_of_study:""});if(!m||!Array.isArray(m)||!o||!Array.isArray(o)||!x||!Array.isArray(x))return e.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects and academic data."}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(m)]})]})})});const R=s=>{var t;const r=(t=s.target.files)==null?void 0:t[0];r&&(b(r),d("csv_file",r))},B=s=>{var t;const r=m.find(i=>i.subject.id.toString()===s);if(r){console.log("Subject selected:",{subjectId:s,subject:r.subject.name,academicLevel:r.academicLevel.name,gradingPeriod:((t=r.gradingPeriod)==null?void 0:t.name)||"None",schoolYear:r.school_year}),d({...a,subject_id:s,academic_level_id:r.academicLevel.id.toString(),school_year:r.school_year,grading_period_ids:[]});const i=x.filter(O=>O.academic_level_id.toString()===r.academicLevel.id.toString());console.log("Available grading periods for academic level:",i)}else d("subject_id",s)},M=s=>{if(s.preventDefault(),!c)return;_(!0),h(0);const r=new FormData;r.append("csv_file",c),r.append("subject_id",a.subject_id),r.append("academic_level_id",a.academic_level_id),r.append("school_year",a.school_year),r.append("year_of_study",a.year_of_study||""),a.grading_period_ids.forEach(i=>{r.append("grading_period_ids[]",i)});const t=setInterval(()=>{h(i=>i>=90?(clearInterval(t),90):i+10)},200);P(route("teacher.grades.upload.store"),r,{forceFormData:!0,onSuccess:()=>{h(100),setTimeout(()=>{_(!1),h(0),b(null),E(),p.current&&(p.current.value="")},1e3)},onError:()=>{_(!1),h(0)}})},H=()=>{var t;const s=a.academic_level_id&&((t=o.find(i=>i.id.toString()===a.academic_level_id))==null?void 0:t.key)||"senior_highschool",r=route("teacher.grades.template")+"?academic_level="+s;console.log("Downloading CSV template for academic level:",s),window.open(r,"_blank")},L=()=>{if(!a.subject_id||!a.school_year){alert("Please select a subject and enter school year first");return}const s=route("teacher.grades.subject-template")+`?subject_id=${a.subject_id}&school_year=${encodeURIComponent(a.school_year)}`;window.open(s,"_blank")};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Q,{user:y}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(W,{user:y}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Grades CSV"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Bulk upload student grades using a CSV file"})]}),e.jsx(K,{href:route("teacher.grades.index"),children:e.jsx(j,{variant:"outline",children:"Back to Grades"})})]}),e.jsxs(N,{className:"max-w-2xl",children:[e.jsx(S,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Upload Grades CSV"]})}),e.jsx(C,{children:e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"csv_file",children:"CSV File"}),e.jsx("div",{className:"mt-2",children:e.jsx(f,{id:"csv_file",ref:p,type:"file",accept:".csv,.txt",onChange:R,className:"cursor-pointer",disabled:g})}),c&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(X,{className:"h-4 w-4"}),c.name," (",(c.size/1024).toFixed(1)," KB)"]}),l.csv_file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.csv_file})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"subject_id",children:"Subject *"}),e.jsxs(k,{value:a.subject_id,onValueChange:B,children:[e.jsx(F,{className:l.subject_id?"border-red-500":"",children:e.jsx(T,{placeholder:"Select a subject"})}),e.jsx(D,{children:m.map(s=>e.jsxs(V,{value:s.subject.id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.id))})]}),l.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.subject_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"academic_level_id",children:"Academic Level *"}),e.jsxs(k,{value:a.academic_level_id,onValueChange:s=>d({...a,academic_level_id:s,grading_period_ids:[]}),children:[e.jsx(F,{className:l.academic_level_id?"border-red-500":"",children:e.jsx(T,{placeholder:"Select academic level"})}),e.jsx(D,{children:o.map(s=>e.jsx(V,{value:s.id.toString(),children:s.name},s.id))})]}),l.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.academic_level_id})]}),e.jsxs("div",{children:[e.jsxs(n,{children:["Grading Periods ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mb-2",children:"Select one or more grading periods to apply these grades to."}),!a.academic_level_id&&e.jsx("p",{className:"text-sm text-gray-500 italic py-3 px-4 border rounded-lg",children:"Please select an academic level first"}),a.academic_level_id&&e.jsxs("div",{className:"space-y-2 border rounded-lg p-3 max-h-48 overflow-y-auto bg-white dark:bg-gray-800",children:[x.filter(s=>{var t;if(((t=s.academic_level_id)==null?void 0:t.toString())!==a.academic_level_id)return!1;const r=o.find(i=>i.id.toString()===a.academic_level_id);return(r==null?void 0:r.key)==="senior_highschool"?!s.parent_id:!0}).map(s=>e.jsxs("div",{className:"flex items-center space-x-2 hover:bg-gray-50 dark:hover:bg-gray-700 p-2 rounded",children:[e.jsx(q,{id:`period-${s.id}`,checked:a.grading_period_ids.includes(s.id.toString()),onCheckedChange:r=>{r?d("grading_period_ids",[...a.grading_period_ids,s.id.toString()]):d("grading_period_ids",a.grading_period_ids.filter(t=>t!==s.id.toString()))}}),e.jsx(n,{htmlFor:`period-${s.id}`,className:"cursor-pointer font-normal flex-1",children:s.name})]},s.id)),x.filter(s=>{var t;if(((t=s.academic_level_id)==null?void 0:t.toString())!==a.academic_level_id)return!1;const r=o.find(i=>i.id.toString()===a.academic_level_id);return(r==null?void 0:r.key)==="senior_highschool"?!s.parent_id:!0}).length===0&&e.jsx("p",{className:"text-sm text-gray-500 italic",children:"No grading periods available for this academic level"})]}),a.grading_period_ids.length>0&&e.jsxs("p",{className:"text-sm text-blue-600 dark:text-blue-400 mt-2",children:["âœ“ ",a.grading_period_ids.length," grading period",a.grading_period_ids.length>1?"s":""," selected"]}),a.grading_period_ids.length===0&&a.academic_level_id&&e.jsx("p",{className:"text-sm text-amber-600 dark:text-amber-400 mt-2",children:"âš ï¸ Please select at least one grading period"}),l.grading_period_ids&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.grading_period_ids})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"school_year",children:"School Year *"}),e.jsx(f,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:a.school_year,onChange:s=>d("school_year",s.target.value),className:l.school_year?"border-red-500":""}),l.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.school_year})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(f,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1",value:a.year_of_study,onChange:s=>d("year_of_study",s.target.value),className:l.year_of_study?"border-red-500":""}),l.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:l.year_of_study})]}),e.jsxs(U,{children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs(A,{children:[e.jsx("strong",{children:"Grade System:"})," Teachers use 1.0-5.0 scale (1.0 highest, 3.0 passing)"]})]}),g&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Uploading... ",v,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${v}%`}})})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs(j,{type:"submit",disabled:$||g||!c||!a.subject_id||!a.academic_level_id||!a.school_year||a.grading_period_ids.length===0,className:"w-full",title:a.subject_id?a.academic_level_id?a.grading_period_ids.length===0?"Please select at least one grading period":a.school_year?c?"Upload grades from CSV":"Please select a CSV file":"Please enter school year":"Please select an academic level":"Please select a subject",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),g?"Uploading...":"Upload Grades"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs(j,{type:"button",variant:"outline",onClick:L,disabled:!a.subject_id||!a.school_year,className:"w-full",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Download Subject Template"]}),e.jsxs(j,{type:"button",variant:"outline",onClick:H,className:"w-full",children:[e.jsx(I,{className:"h-4 w-4 mr-2"}),"Multi-Subject Template"]})]}),a.subject_id&&a.school_year&&e.jsx("p",{className:"text-sm text-muted-foreground text-center",children:"Tip: Download the subject template to get a pre-filled CSV with your enrolled students!"})]})]})})]}),e.jsxs(N,{children:[e.jsx(S,{children:e.jsx(w,{children:"CSV Format Instructions"})}),e.jsxs(C,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2 text-green-600",children:"Subject-Specific Template (Recommended):"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 mb-3",children:[e.jsx("li",{children:"â€¢ Select a subject and school year above"}),e.jsx("li",{children:'â€¢ Click "Download Subject Template" to get a pre-filled CSV with enrolled students'}),e.jsxs("li",{children:["â€¢ Fill in ",e.jsx("strong",{children:"MIDTERM"})," and ",e.jsx("strong",{children:"FINAL TERM"})," grade columns (1.0-5.0 scale)"]}),e.jsx("li",{children:"â€¢ Upload the completed CSV"}),e.jsx("li",{children:"â€¢ The system will create separate grade entries for midterm and final periods"})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This format is perfect for uploading grades for a specific subject with all enrolled students already listed!"})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Multi-Subject CSV Format:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 mb-3",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Subject Code:"})," Subject code (e.g., MATH101, ENG102)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grading Period:"})," Period code (optional)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Use this format for uploading grades across multiple subjects in one file."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Single-Subject CSV Format:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 mb-3",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Simple 4-column format for uploading one grade per student. Subject and grading period must be selected in the form above."})]}),e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-3 rounded-lg",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Grade Values:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grading Scale:"})," 1.0 to 5.0 (1.0 = highest, 3.0 = passing)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Sample Grades:"})," 1.0, 1.25, 1.5, 1.75, 2.0, 2.25, 2.5, 2.75, 3.0, 4.0, 5.0"]})]})]})]}),e.jsxs(U,{children:[e.jsx(J,{className:"h-4 w-4 text-green-600"}),e.jsxs(A,{children:[e.jsx("strong",{children:"Tip:"})," The system will automatically detect the CSV format and process it accordingly. It will update existing grades or create new ones if they don't exist. Grades can be edited within 5 days of creation if not yet submitted for validation."]})]})]})]})]})})]})]})}export{Ne as default};
