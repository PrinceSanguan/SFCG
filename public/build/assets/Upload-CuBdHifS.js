import{r as h,m as K,j as e,$ as O,d as Y,C as q}from"./app-CEl-APsC.js";import{C as F,b as A,c as D,a as U}from"./card-B4q6Ame0.js";import{B as _}from"./button-CKIhprG8.js";import{I as y}from"./input-DKtQm51Y.js";import{L as c}from"./label-B8Lt35n1.js";import{S as f,a as v,b as N,c as b,d as j}from"./select-D0yo45hq.js";import{A as I,a as V}from"./alert-CDPauP51.js";import{S as z,H as J}from"./sidebar-Bueq1zrC.js";import{U as G}from"./upload-C1a3VLbX.js";import{F as M}from"./file-text-DVvQaVsL.js";import{D as Q}from"./download-CANAVn9y.js";/* empty css            */import"./index-DW57C5Ri.js";import"./Combination-DliHkq0c.js";import"./index-Bz9Cl0ZU.js";import"./index-DvXVcg-Y.js";import"./check-X2sMxzrC.js";import"./dropdown-menu-CAqDati1.js";import"./user-CDiIq-up.js";import"./log-out-8dJQvB83.js";import"./book-open-DKUAlxJf.js";import"./graduation-cap-DAO1Kdzj.js";import"./crown-DClj_1Oe.js";function ve({user:S,assignedSubjects:n,academicLevels:m,gradingPeriods:u}){const g=h.useRef(null),[i,C]=h.useState(null),[w,o]=h.useState(0),[x,p]=h.useState(!1),{data:l,setData:t,post:T,processing:B,errors:r,reset:E}=K({csv_file:null,subject_id:"",academic_level_id:"",grading_period_id:"",school_year:"",year_of_study:""});if(!n||!Array.isArray(n)||!m||!Array.isArray(m)||!u||!Array.isArray(u))return e.jsx("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“š"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2",children:"Loading..."}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"Please wait while we load your assigned subjects and academic data."}),e.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:["Debug: assignedSubjects = ",JSON.stringify(n)]})]})})});const H=s=>{var d;const a=(d=s.target.files)==null?void 0:d[0];a&&(C(a),t("csv_file",a))},L=s=>{t("subject_id",s);const a=n.find(d=>d.subject.id.toString()===s);a&&(t("academic_level_id",a.academicLevel.id.toString()),t("school_year",a.school_year),a.gradingPeriod&&t("grading_period_id",a.gradingPeriod.id.toString()))},P=s=>{if(s.preventDefault(),!i)return;p(!0),o(0);const a=new FormData;a.append("csv_file",i),a.append("subject_id",l.subject_id),a.append("academic_level_id",l.academic_level_id),a.append("grading_period_id",l.grading_period_id||""),a.append("school_year",l.school_year),a.append("year_of_study",l.year_of_study||"");const d=setInterval(()=>{o(k=>k>=90?(clearInterval(d),90):k+10)},200);T(route("teacher.grades.upload.store"),a,{forceFormData:!0,onSuccess:()=>{o(100),setTimeout(()=>{p(!1),o(0),C(null),E(),g.current&&(g.current.value="")},1e3)},onError:()=>{p(!1),o(0)}})},$=()=>{window.open(route("teacher.grades.template"),"_blank")},R=(()=>{const s=m.find(a=>a.id.toString()===l.academic_level_id);return(s==null?void 0:s.key)||"college"})()==="college";return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(z,{user:S}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(J,{user:S}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Grades CSV"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Bulk upload student grades using a CSV file"})]}),e.jsx(O,{href:route("teacher.grades.index"),children:e.jsx(_,{variant:"outline",children:"Back to Grades"})})]}),e.jsxs(F,{className:"max-w-2xl",children:[e.jsx(A,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-5 w-5"}),"Upload Grades CSV"]})}),e.jsx(U,{children:e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(c,{htmlFor:"csv_file",children:"CSV File"}),e.jsx("div",{className:"mt-2",children:e.jsx(y,{id:"csv_file",ref:g,type:"file",accept:".csv,.txt",onChange:H,className:"cursor-pointer",disabled:x})}),i&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(M,{className:"h-4 w-4"}),i.name," (",(i.size/1024).toFixed(1)," KB)"]}),r.csv_file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.csv_file})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"subject_id",children:"Subject *"}),e.jsxs(f,{value:l.subject_id,onValueChange:L,children:[e.jsx(v,{className:r.subject_id?"border-red-500":"",children:e.jsx(N,{placeholder:"Select a subject"})}),e.jsx(b,{children:n.map(s=>e.jsxs(j,{value:s.subject.id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.id))})]}),r.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.subject_id})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"academic_level_id",children:"Academic Level *"}),e.jsxs(f,{value:l.academic_level_id,onValueChange:s=>t("academic_level_id",s),children:[e.jsx(v,{className:r.academic_level_id?"border-red-500":"",children:e.jsx(N,{placeholder:"Select academic level"})}),e.jsx(b,{children:m.map(s=>e.jsx(j,{value:s.id.toString(),children:s.name},s.id))})]}),r.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(f,{value:l.grading_period_id,onValueChange:s=>t("grading_period_id",s),children:[e.jsx(v,{className:r.grading_period_id?"border-red-500":"",children:e.jsx(N,{placeholder:"Select grading period (optional)"})}),e.jsxs(b,{children:[e.jsx(j,{value:"0",children:"No Period"}),u.filter(s=>s.academic_level_id.toString()===l.academic_level_id).map(s=>e.jsx(j,{value:s.id.toString(),children:s.name},s.id))]})]}),r.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.grading_period_id})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"school_year",children:"School Year *"}),e.jsx(y,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:l.school_year,onChange:s=>t("school_year",s.target.value),className:r.school_year?"border-red-500":""}),r.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.school_year})]}),e.jsxs("div",{children:[e.jsx(c,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(y,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1",value:l.year_of_study,onChange:s=>t("year_of_study",s.target.value),className:r.year_of_study?"border-red-500":""}),r.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:r.year_of_study})]}),e.jsxs(I,{children:[e.jsx(Y,{className:"h-4 w-4"}),e.jsxs(V,{children:[e.jsx("strong",{children:"Grade System:"})," ",R?"College uses 1.0-5.0 scale (1.0 highest, 3.0 passing)":"Elementary to Senior High uses 75-100 scale (75 passing)"]})]}),x&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Uploading... ",w,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${w}%`}})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(_,{type:"submit",disabled:B||x||!i||!l.subject_id||!l.academic_level_id||!l.school_year,className:"flex-1",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),x?"Uploading...":"Upload Grades"]}),e.jsxs(_,{type:"button",variant:"outline",onClick:$,className:"flex-1",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),"Download Template"]})]})]})})]}),e.jsxs(F,{children:[e.jsx(A,{children:e.jsx(D,{children:"CSV Format Instructions"})}),e.jsxs(U,{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Required Columns:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Grade Values:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"College:"})," 1.0 to 5.0 (3.0 = passing)"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Elementary/Senior High:"})," 75 to 100 (75 = passing)"]})]})]})]}),e.jsxs(I,{children:[e.jsx(q,{className:"h-4 w-4 text-green-600"}),e.jsxs(V,{children:[e.jsx("strong",{children:"Tip:"})," Download the template to see the exact format. The system will automatically detect existing grades and update them, or create new ones if they don't exist."]})]})]})]})]})})]})]})}export{ve as default};
