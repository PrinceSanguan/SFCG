import{r as h,m as W,j as e,$ as Y,d as z,C as q}from"./app-C0m847Uu.js";import{C as D,b as U,c as I,a as G}from"./card-CXjaanlD.js";import{B as v}from"./button-BlgTI_yF.js";import{I as y}from"./input-lwW7iAPS.js";import{L as n}from"./label-D8OZ60FS.js";import{S,a as N,b as C,c as w,d as m}from"./select-BtfEbUe0.js";import{A as O,a as L}from"./alert-CmGg512V.js";import{S as Q,H as X}from"./sidebar-BdsTMvsi.js";import{U as E}from"./upload-Bv7YrnOj.js";import{F as Z}from"./file-text-Bv2RLUpe.js";import{D as ee}from"./download-Dp_zwWC-.js";/* empty css            */import"./index-Ct-BhWPv.js";import"./Combination-BmTelq4r.js";import"./index-CiA2aRk1.js";import"./index-DjKd8qsO.js";import"./check-D-wM8ysj.js";import"./dropdown-menu-CkJ5rdho.js";import"./user-C12OV_Zd.js";import"./log-out-DCiteYXR.js";import"./book-open-7B-Asp4T.js";import"./graduation-cap-DsObIU6C.js";import"./crown-D9DhmBVv.js";function Ce({user:k,assignedSubjects:j,academicLevels:_,gradingPeriods:c}){const f=h.useRef(null),[x,F]=h.useState(null),[V,u]=h.useState(0),[g,b]=h.useState(!1),{data:i,setData:o,post:M,processing:A,errors:t,reset:B}=W({csv_file:null,subject_id:"",academic_level_id:"",grading_period_id:"",school_year:"",year_of_study:""}),P=s=>{var r;const l=(r=s.target.files)==null?void 0:r[0];l&&(F(l),o("csv_file",l))},T=s=>{o("subject_id",s);const l=j.find(r=>r.subject_id.toString()===s);l&&(o("academic_level_id",l.academicLevel.id.toString()),o("school_year",l.school_year),l.gradingPeriod&&o("grading_period_id",l.gradingPeriod.id.toString()))},H=s=>{if(s.preventDefault(),!x)return;b(!0),u(0);const l=setInterval(()=>{u(r=>r>=90?(clearInterval(l),90):r+10)},200);M(route("instructor.grades.upload.store"),{preserveScroll:!0,forceFormData:!0,onSuccess:()=>{clearInterval(l),u(100),setTimeout(()=>{b(!1),u(0),F(null),B(),f.current&&(f.current.value="")},1e3)},onError:()=>{clearInterval(l),b(!1),u(0)}})},$=()=>{window.open(route("instructor.grades.template"),"_blank")},R=(()=>{const s=_.find(l=>l.id.toString()===i.academic_level_id);return(s==null?void 0:s.key)||"college"})()==="college",J=h.useMemo(()=>{var d,p;if(!i.subject_id)return console.log("Upload: No subject selected, returning all periods"),c;const s=j.find(a=>a.subject_id.toString()===i.subject_id);if(!s)return console.log("Upload: No assignment found for subject_id:",i.subject_id),c;const l=s.grading_period_ids||((d=s.subject)==null?void 0:d.grading_period_ids)||[];if(console.log("=== Upload Grading Period Filtering ==="),console.log("Selected subject:",(p=s.subject)==null?void 0:p.name),console.log("Assignment grading_period_ids:",l),console.log("All grading periods:",c.length),l.length===0)return console.log("Upload: No grading_period_ids assigned, showing all periods"),c;const r=c.filter(a=>l.includes(a.id));return console.log("Upload: Filtered grading periods:",r.length,r.map(a=>({id:a.id,name:a.name}))),r},[i.subject_id,j,c]);return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Q,{user:k}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(X,{user:k}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Upload Grades CSV"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Bulk upload student grades using a CSV file"})]}),e.jsx(Y,{href:route("instructor.grades.index"),children:e.jsx(v,{variant:"outline",children:"Back to Grades"})})]}),e.jsxs(D,{className:"max-w-2xl",children:[e.jsx(U,{children:e.jsxs(I,{className:"flex items-center gap-2",children:[e.jsx(E,{className:"h-5 w-5"}),"Upload Grades CSV"]})}),e.jsx(G,{children:e.jsxs("form",{onSubmit:H,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(n,{htmlFor:"csv_file",children:"CSV File"}),e.jsx("div",{className:"mt-2",children:e.jsx(y,{id:"csv_file",ref:f,type:"file",accept:".csv,.txt",onChange:P,className:"cursor-pointer",disabled:g})}),x&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsx(Z,{className:"h-4 w-4"}),x.name," (",(x.size/1024).toFixed(1)," KB)"]}),t.csv_file&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.csv_file})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"subject_id",children:"Subject (Optional for multi-subject CSV)"}),e.jsxs(S,{value:i.subject_id,onValueChange:T,children:[e.jsx(N,{className:t.subject_id?"border-red-500":"",children:e.jsx(C,{placeholder:"Select a subject (or leave blank for multi-subject CSV)"})}),e.jsx(w,{children:j.map(s=>e.jsxs(m,{value:s.subject_id.toString(),children:[s.subject.name," (",s.subject.code,")",s.subject.course&&` - ${s.subject.course.name}`]},s.id))})]}),t.subject_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.subject_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Leave blank to upload grades for multiple subjects. Include Subject Code column in your CSV."})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"academic_level_id",children:"Academic Level (Optional for multi-subject CSV)"}),e.jsxs(S,{value:i.academic_level_id,onValueChange:s=>o("academic_level_id",s),children:[e.jsx(N,{className:t.academic_level_id?"border-red-500":"",children:e.jsx(C,{placeholder:"Select academic level (optional)"})}),e.jsx(w,{children:_.map(s=>e.jsx(m,{value:s.id.toString(),children:s.name},s.id))})]}),t.academic_level_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.academic_level_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(S,{value:i.grading_period_id,onValueChange:s=>o("grading_period_id",s),children:[e.jsx(N,{className:t.grading_period_id?"border-red-500":"",children:e.jsx(C,{placeholder:"Select grading period (optional)"})}),e.jsxs(w,{children:[e.jsx(m,{value:"0",children:"No Period"}),(()=>{const s=_.find(r=>r.id.toString()===i.academic_level_id),l=J.filter(r=>r.academic_level_id.toString()===i.academic_level_id);return(s==null?void 0:s.key)==="college"?l.filter(d=>(d.code==="COL_S1"||d.code==="COL_S2")&&!d.code.includes("_")).map(d=>{const p=l.filter(a=>a.code.startsWith(d.code+"_")&&!a.code.includes("_FA")).sort((a,K)=>a.sort_order-K.sort_order);return e.jsxs("div",{children:[e.jsx(m,{value:d.id.toString(),className:"font-semibold",children:d.name}),p.map(a=>e.jsxs(m,{value:a.id.toString(),className:"pl-6 text-sm",children:["• ",a.name]},a.id))]},d.id)}):l.filter(r=>!r.name.toLowerCase().includes("final average")).sort((r,d)=>r.sort_order-d.sort_order).map(r=>e.jsx(m,{value:r.id.toString(),children:r.name},r.id))})()]})]}),t.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.grading_period_id})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"school_year",children:"School Year *"}),e.jsx(y,{id:"school_year",type:"text",placeholder:"e.g., 2024-2025",value:i.school_year,onChange:s=>o("school_year",s.target.value),className:t.school_year?"border-red-500":""}),t.school_year&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.school_year})]}),e.jsxs("div",{children:[e.jsx(n,{htmlFor:"year_of_study",children:"Year of Study"}),e.jsx(y,{id:"year_of_study",type:"number",min:"1",max:"10",placeholder:"e.g., 1",value:i.year_of_study,onChange:s=>o("year_of_study",s.target.value),className:t.year_of_study?"border-red-500":""}),t.year_of_study&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:t.year_of_study})]}),e.jsxs(O,{children:[e.jsx(z,{className:"h-4 w-4"}),e.jsxs(L,{children:[e.jsx("strong",{children:"Grade System:"})," ",R?"College uses 1.0-5.0 scale (1.0 highest, 3.0 passing)":"Elementary to Senior High uses 75-100 scale (75 passing)"]})]}),g&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-300 border-t-blue-600 rounded-full animate-spin"}),e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Uploading... ",V,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${V}%`}})})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(v,{type:"submit",disabled:A||g||!x||!i.school_year,className:"flex-1",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),g?"Uploading...":"Upload Grades"]}),e.jsxs(v,{type:"button",variant:"outline",onClick:$,className:"flex-1",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"Download Multi-Subject Template"]})]})]})})]}),e.jsxs(D,{children:[e.jsx(U,{children:e.jsx(I,{children:"CSV Format Instructions"})}),e.jsxs(G,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Multi-Subject CSV Format (Recommended):"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1 mb-3",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Student ID:"})," Student number or database ID"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Student Name:"})," Full name of student"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Subject Code:"})," Subject code (e.g., DBMS01, WEBDEV01)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Grade:"})," Numeric grade value"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Grading Period:"})," Period code (e.g., COL_S1_M, COL_S2_M) - Optional"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Notes:"})," Optional comments"]})]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Upload grades for multiple subjects and students in a single CSV file. Each row represents one grade entry."})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Grade Values:"}),e.jsxs("ul",{className:"text-sm text-gray-600 dark:text-gray-400 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"College:"})," 1.0 to 5.0 (3.0 = passing)"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"Elementary/Senior High:"})," 75 to 100 (75 = passing)"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium mb-2",children:"Example Multi-Subject CSV:"}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-3 rounded text-xs font-mono overflow-x-auto",children:[e.jsx("div",{children:"Student ID,Student Name,Subject Code,Grade,Grading Period,Notes"}),e.jsx("div",{children:"CO-2024-001,John Doe,DBMS01,1.5,COL_S1_M,Good performance"}),e.jsx("div",{children:"CO-2024-001,John Doe,WEBDEV01,1.75,COL_S1_M,Excellent work"}),e.jsx("div",{children:"CO-2024-002,Jane Smith,DBMS01,2.0,COL_S1_M,Satisfactory"})]})]})]}),e.jsxs(O,{children:[e.jsx(q,{className:"h-4 w-4 text-green-600"}),e.jsxs(L,{children:[e.jsx("strong",{children:"Tip:"})," Download the template to see the exact format. The system will automatically detect existing grades and update them, or create new ones if they don't exist. You can upload grades for multiple subjects and semesters in one file!"]})]})]})]})]})})]})]})}export{Ce as default};
