import{m as M,r as h,j as e,$ as E}from"./app-CNA0EGn6.js";import{C as P,b as B,c as O,a as q}from"./card-B8T2hQI9.js";import{B as j}from"./button-DzKRCm_S.js";import{I as K}from"./input-Bdkok1p0.js";import{L as A}from"./label-DywOQtTh.js";import{S as T,a as V,b as W,c as $,d as p,e as G,f as F}from"./select-BwReAl1_.js";import{S as z,H as R}from"./sidebar-DUL9580-.js";import{A as Y}from"./arrow-left-Bv7-vddA.js";import{S as J}from"./square-pen-DpzIXwVo.js";import{S as Q}from"./save-hYBO1q5L.js";/* empty css            */import"./index-CFb5Ihyo.js";import"./Combination-vSUcjMKV.js";import"./index-BzFgs0q7.js";import"./index-D2meUdLJ.js";import"./check-Dx3gboGd.js";import"./dropdown-menu-DWP2G9FP.js";import"./user-8lC43fkC.js";import"./log-out-DNB9xrwl.js";import"./book-open-CgaWo9e8.js";import"./graduation-cap-DUOax5O-.js";import"./upload-BcLIqBFE.js";import"./crown-CkMoiUp1.js";function ve({user:f,grade:r,gradingPeriods:n,assignedSubjects:g}){var _,y,S,C,k,w,L;const{data:b,setData:N,put:U,processing:v,errors:c}=M({grade:r.grade.toString(),grading_period_id:((_=r.grading_period_id)==null?void 0:_.toString())||"0"}),u=h.useMemo(()=>{const s=new Set;return g.forEach(t=>{t.enrolled_students.forEach(l=>{l.semester&&s.add(l.semester.toLowerCase())})}),Array.from(s)},[g]),H=h.useMemo(()=>u.some(s=>s.includes("1st")||s.includes("first")),[u]),I=h.useMemo(()=>u.some(s=>s.includes("2nd")||s.includes("second")),[u]),x=h.useMemo(()=>{var d,m;const s=r.subject_id;console.log("=== Edit Grading Period Filtering ==="),console.log("Current grade subject_id:",s),console.log("Current grade subject:",(d=r.subject)==null?void 0:d.name);const t=g.find(a=>a.subject.id===s);if(!t)return console.log("Edit: No assignment found for current subject, showing all periods"),n;const l=t.grading_period_ids||((m=t.subject)==null?void 0:m.grading_period_ids)||[];if(console.log("Assignment grading_period_ids:",l),console.log("All grading periods:",n.length),l.length===0)return console.log("Edit: No grading_period_ids assigned, showing all periods"),n;const o=n.filter(a=>l.includes(a.id));return console.log("Edit: Filtered grading periods:",o.length,o.map(a=>({id:a.id,name:a.name}))),o},[r.subject_id,g,n]),i=()=>{var t,l,o,d,m;if(console.log("Academic Level Data:",r.academicLevel),console.log("Academic Level Key:",(t=r.academicLevel)==null?void 0:t.key),console.log("Academic Level Name:",(l=r.academicLevel)==null?void 0:l.name),console.log("Subject Course:",(o=r.subject)==null?void 0:o.course),console.log("Full Grade Object:",r),(d=r.academicLevel)!=null&&d.key){const a=r.academicLevel.key==="college";return console.log("Using direct academic level, Is College:",a),a?"college":r.academicLevel.key}if((m=r.subject)!=null&&m.course)return console.log("Using course fallback, assuming college level"),"college";const s=parseFloat(r.grade);return s>=1&&s<=5?(console.log("Using grade value fallback, assuming college level (1-5 scale)"),"college"):(console.log("Using default fallback: elementary"),"elementary")},D=s=>{s.preventDefault(),U(route("instructor.grades.update",r.id),{onSuccess:()=>{console.log("Grade updated successfully")},onError:t=>{console.log("Grade update failed:",t)}})};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(z,{user:f}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(R,{user:f}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{href:route("instructor.grades.show-student",[r.student_id,r.subject_id]),children:e.jsxs(j,{variant:"outline",size:"sm",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Back to Student"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Edit Grade"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Update the grade for ",r.student.name," in ",r.subject.name]})]})]})}),e.jsxs(P,{className:"max-w-2xl",children:[e.jsx(B,{children:e.jsxs(O,{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5"}),"Grade Information"]})}),e.jsxs(q,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-6",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3",children:"Current Grade Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Student:"}),e.jsx("p",{className:"font-medium",children:((y=r.student)==null?void 0:y.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Subject:"}),e.jsxs("p",{className:"font-medium",children:[((S=r.subject)==null?void 0:S.name)||"Unknown"," (",((C=r.subject)==null?void 0:C.code)||"N/A",")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Academic Level:"}),e.jsx("p",{className:"font-medium",children:((k=r.academicLevel)==null?void 0:k.name)||"Unknown"}),!((w=r.academicLevel)!=null&&w.name)&&e.jsxs("p",{className:"text-xs text-yellow-600 mt-1",children:["Detected: ",i()==="college"?"College (5-1 scale)":"Elementary/Senior High (75-100 scale)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"School Year:"}),e.jsx("p",{className:"font-medium",children:r.school_year||"N/A"})]}),((L=r.subject)==null?void 0:L.course)&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Course:"}),e.jsxs("p",{className:"font-medium",children:[r.subject.course.name," (",r.subject.course.code,")"]})]})]})]}),e.jsxs("form",{onSubmit:D,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"grade",children:"Grade"}),e.jsxs("div",{className:"mb-2 p-2 bg-blue-50 border border-blue-200 rounded text-sm",children:[e.jsx("p",{className:"font-medium text-blue-800",children:i()==="college"?"🎓 College Grading Scale (5-1)":"🏫 Elementary/Senior High Scale (75-100)"}),e.jsx("p",{className:"text-blue-600",children:i()==="college"?"1.0 = Highest, 5.0 = Lowest, 3.0 = Passing":"75 = Passing, 100 = Highest"})]}),e.jsx(K,{id:"grade",type:"number",step:i()==="college"?"0.1":"0.01",min:i()==="college"?"1.0":"75",max:i()==="college"?"5.0":"100",placeholder:i()==="college"?"Enter grade (1.0-5.0)":"Enter grade (0-100)",value:b.grade,onChange:s=>N("grade",s.target.value),className:c.grade?"border-red-500":"",autoFocus:!0}),c.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.grade}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:i()==="college"?"College: 1.0 (highest) to 5.0 (lowest). 3.0 is passing (equivalent to 75).":"Elementary to Senior High: 75 (passing) to 100 (highest)."})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(T,{value:b.grading_period_id,onValueChange:s=>N("grading_period_id",s),children:[e.jsx(V,{className:c.grading_period_id?"border-red-500":"",children:e.jsx(W,{placeholder:"Select grading period"})}),e.jsxs($,{children:[e.jsx(p,{value:"0",children:"No Period"}),x&&x.length>0?e.jsxs(e.Fragment,{children:[H&&e.jsxs(G,{children:[e.jsx(F,{children:"First Semester"}),x.filter(s=>s.code.startsWith("COL_S1_")&&!s.code.includes("_FA")).sort((s,t)=>s.sort_order-t.sort_order).map(s=>e.jsx(p,{value:s.id.toString(),children:s.name},s.id))]}),I&&e.jsxs(G,{children:[e.jsx(F,{children:"Second Semester"}),x.filter(s=>s.code.startsWith("COL_S2_")&&!s.code.includes("_FA")).sort((s,t)=>s.sort_order-t.sort_order).map(s=>e.jsx(p,{value:s.id.toString(),children:s.name},s.id))]})]}):e.jsx(p,{value:"none",disabled:!0,children:"No grading periods assigned to this subject"})]})]}),c.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:c.grading_period_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select which grading period this grade belongs to"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(j,{type:"submit",disabled:v,className:"flex-1",children:[e.jsx(Q,{className:"h-4 w-4 mr-2"}),v?"Updating...":"Update Grade"]}),e.jsx(E,{href:route("instructor.grades.show-student",[r.student_id,r.subject_id]),className:"flex-1",children:e.jsx(j,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]})]})]})]})})]})]})}export{ve as default};
