import{j as e,$ as F}from"./app-BRLfWJeb.js";import{S as V,H as q}from"./sidebar-CC1opG_k.js";import{C as f,b as v,c as w,a as j}from"./card-Cmoof86j.js";import{B as C}from"./button-CEOBxFAI.js";import{B as k}from"./badge-BBpa_TNv.js";import{A as M}from"./arrow-left-CNYsEfBW.js";import{U as N}from"./user-Ba8tjkzc.js";import{M as R}from"./mail--A_iFBXJ.js";import{B as I}from"./book-open-BTFbegHE.js";import{G as O}from"./graduation-cap-CYPu5cnH.js";import{C as $}from"./calendar-0__0f39U.js";import{P as z}from"./plus-CXDr-iFv.js";import{S as J}from"./square-pen-CIPZqDXo.js";/* empty css            */import"./dropdown-menu-BeVjX3NF.js";import"./Combination-4HCHszUy.js";import"./index-DUsJDyDI.js";import"./chevron-down-BXpWMyEI.js";import"./log-out-CYdEeUbO.js";import"./upload-DDDOkF3-.js";import"./crown-BcrxSINL.js";function ue({user:A,student:m,subject:g,academicLevel:u,grades:p,gradingPeriods:b,assignmentSchoolYear:G}){const n=p.length>0?p[0]:null,x=u.key,L=(s,o)=>o==="college"||o==="senior_highschool"?s<=1.5?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":s<=2.5?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":s<=3?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300":s>=90?"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300":s>=80?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-300":s>=75?"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300":"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300",P=(s,o)=>o==="college"||o==="senior_highschool"?s<=1.5?"Superior":s<=2?"Very Good":s<=2.5?"Good":s<=3?"Satisfactory":"Failing":s>=95?"Outstanding":s>=90?"Very Good":s>=85?"Good":s>=80?"Satisfactory":s>=75?"Fair":"Failing",h=(()=>{console.log("ðŸ” DEBUG - getSemesterStructure called with:",{academicLevelKey:x,allGradingPeriods:b.map(r=>({id:r.id,name:r.name,code:r.code}))});let s=b.filter(r=>{const a=x,t=r.name.toLowerCase(),l=r.code.toLowerCase(),i=[a.toLowerCase(),a.toLowerCase().replace("_",""),a.toLowerCase().replace("_"," ")];a==="college"&&i.push("tertiary","university","higher"),a==="senior_highschool"&&i.push("senior high","shs","senior_high","seniorhigh");const c=i.some(d=>l.includes(d)||t.includes(d));return console.log(`ðŸ” Period "${r.name}" (${r.code}) relevant for ${a}:`,c),c});if(s.length===0&&(console.log("ðŸ” No level-specific periods found, using all active periods as fallback"),s=b.filter(r=>r.is_active)),console.log("ðŸ” DEBUG - Relevant periods after filtering:",s.map(r=>({id:r.id,name:r.name,code:r.code}))),["senior_highschool","college"].includes(x)){const r={};s.forEach(t=>{let l=1;const i=t.name.toLowerCase(),c=t.code.toLowerCase();["s2","2nd","second","_s2","semester_2","sem_2","sem2","2nd semester","second semester","semester 2","sem 2","2nd sem","second sem","ii"," 2 ","_2_","-2-","spring","winter"].some(D=>c.includes(D)||i.includes(D))&&(l=2),console.log(`ðŸ” Period "${t.name}" (${t.code}) assigned to Semester ${l}`),r[l]||(r[l]={name:`${l===1?"First":"Second"} Semester`,periods:[]});const y=t.name.toLowerCase()==="first semester"||t.name.toLowerCase()==="second semester"||t.code.match(/^(COL|SHS|EL|JHS)_S[12]$/i);!(t.name.toLowerCase().includes("final average")||t.code.includes("FA")||t.name.toLowerCase()==="final"&&!t.name.toLowerCase().includes("pre"))&&!y&&r[l].periods.push({id:t.id,name:t.name,code:t.code,gradingPeriodId:t.id})});let a=Object.keys(r).map(t=>({semesterNumber:parseInt(t),...r[t]}));if(a.length===0||a.every(t=>t.periods.length===0)){console.log("ðŸ” No periods grouped by semester, creating fallback structure");const t=s.filter(l=>!l.name.toLowerCase().includes("final average")&&!l.code.includes("FA")&&!l.name.toLowerCase().includes("final")&&!l.code.toLowerCase().includes("final"));if(console.log("ðŸ” All input periods for fallback:",t.map(l=>({id:l.id,name:l.name,code:l.code}))),t.length>0)if(t.length>=2){const l=Math.ceil(t.length/2);a=[{semesterNumber:1,name:"First Semester",periods:t.slice(0,l).map(i=>({id:i.id,name:i.name,code:i.code,gradingPeriodId:i.id}))},{semesterNumber:2,name:"Second Semester",periods:t.slice(l).map(i=>({id:i.id,name:i.name,code:i.code,gradingPeriodId:i.id}))}].filter(i=>i.periods.length>0)}else a=[{semesterNumber:1,name:"Semester",periods:t.map(l=>({id:l.id,name:l.name,code:l.code,gradingPeriodId:l.id}))}]}return console.log("ðŸ” Final semester structure (semester-based):",a),a}else{const r=[{semesterNumber:1,name:"Academic Year",periods:s.filter(a=>!a.name.toLowerCase().includes("final average")&&!a.code.includes("FA")).sort((a,t)=>a.id-t.id).map(a=>({id:a.id,name:a.name,code:a.code,gradingPeriodId:a.id}))}];return console.log("ðŸ” Final quarter structure:",r),r}})();console.log("ðŸ” DEBUG - Show component data:",{academicLevelKey:x,academicLevel:u,gradingPeriods:b.map(s=>({id:s.id,name:s.name,code:s.code})),semesterStructure:h,totalGradingPeriods:b.length,semesterStructureLength:h.length,totalPeriodsInStructure:h.reduce((s,o)=>s+o.periods.length,0)});const U=()=>{if(!["college","senior_highschool"].includes(x)){const i=p.filter(c=>c.grade!==null&&c.grade!==void 0).map(c=>c.grade);return i.length>0?{semester1Average:null,semester2Average:null,overallAverage:i.reduce((c,d)=>c+d,0)/i.length}:{semester1Average:null,semester2Average:null,overallAverage:null}}let o=null,r=null;const a=h.find(i=>i.semesterNumber===1);if(a&&a.periods.length>0){const i=a.periods.map(d=>d.gradingPeriodId),c=p.filter(d=>d.grading_period_id&&i.includes(d.grading_period_id));console.log("ðŸ” Semester 1 calculation:",{periodIds:i,foundGrades:c.map(d=>({id:d.grading_period_id,grade:d.grade})),grades:c.map(d=>d.grade)}),c.length>0&&(o=c.reduce((y,S)=>y+parseFloat(S.grade.toString()),0)/c.length)}const t=h.find(i=>i.semesterNumber===2);if(t&&t.periods.length>0){const i=t.periods.map(d=>d.gradingPeriodId),c=p.filter(d=>d.grading_period_id&&i.includes(d.grading_period_id));console.log("ðŸ” Semester 2 calculation:",{periodIds:i,foundGrades:c.map(d=>({id:d.grading_period_id,grade:d.grade})),grades:c.map(d=>d.grade)}),c.length>0&&(r=c.reduce((y,S)=>y+parseFloat(S.grade.toString()),0)/c.length)}let l=null;return o!==null&&r!==null?l=(o+r)/2:o!==null?l=o:r!==null&&(l=r),console.log("ðŸ” Final semester averages:",{semester1Average:o,semester2Average:r,overallAverage:l}),{semester1Average:o,semester2Average:r,overallAverage:l}},{semester1Average:B,semester2Average:E,overallAverage:H}=U(),_=H;return h.reduce((s,o)=>s+o.periods.length,0),e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(V,{user:A}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(q,{user:A}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(F,{href:route("instructor.grades.index"),children:e.jsxs(C,{variant:"outline",size:"sm",children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Back to Grades"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Student Details"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["View and manage grades for ",m.name]})]})]})}),e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Personal Information"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center",children:e.jsx(N,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Name"}),e.jsx("p",{className:"font-medium",children:m.name})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center",children:e.jsx(N,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Student ID"}),e.jsx("p",{className:"font-medium",children:m.student_number||m.id})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center",children:e.jsx(R,{className:"h-5 w-5 text-green-600 dark:text-green-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Email"}),e.jsx("p",{className:"font-medium",children:m.email})]})]})]})})]}),m.parents&&m.parents.length>0&&e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(N,{className:"h-5 w-5"}),"Linked Parents"]})}),e.jsx(j,{children:e.jsx("div",{className:"space-y-3",children:m.parents.map(s=>e.jsx("div",{className:"flex items-center justify-between p-3 border rounded-lg",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-gray-900 dark:text-gray-100",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:s.email})]}),e.jsx(k,{variant:"outline",children:s.pivot.relationship_type.charAt(0).toUpperCase()+s.pivot.relationship_type.slice(1)})]}),s.pivot.emergency_contact&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Emergency Contact: ",s.pivot.emergency_contact]}),s.pivot.notes&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Notes: ",s.pivot.notes]})]})},s.id))})})]}),e.jsxs(f,{children:[e.jsx(v,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(I,{className:"h-5 w-5"}),"Subject & Course Information"]})}),e.jsx(j,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center",children:e.jsx(I,{className:"h-5 w-5 text-purple-600 dark:text-purple-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Subject"}),e.jsxs("p",{className:"font-medium",children:[g.name," (",g.code,")"]})]})]}),g.course&&e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-indigo-100 dark:bg-indigo-900 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"h-5 w-5 text-indigo-600 dark:text-indigo-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Course"}),e.jsxs("p",{className:"font-medium",children:[g.course.name," (",g.course.code,")"]})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-orange-100 dark:bg-orange-900 rounded-full flex items-center justify-center",children:e.jsx(O,{className:"h-5 w-5 text-orange-600 dark:text-orange-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Academic Level"}),e.jsx("p",{className:"font-medium",children:u.name})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center",children:e.jsx($,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"School Year"}),e.jsx("p",{className:"font-medium",children:(n==null?void 0:n.school_year)||G})]})]})]})})]}),h.length>0&&h.some(s=>s.periods.length>0)?e.jsxs(e.Fragment,{children:[_&&e.jsx(f,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200",children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:"Overall Average"}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Combined average for ",n==null?void 0:n.school_year]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-4xl font-bold text-gray-900 mb-2",children:_.toFixed(2)}),e.jsx(k,{className:`text-sm px-4 py-2 ${["Superior","Very Good","Good","Satisfactory","Fair","Outstanding"].includes(P(_,x))?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:P(_,x)})]})]})})}),h.map((s,o)=>s.periods.length===0?null:e.jsxs(f,{className:"bg-white shadow-sm",children:[e.jsx(v,{children:e.jsxs(w,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx($,{className:"h-5 w-5 text-gray-600"}),s.name]})}),e.jsx(j,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-800 text-white",children:[e.jsx("th",{className:"text-left p-3 font-medium border-r border-gray-700",children:"Student ID"}),e.jsx("th",{className:"text-left p-3 font-medium border-r border-gray-700",children:"Subject"}),e.jsx("th",{className:"text-left p-3 font-medium border-r border-gray-700",children:"Faculty"}),s.periods.map(r=>e.jsx("th",{className:"text-center p-3 font-medium border-r border-gray-700",children:r.name.replace(/First Semester /,"").replace(/Second Semester /,"").replace(/First /,"").replace(/Second /,"").replace(/Semester /,"").trim()},r.id)),e.jsx("th",{className:"text-center p-3 font-medium border-r border-gray-700",children:"Semester Average"}),e.jsx("th",{className:"text-center p-3 font-medium",children:"Grade Status"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{className:"border-b bg-white hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 border-r border-gray-200 font-medium",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-4 w-4 mr-2 text-gray-400"}),m.student_number||m.id]})}),e.jsx("td",{className:"p-3 border-r border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{className:"h-4 w-4 mr-2 text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-gray-900",children:g.name}),e.jsx("div",{className:"text-sm text-gray-500",children:g.code})]})]})}),e.jsx("td",{className:"p-3 border-r border-gray-200",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-4 w-4 mr-2 text-gray-400"}),e.jsx("div",{className:"text-sm text-gray-600",children:A.name})]})}),s.periods.map(r=>{const a=p.find(t=>t.grading_period_id===r.gradingPeriodId);return e.jsx("td",{className:"p-3 border-r border-gray-200 text-center",children:a?e.jsx(k,{className:L(a.grade,x),children:a.grade}):e.jsx("span",{className:"text-gray-400",children:"-"})},r.id)}),e.jsx("td",{className:"p-3 border-r border-gray-200 text-center",children:(()=>{const r=s.semesterNumber===1?B:E;return r?e.jsx(k,{className:`text-lg px-3 py-1 ${L(r,x)}`,children:r.toFixed(2)}):e.jsx("span",{className:"text-gray-400",children:"-"})})()}),e.jsx("td",{className:"p-3 text-center",children:(()=>{const r=s.semesterNumber===1?B:E;if(r){const a=P(r,x);return e.jsx(k,{className:`${["Superior","Very Good","Good","Satisfactory","Fair","Outstanding"].includes(a)?"bg-blue-100 text-blue-800":"bg-red-100 text-red-800"}`,children:a})}return e.jsx("span",{className:"text-gray-400",children:"No Grade"})})()})]})})]})})})]},s.semesterNumber))]}):e.jsxs(f,{className:"bg-white shadow-sm",children:[e.jsx(v,{children:e.jsxs(w,{className:"flex items-center gap-2 text-lg font-semibold",children:[e.jsx($,{className:"h-5 w-5 text-gray-600"}),"Detailed Grades"]})}),e.jsx(j,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"h-16 w-16 text-gray-400 mx-auto mb-4",children:"ðŸ“Š"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium mb-2",children:"No grading periods configured"}),e.jsxs("p",{className:"text-sm text-gray-400 dark:text-gray-500",children:["Please contact the registrar to set up grading periods for ",u.name,"."]})]})})]}),e.jsx(f,{children:e.jsx(j,{className:"pt-6",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx(F,{href:route("instructor.grades.create")+`?student_id=${m.id}&subject_id=${g.id}&academic_level_id=${u.id}&academic_level_key=${u.key}&school_year=${(n==null?void 0:n.school_year)||G}`,className:"flex-1",onClick:()=>{console.log("Navigating to grade creation with params:",{student_id:m.id,subject_id:g.id,academic_level_id:u.id,academic_level_key:u.key,school_year:(n==null?void 0:n.school_year)||G})},children:e.jsxs(C,{className:"w-full",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Input New Grade"]})}),n&&n.is_editable&&e.jsxs("div",{className:"flex-1 flex flex-col gap-2",children:[e.jsx(F,{href:route("instructor.grades.edit",n.id),className:"w-full",children:e.jsxs(C,{variant:"outline",className:"w-full",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Edit Current Grade"]})}),n.days_remaining!==void 0&&n.days_remaining<3&&e.jsxs("p",{className:"text-xs text-center text-muted-foreground",children:["â° Editable for ",n.days_remaining," more ",n.days_remaining===1?"day":"days"]})]}),n&&!n.is_editable&&e.jsxs("div",{className:"flex-1",children:[e.jsx(C,{variant:"outline",className:"w-full",disabled:!0,children:n.edit_status==="locked"?"ðŸ”’ Grade Locked":"â° Edit Window Expired"}),e.jsx("p",{className:"text-xs text-center text-muted-foreground mt-2",children:n.edit_status==="locked"?"Grade submitted for validation":"5-day edit period has ended"})]})]})})})]})})]})]})}export{ue as default};
