import{r as y,m as b,j as e,S as k}from"./app-Bf0VEOBc.js";import{H as xe}from"./header-CwCdMTu1.js";import{S as he}from"./sidebar-BvNE3K_S.js";import{C as S,a as w,b as ue,c as pe}from"./card-BFvsoICp.js";import{B as u}from"./button-BSqbYWk0.js";import{S as M,a as E,b as $,c as R,d as C}from"./select-BRlNDrkW.js";import{T as ge,a as je,b as V,c as o,d as fe,e as m}from"./table-CwLVoMDA.js";import{D as Ne,a as ve,b as _e,c as B,d as ye}from"./dropdown-menu-B-Quhz9R.js";import{B as D}from"./badge-Djx6SFLR.js";import{A as z}from"./arrow-left-B0ieP4nl.js";import{S as be}from"./school-Ckfl8shp.js";import{B as ke}from"./book-open-DCgXVRgM.js";import{G as Se}from"./graduation-cap-BJswJ5im.js";import{U as we}from"./users-Drdt5E8w.js";import{F as A}from"./file-text-CBjXwMQf.js";import{E as De,P as Ce}from"./printer-Cs6S6kmr.js";import{D as L}from"./download-BReTyEAu.js";/* empty css            */import"./separator-C4eVgY5H.js";import"./index-Kf14M9Kd.js";import"./chevron-down-BN57fxWa.js";import"./chevron-right-CZQzSfUU.js";import"./crown-Ub7UbgK3.js";import"./building-2-D6a2RDVC.js";import"./user-cog-BsT128V-.js";import"./user-plus-DiYcFrOF.js";import"./user-check-BV8B5b_g.js";import"./notebook-BLFoY7Wo.js";import"./chart-no-axes-column-increasing-Cyc_ojLP.js";import"./shield-CwYNVTDM.js";import"./Combination-CT-LzSsG.js";import"./index-CMiXmo__.js";import"./index-DPulQNaq.js";import"./check-C25aqtg1.js";const O=[{key:"elementary",name:"Elementary",icon:be,color:"bg-blue-500 hover:bg-blue-600",iconColor:"text-blue-600"},{key:"junior_highschool",name:"Junior High School",icon:ke,color:"bg-green-500 hover:bg-green-600",iconColor:"text-green-600"},{key:"senior_highschool",name:"Senior High School",icon:Se,color:"bg-orange-500 hover:bg-orange-600",iconColor:"text-orange-600"},{key:"college",name:"College",icon:we,color:"bg-purple-500 hover:bg-purple-600",iconColor:"text-purple-600"}];function ds({user:G,academicLevels:f,templates:J,allHonors:N=[],generatedCertificates:i=[],schoolYears:v,currentSchoolYear:q}){var F,K;const[r,T]=y.useState(null),[n,Q]=y.useState(q||(v==null?void 0:v[0])||"2024-2025"),[p,U]=y.useState(""),[d,_]=y.useState([]),{setData:X,post:Z,processing:Y}=b({student_id:"",template_id:"",academic_level_id:"",school_year:n}),{setData:ee,post:se,processing:H}=b({student_ids:[],template_id:"",academic_level_id:"",school_year:n}),{setData:le,post:te,processing:P}=b({certificate_ids:[]}),{setData:ae,post:ie,processing:I}=b({academic_level_id:"",school_year:n,honor_type_id:""}),W=s=>N.length?N.filter(l=>l&&l.academic_level&&l.academic_level.key===s&&l.school_year===n).sort((l,t)=>l.year_level!==t.year_level?(l.year_level||"").localeCompare(t.year_level||""):l.section_id!==t.section_id?(l.section_id||0)-(t.section_id||0):s==="college"?(l.gpa||0)-(t.gpa||0):(t.gpa||0)-(l.gpa||0)):[],ne=s=>{const l=f.find(t=>t.key===s);return l?J.filter(t=>t.academic_level_id===l.id&&t.is_active):[]},ce=s=>{X({student_id:s.student.id.toString(),template_id:p,academic_level_id:s.academic_level.id.toString(),school_year:n}),Z(route("admin.academic.certificates.generate"),{onSuccess:()=>{k.reload()}})},re=()=>{if(d.length===0||!p)return;const s=f.find(l=>l.key===r);s&&(ee({student_ids:d,template_id:p,academic_level_id:s.id.toString(),school_year:n}),se(route("admin.academic.certificates.generate-bulk"),{onSuccess:()=>{_([]),k.reload()}}))},de=s=>{_(l=>l.includes(s)?l.filter(t=>t!==s):[...l,s])},oe=()=>{const l=W(r).map(t=>t.student.id);_(d.length===l.length?[]:l)},me=()=>{const s=f.find(l=>l.key===r);s&&(ae({academic_level_id:s.id.toString(),school_year:n,honor_type_id:""}),ie(route("admin.academic.certificates.bulk-generate-by-level"),{onSuccess:()=>{k.reload()}}))},x=r?W(r):[],j=r?ne(r):[];return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(he,{user:G}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(xe,{user:G}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"mx-auto max-w-7xl space-y-6",children:[e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>k.get("/admin/academic"),children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Back to Academic"]})}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-gray-100",children:"Certificate Management"}),e.jsx("p",{className:"text-lg text-gray-600 dark:text-gray-400",children:"Generate and manage honor certificates by academic level."})]}),e.jsx(S,{children:e.jsx(w,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium",children:"School Year:"}),e.jsxs(M,{value:n,onValueChange:Q,children:[e.jsx(E,{className:"w-40",children:e.jsx($,{})}),e.jsx(R,{children:v.map(s=>e.jsx(C,{value:s,children:s},s))})]})]})})}),r?e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(u,{variant:"outline",onClick:()=>{T(null),_([]),U("")},children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),"Back to Categories"]}),e.jsxs("h2",{className:"text-2xl font-bold",children:[(F=O.find(s=>s.key===r))==null?void 0:F.name," Honor Students"]}),e.jsxs(D,{variant:"outline",children:[x.length," students"]})]})}),e.jsxs(S,{children:[e.jsx(ue,{children:e.jsx(pe,{children:"Certificate Generation"})}),e.jsx(w,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-end",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("label",{className:"text-sm font-medium mb-2 block",children:["Select Certificate Template",j.length===0&&e.jsx("span",{className:"ml-2 text-xs text-red-600 font-normal",children:"(No templates - Run: php artisan db:seed --class=CertificateTemplateSeeder)"})]}),e.jsxs(M,{value:p,onValueChange:U,children:[e.jsx(E,{className:j.length===0?"border-red-300":"",children:e.jsx($,{placeholder:j.length>0?"Choose a template...":"⚠️ No templates available - seed database first"})}),e.jsx(R,{children:j.length>0?j.map(s=>e.jsx(C,{value:s.id.toString(),children:s.name},s.id)):e.jsx(C,{value:"none",disabled:!0,children:"No templates available - run CertificateTemplateSeeder"})})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(u,{onClick:me,disabled:x.length===0||I,className:"bg-purple-600 hover:bg-purple-700 text-white",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),I?"Generating All...":"Generate All Missing Certificates"]}),e.jsxs(Ne,{children:[e.jsx(ve,{asChild:!0,children:e.jsxs(u,{variant:"outline",children:[e.jsx(De,{className:"h-4 w-4 mr-2"}),"More Actions"]})}),e.jsxs(_e,{align:"end",className:"w-56",children:[e.jsxs(B,{onClick:re,disabled:d.length===0||!p||H,children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),H?"Generating...":`Generate ${d.length} Selected`]}),e.jsxs(B,{onClick:()=>{console.log("[BULK DOWNLOAD] Starting bulk certificate download"),console.log("[BULK DOWNLOAD] Selected students:",d),console.log("[BULK DOWNLOAD] Selected category data:",x),console.log("[BULK DOWNLOAD] Generated certificates:",i);const s=x.filter(l=>d.includes(l.student.id)).map(l=>{const t=i==null?void 0:i.find(h=>h.student.id===l.student.id&&h.academic_level.id===l.academic_level.id);return console.log(`[BULK DOWNLOAD] Student ${l.student.name} - Certificate ID:`,t==null?void 0:t.id),t==null?void 0:t.id}).filter(l=>l!==void 0);console.log("[BULK DOWNLOAD] Final certificate IDs:",s),s.length>0?(console.log("[BULK DOWNLOAD] Submitting form with certificate IDs:",s),le({certificate_ids:s}),te(route("admin.academic.certificates.bulk-print-pdf"),{onSuccess:()=>{console.log("[BULK DOWNLOAD] Download successful")},onError:l=>{console.error("[BULK DOWNLOAD] Download failed:",l),alert("Failed to download certificates. Please check console for errors.")}})):(console.warn("[BULK DOWNLOAD] No certificate IDs found - certificates may not be generated yet"),alert("No certificates found for selected students. Please generate certificates first."))},disabled:d.length===0||P,children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),P?"Preparing...":`Download ${d.length} Selected`]}),e.jsx(ye,{}),e.jsxs(B,{onClick:()=>{var s;return window.open(`/admin/academic/certificates/honor-roll/pdf?academic_level_id=${(s=f.find(l=>l.key===r))==null?void 0:s.id}&school_year=${n}`,"_blank")},children:[e.jsx(L,{className:"h-4 w-4 mr-2"}),"Honor Roll PDF"]})]})]})]})]})})]}),e.jsx(S,{children:e.jsx(w,{children:x.length>0?e.jsxs(ge,{children:[e.jsx(je,{children:e.jsxs(V,{children:[e.jsx(o,{className:"w-12",children:e.jsx("input",{type:"checkbox",checked:d.length===x.length&&x.length>0,onChange:oe})}),e.jsx(o,{children:"Rank"}),e.jsx(o,{children:"Student Name"}),e.jsx(o,{children:"Student Number"}),e.jsx(o,{children:"Year Level"}),e.jsx(o,{children:"Section"}),e.jsx(o,{children:"Honor Type"}),e.jsx(o,{children:"GPA"}),e.jsx(o,{children:"Certificate"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(fe,{children:x.map((s,l)=>{var t,h;return!s||!s.student?null:e.jsxs(V,{children:[e.jsx(m,{children:e.jsx("input",{type:"checkbox",checked:d.includes(s.student.id),onChange:()=>de(s.student.id)})}),e.jsxs(m,{className:"font-medium",children:["#",l+1]}),e.jsx(m,{className:"font-medium",children:s.student.name}),e.jsx(m,{children:s.student.student_number||"N/A"}),e.jsx(m,{children:s.year_level||s.student.year_level||"N/A"}),e.jsx(m,{children:((t=s.student.section)==null?void 0:t.name)||"N/A"}),e.jsx(m,{children:e.jsx(D,{variant:"secondary",children:((h=s.honor_type)==null?void 0:h.name)||"Unknown Honor"})}),e.jsx(m,{className:"font-mono",children:s.gpa?s.gpa.toFixed(2):"N/A"}),e.jsx(m,{children:(()=>{const c=i==null?void 0:i.find(a=>a.student.id===s.student.id&&a.academic_level.id===s.academic_level.id&&a.school_year===s.school_year);return c?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:"default",className:"text-xs",children:"Generated"}),e.jsx("span",{className:"text-xs text-gray-500",children:c.serial_number})]}):e.jsx(D,{variant:"outline",className:"text-xs",children:"Pending"})})()}),e.jsx(m,{children:e.jsx("div",{className:"flex gap-1",children:(()=>{const c=i==null?void 0:i.find(a=>a.student.id===s.student.id&&a.academic_level.id===s.academic_level.id&&a.school_year===s.school_year);return c?e.jsxs(e.Fragment,{children:[e.jsx(u,{size:"sm",variant:"outline",onClick:()=>window.open(route("admin.academic.certificates.download",c.id),"_blank"),className:"h-8 px-2",children:e.jsx(L,{className:"h-3 w-3"})}),e.jsx(u,{size:"sm",variant:"outline",onClick:()=>window.open(route("admin.academic.certificates.print",c.id),"_blank"),className:"h-8 px-2",children:e.jsx(Ce,{className:"h-3 w-3"})})]}):e.jsxs(u,{size:"sm",variant:"outline",onClick:()=>ce(s),disabled:!p||Y,className:"h-8 px-2",children:[e.jsx(A,{className:"h-3 w-3 mr-1"}),"Generate"]})})()})})]},s.id||l)})})]}):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No Honor Students Found"}),e.jsxs("p",{className:"text-sm",children:["No approved honor students for ",(K=O.find(s=>s.key===r))==null?void 0:K.name," in ",n,"."]})]})})})]}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:O.map(s=>{const l=s.icon,t=N.filter(c=>{var a;return((a=c==null?void 0:c.academic_level)==null?void 0:a.key)===s.key&&c.school_year===n}).length,h=N.filter(a=>{var g;return((g=a==null?void 0:a.academic_level)==null?void 0:g.key)===s.key&&a.school_year===n}).filter(a=>i==null?void 0:i.some(g=>g.student.id===a.student.id&&g.academic_level.id===a.academic_level.id&&g.school_year===a.school_year)).length;return e.jsx(S,{className:"cursor-pointer transition-all hover:shadow-lg",onClick:()=>T(s.key),children:e.jsx(w,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col items-center text-center space-y-4",children:[e.jsx("div",{className:"p-4 rounded-full bg-gray-100",children:e.jsx(l,{className:`h-8 w-8 ${s.iconColor}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:s.name}),e.jsxs("p",{className:"text-sm text-gray-600",children:[t," honor students"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[h," certificates generated"]})]}),e.jsx(u,{className:`w-full ${s.color} text-white`,children:"View Students"})]})})},s.key)})})})]})})]})]})}export{ds as default};
