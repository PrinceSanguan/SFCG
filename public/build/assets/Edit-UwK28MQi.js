import{m as B,r as j,j as e,$ as E}from"./app-CViGVvqy.js";import{C as T,b as O,c as P,a as $}from"./card-NMLdEJmk.js";import{B as v}from"./button-DiWFzzT5.js";import{I as q}from"./input-BJ8G7PI6.js";import{L as A}from"./label-DZSTcotX.js";import{S as K,a as R,b as W,c as z,d as f,e as U,f as I}from"./select-DLqR235R.js";import{S as Q,H as Y}from"./sidebar-0j1jDQvV.js";import{A as J}from"./arrow-left-DdTnbzCd.js";import{S as X}from"./square-pen-C5uLW6BP.js";import{S as Z}from"./save-DXy2jLIO.js";/* empty css            */import"./index-DWN-WMuw.js";import"./Combination-C9zjrKcH.js";import"./index-Cb8erKHP.js";import"./index-2ReaRh1u.js";import"./check-8_YgItWi.js";import"./dropdown-menu-Cy2ObofB.js";import"./user-BFgo5uTk.js";import"./log-out-qM4kMBDb.js";import"./book-open-B_glwqrm.js";import"./graduation-cap-M7IrsvWG.js";import"./upload-DfRlq-xf.js";import"./crown-BAO9u2te.js";function _e({user:N,grade:r,gradingPeriods:d,assignedSubjects:g}){var S,k,C,w,F,L,G;const x=s=>{const t={1.1:"97-98%",1.2:"95-96%",1.3:"93-94%",1.4:"91-92%",1.5:"90%",1.6:"89%",1.7:"88%",1.8:"87%",1.9:"86%",2:"85%",2.1:"84%",2.2:"83%",2.3:"82%",2.4:"81%",2.5:"80%",2.6:"79%",2.7:"78%",2.8:"77%",2.9:"76%",3:"75%",3.1:"74%",3.2:"73%",3.3:"72%",3.4:"71%",3.5:"70%",5:"Below 70%"},a=Math.round(s*10)/10;return t[a]||""},b=s=>s>=1&&s<=1.2?"Excellent":s>=1.3&&s<=1.5?"Superior":s>=1.6&&s<=1.8?"Very Good":s>=1.9&&s<=2.1?"Good":s>=2.2&&s<=2.4?"Average":s>=2.5&&s<=2.7?"Satisfactory":s>=2.8&&s<=3?"Fair":s>3&&s<=3.5?"Conditional":s===5?"Failing":"",{data:n,setData:y,put:D,processing:_,errors:i}=B({grade:r.grade.toString(),grading_period_id:((S=r.grading_period_id)==null?void 0:S.toString())||"0"}),h=j.useMemo(()=>{const s=new Set;return g.forEach(t=>{t.enrolled_students.forEach(a=>{a.semester&&s.add(a.semester.toLowerCase())})}),Array.from(s)},[g]),M=j.useMemo(()=>h.some(s=>s.includes("1st")||s.includes("first")),[h]),H=j.useMemo(()=>h.some(s=>s.includes("2nd")||s.includes("second")),[h]),p=j.useMemo(()=>{var m,u;const s=r.subject_id;console.log("=== Edit Grading Period Filtering ==="),console.log("Current grade subject_id:",s),console.log("Current grade subject:",(m=r.subject)==null?void 0:m.name);const t=g.find(l=>l.subject.id===s);if(!t)return console.log("Edit: No assignment found for current subject, showing all periods"),d;const a=t.grading_period_ids||((u=t.subject)==null?void 0:u.grading_period_ids)||[];if(console.log("Assignment grading_period_ids:",a),console.log("All grading periods:",d.length),a.length===0)return console.log("Edit: No grading_period_ids assigned, showing all periods"),d;const c=d.filter(l=>a.includes(l.id));return console.log("Edit: Filtered grading periods:",c.length,c.map(l=>({id:l.id,name:l.name}))),c},[r.subject_id,g,d]),o=()=>{var t,a,c,m,u;if(console.log("Academic Level Data:",r.academicLevel),console.log("Academic Level Key:",(t=r.academicLevel)==null?void 0:t.key),console.log("Academic Level Name:",(a=r.academicLevel)==null?void 0:a.name),console.log("Subject Course:",(c=r.subject)==null?void 0:c.course),console.log("Full Grade Object:",r),(m=r.academicLevel)!=null&&m.key){const l=r.academicLevel.key==="college";return console.log("Using direct academic level, Is College:",l),l?"college":r.academicLevel.key}if((u=r.subject)!=null&&u.course)return console.log("Using course fallback, assuming college level"),"college";const s=parseFloat(r.grade);return s>=1&&s<=5?(console.log("Using grade value fallback, assuming college level (1-5 scale)"),"college"):(console.log("Using default fallback: elementary"),"elementary")},V=s=>{s.preventDefault(),D(route("instructor.grades.update",r.id),{onSuccess:()=>{console.log("Grade updated successfully")},onError:t=>{console.log("Grade update failed:",t)}})};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(Q,{user:N}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(Y,{user:N}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"flex flex-col gap-2",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx(E,{href:route("instructor.grades.show-student",[r.student_id,r.subject_id]),children:e.jsxs(v,{variant:"outline",size:"sm",children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Back to Student"]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Edit Grade"}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Update the grade for ",r.student.name," in ",r.subject.name]})]})]})}),e.jsxs(T,{className:"max-w-2xl",children:[e.jsx(O,{children:e.jsxs(P,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-5 w-5"}),"Grade Information"]})}),e.jsxs($,{children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg mb-6",children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-gray-100 mb-3",children:"Current Grade Details"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Student:"}),e.jsx("p",{className:"font-medium",children:((k=r.student)==null?void 0:k.name)||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Subject:"}),e.jsxs("p",{className:"font-medium",children:[((C=r.subject)==null?void 0:C.name)||"Unknown"," (",((w=r.subject)==null?void 0:w.code)||"N/A",")"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Academic Level:"}),e.jsx("p",{className:"font-medium",children:((F=r.academicLevel)==null?void 0:F.name)||"Unknown"}),!((L=r.academicLevel)!=null&&L.name)&&e.jsxs("p",{className:"text-xs text-yellow-600 mt-1",children:["Detected: ",o()==="college"?"College (5-1 scale)":"Elementary/Senior High (75-100 scale)"]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"School Year:"}),e.jsx("p",{className:"font-medium",children:r.school_year||"N/A"})]}),((G=r.subject)==null?void 0:G.course)&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Course:"}),e.jsxs("p",{className:"font-medium",children:[r.subject.course.name," (",r.subject.course.code,")"]})]})]})]}),e.jsxs("form",{onSubmit:V,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(A,{htmlFor:"grade",children:"Grade"}),e.jsx(q,{id:"grade",type:"number",step:o()==="college"?"0.1":"0.01",min:o()==="college"?"1.0":"75",max:o()==="college"?"5.0":"100",placeholder:o()==="college"?"Valid: 1.1-3.5 or 5.0":"Enter grade (0-100)",value:n.grade,onChange:s=>{const t=s.target.value;if(y("grade",t),t&&o()==="college"){const a=parseFloat(t);console.log("[GRADE_EDIT] Grade changed:",{grade:a,percentage:x(a),quality:b(a),student:r.student.name})}},className:i.grade?"border-red-500":"",autoFocus:!0}),i.grade&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.grade}),n.grade&&o()==="college"&&e.jsx("div",{className:"mt-2 p-3 bg-blue-50 dark:bg-blue-950 rounded-md border border-blue-200 dark:border-blue-800",children:e.jsxs("p",{className:"text-sm font-semibold text-blue-900 dark:text-blue-100",children:[x(parseFloat(n.grade))&&e.jsxs(e.Fragment,{children:[x(parseFloat(n.grade)),b(parseFloat(n.grade))&&` - ${b(parseFloat(n.grade))}`]}),!x(parseFloat(n.grade))&&e.jsx("span",{className:"text-red-600 dark:text-red-400",children:"Invalid grade (use 1.1-3.5 or 5.0)"})]})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:o()==="college"?"Valid grades: 1.1-3.5 (0.1 increments) or 5.0. 3.0 is passing (75%).":"Elementary to Senior High: 75 (passing) to 100 (highest)."})]}),e.jsxs("div",{children:[e.jsx(A,{htmlFor:"grading_period_id",children:"Grading Period"}),e.jsxs(K,{value:n.grading_period_id,onValueChange:s=>y("grading_period_id",s),children:[e.jsx(R,{className:i.grading_period_id?"border-red-500":"",children:e.jsx(W,{placeholder:"Select grading period"})}),e.jsxs(z,{children:[e.jsx(f,{value:"0",children:"No Period"}),p&&p.length>0?e.jsxs(e.Fragment,{children:[M&&e.jsxs(U,{children:[e.jsx(I,{children:"First Semester"}),p.filter(s=>s.code.startsWith("COL_S1_")&&!s.code.includes("_FA")).sort((s,t)=>s.sort_order-t.sort_order).map(s=>e.jsx(f,{value:s.id.toString(),children:s.name},s.id))]}),H&&e.jsxs(U,{children:[e.jsx(I,{children:"Second Semester"}),p.filter(s=>s.code.startsWith("COL_S2_")&&!s.code.includes("_FA")).sort((s,t)=>s.sort_order-t.sort_order).map(s=>e.jsx(f,{value:s.id.toString(),children:s.name},s.id))]})]}):e.jsx(f,{value:"none",disabled:!0,children:"No grading periods assigned to this subject"})]})]}),i.grading_period_id&&e.jsx("p",{className:"text-sm text-red-500 mt-1",children:i.grading_period_id}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Select which grading period this grade belongs to"})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[e.jsxs(v,{type:"submit",disabled:_,className:"flex-1",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),_?"Updating...":"Update Grade"]}),e.jsx(E,{href:route("instructor.grades.show-student",[r.student_id,r.subject_id]),className:"flex-1",children:e.jsx(v,{type:"button",variant:"outline",className:"w-full",children:"Cancel"})})]})]})]})]})]})})]})]})}export{_e as default};
