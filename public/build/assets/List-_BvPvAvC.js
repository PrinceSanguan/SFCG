import{r,K as ce,u as he,j as e,$ as C,S as w}from"./app-DmT17zTh.js";import{H as xe}from"./header-CTyXzzp5.js";import{S as pe}from"./sidebar-BS7whXcF.js";import{C as Y,a as q,b as me,c as ge}from"./card-uc524Emf.js";import{B as fe}from"./badge-CABJNoJl.js";import{B as p}from"./button-BItZxR9y.js";import{I as je}from"./input-Fc3ypNEC.js";import{P as ue}from"./PasswordResetModal-DkGZN2hG.js";import{S as f,a as j,b as u,c as S,d as _}from"./select-0se3HOlv.js";import{D as Se,b as _e,c as Ne,d as ye,e as Ce,f as we}from"./dialog-ByB-MAd1.js";import{S as be}from"./search-CbZVX-x-.js";import{P as ke}from"./plus-Df-pQl1M.js";import{U as G}from"./upload-BMzILllG.js";import{D as J}from"./download-GiOZjQTt.js";import{E as ve}from"./eye-7Cr-MucY.js";import{S as De}from"./square-pen-Dm6c1meY.js";import{R as Ve}from"./rotate-ccw-Bm552lDu.js";import{T as Te}from"./trash-2-D4lqtsEJ.js";/* empty css            */import"./dropdown-menu-DV_1csEE.js";import"./Combination-ZBu19F_K.js";import"./index-DFaqat22.js";import"./separator-Db9M0PP0.js";import"./users-DqU8cVfZ.js";import"./chevron-right-Bw0BDlDH.js";import"./crown-Dbzi_xoC.js";import"./building-2-B27duaUF.js";import"./user-cog-Bou752gi.js";import"./book-open-Cb_QfGzV.js";import"./user-check-_qUhIjGk.js";import"./graduation-cap-jDtqs95h.js";import"./notebook-gQ3sUZu5.js";import"./chart-no-axes-column-increasing-olYAkrKO.js";import"./shield-D5b184Ay.js";import"./label-CmDDlX5C.js";import"./alert-BalDc8V_.js";import"./index-9tcP2Xg6.js";import"./index-H9SyZF4B.js";import"./check-DmE6gQZb.js";function fs({user:b,users:h,filters:n,roles:Q,currentAcademicLevel:a,sections:N=[],specificYearLevels:D={},tracks:W=[],strands:V=[],departments:X=[],courses:T=[]}){const[O,Z]=r.useState(n.search||""),[P,z]=r.useState(null),[U,E]=r.useState(!1),[l,k]=r.useState(""),[i,y]=r.useState(""),[d,I]=r.useState(""),[x,M]=r.useState(""),[c,F]=r.useState(""),[m,R]=r.useState(""),{errors:L}=ce().props,B=r.useRef(null),{addToast:g}=he();if(!b)return e.jsx("div",{children:"Loading..."});const A=r.useMemo(()=>a==="senior_highschool"&&d?V.filter(s=>s.track_id.toString()===d):V,[a,d,V]),ee=r.useMemo(()=>a==="college"&&c?T.filter(s=>s.department_id.toString()===c):T,[a,c,T]),se=r.useMemo(()=>a==="elementary"||a==="junior_highschool"?l&&N.length>0?N.filter(s=>s.specific_year_level===l):N:a==="senior_highschool"?d&&x&&l?N.filter(s=>{var t,o;return((t=s.track_id)==null?void 0:t.toString())===d&&((o=s.strand_id)==null?void 0:o.toString())===x&&s.specific_year_level===l}):[]:a==="college"?c&&m&&l?N.filter(s=>{var t,o;return((t=s.department_id)==null?void 0:t.toString())===c&&((o=s.course_id)==null?void 0:o.toString())===m&&s.specific_year_level===l}):[]:N,[a,l,d,x,c,m,N]);r.useEffect(()=>{a==="senior_highschool"&&(M(""),y(""))},[d,a]),r.useEffect(()=>{a==="senior_highschool"&&y("")},[x,a]),r.useEffect(()=>{a==="college"&&(R(""),y(""))},[c,a]),r.useEffect(()=>{a==="college"&&y("")},[m,a]),r.useEffect(()=>{y("")},[l]);const H=()=>{w.get(route("admin.students.index"),{search:O},{preserveState:!0,replace:!0})},v=s=>{const t=n.sort_direction||"desc",o=n.sort_by===s&&t==="desc"?"asc":"desc";w.get(route("admin.students.index"),{...n,sort_by:s,sort_direction:o},{preserveState:!0,replace:!0})},ae=s=>{confirm("Are you sure you want to delete this student? This action cannot be undone.")&&w.delete(route("admin.students.destroy",s),{onSuccess:()=>{w.reload()},onError:t=>{console.error("Delete failed:",t)}})},te=s=>{z(s)},le=()=>{a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?E(!0):$()},re=()=>{if(!i&&(a==="elementary"||a==="junior_highschool")){g("Please select a grade level and section first.","error");return}if(!i&&a==="senior_highschool"){g("Please select track, strand, and section first.","error");return}if(!i&&a==="college"){g("Please select department, course, year level, and section first.","error");return}const s={};a&&(s.academic_level=a),l&&(s.specific_year_level=l),d&&(s.track_id=d),x&&(s.strand_id=x),c&&(s.department_id=c),m&&(s.course_id=m),i&&(s.section_id=i),window.location.href=route("admin.students.template",s),g("Downloading CSV template...","success")},$=()=>{const s=a?{academic_level:a}:{};window.location.href=route("admin.students.template",s)},oe=()=>{var s;if(!i&&(a==="elementary"||a==="junior_highschool")){g("Please select a grade level and section first.","error");return}if(!i&&a==="senior_highschool"){g("Please select track, strand, and section first.","error");return}if(!i&&a==="college"){g("Please select department, course, year level, and section first.","error");return}(s=B.current)==null||s.click()},ne=s=>{var K;const t=(K=s.target.files)==null?void 0:K[0];if(!t)return;const o=new FormData;o.append("file",t),a&&o.append("academic_level",a),l&&o.append("specific_year_level",l),d&&o.append("track_id",d),x&&o.append("strand_id",x),c&&o.append("department_id",c),m&&o.append("course_id",m),i&&o.append("section_id",i),w.post(route("admin.students.upload"),o,{forceFormData:!0,onSuccess:()=>{g("Students CSV uploaded successfully.","success"),E(!1),k(""),y(""),I(""),M(""),F(""),R(""),w.reload()},onError:de=>{console.error("CSV upload failed:",de),g("CSV upload failed. Please check the file format.","error")},preserveScroll:!0}),s.target.value=""},ie=s=>{switch(s){case"admin":return"default";case"registrar":case"teacher":case"instructor":case"adviser":case"chairperson":case"principal":return"secondary";case"student":case"parent":return"outline";default:return"outline"}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(pe,{user:b}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(xe,{user:b}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[a?a.charAt(0).toUpperCase()+a.slice(1).replace("_"," "):"Students"," Management"]}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Create, manage, and monitor ",a?a.replace("_"," "):"student"," accounts in the school system."]})]}),e.jsx(Y,{children:e.jsx(q,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:flex-wrap lg:items-center lg:justify-between",children:[e.jsx("div",{className:"flex flex-col gap-3 md:flex-row md:flex-wrap md:items-center flex-1 min-w-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(je,{placeholder:"Search students...",value:O,onChange:s=>Z(s.target.value),onKeyDown:s=>s.key==="Enter"&&H(),className:"w-64"}),e.jsx(p,{onClick:H,variant:"outline",children:e.jsx(be,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end w-full lg:w-auto",children:[a&&e.jsx(C,{href:route(`admin.students.${a.replace("_","-")}.create`),children:e.jsxs(p,{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Add New ",a.charAt(0).toUpperCase()+a.slice(1).replace("_"," ")]})}),e.jsx("input",{type:"file",accept:".csv,text/csv",ref:B,className:"hidden",onChange:ne}),e.jsxs(p,{variant:"outline",className:"flex items-center gap-2",onClick:le,children:[e.jsx(G,{className:"h-4 w-4"}),a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?"CSV Upload Manager":"Upload CSV"]}),!(a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college")&&e.jsxs(p,{variant:"outline",className:"flex items-center gap-2",onClick:$,children:[e.jsx(J,{className:"h-4 w-4"}),"Download Template"]})]})]})})}),e.jsxs(Y,{children:[e.jsx(me,{children:e.jsxs(ge,{children:[a?a.charAt(0).toUpperCase()+a.slice(1).replace("_"," "):"Students"," (",h.total," total)"]})}),e.jsxs(q,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>v("name"),children:["Name",n.sort_by==="name"&&e.jsx("span",{className:"ml-1",children:n.sort_direction==="desc"?"↓":"↑"})]}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>v("student_number"),children:["Student ID",n.sort_by==="student_number"&&e.jsx("span",{className:"ml-1",children:n.sort_direction==="desc"?"↓":"↑"})]}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>v("email"),children:["Email",n.sort_by==="email"&&e.jsx("span",{className:"ml-1",children:n.sort_direction==="desc"?"↓":"↑"})]}),e.jsx("th",{className:"p-3 text-left",children:"Role"}),e.jsx("th",{className:"p-3 text-left",children:"Parents"}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>v("created_at"),children:["Created",n.sort_by==="created_at"&&e.jsx("span",{className:"ml-1",children:n.sort_direction==="desc"?"↓":"↑"})]}),e.jsx("th",{className:"p-3 text-left",children:"Last Login"}),e.jsx("th",{className:"p-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:h.data.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"p-3 font-medium",children:s.name}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.student_number||"—"}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.email}),e.jsx("td",{className:"p-3",children:e.jsx(fe,{variant:ie(s.user_role),children:Q[s.user_role]||s.user_role})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.parents&&s.parents.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.parents.slice(0,2).map(t=>e.jsx(C,{href:route("admin.parents.show",t.id),className:"underline",children:t.name},t.id)),s.parents.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.parents.length-2," more"]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"No parents linked"})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString():"Never"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(C,{href:route("admin.students.show",s.id),children:e.jsx(p,{variant:"outline",size:"sm",children:e.jsx(ve,{className:"h-3 w-3"})})}),e.jsx(C,{href:route("admin.students.edit",s.id),children:e.jsx(p,{variant:"outline",size:"sm",children:e.jsx(De,{className:"h-3 w-3"})})}),e.jsx(p,{variant:"outline",size:"sm",onClick:()=>te(s),children:e.jsx(Ve,{className:"h-3 w-3"})}),s.id!==b.id&&e.jsx(p,{variant:"destructive",size:"sm",onClick:()=>ae(s.id),children:e.jsx(Te,{className:"h-3 w-3"})})]})})]},s.id))})]})}),h.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",h.from," to ",h.to," of ",h.total," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h.current_page>1&&e.jsx(C,{href:route("admin.students.index",{...n,page:h.current_page-1}),children:e.jsx(p,{variant:"outline",size:"sm",children:"Previous"})}),e.jsxs("span",{className:"text-sm",children:["Page ",h.current_page," of ",h.last_page]}),h.current_page<h.last_page&&e.jsx(C,{href:route("admin.students.index",{...n,page:h.current_page+1}),children:e.jsx(p,{variant:"outline",size:"sm",children:"Next"})})]})]})]})]})]})})]}),P&&e.jsx(ue,{user:P,isOpen:!!P,onClose:()=>z(null),errors:L}),e.jsx(Se,{open:U,onOpenChange:E,children:e.jsxs(_e,{className:"sm:max-w-[500px]",children:[e.jsxs(Ne,{children:[e.jsx(ye,{children:"CSV Upload Manager"}),e.jsx(Ce,{children:a==="senior_highschool"?"Select the track, strand, year level, and section first, then download the template and upload your CSV file.":a==="college"?"Select the department, course, year level, and section first, then download the template and upload your CSV file.":"Select the grade level and section first, then download the template and upload your CSV file."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[(a==="elementary"||a==="junior_highschool")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Grade Level"}),e.jsxs(f,{value:l,onValueChange:k,children:[e.jsx(j,{children:e.jsx(u,{placeholder:"Select grade level"})}),e.jsx(S,{children:Object.entries(D).map(([s,t])=>e.jsx(_,{value:s,children:t},s))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Track"}),e.jsxs(f,{value:d,onValueChange:I,children:[e.jsx(j,{children:e.jsx(u,{placeholder:"Select track"})}),e.jsx(S,{children:W.map(s=>e.jsx(_,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Strand"}),e.jsxs(f,{value:x,onValueChange:M,disabled:!d,children:[e.jsx(j,{children:e.jsx(u,{placeholder:d?"Select strand":"Select track first"})}),e.jsx(S,{children:A.map(s=>e.jsx(_,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(f,{value:l,onValueChange:k,disabled:!x,children:[e.jsx(j,{children:e.jsx(u,{placeholder:x?"Select year level":"Select strand first"})}),e.jsx(S,{children:Object.entries(D).map(([s,t])=>e.jsx(_,{value:s,children:t},s))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Department"}),e.jsxs(f,{value:c,onValueChange:F,children:[e.jsx(j,{children:e.jsx(u,{placeholder:"Select department"})}),e.jsx(S,{children:X.map(s=>e.jsx(_,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Course"}),e.jsxs(f,{value:m,onValueChange:R,disabled:!c,children:[e.jsx(j,{children:e.jsx(u,{placeholder:c?"Select course":"Select department first"})}),e.jsx(S,{children:ee.map(s=>e.jsx(_,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(f,{value:l,onValueChange:k,disabled:!m,children:[e.jsx(j,{children:e.jsx(u,{placeholder:m?"Select year level":"Select course first"})}),e.jsx(S,{children:Object.entries(D).map(([s,t])=>e.jsx(_,{value:s,children:t},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Section"}),e.jsxs(f,{value:i,onValueChange:y,disabled:a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?!l:!x,children:[e.jsx(j,{children:e.jsx(u,{placeholder:a==="elementary"||a==="junior_highschool"?l?"Select section":"Select grade level first":a==="senior_highschool"||a==="college"?l?"Select section":"Select year level first":x?"Select section":"Select track and strand first"})}),e.jsx(S,{children:se.map(s=>e.jsx(_,{value:s.id.toString(),children:s.name},s.id))})]})]}),i&&e.jsxs("div",{className:"rounded-md bg-blue-50 p-3 text-sm text-blue-900 dark:bg-blue-950 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"Next Steps:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'Click "Download Template" to get the CSV file'}),e.jsx("li",{children:"Fill in student information (do NOT modify Student ID column)"}),e.jsx("li",{children:'Click "Upload CSV" to import the students'})]})]})]}),e.jsxs(we,{className:"flex gap-2",children:[e.jsxs(p,{variant:"outline",onClick:re,disabled:!i,children:[e.jsx(J,{className:"h-4 w-4 mr-2"}),"Download Template"]}),e.jsxs(p,{onClick:oe,disabled:!i,children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),"Upload CSV"]})]})]})})]})}export{fs as default};
