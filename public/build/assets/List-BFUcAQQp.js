import{r,K as pe,u as ge,j as e,$ as w,S as b}from"./app-DdfDr2dw.js";import{H as je}from"./header-0OmniU0w.js";import{S as fe}from"./sidebar-gFLW4kCL.js";import{C as W,a as J,b as ue,c as Se}from"./card-DcJswE_a.js";import{B as Ne}from"./badge-Dje52MJ0.js";import{B as g}from"./button-Jl-i1Srl.js";import{I as Q}from"./input-DE_ShS_g.js";import{P as ye}from"./PasswordResetModal-DfV3o88a.js";import{S as f,a as u,b as S,c as N,d as y}from"./select-Gz7_yFid.js";import{D as _e,b as Ce,c as we,d as be,e as ke,f as ve}from"./dialog-ix5qset3.js";import{S as De}from"./search-2oeNjrEe.js";import{P as Ve}from"./plus-C7AoxBUv.js";import{U as X}from"./upload-C679s-Co.js";import{D as Z}from"./download-tFPEY0z0.js";import{E as Pe}from"./eye-Duc20laH.js";import{S as Te}from"./square-pen-Czay9h6R.js";import{R as Ee}from"./rotate-ccw-BZ1nREl9.js";import{T as Ye}from"./trash-2-DsGbPdWu.js";/* empty css            */import"./dropdown-menu-DMHLd492.js";import"./Combination-D09KndP7.js";import"./index-Da5TRz4C.js";import"./separator-d5fs75Mb.js";import"./chevron-down-BO1CcjDB.js";import"./users-Coq7_ZTr.js";import"./chevron-right-BSDF5aRH.js";import"./crown-BAuu2TPJ.js";import"./building-2-uqAKn25H.js";import"./user-cog-VH7y5fV6.js";import"./book-open-Cr-oIn45.js";import"./user-check-BMev7T1V.js";import"./graduation-cap-DuYg80FC.js";import"./notebook-BboTc866.js";import"./chart-no-axes-column-increasing-CQ4tZfgQ.js";import"./shield-BX_NAm_v.js";import"./label-DwgdJFny.js";import"./alert-C1Khxdt1.js";import"./index-wXXfOe69.js";import"./index-Da_j2Urw.js";import"./check-C8ZLgws9.js";function Ns({user:k,users:h,filters:i,roles:U,currentAcademicLevel:a,sections:_=[],specificYearLevels:V={},tracks:L=[],strands:P=[],departments:A=[],courses:T=[]}){const[F,ee]=r.useState(i.search||""),[E,z]=r.useState(null),[se,Y]=r.useState(!1),[l,v]=r.useState(""),[n,C]=r.useState(""),[M,I]=r.useState(""),[d,B]=r.useState(""),[x,R]=r.useState(""),[c,H]=r.useState(""),[j,O]=r.useState(""),{errors:ae,flash:m}=pe().props,$=r.useRef(null),{addToast:p}=ge();if(!k)return e.jsx("div",{children:"Loading..."});r.useEffect(()=>{m!=null&&m.success&&p(m.success,"success"),m!=null&&m.warning&&p(m.warning,"warning"),m!=null&&m.error&&p(m.error,"error")},[m]);const te=r.useMemo(()=>a==="senior_highschool"&&d?P.filter(s=>s.track_id.toString()===d):P,[a,d,P]),le=r.useMemo(()=>a==="college"&&c?T.filter(s=>s.department_id.toString()===c):T,[a,c,T]),re=r.useMemo(()=>a==="elementary"||a==="junior_highschool"?l&&_.length>0?_.filter(s=>s.specific_year_level===l):_:a==="senior_highschool"?d&&x&&l?_.filter(s=>{var t,o;return((t=s.track_id)==null?void 0:t.toString())===d&&((o=s.strand_id)==null?void 0:o.toString())===x&&s.specific_year_level===l}):[]:a==="college"?c&&j&&l?_.filter(s=>{var t,o;return((t=s.department_id)==null?void 0:t.toString())===c&&((o=s.course_id)==null?void 0:o.toString())===j&&s.specific_year_level===l}):[]:_,[a,l,d,x,c,j,_]);r.useEffect(()=>{a==="senior_highschool"&&(R(""),C(""))},[d,a]),r.useEffect(()=>{a==="senior_highschool"&&C("")},[x,a]),r.useEffect(()=>{a==="college"&&(O(""),C(""))},[c,a]),r.useEffect(()=>{a==="college"&&C("")},[j,a]),r.useEffect(()=>{C("")},[l]);const G=()=>{b.get(route("admin.students.index"),{search:F},{preserveState:!0,replace:!0})},D=s=>{const t=i.sort_direction||"desc",o=i.sort_by===s&&t==="desc"?"asc":"desc";b.get(route("admin.students.index"),{...i,sort_by:s,sort_direction:o},{preserveState:!0,replace:!0})},oe=s=>{confirm("Are you sure you want to delete this student? This action cannot be undone.")&&b.delete(route("admin.students.destroy",s),{onSuccess:()=>{b.reload()},onError:t=>{console.error("Delete failed:",t)}})},ie=s=>{z(s)},ne=()=>{a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?Y(!0):K()},de=()=>{if(!n&&(a==="elementary"||a==="junior_highschool")){p("Please select a grade level and section first.","error");return}if(!n&&a==="senior_highschool"){p("Please select track, strand, and section first.","error");return}if(!n&&a==="college"){p("Please select department, course, year level, and section first.","error");return}const s={};a&&(s.academic_level=a),l&&(s.specific_year_level=l),d&&(s.track_id=d),x&&(s.strand_id=x),c&&(s.department_id=c),j&&(s.course_id=j),n&&(s.section_id=n),window.location.href=route("admin.students.template",s),p("Downloading CSV template...","success")},K=()=>{const s=a?{academic_level:a}:{};window.location.href=route("admin.students.template",s)},ce=()=>{var s;if(!n&&(a==="elementary"||a==="junior_highschool")){p("Please select a grade level and section first.","error");return}if(!n&&a==="senior_highschool"){p("Please select track, strand, and section first.","error");return}if(!n&&a==="college"){p("Please select department, course, year level, and section first.","error");return}(s=$.current)==null||s.click()},he=s=>{var q;const t=(q=s.target.files)==null?void 0:q[0];if(!t)return;const o=new FormData;o.append("file",t),a&&o.append("academic_level",a),l&&o.append("specific_year_level",l),d&&o.append("track_id",d),x&&o.append("strand_id",x),c&&o.append("department_id",c),j&&o.append("course_id",j),n&&o.append("section_id",n),M&&o.append("school_year",M),b.post(route("admin.students.upload"),o,{forceFormData:!0,onSuccess:()=>{p("Students CSV uploaded successfully.","success"),Y(!1),v(""),C(""),I(""),B(""),R(""),H(""),O(""),b.reload()},onError:me=>{console.error("CSV upload failed:",me),p("CSV upload failed. Please check the file format.","error")},preserveScroll:!0}),s.target.value=""},xe=s=>{switch(s){case"admin":return"default";case"registrar":case"teacher":case"instructor":case"adviser":case"chairperson":case"principal":return"secondary";case"student":case"parent":return"outline";default:return"outline"}};return e.jsxs("div",{className:"flex h-screen bg-gray-100 dark:bg-gray-900",children:[e.jsx(fe,{user:k}),e.jsxs("div",{className:"flex flex-1 flex-col overflow-hidden",children:[e.jsx(je,{user:k}),e.jsx("main",{className:"flex-1 overflow-y-auto bg-gray-100 p-4 md:p-6 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-gray-100",children:[a?a.charAt(0).toUpperCase()+a.slice(1).replace("_"," "):"Students"," Management"]}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400",children:["Create, manage, and monitor ",a?a.replace("_"," "):"student"," accounts in the school system."]})]}),e.jsx(W,{children:e.jsx(J,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-3 lg:flex-row lg:flex-wrap lg:items-center lg:justify-between",children:[e.jsx("div",{className:"flex flex-col gap-3 md:flex-row md:flex-wrap md:items-center flex-1 min-w-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(Q,{placeholder:"Search students...",value:F,onChange:s=>ee(s.target.value),onKeyDown:s=>s.key==="Enter"&&G(),className:"w-64"}),e.jsx(g,{onClick:G,variant:"outline",children:e.jsx(De,{className:"h-4 w-4"})})]})}),e.jsxs("div",{className:"flex flex-wrap gap-2 justify-end w-full lg:w-auto",children:[a&&e.jsx(w,{href:route(`admin.students.${a.replace("_","-")}.create`),children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4"}),"Add New ",a.charAt(0).toUpperCase()+a.slice(1).replace("_"," ")]})}),e.jsx("input",{type:"file",accept:".csv,text/csv",ref:$,className:"hidden",onChange:he}),e.jsxs(g,{variant:"outline",className:"flex items-center gap-2",onClick:ne,children:[e.jsx(X,{className:"h-4 w-4"}),a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?"CSV Upload Manager":"Upload CSV"]}),!(a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college")&&e.jsxs(g,{variant:"outline",className:"flex items-center gap-2",onClick:K,children:[e.jsx(Z,{className:"h-4 w-4"}),"Download Template"]})]})]})})}),e.jsxs(W,{children:[e.jsx(ue,{children:e.jsxs(Se,{children:[a?a.charAt(0).toUpperCase()+a.slice(1).replace("_"," "):"Students"," (",h.total," total)"]})}),e.jsxs(J,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>D("name"),children:["Name",i.sort_by==="name"&&e.jsx("span",{className:"ml-1",children:i.sort_direction==="desc"?"↓":"↑"})]}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>D("student_number"),children:["Student ID",i.sort_by==="student_number"&&e.jsx("span",{className:"ml-1",children:i.sort_direction==="desc"?"↓":"↑"})]}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>D("email"),children:["Email",i.sort_by==="email"&&e.jsx("span",{className:"ml-1",children:i.sort_direction==="desc"?"↓":"↑"})]}),e.jsx("th",{className:"p-3 text-left",children:"Role"}),e.jsx("th",{className:"p-3 text-left",children:"Parents"}),e.jsxs("th",{className:"cursor-pointer p-3 text-left hover:bg-gray-50 dark:hover:bg-gray-800",onClick:()=>D("created_at"),children:["Created",i.sort_by==="created_at"&&e.jsx("span",{className:"ml-1",children:i.sort_direction==="desc"?"↓":"↑"})]}),e.jsx("th",{className:"p-3 text-left",children:"Last Login"}),e.jsx("th",{className:"p-3 text-left",children:"Actions"})]})}),e.jsx("tbody",{children:h.data.map(s=>e.jsxs("tr",{className:"border-b hover:bg-gray-50 dark:hover:bg-gray-800",children:[e.jsx("td",{className:"p-3 font-medium",children:s.name}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.student_number||"—"}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.email}),e.jsx("td",{className:"p-3",children:e.jsx(Ne,{variant:xe(s.user_role),children:U[s.user_role]||s.user_role})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.parents&&s.parents.length>0?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.parents.slice(0,2).map(t=>e.jsx(w,{href:route("admin.parents.show",t.id),className:"underline",children:t.name},t.id)),s.parents.length>2&&e.jsxs("span",{className:"text-xs text-gray-500",children:["+",s.parents.length-2," more"]})]}):e.jsx("span",{className:"text-xs text-gray-400",children:"No parents linked"})}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:new Date(s.created_at).toLocaleDateString()}),e.jsx("td",{className:"p-3 text-gray-600 dark:text-gray-400",children:s.last_login_at?new Date(s.last_login_at).toLocaleDateString():"Never"}),e.jsx("td",{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{href:route("admin.students.show",s.id),children:e.jsx(g,{variant:"outline",size:"sm",children:e.jsx(Pe,{className:"h-3 w-3"})})}),e.jsx(w,{href:route("admin.students.edit",s.id),children:e.jsx(g,{variant:"outline",size:"sm",children:e.jsx(Te,{className:"h-3 w-3"})})}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>ie(s),children:e.jsx(Ee,{className:"h-3 w-3"})}),s.id!==k.id&&e.jsx(g,{variant:"destructive",size:"sm",onClick:()=>oe(s.id),children:e.jsx(Ye,{className:"h-3 w-3"})})]})})]},s.id))})]})}),h.last_page>1&&e.jsxs("div",{className:"mt-4 flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Showing ",h.from," to ",h.to," of ",h.total," results"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[h.current_page>1&&e.jsx(w,{href:route("admin.students.index",{...i,page:h.current_page-1}),children:e.jsx(g,{variant:"outline",size:"sm",children:"Previous"})}),e.jsxs("span",{className:"text-sm",children:["Page ",h.current_page," of ",h.last_page]}),h.current_page<h.last_page&&e.jsx(w,{href:route("admin.students.index",{...i,page:h.current_page+1}),children:e.jsx(g,{variant:"outline",size:"sm",children:"Next"})})]})]})]})]})]})})]}),E&&e.jsx(ye,{user:E,isOpen:!!E,onClose:()=>z(null),errors:ae}),e.jsx(_e,{open:se,onOpenChange:Y,children:e.jsxs(Ce,{className:"sm:max-w-[500px]",children:[e.jsxs(we,{children:[e.jsx(be,{children:"CSV Upload Manager"}),e.jsx(ke,{children:a==="senior_highschool"?"Select the track, strand, year level, and section first, then download the template and upload your CSV file.":a==="college"?"Select the department, course, year level, and section first, then download the template and upload your CSV file.":"Select the grade level and section first, then download the template and upload your CSV file."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[(a==="elementary"||a==="junior_highschool")&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Grade Level"}),e.jsxs(f,{value:l,onValueChange:v,children:[e.jsx(u,{children:e.jsx(S,{placeholder:"Select grade level"})}),e.jsx(N,{children:Object.entries(V).map(([s,t])=>e.jsx(y,{value:s,children:t},s))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Track"}),e.jsxs(f,{value:d,onValueChange:B,children:[e.jsx(u,{children:e.jsx(S,{placeholder:"Select track"})}),e.jsx(N,{children:L.map(s=>e.jsx(y,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Strand"}),e.jsxs(f,{value:x,onValueChange:R,disabled:!d,children:[e.jsx(u,{children:e.jsx(S,{placeholder:d?"Select strand":"Select track first"})}),e.jsx(N,{children:te.map(s=>e.jsx(y,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="senior_highschool"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(f,{value:l,onValueChange:v,disabled:!x,children:[e.jsx(u,{children:e.jsx(S,{placeholder:x?"Select year level":"Select strand first"})}),e.jsx(N,{children:Object.entries(V).map(([s,t])=>e.jsx(y,{value:s,children:t},s))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Department"}),e.jsxs(f,{value:c,onValueChange:H,children:[e.jsx(u,{children:e.jsx(S,{placeholder:"Select department"})}),e.jsx(N,{children:A.map(s=>e.jsx(y,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Course"}),e.jsxs(f,{value:j,onValueChange:O,disabled:!c,children:[e.jsx(u,{children:e.jsx(S,{placeholder:c?"Select course":"Select department first"})}),e.jsx(N,{children:le.map(s=>e.jsx(y,{value:s.id.toString(),children:s.name},s.id))})]})]}),a==="college"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Year Level"}),e.jsxs(f,{value:l,onValueChange:v,disabled:!j,children:[e.jsx(u,{children:e.jsx(S,{placeholder:j?"Select year level":"Select course first"})}),e.jsx(N,{children:Object.entries(V).map(([s,t])=>e.jsx(y,{value:s,children:t},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Section"}),e.jsxs(f,{value:n,onValueChange:C,disabled:a==="elementary"||a==="junior_highschool"||a==="senior_highschool"||a==="college"?!l:!x,children:[e.jsx(u,{children:e.jsx(S,{placeholder:a==="elementary"||a==="junior_highschool"?l?"Select section":"Select grade level first":a==="senior_highschool"||a==="college"?l?"Select section":"Select year level first":x?"Select section":"Select track and strand first"})}),e.jsx(N,{children:re.map(s=>e.jsx(y,{value:s.id.toString(),children:s.name},s.id))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"School Year"}),e.jsx(Q,{type:"text",placeholder:"e.g., 2024-2025",value:M,onChange:s=>I(s.target.value)}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-3",children:[e.jsx("p",{className:"text-sm text-blue-800 font-medium mb-1",children:"School Year Format Guide:"}),e.jsxs("ul",{className:"text-xs text-blue-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Format: YYYY-YYYY (e.g., 2024-2025, 2025-2026)"}),e.jsx("li",{children:"First year must be one less than second year"}),e.jsx("li",{children:"Used to track student enrollment for specific academic year"}),e.jsx("li",{children:"Will be included in the CSV template"})]})]})]}),n&&e.jsxs("div",{className:"rounded-md bg-blue-50 p-3 text-sm text-blue-900 dark:bg-blue-950 dark:text-blue-100",children:[e.jsx("p",{className:"font-medium mb-1",children:"Next Steps:"}),e.jsxs("ol",{className:"list-decimal list-inside space-y-1",children:[e.jsx("li",{children:'Click "Download Template" to get the CSV file'}),e.jsx("li",{children:'Click "Upload CSV" to import the students'})]})]})]}),e.jsxs(ve,{className:"flex gap-2",children:[e.jsxs(g,{variant:"outline",onClick:de,disabled:!n,children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Download Template"]}),e.jsxs(g,{onClick:ce,disabled:!n,children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),"Upload CSV"]})]})]})})]})}export{Ns as default};
